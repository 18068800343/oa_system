<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.ldxx.dao.FbContractOverDao" >
  <insert id="addFbContractOver" parameterType="FbContractOver">
  	insert into fb_contract_over (fco_id,prj_code, cj_contract, cj_name,fb_money,fb_end_money,
      fb_contract,fb_name,settlement_time, work_info,qianqi_jy_money,is_kouchu)
    values (#{fb.fcoId},#{fb.prjCode},#{fb.cjContract}, #{fb.cjName},#{fb.fbMoney},#{fb.fbEndMoney},#{fb.fbContract},
       #{fb.fbName}, #{fb.settlementTime}, #{fb.workInfo}, #{fb.qianqijyMoney}, #{fb.isKouchu}
      )
  </insert>
  
  <select id="selectFbContractOver" resultType="FbContractOver">
  	select a.* from fb_contract_over as a 
  	left join mode_status as b on a.fco_id=b.mode_id
  	where b.status=#{state}
  </select>
  
   <select id="selectFbContractOver2" resultType="FbContractOver">
  	select a.*,f.StarterName as starterName,b.status as status
  	FROM fb_contract_over as a 
  	left join mode_status as b on a.fco_id=b.mode_id
  	LEFT JOIN (SELECT mode_id,StarterName from (SELECT * from flowhistroy order by do_date ASC) f 
					LEFT JOIN fb_contract_over a ON a.fco_id=f.mode_id  GROUP BY mode_id )  AS  f on a.fco_id=f.mode_id
  	where (b.status=1 or b.status=2 or b.status=3)
  </select>
  
  <select id="selectFbContractOverById" resultType="FbContractOver">
  	SELECT * FROM fb_contract_over where fco_id=#{id}
  </select>
  
  <update id="updateFbContractOver" parameterType="FbContractOver">
  	update fb_contract_over set 
  		fb_contract=#{fb.fbContract},
  		fb_name=#{fb.fbName},
  		fb_money=#{fb.fbMoney},
  		fb_end_money=#{fb.fbEndMoney},
  		cj_contract=#{fb.cjContract},
  		cj_name=#{fb.cjName},
  		prj_code=#{fb.prjCode},
  		settlement_time=#{fb.settlementTime},
  		work_info=#{fb.workInfo},
  		qianqi_jy_money=#{fb.qianqijyMoney},
  		is_kouchu=#{fb.isKouchu}
  	where fco_id=#{fb.fcoId}
  </update>
  
  <select id="selectFbJsMoneyByNo" resultType="Double"> 
  	select IFNULL(sum(fb_end_money),0) from fb_contract_over as a
  	left join mode_status as b on a.fco_id=b.mode_id
  	where b.status=2 and a.prj_code=#{no}
  </select>
  
  <select id="selectFbJsByNo" resultType="FbContractOver">
  	select * from fb_contract_over a
  	left join mode_status as b on a.fco_id=b.mode_id
  	where b.status=2 and a.prj_code=#{no}
  </select>
  
</mapper>