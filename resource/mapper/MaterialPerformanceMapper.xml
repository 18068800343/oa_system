<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.ldxx.dao.MaterialPerformanceDao">
	<select id="selectmaterialPerformanceByStatus" resultType="clfbCgcontractPerformance">
		select *,c.cc_name from clfb_cgcontract_performance  a
		left join mode_status m on m.mode_id=a.p_id
		left join consociation_company c on c.cc_id=a.contract_yi 
		where m.status=#{status} and a.history=1
	</select>
	<select id="pNocount" resultType="int">
		select count(1) from (select distinct p_no from clfb_cgcontract_performance) as a
	</select>
	<insert id="addmaterialPerformanceSave">
		insert into clfb_cgcontract_performance(p_id,p_no,cg_contract,cg_no,cj_contract,cj_no,
		task_no,prj_person,contract_yi,fb_person,contract_money,provisional_money,settlement_money,
		settlement_desc,accumulative_payment_money,performance_grade,performance_desc,make_time,history)
		values(#{c.pId},#{c.pNo},#{c.cgContract},#{c.cgNo},#{c.cjContract},#{c.cjNo},#{c.taskNo},#{c.prjPerson},#{c.contractYi},
		#{c.fbPerson},#{c.contractMoney},#{c.provisionalMoney},#{c.settlementMoney},#{c.settlementDesc},#{c.accumulativePaymentMoney},#{c.performanceGrade},#{c.performanceDesc},now(),1)
	</insert>
	<update id="updateHistoryById">
		update clfb_cgcontract_performance set history=0 where p_id=#{pId}
	</update>
	<select id="selectHistoryByNo" resultType="clfbCgcontractPerformance">
		select *,c.cc_name from clfb_cgcontract_performance a
		left join consociation_company c on c.cc_id=a.contract_yi 
		where p_no=#{no} and history=0
	</select>
</mapper>