<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.ldxx.dao.BudgetFpplicationFormDao" >
	<insert id="saveBudge" parameterType="BudgetFpplicationForm">
		insert into budget_fpplication_form(bf_id,prj_id,task_no,prj_unit,budget_date,declarer,make_time,state) values
			(#{budge.bfId},#{budge.prjId},#{budge.taskNo },#{budge.prjUnit},#{budge.budgetDate},#{budge.declarer},#{budge.makeTime},#{budge.state})
	</insert>
	<delete id="deleteBudgeById" parameterType="String">
		delete from budget_fpplication_form where bf_id=#{id}
	</delete>
	<update id="updateBudge" parameterType="BudgetFpplicationForm">
		update budget_fpplication_form 
			set prj_id=#{budge.prjId},
				task_no =#{budge.taskNo},
				prj_unit=#{budge.prjUnit},
				budget_date=#{budge.budgetDate},
				declarer=#{budge.declarer},
				make_time=#{budge.makeTime},
				state=#{budge.state}
			where bf_id=#{budge.bfId}
	</update>
	<select id="selectBudgeByStatus" parameterType="String" resultType="BudgetFpplicationForm">
		select b.*,t.prj_name,c.cc_name from budget_fpplication_form b 
			left join task t on b.prj_id=t.prj_id
			left join mode_status m on b.bf_id=m.mode_id 
			left join consociation_company c on t.prj_owner_unit=c.cc_id
			where m.status=#{status} and b.state=1
	</select>
	<select id="selectBudgeById" resultType="BudgetFpplicationForm">
		select b.*,t.prj_name from budget_fpplication_form b
			left join task t on b.prj_id=t.prj_id
			where bf_id=#{id} 
	</select>
	<select id="selectBudgeHistory" resultType="BudgetFpplicationForm">
		select b.*,t.prj_name from budget_fpplication_form b
			left join task t on b.prj_id=t.prj_id
			where task_no=#{taskNo} and state=0
	</select>
	<update id="changeStateById" parameterType="String">
		update budget_fpplication_form  set state=0 where bf_id=#{bfId}
	</update>
</mapper>