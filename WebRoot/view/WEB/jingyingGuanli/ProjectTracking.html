<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="../../font2/iconfont.css">
    <link rel="stylesheet" href="../../font3/iconfont.css">
	<link href="../../style/bootstrap.min.css" rel="stylesheet">
    <link href="../../style/style.css" rel="stylesheet">
    <link href="../../toastr/toastr.css" rel="stylesheet">
    <link rel="stylesheet" href="../../style/jquery.dataTables.min.css">
    <link rel="stylesheet" href="../../style/jquery-editable-select.css">
    <style lang="">
        .UpperPart{
            display: flex;
            justify-content:space-between;
            border-bottom: 1px solid #ccc;
            padding-bottom: 12px;
        }
        .selected{
            background: rgba(247, 161, 3,0.2);
        }
        #mainContent th{
            cursor: pointer;
        }
        .lookhetong a{
            color: orange;
        }
    </style>
</head>
<body>
    
    <!-- 面包屑 -->
    <div class="mianbao">
    	<ul class="breadcrumb">
    		<li><i class="iconfont icon-knowledgebase"></i></li>
            <li>经营管理</li>
			<li class="active">项目跟踪</li>
		</ul>
    </div>

    <div class="zhuti-content">

        <div>
            <!-- Nav tabs -->
            <ul class="nav nav-tabs" role="tablist">
                <li role="presentation" class="active"><a href="#home" aria-controls="home" role="tab" data-toggle="tab">项目跟踪单</a></li>
                <li role="presentation" onclick="initTable2()"><a href="#profile" aria-controls="profile" role="tab" data-toggle="tab">项目跟踪日志</a></li>
            </ul>
            <!-- Tab panes -->
            <div class="tab-content">
                <div role="tabpanel" class="tab-pane active" id="home">
                    <div class="UpperPart">
                            <div class="UpperPartL">
                                
                            </div>
                            <div class="UpperPartR">
                                <button type="button" class="btn btn-primary Pdaa" onclick="openModal()">新建项目跟踪单</button>
                            </div>
<!-- Modal -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="myModal">
    <div class="modal-dialog modal-lg" role="document" style="width:70%;">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>新建项目跟踪单</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form id="new_form" class="form-inline" method="post" enctype="multipart/form-data">
                    	<table class="table table-bordered table-condensed">
                    		<thead>
	                    			<tr>
			                    		<th colspan="4">项目基本信息</th>
			                    	</tr>
	                    		</thead>
	                    		<tr>
	                                <td style="width:15%;">项目名称  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
	                                <td style="width:35%;"><input type="text" style="width:100%;" class="form-control" id="new_prj_name"></td>
	                                <!-- <td style="width:20%;">项目编号</td>
	                                <td style="width:30%;"><input type="text" style="width:70%;" class="form-control" id="new_prj_no"></td> -->
	                            	<td style="width:15%;">项目状态  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
	                                <td style="width:35%;">
	                                    <select id="new_prj_status" class="form-control" style="width:100%;">
	                                        <option value="计划阶段">计划阶段</option>
	                                        <option value="立项阶段">立项阶段</option>
	                                        <option value="拟招标阶段">拟招标阶段</option>
	                                        <option value="招标待发">招标待发</option>
	                                    </select>
	                                </td>
	                            </tr>
	                            <tr>
	                            	<td>项目地址  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
	                                <td>
	                                	<div class="docs-methods">
	                                			<form class="form-inline">
		                                            <div id="distpicker">
		                                                <div class="form-group">
		                                                    <div style="position: relative;">
		                                                        <input id="new_prj_addr" style="width:100%" class="form-control" readonly type="text" value="" data-toggle="city-picker">
		                                                    </div>
		                                                </div>
		                                            </div>
		                                        </form>
		                                    </div>
	                                </td>
	                                <td>业务类型  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
	                                <td>
	                                    <select id="new_business_type" class="form-control" style="width:100%;">
	                                        <option value="JC 检测类">JC 检测</option>
	                                        <option value="XJSG 新建施工">XJSG 新建施工</option>
	                                        <option value="JGSG 加固施工">JGSG 加固施工</option>
	                                        <option value="SJ 设计">SJ 设计</option>
	                                        <option value="JSFW 技术服务">JSFW 技术服务</option>
	                                        <option value="KY 科研项目">KY 科研</option>
	                                        <option value="EPC EPC">EPC EPC</option>
	                                        <option value="QT 其他">QT 其他</option>
	                                    </select>
	                                </td>
	                            </tr>
                    	</table>
                        <table class="table table-bordered table-condensed">
                            	<thead>
	                    			<tr>
			                    		<th colspan="4">业主基本信息</th>
			                    	</tr>
	                    		</thead>
                     <!--  <tr>
                               <td style="width:20%;">项目级别</td>
                                <td style="width:30%;">
                                    <select  id="new_prj_lv" class="form-control" style="width:70%;">
                                        <option value="大型">大型</option>
                                        <option value="中型">中型</option>
                                        <option value="小型">小型</option>
                                        <option value="其它">其它</option>
                                    </select>
                                </td> 
                            </tr>-->
                            <tr>
                            	<td style="width:15%;">业主单位</td>
                                <td style="width:35%;">
                                	<select class="form-control" style="width:100%;" id="yezhudanwei" data-live-search="true"></select>
                                </td>
                                <td style="width:15%;">跟踪部门</td>
                                <td style="width:35%;">
                                    <!-- <select class="form-control selectpicker" style="width:70%;" id="new_department">
                                    </select> -->
                                    <input type="text" style="width:100%;" class="form-control" id="new_department" disabled>
                                </td>
                                <!-- <td style="width:20%;">项目等级</td>
                                <td style="width:30%;">
                                    <select class="form-control" style="width:70%;" id="prj_level">
                                    <option value='0'>小型项目</option>
                                    <option value='1'>中型项目</option>
                                    <option value='2'>大型项目</option>
                                    </select>
                                    <input type="text" style="width:70%;" class="form-control" id="prj_level" >
                                </td> -->
                            </tr>
                            <tr>
                                <td class="jinqianyanse">预估项目规模(元)  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td><input type="text" style="width:100%;" class="form-control" id="new_prj_scale"></td>
                                <td>填报时间  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td><input type="text" style="width:100%;" class="form-control" id="year"></td>
                            </tr>
                            <tr>
                                <td>发包方式</td>
                                <td>
                                    <select class="form-control" style="width:100%;" id="new_isbid">
                                        <option value="直接委托">直接委托</option>
                                        <option value="邀请招标">邀请招标</option>
                                        <option value="公开招标">公开招标</option>
                                    </select>
                                </td>
                                <td>跟踪人</td>
                                <td>
                                    <!-- <select class="form-control" style="width:70%;" id="new_person">
                                    </select> -->
                                    <input type="text" style="width:100%;" class="form-control" id="new_person" disabled>
                                </td>
                            </tr>
                            <tr>
                                <td>项目概况  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td colspan="3"><textarea class="form-control" rows="3" style="width:100%;" id="new_prj_desc"></textarea></td>
                            </tr>
                            <tr>
                                <td>备注</td>
                                <td colspan="3"><textarea class="form-control" rows="3" style="width:100%;" id="new_desc"></textarea></td>
                            </tr>
                            <tr>
                                <td>业务附件 <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td colspan="3" id="add_file"><input name="file" type="file"  class="form-control"></td>
                            </tr>
                        </table>
                        
                        <table class="table table-bordered table-condensed">
                        	<thead>
                        		<tr>
                        			<th colspan="5">添加联系人,联系方式</th>
                        		</tr>
                        	</thead>
                            <tr>
                                <td style="width:15%;">联系人  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td style="width:35%;">
                                    <select class="form-control" style="width:200px;" id="lianxiren">
                                    </select>
                                </td>
                                <td style="width:10%;">联系方式  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td style="width:20%;">
                                    <select class="form-control" style="width:200px;" id="lianxifangshi">
                                    </select>
                                </td>
                                <td style="width:20%;">
	                                <button type="button" style="margin-left: 5px;" class="btn btn-primary"  id="xuanzelianxiren" data-toggle="modal" data-target="#addGuanliren">新建联系人</button>
	                                <button type="button" class="btn btn-info" onclick="addLianxiren(this)">添加</button>
                                </td>
                            </tr>
                        </table>
                        <table class="table table-bordered table-condensed" id="lianxibiaoge">
                            <thead>
                                <tr>
                                    <th colspan="3">添加的联系人,联系方式</th>
                                </tr>
                                <tr>
                                    <th  style="width:15%;">联系人</th>
                                    <th>联系方式</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                
                            </tbody>
                        </table>
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-default" onclick="new_save()">保存</button>
            <button type="button" class="btn btn-success" onclick="new_submit()">提交</button>
        </div>
        </div>
    </div>
</div>
<!-- model结束 -->

<!--选人 modal -->
<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="addGuanliren">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="gridSystemModalLabel">新建联系人,联系方式</h4>
            </div>
            <div class="modal-body">
            
                <div>
                	
                	<table class="table table-bordered table-condensed" >
                		<tr>
                			<td>联系人</td>
                			<td><input type="text" class="form-control" style="width:180px;" id="xinjianlianxiren"></td>
                			<td>联系方式</td>
                			<td><input type="text" class="form-control" style="width:180px;" id="xinjianlianxifangshi"></td>
                		</tr>
                	</table>
              </div>
              
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="saveGuanliren()" data-dismiss="modal">确定</button>
            </div>
        </div>
    </div>
</div>
<!-- 选人 modal结束 --> 

<!-- 修改Modal -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="change">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>修改项目跟踪单</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline" method="post" enctype="multipart/form-data"  id="edit_form">
                        <table class="table table-bordered table-condensed">
                            <tr>
                                <td style="width:15%;">项目名称  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td style="width:35%;"><input type="text" style="width:100%;" class="form-control" id="edit_prj_name"></td>
                                <td style="width:15%;">项目编号</td>
                                <td style="width:35%;"><input type="text" style="width:100%;" class="form-control" id="edit_prj_no"></td>
                            </tr>
                            <tr>
                                <td>项目状态  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                    <select id="edit_prj_status" class="form-control" style="width:100%;">
                                        <option value="计划阶段">计划阶段</option>
                                        <option value="立项阶段">立项阶段</option>
                                        <option value="拟招标阶段">拟招标阶段</option>
                                        <option value="招标待发">招标待发</option>
                                    </select>
                                </td>
                                <td>业务类型  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                    <select id="edit_business_type" class="form-control" style="width:100%;">
                                        <option value="JC 检测类">JC 检测</option>
                                        <option value="XJSG 新建施工">XJSG 新建施工</option>
                                        <option value="JGSG 加固施工">JGSG 加固施工</option>
                                        <option value="SJ 设计">SJ 设计</option>
                                        <option value="JSFW 技术服务">JSFW 技术服务</option>
                                        <option value="KY 科研项目">KY 科研</option>
                                        <option value="EPC EPC">EPC EPC</option>
                                        <option value="QT 其他">QT 其他</option>
                                    </select>
                                </td>
                                <!-- <td style="width:20%;">项目级别</td>
                                <td style="width:30%;">
                                    <select id="edit_prj_lv" class="form-control" style="width:70%;">
                                        <option value="大型">大型</option>
                                        <option value="中型">中型</option>
                                        <option value="小型">小型</option>
                                        <option value="其它">其它</option>
                                    </select>
                                </td> -->
                            </tr>
                            <tr>
                                <td>项目地址  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                    <input type="text" class="form-control" style="width:100%;" id="edit_prj_addr">
                                </td>
                                <td>预估项目规模  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td><input type="text" style="width:100%;" class="form-control" id="edit_prj_scale"></td>
                            </tr>
                            <tr>
                                <td>填报时间  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td><input type="text" style="width:100%;" class="form-control" id="edit_year"></td>
                                <td>跟踪部门  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                    <!-- <select class="form-control" style="width:70%;" id="edit_department">
                                    </select> -->
                                    <input type="text" style="width:100%;" class="form-control" id="edit_department" disabled>
                                </td>
                            </tr>
                            <tr>
                               <!--  <td style="width:20%;">是否投标</td>
                                <td style="width:30%;">
                                    <select class="form-control" style="width:70%;" id="edit_isbid">
                                        <option value="是">是</option>
                                        <option value="否">否</option>
                                    </select>
                                </td> -->
                                <td>发包方式</td>
                                <td>
                                    <select class="form-control" style="width:100%;" id="edit_isbid">
                                        <option value="直接委托">直接委托</option>
                                        <option value="邀请招标">邀请招标</option>
                                        <option value="公开招标">公开招标</option>
                                    </select>
                                </td>
                                <td>跟踪人</td>
                                <td>
                                    <input type="text" style="width:100%;" class="form-control" id="edit_gz_person" disabled>
                                </td>
                            </tr>
                            <tr>
                                <td>项目概况  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td colspan="3"><textarea class="form-control" rows="3" style="width:100%;" id="edit_prj_desc"></textarea></td>
                            </tr>
                            <tr>
                                <td>备注</td>
                                <td colspan="3"><textarea class="form-control" rows="3" style="width:100%;" id="edit_desc"></textarea></td>
                            </tr>
                            <tr id="file_tr">
                                <td>业务附件</td>
                                <td id="file_tr_td" colspan="2"></td>
                                <td id="file_tr_td2"></td>
                            </tr>
                        </table>
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <!-- <button type="button" class="btn btn-success" onclick="edit_save()">保存</button> -->
            <button type="button" class="btn btn-success" onclick="edit_submit()">提交</button>
        </div>
        </div>
    </div>
</div>
<!-- 修改model结束 -->


<!-- 查看Modal -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="look">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>查看项目跟踪单</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline" method="post" enctype="multipart/form-data">
	                    <table class="table table-bordered">
			                    	<thead>
			                    			<tr>
					                    		<th colspan="4">项目基本信息</th>
					                    	</tr>
			                    	</thead>
			                    	<tr>
		                                <td style="width:20%;">项目名称</td>
		                                <td id="look_prj_name" style="width:30%;"></td>
		                                <td style="width:20%;">项目编号</td>
		                                <td id="look_prj_no" style="width:30%;"></td>
		                            </tr>
		                            <tr>
		                                <td>项目状态</td>
		                                <td id="look_prj_status" ></td>
		                                <td>业务类型</td>
		                                <td id="look_business_type" ></td>
		                                <!-- <td>项目级别</td>
		                                <td id="look_prj_lv" ></td> -->
		                            </tr>
		                            <tr>
		                                <td>项目地址</td>
		                                <td id="look_prj_addr"></td>
		                                <td></td>
		                                <td></td>
		                            </tr>
	                   	</table>
                        <table class="table table-bordered table-condensed">
                            <thead>
		                    			<tr>
				                    		<th colspan="4">业主信息</th>
				                    	</tr>
	                    	</thead>
                            <tr>
                                <td>业主单位</td>
                                <td id="look_prj_unit"></td>
                                <td>跟踪部门</td>
                                <td id="look_department"></td>
                                
                            </tr>
                            <tr>
                            	<td  class="jinqianyanse">预估项目规模(元)</td>
                                <td id="look_prj_scale"></td>
                                <td>填报时间</td>
                                <td id="look_year"></td>
                                 <!-- <td>项目规模</td>
                                <td id="look_prj_lv"></td> -->
                            </tr>
                            <tr>
                            	<td>发包方式</td>
                                <td id="isbid"></td>
                            	<td>跟踪人</td>
                                <td id="look_person"></td>
                            </tr>
                            <!-- <tr>
                            	<td>跟踪结果</td>
                                <td id="look_gz_end"></td>
                                
                            </tr> -->
                            <tr>
                                <td>项目概况</td>
                                <td colspan="3" id="look_prj_desc"></td>
                            </tr>
                            <tr>
                                <td>备注</td>
                                <td colspan="3" id="look_desc"></td>
                            </tr>
                            <tr id="look_tr">
                                
                            </tr>
                        </table>
                        <table class="table table-bordered table-condensed" id="person_list">
                        	<thead>
                        		<tr>
                        			<th>联系人</th>
                        			<th>联系方式</th>
                        		</tr>
                        	</thead>
                        	<tbody></tbody>
                        </table>
                        <br/>
					<h2 style="color:red;">审批详情</h2>
					<table class="table table-bordered table-condensed" id="d_table">
                    		<thead>
                    			<tr>
                    				<th style="width:30%;">业务名称</th>
                    				<th style="width:12%;">操作人</th>
                    				<th style="width:23%;">意见</th>
                    				<th style="width:12%;">操作类型</th>
                    				<th style="width:23%;">操作时间</th>
                    			</tr>
                    		</thead>
                    		<tbody></tbody>
                    	</table>
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        </div>
        </div>
    </div>
</div>
<!-- 查看model结束 -->

<!-- 查看Modal -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="gz_end_modal">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>填报项目跟踪结果</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline" method="post" enctype="multipart/form-data">
                        <table class="table table-bordered table-condensed">
                            <tr>
                            	<td style="width:30%;">跟踪结果</td>
                            	<td><input type="text" class="form-control" id="gz_end"></td>
                            </tr>
                        </table>
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-success"  onclick="saveGzEnd()">保存</button>
        </div>
        </div>
    </div>
</div>
<!-- 查看model结束 -->
                
                        </div>
                        <div class="LowerPart" style="margin-top:3px;">
                            <table class="table table-bordered table-condensed" id="mainContent">
                                <thead>
                                    <tr>
                                        <th style="width:12%;">项目跟踪单号</th>
                                        <th style="width:20%;">项目名称</th>
                                        <th style="width:10%;">项目状态</th>
                                        <th style="width:10%;">填报时间</th>
                                        <th style="width:10%;">跟踪部门</th>
                                        <th style="width:13%;" class="jinqianyanse">预估项目规模(元)</th>
                                        <th style="width:8%;">项目规模</th>
                                        <th style="width:10%;">跟踪结果</th>
                                        <th style="width:7%;">操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                           
                                </tbody>   
                            </table>
                        </div>
                </div>
<!-- allMsg -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="allMsg1">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>所有信息</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline">
                        <table class="table table-bordered table-condensed">
                            <tr>
                                <td style="width:100px;">项目名称</td>
                                <td>发发生</td>
                                <td style="width:100px;">项目编号</td>
                                <td>14215</td>
                            </tr>
                            <tr>
                                <td>项目状态</td>
                                <td>xbcxnxn</td>
                                <td>项目级别</td>
                                <td>sdgdshsadad</td>
                            </tr>
                            <tr>
                                <td>业务类型</td>
                                <td>试验检测</td>
                                <td>项目地址</td>
                                <td>hdsaygatea</td>
                            </tr>
                            <tr>
                                <td>预估项目规模(金额)</td>
                                <td>132156</td>
                                <td>填报时间</td>
                                <td>3212151614</td>
                            </tr>
                            <tr>
                                <td>是否投标</td>
                                <td>是</td>
                                <td>跟踪部门</td>
                                <td>sdgsdgdsgsd</td>
                            </tr>
                            <tr>
                                <td>项目概况</td>
                                <td colspan="3">dsagasdsa</td>
                            </tr>
                            <tr>
                                <td>备注</td>
                                <td colspan="3">qewgafsdads</td>
                            </tr>
                            <tr>
                                <td>业务附件</td>
                                <td colspan="3">dasgdassad</td>
                            </tr>
                        </table> 
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        </div>
        </div>
    </div>
</div>
<!-- allMsg结束 -->
 <div role="tabpanel" class="tab-pane" id="profile">
        <div class="UpperPart">
               <div class="UpperPartL">
                            
               </div>
               <div class="UpperPartR">
                      <button type="button" class="btn btn-primary Pdad" onclick="openModal2()">新建项目跟踪日志</button>
                </div>
                <!-- Modal -->
                <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="myModal2">
                    <div class="modal-dialog modal-lg" role="document">
                        <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="myModalLabel"><b>新建项目跟踪日志</b></h4>
                        </div>
                        <div class="modal-body">
                                <div>     
                                    <form class="form-inline">
                                        <table class="table table-bordered table-condensed">
                                            <tr>
                                                <td style="width:20%;">项目名称  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                                <td style="width:30%;">
                                                	<select style="width:80%;" class="form-control"  id="new_prj_name_log">
                                                		
                                                	</select>
                                                </td>
                                                <td style="width:20%;">项目编号</td>
                                                <td style="width:30%;">
                                                	<select style="width:80%;" class="form-control" id="new_business_no_log">
                                                		
                                                	</select>
                                                </td>
                                            </tr>
                                            <tr>
                                            	<td>跟踪人</td>
                                            	<td><input type="text" style="width:80%;" class="form-control" id="new_log_person" disabled></td>
                                            	<td></td>
                                            	<td></td>
                                            </tr>
                                            <!-- <tr>
                                                <td style="width:20%;">客户名称</td>
                                                <td style="width:30%;"><input type="text" style="width:70%;" class="form-control" id="new_client_name"></td>
                                                <td style="width:20%;">主办部门  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                                <td style="width:30%;">
                                                    <select class="form-control" style="width:70%;" id="new_main_department">
                                                    </select>
                                                </td>
                                            </tr> -->
                                            <tr>
                                                <td>日志  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                                <td colspan="3"><textarea class="form-control" rows="4" style="width:100%;" id="new_log"></textarea></td>
                                            </tr>
                                        </table> 
                                    </form>  
                                </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                            <button type="button" class="btn btn-success" onclick="new_save_log()">保存</button>
                        </div>
                        </div>
                    </div>
                </div>
                <!-- model结束 -->
                
                <!-- 修改Modal -->
                <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="edit_modal">
                    <div class="modal-dialog modal-lg" role="document">
                        <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="myModalLabel"><b>修改项目跟踪日志</b></h4>
                        </div>
                        <div class="modal-body">
                                <div>     
                                    <form class="form-inline">
                                        <table class="table table-bordered table-condensed">
                                            <tr>
                                                <td style="width:20%;">项目名称  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                                <td style="width:30%;">
                                                	<select class="form-control" style="width:80%;" id="edit_prj_name_log">
                                                		
                                                	</select>
                                                </td>
                                                <td style="width:20%;">经营编号</td>
                                                <td style="width:30%;">
                                                	<select class="form-control" style="width:80%;" id="edit_business_no_log">
                                                		
                                                	</select>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>跟踪人</td>
                                                <td><input type="text" style="width:80%;" class="form-control" id="edit_log_person" disabled></td>
                                                <td></td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>日志</td>
                                                <td colspan="3"><textarea class="form-control" rows="4" style="width:100%;" id="edit_log"></textarea></td>
                                            </tr>
                                        </table> 
                                    </form>  
                                </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                            <button type="button" class="btn btn-success" onclick="edit_save_log()">保存</button>
                        </div>
                        </div>
                    </div>
                </div>
                <!-- 修改model结束 -->
                
                
                 <!-- 查看Modal -->
                <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="look_modal">
                    <div class="modal-dialog modal-lg" role="document">
                        <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="myModalLabel"><b>查看项目跟踪日志</b></h4>
                        </div>
                        <div class="modal-body">
                                <div>     
                                    <form class="form-inline">
                                        <table class="table table-bordered table-condensed">
                                            <tr>
                                                <td style="width:20%;">项目名称</td>
                                                <td id="look_prj_name_log" style="width:30%;"></td>
                                                <td style="width:20%;">经营编号</td>
                                                <td id="look_business_no_log" style="width:30%;"></td>
                                            </tr>
                                            <tr>
                                                <td>跟踪人</td>
                                                <td id="look_log_person"></td>
                                                <td></td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>日志  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                                <td colspan="3" id="look_log"></td>
                                            </tr>
                                        </table> 
                                    </form>  
                                </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                        </div>
                        </div>
                    </div>
                </div>
                <!-- 查看model结束 -->
                
                    </div>
                    <div class="LowerPart" style="margin-top:3px;">
                        <table class="table table-bordered table-condensed" id="mainContent2">
                            <thead>
                                <tr>
                                    <th>项目编号</th>
                                    <th>项目名称</th>
                                    <th>跟踪人</th>
                                    <th style="width:120px;">操作</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>   
                        </table>
                    </div>
                </div>
                
            </div>   
        </div>

        
    </div>
    <!-- 提交 modal -->
<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="tijiaogei">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="gridSystemModalLabel">提交给</h4>
            </div>
            <div class="modal-body">
                <table class="table table-bordered table-condensed" id="tijiaoren">
                        	<thead>
                        			<tr>
		                            	<th></th>
		                                <th>部门</th>
		                                <th>职务</th>
		                                <th>审批人</th>
		                            </tr>
                        	</thead>
                            <tbody>
                            	
                            </tbody>
                        </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-success" data-dismiss="modal" onclick="submitPerson()">提交</button>
            </div>
        </div>
    </div>
</div>
<!-- 提交 modal结束 -->
</body>
<script src="../../js/jquery.js"></script>
<script src="../../js/common-scripts.js"></script>
<script src="../../js/jquery.dataTables.min.js"></script>
<script src="../../js/bootstrap.min.js"></script>
<script src="../../js/laydate/laydate.js"></script>
<script src="../../js/jquery-editable-select.js"></script>
<script src="../../js/jquery-form.min.js"></script>
<script src="../../toastr/toastr.js"></script>
<script src="../../js/city-picker.data.js"></script>
<script src="../../js/city-picker.js"></script>
<script src="../../js/quanxian.js"></script>
<script>
    $(document).ready( function () {
    	laydate.render({
            elem: '#year' //指定元素
        });
        laydate.render({
            elem: '#edit_year' //指定元素
        });
        
        initTable();
        initDepartment();
        initLogPrj();
        leixingSelect2();
	});
    
    
    var table=$('#mainContent').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 10,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
		            { "data": "prjNo"}, 
		            { "data": "prjName"}, 
		            { "data": "prjStates"}, 
		            { "data": "fillTime"}, 
		            { "data": "traceDepartment"}, 
		            { "data": "predictPrjScale", render: $.fn.dataTable.render.number( ',', '.', 2, '' )}, 
		            { "data": "prjLv"}, 
		            { "data": "gzEnd"},
		            { "data": null}
		        ],
		        "columnDefs": [
								{	
										 "class": "tcenter",
										    "targets": 8,
										    "searchable": true,
										    "render": function(data, type, full) {
										    	/* &nbsp <i class="iconfont icon-xiugai Pdac" style="font-size:18px;cursor:pointer;display:none;" title="修改" onclick="updateThis(this)"></i> */
										    	return '<i class="iconfont icon-icon-test Pdab" style="font-size:18px;cursor:pointer;display:none;" onclick="lookThis(this)" title="查看"></i> &nbsp <i class="iconfont icon-xiugai Pdac" style="font-size:18px;cursor:pointer;display:none;" title="填报跟踪结果" onclick="addGzEnd(this)"></i>';
										        }
										  }
								],
								"fnDrawCallback" : function() {
									$.ajax({
				                		type:"post",
				                		url:getContextPath()+"/login/getUser",
				                		async:false,
				                		data:{
				                		},
				                		success:function(json){
				                			
				                			if(json!=null &&json!=""){
				                				var arr = json.uPermissions.split(',');
				                				
				                				for(var i=0;i<arr.length;i++){
				                					var arr2 = arr[i].replace("+","");
				                					//console.log(arr2);
				                					if(arr[i].indexOf("Pdab") >= 0 ){
				                						$(".Pdab").show();
				                					}
				                					if(arr[i].indexOf("Pdac") >= 0 ){
				                						$(".Pdac").show();
				                					}
				                				}
				                				
				                			}
				                			
				                		}
				                	});
									
								},
        "order": [[1, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
        
	});
    var table2=$('#mainContent2').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 10,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
		            { "data": "manageNo"}, 
		            { "data": "prjName"}, 
		            { "data": "ptlName"},
		            { "data": null},
		        ],
		        "columnDefs": [
								{	
										 "class": "tcenter",
										    "targets": 3,
										    "searchable": true,
										    "render": function(data, type, full) {
										    	return '<i class="iconfont logLook icon-icon-test Pdae" style="font-size:18px;cursor:pointer;display:none;" onclick="lookThisLog(this)" title="查看"></i> &nbsp <i class="iconfont logEdit icon-xiugai Pdaf" style="font-size:18px;cursor:pointer;display:none;" title="修改" onclick="updateThisLog(this)"></i>';
										        }
										  }
								],
        "order": [[1, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
        
	});
    
	function initTable(){
        $.ajax({
            type: 'POST',
            url: getContextPath()+'/trace/selectProjectTrace',
            dataType: 'json',
            data: {
            	status:2
            },
            success: function (json) {
                $('#mainContent').dataTable().fnClearTable();
                $('#mainContent').DataTable().rows.add(json).draw(false);
                
                $.ajax({
            		type:"post",
            		url:getContextPath()+"/login/getUser",
            		data:{
            		},
            		success:function(json){
            			
            			if(json!=null &&json!=""){
            				var arr = json.uPermissions.split(',');
            				
            				for(var i=0;i<arr.length;i++){
            					var arr2 = arr[i].replace("+","");
            					//console.log(arr2);
            					if(arr[i].indexOf("Pdab") >= 0 ){
            						$(".Pdab").show();
            					}
            					if(arr[i].indexOf("Pdac") >= 0 ){
            						$(".Pdac").show();
            					}
            				}
            				
            			}
            			
            		}
            	});
                
            }
        });
    }
	
	function initTable2(){
        $.ajax({
            type: 'POST',
            url: getContextPath()+'/traceLog/selectProjectTraceLog',
            dataType: 'json',
            data: {
            },
            success: function (json) {
                $('#mainContent2').dataTable().fnClearTable();
                $('#mainContent2').DataTable().rows.add(json).draw(false);
                
                $.ajax({
            		type:"post",
            		url:getContextPath()+"/login/getUser",
            		data:{
            		},
            		success:function(json){
            			
            			if(json!=null &&json!=""){
            				var arr = json.uPermissions.split(',');
            				
            				for(var i=0;i<arr.length;i++){
            					var arr2 = arr[i].replace("+","");
            					//console.log(arr2);
            					if(arr[i].indexOf("Pdae") >= 0 ){
            						$(".Pdae").show();
            					}
            					if(arr[i].indexOf("Pdaf") >= 0 ){
            						$(".Pdaf").show();
            					}
            				}
            				
            			}
            			
            		}
            	});
                
            }
        });
    }

	function initDepartment(){
		$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/organizationManagement/getAllOrganizationManagement',
	        dataType: 'json',
	        data: {
	           
	        },
	        success: function (json) {
	        	$("#new_department").html('');
	        	/* $("#edit_department").html(''); */
	        	$("#look_department").html('');
	        	$("#new_main_department").html('');
	        	$("#edit_main_department").html('');
	        	$("#look_main_department").html('');
	        	for(var i=0;i<json.length;i++){
	        		$("#new_department").append("<option value="+json[i].omId+">"+json[i].omName+"</option>");
	        		/* $("#edit_department").append("<option value="+json[i].omId+">"+json[i].omName+"</option>"); */
	        		$("#look_department").append("<option value="+json[i].omId+">"+json[i].omName+"</option>");
	        		$("#new_main_department").append("<option value="+json[i].omId+">"+json[i].omName+"</option>");
	        		$("#edit_main_department").append("<option value="+json[i].omId+">"+json[i].omName+"</option>");
	        		$("#look_main_department").append("<option value="+json[i].omId+">"+json[i].omName+"</option>");
	        	}
	        }
		});
	}
	
	 //业主单位
	 var lianxiid;
    function leixingSelect2(){
	    $.ajax({
	        type: 'POST',
	        url: getContextPath()+'/cooperator/selectCooperatorIdAndNameByCcType',
	        dataType: 'json',
	        data: {
	           ccType:'业主单位'
	        },
	        success: function (json) {
	        	$("#yezhudanwei").html('');
	        	 for(var i=0;i<json.length;i++){
	        		$("#yezhudanwei").append( "<option value='" + json[i].ccId + "' data-id='" + json[i].ccId + "'>"
		                    + json[i].ccName + "</option>")
	        	}
	        	 $("#yezhudanwei").trigger("change");
	        	 $('#yezhudanwei').editableSelect().on('select.editable-select', function (e, dom) {
	                 	console.log(dom.attr("data-id"));
		                 var yezhudanwei=$("#yezhudanwei").val();
		                
		             	$.ajax({
		         	        type: 'POST',
		         	        url: getContextPath()+'/task/getEnterpriseById',
		         	        dataType: 'json',
		         	        data: {
		         	           id:dom.attr("data-id")
		         	        },
		         	        success: function (json) {
		         	        	$("#lianxiren").html('');
		         	        	
		         	        	for(var i=0;i<json.length;i++){
		         	        		lianxiid=json[0].eId
		         	        		$("#lianxiren").append("<option data-id="+json[i].eId+" value="+json[i].eMan+">"+json[i].eMan+"</option>");
		         	        	}
		         	        	
		         	        	$("#lianxiren").trigger("change");
		         	        }
		             	});
		             	$("#lianxiren").on("change",function(){
		                	var yezhudanwei=$("#yezhudanwei").val();
		                	var name=$("#lianxiren").val();
		                	$.ajax({
		            	        type: 'POST',
		            	        url: getContextPath()+'/task/getEnterpriseByIdAndName',
		            	        dataType: 'json',
		            	        data: {
		            	           id:dom.attr("data-id"),
		            	           name:name
		            	        },
		            	        success: function (json) {
		            	        	$("#lianxifangshi").html('');
		            	        	for(var i=0;i<json.length;i++){
		            	        		$("#lianxifangshi").append("<option value="+json[i].eTel+">"+json[i].eTel+"</option>");
		            	        	}
		            	        }
		                	});
		                })
		                
          		 });
	        }
	    });
	}
    
    
    
    
    
    

    function saveGuanliren(){
    	
		 $.ajax({
	        type: 'POST',
	        url: getContextPath()+'/cooperator/countOfEnterprise',
	        dataType: 'json',
	        data:{
	        	eId:lianxiid,
	        	eMan:$("#xinjianlianxiren").val(),
	        	eTel:$("#xinjianlianxifangshi").val()
	        },
	        success: function (json) {
	        	
	        	$("#lianxibiaoge tbody").append("<tr><td>"
	        			+'<input type="text" class="form-control" value='+$("#xinjianlianxiren").val()+' disabled>'
	        			+"</td><td>"
	        			+'<input type="text" class="form-control" value='+$("#xinjianlianxifangshi").val()+' disabled>'
	        			+"</td><td><button type='button' style='text-align:right;' class='btn btn-primary' onclick='deleteLianxiren(this)'>移除联系人</button></td></tr>")
	        }
	    });
		
    }

  //增加联系人联系电话
    function addLianxiren(aa){
    	var eid=$(aa).parent().prev().prev().prev().find("select").find("option:selected").attr("data-id");
	    var dianhua=$(aa).parent().prev().find("select").val();
	    var ren=$(aa).parent().prev().prev().prev().find("select").val();
    	$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/cooperator/countOfEnterprise',
	        dataType: 'json',
	        data:{
	        	eId:eid,
	        	eMan:dianhua,
	        	eTel:ren
	        },
	        success: function (json) {
	        	var lianxiren=$("#lianxiren").val();
	        	var lianxifangshi=$("#lianxifangshi").val();
	        	if(lianxiren==null||lianxifangshi==null||lianxiren==''||lianxifangshi==''){
	        		toastr.error("联系人或联系方式为空");
	        		return;
	        	}
	        	$("#lianxibiaoge tbody").append("<tr><td>"
	        			+'<input type="text" class="form-control" value='+lianxiren+' disabled>'
	        			+"</td><td>"
	        			+'<input type="text" class="form-control" value='+lianxifangshi+' disabled>'
	        			+"</td><td><button type='button' style='text-align:right;' class='btn btn-primary' onclick='deleteLianxiren(this)'>移除联系人</button></td></tr>")
	        }
	    }); 
    }
    function deleteLianxiren(obj){
    	var tr=$(obj).parent().parent();
    	$(tr).remove();
    }

    
	function openModal(){
		$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/login/getUser',
	        dataType: 'json',
	        data: {
	        },
	        success: function (json) {
	        	$("#new_department").val(json.omName);
	        	$("#new_person").val(json.uName);
	        	$("#myModal").modal("show");
	        }
		})
	}
	
	function openModal2(){
		$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/login/getUser',
	        dataType: 'json',
	        data: {
	        },
	        success: function (json) {
	        	$("#new_log_person").val(json.uName);
	        	$("#myModal2").modal("show");
	        }
		})
	}
	
	function new_save(){
		var new_prj_name=$("#new_prj_name").val();
		/* var new_prj_no=$("#new_prj_no").val(); */
		var new_prj_status=$("#new_prj_status").val();
		/* var new_prj_lv=$("#new_prj_lv").val(); */
		var new_business_type=$("#new_business_type").val();
		var new_prj_addr=$("#new_prj_addr").val();
		var new_prj_scale=$("#new_prj_scale").val();
		if(new_prj_scale==''){
			new_prj_scale=0;
		}
		var year=$("#year").val();
		var new_isbid=$("#new_isbid").val();
		var new_department=$("#new_department").val();
		var new_person=$("#new_person").val();
		var new_prj_desc=$("#new_prj_desc").val();
		var new_desc=$("#new_desc").val();
		var yezhudanwei=$("#yezhudanwei").val();
		var enterpriseList=new Array();
		$("#lianxibiaoge tbody").find("tr").each(function(){
			var enterprise={
					eId:undefined,
					eMan:undefined,
					eTel:undefined
			}
			enterprise.eMan=$(this).find("input").eq(0).val();
			enterprise.eTel=$(this).find("input").eq(1).val();
			enterpriseList.push(enterprise);
		})
		
		var trace={
			ptId:null,
        	prjNo:undefined,
        	prjName:undefined,
        	prjStates:undefined,
        	prjLv:undefined,
        	businessType:undefined,
        	prjAddr:undefined,
        	fillTime:undefined,
        	isbid:undefined,
        	traceDepartment:undefined,
        	predictPrjScale:undefined,
        	prjDesc:undefined,
        	ptInfo:undefined,
        	ptUser:undefined,
        	prjUnit:undefined,
        	gzEnd:undefined,
        	enterprise:undefined
		}
		
			trace.prjName=new_prj_name;
			trace.prjStates=new_prj_status;
			trace.businessType=new_business_type;
			trace.prjAddr=new_prj_addr;
			trace.predictPrjScale=new_prj_scale;
			trace.fillTime=year;
			trace.isbid=new_isbid;
			trace.traceDepartment=new_department;
			trace.ptUser=new_person;
			trace.prjDesc=new_prj_desc;
			trace.ptInfo=new_desc;
			trace.prjUnit=yezhudanwei;
			trace.enterprise=enterpriseList;
		
		if(new_prj_name==''){
			toastr.error("项目名称不能为空");
			return;
		}
		
		var formData = new FormData();
  		formData.append("trace", JSON.stringify(trace));
  		
  		formData.append("file", $("#add_file").find("input")[0].files[0]);
		
  		$.ajax({
  			type: 'POST',
  			url: getContextPath()+'/trace/addProjectTraceOfSave',
            data: formData,  
            cache: false,
            processData: false,
            contentType: false,
            async: false,
            dataType: 'json',
            success: function (json) {
             	if(json>0){
             		toastr.success("保存成功");
             		$("#myModal").modal("hide");
             	}else{
             		toastr.error("保存失败");
             	}
            }
  		});
	}
	
	
	function new_submit(){
		var new_prj_name=$("#new_prj_name").val();
		/* var new_prj_no=$("#new_prj_no").val(); */
		var new_prj_status=$("#new_prj_status").val();
		/* var new_prj_lv=$("#new_prj_lv").val(); */
		var new_business_type=$("#new_business_type").val();
		var new_prj_addr=$("#new_prj_addr").val();
		var new_prj_scale=$("#new_prj_scale").val();
		var year=$("#year").val();
		var new_isbid=$("#new_isbid").val();
		var new_department=$("#new_department").val();
		var new_person=$("#new_person").val();
		var new_prj_desc=$("#new_prj_desc").val();
		var new_desc=$("#new_desc").val();
		var yezhudanwei=$("#yezhudanwei").val();
		var enterpriseList=new Array();
		$("#lianxibiaoge tbody").find("tr").each(function(){
			var enterprise={
					eId:undefined,
					eMan:undefined,
					eTel:undefined
			}
			enterprise.eMan=$(this).find("input").eq(0).val();
			enterprise.eTel=$(this).find("input").eq(1).val();
			enterpriseList.push(enterprise);
		})
		
		var trace={
			ptId:null,
        	prjNo:undefined,
        	prjName:undefined,
        	prjStates:undefined,
        	prjLv:undefined,
        	businessType:undefined,
        	prjAddr:undefined,
        	fillTime:undefined,
        	isbid:undefined,
        	traceDepartment:undefined,
        	predictPrjScale:undefined,
        	prjDesc:undefined,
        	ptInfo:undefined,
        	ptUser:undefined,
        	prjUnit:undefined,
        	gzEnd:undefined,
        	enterprise:undefined
		}
		
			trace.prjName=new_prj_name;
			trace.prjStates=new_prj_status;
			trace.businessType=new_business_type;
			trace.prjAddr=new_prj_addr;
			trace.predictPrjScale=new_prj_scale;
			trace.fillTime=year;
			trace.isbid=new_isbid;
			trace.traceDepartment=new_department;
			trace.ptUser=new_person;
			trace.prjDesc=new_prj_desc;
			trace.ptInfo=new_desc;
			trace.prjUnit=yezhudanwei;
			trace.enterprise=enterpriseList;
		
		if(new_prj_name==''){
			toastr.error("项目名称不能为空");
			return;
		}
		if(new_prj_status==''){
			toastr.error("项目状态不能为空");
			return;
		}
		if(yezhudanwei==''){
			toastr.error("业主单位不能为空");
			return;
		}
		if(new_prj_desc==''){
			toastr.error("项目概况不能为空");
			return;
		}
		if(new_prj_addr==''){
			toastr.error("项目地址不能为空");
			return;
		}
		if(new_business_type==''){
			toastr.error("业务类型不能为空");
			return;
		}
		if(new_prj_scale==''){
			toastr.error("预估项目规模不能为空");
			return;
		}
		if(year==''){
			toastr.error("填报时间不能为空");
			return;
		}
		
		var formData = new FormData();
  		formData.append("trace", JSON.stringify(trace));
  		
  		if($("#add_file").find("input").length<1||$("#add_file").find("input").eq(0).val()==''){
				toastr.error("请上传业务附件");
				return;
		}
  		
  		formData.append("file", $("#add_file").find("input")[0].files[0]);
		
  		$.ajax({
  			type: 'POST',
  			url: getContextPath()+'/trace/addProjectTraceOfSubmit',
            data: formData,  
            cache: false,
            processData: false,
            contentType: false,
            async: false,
            dataType: 'json',
            success: function (json) {
             if(json=='0'){
        		toastr.error("保存失败");
        	}else{
        		$("#myModal").modal("hide");
        		lianjie=json.url;
            	if(json.receiver!=null&&json.receiver.length>=1){
	        		  $("#tijiaogei").modal('show');
	        		  $("#tijiaoren tbody").empty("");
	        		  for(var i=0;i<json.receiver.length;i++){
	        			  $("#tijiaoren tbody").append('<tr><td>'
	        					  +'<input type="radio" name="tijiaorenming" data-id="'+json.receiver[i].userId+'" data-id2="'+json.receiver[i].omId+'" data-id3="'+json.receiver[i].dutyId+'">'
	        					  +'</td><td>'
	        					  +json.receiver[i].omName
	        					  +'</td><td>'
	        					  +json.receiver[i].dutyName
	        					  +'</td><td>'
	        					  +json.receiver[i].uName
	        					  +'</td></tr>');
	        		  }
	        	  }else if(json.receiver.length==1){
	        		  $.ajax({
	        	          type: 'POST',
	        	          url: getContextPath()+'/task/addTask4',
	        	          dataType: 'json',
	        	          data:{
	        	        	  url:json.url,
	        	        	  userId:json.receiver.userId,
	        	        	  uName:json.receiver.uName,
	        	        	  omName:json.receiver.omName,
	        	        	  dutyName:json.receiver.dutyName,
	        	        	  omId:json.receiver.omId,
	        	        	  dutyId:json.receiver.dutyId
	        	          },
	        	          success: function (json) {
	        	        	  toastr.success('提交成功');
	        	          }
	        	      }); 
	        	  }
        		}
            }
  		});
  		
		/* var options={
				type: 'POST',
		        url: getContextPath()+'/trace/addProjectTraceOfSubmit',
		        dataType: 'json',
		        contentType: "application/json", 
		        data: JSON.stringify(trace),
		        success: function (json) {
		        	if(json=='0'){
		        		toastr.error("保存失败");
		        	}else{
		        		$("#myModal").modal("hide");
		        		lianjie=json.url;
		            	if(json.receiver!=null&&json.receiver.length>=1){
			        		  $("#tijiaogei").modal('show');
			        		  $("#tijiaoren tbody").empty("");
			        		  for(var i=0;i<json.receiver.length;i++){
			        			  $("#tijiaoren tbody").append('<tr><td>'
			        					  +'<input type="radio" name="tijiaorenming" data-id="'+json.receiver[i].userId+'" data-id2="'+json.receiver[i].omId+'" data-id3="'+json.receiver[i].dutyId+'">'
			        					  +'</td><td>'
			        					  +json.receiver[i].omName
			        					  +'</td><td>'
			        					  +json.receiver[i].dutyName
			        					  +'</td><td>'
			        					  +json.receiver[i].uName
			        					  +'</td></tr>');
			        		  }
			        	  }else if(json.receiver.length==1){
			        		  $.ajax({
			        	          type: 'POST',
			        	          url: getContextPath()+'/task/addTask4',
			        	          dataType: 'json',
			        	          data:{
			        	        	  url:json.url,
			        	        	  userId:json.receiver.userId,
			        	        	  uName:json.receiver.uName,
			        	        	  omName:json.receiver.omName,
			        	        	  dutyName:json.receiver.dutyName,
			        	        	  omId:json.receiver.omId,
			        	        	  dutyId:json.receiver.dutyId
			        	          },
			        	          success: function (json) {
			        	        	  toastr.success('提交成功');
			        	          }
			        	      }); 
			        	  }
		        	}
		        }
		}
		$("#new_form").ajaxSubmit(options); */
	}
	
	function submitPerson(){
  		var uid=$("input[name='tijiaorenming']:checked").attr("data-id");
  	  var omid=$("input[name='tijiaorenming']:checked").attr("data-id2");
  	  var dutyid=$("input[name='tijiaorenming']:checked").attr("data-id3");
  	  var bmmc=$("input[name='tijiaorenming']:checked").parent().next().text();
  	  var zw=$("input[name='tijiaorenming']:checked").parent().next().next().text();
  	  var uname=$("input[name='tijiaorenming']:checked").parent().next().next().next().text();
  	  //var uname=$("input[name='tijiaorenming']:checked").val();
  	  $.ajax({
            type: 'POST',
            url: getContextPath()+'/task/addTask4',
            dataType: 'json',
            data:{
          	  url:lianjie,
          	  userId:uid,
          	  uName:uname,
          	  omName:bmmc,
          	  dutyName:zw,
          	  omId:omid,
          	  dutyId:dutyid
            },
            success: function (json) {
          	  toastr.success('提交成功');
            }
        });  
  	}
	
	
	
	var edit_id;
	var edit_dom;
	var aId;
	var acName;
	var acUrl;
	function updateThis(obj){
		edit_dom=$(obj).parents("tr");
		var data=$('#mainContent').DataTable().row(edit_dom).data();
		edit_id=data.ptId;
		$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/trace/selectProjectTraceById',
	        dataType: 'json',
	        data: {
	           id:edit_id,
	           status:2
	        },
	        success: function (json) {
	        	$("#edit_prj_name").val(json.prjName);
	    		$("#edit_prj_no").val(json.prjNo);
	    		$("#edit_prj_status").val(json.prjStates);
	    		$("#edit_prj_lv").val(json.prjLv);
	    		$("#edit_business_type").val(json.businessType);
	    		$("#edit_prj_addr").val(json.prjAddr);
	    		$("#edit_prj_scale").val(json.predictPrjScale);
	    		$("#edit_year").val(json.fillTime);
	    		$("#edit_isbid").val(json.isbid);
	    		$("#edit_department").val(json.traceDepartment);
	    		$("#edit_gz_person").val(json.ptUser);
	    		$("#edit_prj_desc").val(json.prjDesc);
	    		$("#edit_desc").val(json.ptInfo);
	    		
	    		
	    		$.ajax({
	    			type:"post",
	    			url:getContextPath()+"/accessory/selectAccessoryById",
	    			dataType:"json",
	    			data:{
	    				id:json.ptId
	    			},
	    			success:function(json){
	    				if(json.length!=0){
	    					aId=json[0].aId;
							acName=json[0].acName;
							acUrl=json[0].acUrl;
							$("#file_tr_td").html('');
							$("#file_tr_td").append("<input type='text' style='width:100%;' class='form-control' data="+acUrl+" value="+acName+" disabled>");
							$("#file_tr_td2").append("<button type='button' class='btn btn-primary' onclick='deleteFile()'>删除附件</button>");
	    				}else{
	    					$("#file_tr_td").html('');
							$("#file_tr_td").append("<input type='file' style='width:100%;' class='form-control' name='file'>");
							$("#file_tr_td2").html('');
	    				}
	    				
	    			}
	    		});
	    		$("#change").modal("show");
	        }
		});
	}
	
	function initFileInput(){
		$("#file_tr_td").empty();
		$("#file_tr_td2").empty();
		$("#file_tr_td").append("<input name='file' type='file' class='form-control'>");
	}
	
	function deleteFile(){
		var statu = confirm("确认删除吗?");
		  if(!statu){
		   return false;
		  }
		$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/trace/deleteAccessory',
	        dataType: 'json',
	        data: {
	        	aId:aId,
	        	acName:acName,
	        	acUrl:acUrl
	        },
	        success: function (json) {
	        	if(json==0){
	        		toastr.error("删除失败");
	        	}else{
	        		toastr.success("删除成功");
	        		initFileInput();
	        	}
	        }
		});
	}
	
	
	var look_dom;
	var look_id;
	var url;
	var fileName;
	function lookThis(obj){
		look_dom=$(obj).parents("tr");
		var data=$('#mainContent').DataTable().row(look_dom).data();
		look_id=data.ptId;
		$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/trace/selectProjectTraceById',
	        dataType: 'json',
	        data: {
	           id:look_id,
	           status:2
	        },
	        success: function (json) {
	        	$("#download_td").html('');
	        	$("#look_prj_name").text(json.prjName);
	    		$("#look_prj_no").text(json.prjNo);
	    		$("#look_prj_status").text(json.prjStates);
	    		$("#look_prj_lv").text(json.prjLv);
	    		$("#look_business_type").text(json.businessType);
	    		$("#look_prj_addr").text(json.prjAddr);
	    		$("#look_prj_scale").text(json.predictPrjScale);
	    		$("#look_year").text(json.fillTime);
	    		$("#look_isbid").text(json.isbid);
	    		$("#look_department").text(json.traceDepartment);
	    		$("#look_person").text(json.ptUser);
	    		$("#look_prj_desc").text(json.prjDesc);
	    		$("#look_gz_end").text(json.gzEnd);
	    		$("#look_prj_unit").text(json.prjUnit);
	    		$("#look_desc").text(json.ptInfo);
	    		$("#isbid").text(json.isbid)
	    		$.ajax({
	    			type: 'POST',
	                url: getContextPath()+'/work/selectDepartmentAndPerson',
	                dataType: 'json',
	                data: {
	                	id:look_id
	                },
	                success: function (json) {
	                	var accessory=json.accessory;
	                	var enterprise=json.enterprise;
	                	$("#person_list tbody").html('');
	                	for(var i=0;i<enterprise.length;i++){
	                		$("#person_list tbody").append("<tr><td>"+enterprise[i].eMan+"</td><td>"+enterprise[i].eTel+"</td></tr>")
	                	}
	                	
	                	/* if(accessory.length==0){
	    	    			$("#look_url").val("无");
	    	    			$("#download_td").html('');
	    	    		}else{
	    	    			 fileName=accessory[0].acName;
	    		    		$("#look_url").val(fileName);
	    		    		url=accessory[0].acUrl;
	    		    		$("#download_td").append("<button type='button' class='btn btn-primary' onclick='download()'>下载附件</button>"); 	
	    	    		} */
	    	    		$("#look_tr").html("")
	                	for(var i=0;i<accessory.length;i++){
                            $("#look_tr").append("<td>业务附件</td>"+
									"<td colspan='2'><a href='"+getLocalPath()+"/oa_file/"+accessory[i].acUrl+"' target='view_window' style='color:blue;'>"+accessory[i].acName+"</a></td>"
				         	    );
    		    		}
	                }
	    		})
	    		$("#look").modal("show");
	        }
		});
		
		$.ajax({
        	type: 'POST',
            url: getContextPath()+'/flowHistory/getHistoryNowAndLastByModeId',
            data:{
            	id:data.ptId
            },
            success: function (json) {
            	$("#d_table tbody").html('');
            	for(var i=0;i<json.length;i++){
            		var operatorType = json[i].operateType;
            		operatorType = getCnByOt(operatorType);
            		var date = json[i].doDate;
            		var title = json[i].title;
            		var name = json[i].actorname;
            		if(date == null){
            			date="";
            			if(json[i].operateType==8){
            				title="<lable style='color:red'>"+json[i].title+"</lable>";
            				name="<lable style='color:red'>"+json[i].actorname+"</lable>";
            				operatorType="<lable style='color:red'>"+operatorType+"</lable>";
            			}else{
            				title = json[i].title;
            				name = json[i].actorname;
            			}
            		}
                	$("#d_table tbody").append("<tr><td>"+title+"</td><td>"+name+"</td><td></td><td>"+operatorType+"</td><td>"+date+"</td></tr>");
            	}
            }
        });
		
	}
	
	function getCnByOt(s){
		  if(s==1){
			  return "提交";
		  }else if(s==2){
			  return "退回";
		  }else if(s==3){
			  return "撤销";
		  }else if(s==0){
			  return "驳回";
		  }else if(s==8){
			  return "待审批";
		  }
	  }
	
	
	function getLocalPath(){
		var pathArray = window.location.pathname.split('/');
		var secondLevelLocation = pathArray[1];
		var loginUrl = window.location.protocol + "//"  + window.location.host ;
		return loginUrl;
	}
	
	function download(){
		window.location.href=encodeURI(getContextPath()+"/FileDownLoad?fileName="+fileName+"&filePath="+url);
	}
	
	
	function edit_save(){
		var edit_prj_name=$("#edit_prj_name").val();
		var edit_prj_no=$("#edit_prj_no").val();
		var edit_prj_status=$("#edit_prj_status").val();
		var edit_prj_lv=$("#edit_prj_lv").val();
		var edit_business_type=$("#edit_business_type").val();
		var edit_prj_addr=$("#edit_prj_addr").val();
		var edit_prj_scale=$("#edit_prj_scale").val();
		var edit_year=$("#edit_year").val();
		var edit_isbid=$("#edit_isbid").val();
		var edit_department=$("#edit_department").val();
		var edit_prj_desc=$("#edit_prj_desc").val();
		var edit_desc=$("#edit_desc").val();
		if(edit_prj_name==''){
			toastr.error("项目名称不能为空");
			return;
		}
		if(edit_prj_status==''){
			toastr.error("项目状态不能为空");
			return;
		}
		if(edit_department==''){
			toastr.error("跟踪部门不能为空");
			return;
		}
		if(edit_prj_desc==''){
			toastr.error("项目概况不能为空");
			return;
		}
		if(edit_prj_addr==''){
			toastr.error("项目地址不能为空");
			return;
		}
		if(edit_business_type==''){
			toastr.error("业务类型不能为空");
			return;
		}
		if(edit_prj_scale==''){
			toastr.error("预估项目规模(不能为空");
			return;
		}
		if(edit_year==''){
			toastr.error("填报时间不能为空");
			return;
		}
		
		var options={
				type: 'POST',
		        url: getContextPath()+'/trace/updateProjectTraceOfSave',
		        dataType: 'json',
		        data: {
					ptId:edit_id,		        	
		        	prjName:edit_prj_name,
		        	prjNo:edit_prj_no,
		        	prjStates:edit_prj_status,
		        	prjLv:edit_prj_lv,
		        	businessType:edit_business_type,
		        	prjAddr:edit_prj_addr,
		        	predictPrjScale:edit_prj_scale,
		        	fillTime:edit_year,
		        	isbid:edit_isbid,
		        	traceDepartment:edit_department,
		        	prjDesc:edit_prj_desc,
		        	ptInfo:edit_desc
		        },
		        success: function (json) {
		        	if(json.result==0){
		        		toastr.error("修改保存失败");
		        	}else{
		        		/* $('#mainContent').DataTable().row.add(json.trace).draw(false); */
		        		toastr.success("修改保存成功");
		        		$("#change").modal("hide");
		        	}
		        }
		}
		$("#edit_form").ajaxSubmit(options);
	}
	
	
	function edit_submit(){
		var edit_prj_name=$("#edit_prj_name").val();
		var edit_prj_no=$("#edit_prj_no").val();
		var edit_prj_status=$("#edit_prj_status").val();
		var edit_business_type=$("#edit_business_type").val();
		var edit_prj_addr=$("#edit_prj_addr").val();
		var edit_prj_scale=$("#edit_prj_scale").val();
		var edit_year=$("#edit_year").val();
		var edit_isbid=$("#edit_isbid").val();
		var edit_department=$("#edit_department").val();
		var edit_user=$("#edit_gz_person").val();
		var edit_prj_desc=$("#edit_prj_desc").val();
		var edit_desc=$("#edit_desc").val();
		if(edit_prj_name==''){
			toastr.error("项目名称不能为空");
			return;
		}
		if(edit_prj_status==''){
			toastr.error("项目状态不能为空");
			return;
		}
		if(edit_department==''){
			toastr.error("跟踪部门不能为空");
			return;
		}
		if(edit_prj_desc==''){
			toastr.error("项目概况不能为空");
			return;
		}
		if(edit_prj_addr==''){
			toastr.error("项目地址不能为空");
			return;
		}
		if(edit_business_type==''){
			toastr.error("业务类型不能为空");
			return;
		}
		if(edit_prj_scale==''){
			toastr.error("预估项目规模(不能为空");
			return;
		}
		if(edit_year==''){
			toastr.error("填报时间不能为空");
			return;
		}
		
		var options={
				type: 'POST',
		        url: getContextPath()+'/trace/updateProjectTraceOfSubmit',
		        dataType: 'json',
		        data: {
		        	ptId:edit_id,
		        	prjName:edit_prj_name,
		        	prjNo:edit_prj_no,
		        	prjStates:edit_prj_status,
		        	ptUser:edit_user,
		        	businessType:edit_business_type,
		        	prjAddr:edit_prj_addr,
		        	predictPrjScale:edit_prj_scale,
		        	fillTime:edit_year,
		        	isbid:edit_isbid,
		        	traceDepartment:edit_department,
		        	prjDesc:edit_prj_desc,
		        	ptInfo:edit_desc
		        },
		        success: function (json) {
		        	if(json.result==0){
		        		toastr.error("添加提交失败");
		        	}else{
		        		toastr.success("添加提交成功");
		        		$("#change").modal("hide");
		        	}
		        }
		}
		$("#edit_form").ajaxSubmit(options);
	}
	
	
	/***************************************************** 项目跟踪日志 ***********************************************/
	function initLogPrj(){
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/trace/selectProjectTrace',
            dataType: 'json',
            data: {
            	status:2
            },
            success: function (json) {
            	$("#new_prj_name_log").html("");
            	$("#new_business_no_log").html("");
            	$("#edit_prj_name_log").html("");
            	$("#edit_business_no_log").html("");
                for(var i=0;i<json.length;i++){
                	$("#new_prj_name_log").append("<option value="+json[i].prjName+">"+json[i].prjName+"</option>")
                	$("#new_business_no_log").append("<option value="+json[i].prjNo+">"+json[i].prjNo+"</option>")
                	$("#edit_prj_name_log").append("<option value="+json[i].prjName+">"+json[i].prjName+"</option>")
                	$("#edit_business_no_log").append("<option value="+json[i].prjNo+">"+json[i].prjNo+"</option>")
                }
                $('#new_prj_name_log').editableSelect().on('select.editable-select', function (e, dom) {
              		$.ajax({
                        type: 'POST',
                        url: getContextPath()+'/trace/selectProjectTraceByName',
                        dataType: 'json',
                        data: {
                        	name:$('#new_prj_name_log').val()
                        },
                        success: function (json) {
                        	$('#new_business_no_log').val(json.prjNo);
                        }
              		});
    		  	})
    		  	
    		  	 $('#new_business_no_log').editableSelect().on('select.editable-select', function (e, dom) {
              		$.ajax({
                        type: 'POST',
                        url: getContextPath()+'/trace/selectProjectTraceByNo',
                        dataType: 'json',
                        data: {
                        	no:$('#new_business_no_log').val()
                        },
                        success: function (json) {
                        	$('#new_prj_name_log').val(json.prjName);
                        }
              		});
    		  	})
    		  	
    		  	$('#edit_prj_name_log').editableSelect().on('select.editable-select', function (e, dom) {
              		$.ajax({
                        type: 'POST',
                        url: getContextPath()+'/trace/selectProjectTraceByName',
                        dataType: 'json',
                        data: {
                        	name:$('#edit_prj_name_log').val()
                        },
                        success: function (json) {
                        	$('#edit_business_no_log').val(json.prjNo);
                        }
              		});
    		  	})
    		  	
    		  	 $('#edit_business_no_log').editableSelect().on('select.editable-select', function (e, dom) {
              		$.ajax({
                        type: 'POST',
                        url: getContextPath()+'/trace/selectProjectTraceByNo',
                        dataType: 'json',
                        data: {
                        	no:$('#edit_business_no_log').val()
                        },
                        success: function (json) {
                        	$('#edit_prj_name_log').val(json.prjName);
                        }
              		});
    		  	})
    		  	
            }
        });
	}
	
	
	function new_save_log(){
		var new_prj_name_log=$("#new_prj_name_log").val();
		var new_business_no_log=$("#new_business_no_log").val();
		var new_log_person=$("#new_log_person").val();
		/* var new_client_name=$("#new_client_name").val();
		var new_main_department=$("#new_main_department").val(); */
		var new_log=$("#new_log").val();
		if(new_prj_name_log==''){
			toastr.error("项目名称不能为空");
			return;
		}
		if(new_log==''){
			toastr.error("日志不能为空");
			return;
		}
		
		$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/traceLog/addProjectTraceLogBySave',
	        dataType: 'json',
	        data: {
	        	manageNo:new_business_no_log,
	        	prjName:new_prj_name_log,
	        	ptlName:new_log_person,
	        	ptlLog:new_log
	        },
	        success: function (json) {
	        	var result=json.result;
	        	if(result==0){
	        		toastr.error("添加保存失败");
	        	}else{
	        		var log=json.log;
	        		toastr.success("添加保存成功");
	        		$("#mainContent2").DataTable().row.add(log).draw(false);
	        		$(".logEdit").show();
	        		$(".logLook").show();
					$("#myModal2").modal("hide");
	        	}
	        }
		});
	}
	
	
	/* function new_submit_log(){
		var new_prj_name_log=$("#new_prj_name_log").val();
		var new_business_no_log=$("#new_business_no_log").val();
		var new_client_name=$("#new_client_name").val();
		var new_main_department=$("#new_main_department").val();
		var new_log=$("#new_log").val();
		if(new_prj_name_log==''){
			toastr.error("项目名称不能为空");
			return;
		}
		if(new_main_department==''){
			toastr.error("主办部门不能为空");
			return;
		}
		$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/traceLog/addProjectTraceLogBySubmit',
	        dataType: 'json',
	        data: {
	        	manageNo:new_business_no_log,
	        	prjName:new_prj_name_log,
	        	clientName:new_client_name,
	        	sponsorDepartment:new_main_department,
	        	ptlLog:new_log
	        },
	        success: function (json) {
	        	if(json=='0'){
	        		toastr.error("保存失败");
	        	}else{
	        		$("#myModal2").modal("hide");
	        		lianjie=json.url;
	            	if(json.receiver!=null&&json.receiver.length>=1){
		        		  $("#tijiaogei").modal('show');
		        		  $("#tijiaoren tbody").empty("");
		        		  for(var i=0;i<json.receiver.length;i++){
		        			  $("#tijiaoren tbody").append('<tr><td>'
		        					  +'<input type="radio" name="tijiaorenming" data-id="'+json.receiver[i].userId+'" data-id2="'+json.receiver[i].omId+'" data-id3="'+json.receiver[i].dutyId+'">'
		        					  +'</td><td>'
		        					  +json.receiver[i].omName
		        					  +'</td><td>'
		        					  +json.receiver[i].dutyName
		        					  +'</td><td>'
		        					  +json.receiver[i].uName
		        					  +'</td></tr>');
		        		  }
		        	  }else if(json.receiver.length==1){
		        		  $.ajax({
		        	          type: 'POST',
		        	          url: getContextPath()+'/task/addTask4',
		        	          dataType: 'json',
		        	          data:{
		        	        	  url:json.url,
		        	        	  userId:json.receiver.userId,
		        	        	  uName:json.receiver.uName,
		        	        	  omName:json.receiver.omName,
		        	        	  dutyName:json.receiver.dutyName,
		        	        	  omId:json.receiver.omId,
		        	        	  dutyId:json.receiver.dutyId
		        	          },
		        	          success: function (json) {
		        	        	  toastr.success('提交成功');
		        	          }
		        	      }); 
		        	  }
	        	}
	        }
		});
	} */
	
	
	function lookThisLog(obj){
		var dom=$(obj).parents("tr");
		var data=$("#mainContent2").DataTable().row(dom).data();
		
		$("#look_prj_name_log").text(data.prjName);
		$("#look_business_no_log").text(data.manageNo);
		$("#look_log_person").text(data.ptlName);
		$("#look_log").text(data.ptlLog);
		
		$("#look_modal").modal("show");
	}
	
	var ptlId;
	var logdom;
	function  updateThisLog(obj){
		logdom=$(obj).parents("tr");
		var data=$("#mainContent2").DataTable().row(logdom).data();
		ptlId=data.ptlId;
		
		$("#edit_prj_name_log").val(data.prjName);
		$("#edit_business_no_log").val(data.manageNo);
		$("#edit_log_person").val(data.ptlName);
		$("#edit_log").val(data.ptlLog);
		
		
		$("#edit_modal").modal("show");
	}
	
	
	function edit_save_log(){
		var prjName=$("#edit_prj_name_log").val();
		var manageNo=$("#edit_business_no_log").val();
		var ptlName=$("#edit_log_person").val();
		var ptlLog=$("#edit_log").val();
		if(prjName==''){
			toastr.error("项目名称不能为空");
			return;
		}
		if(new_log==''){
			toastr.error("日志不能为空");
			return;
		}
		
		$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/traceLog/updateProjectTraceLogBySave',
	        dataType: 'json',
	        data: {
	        	manageNo:manageNo,
	        	prjName:prjName,
	        	ptlName:ptlName,
	        	ptlLog:ptlLog,
	        	ptlId:ptlId
	        },
	        success: function (json) {
	        	var result=json.result;
	        	if(result==0){
	        		toastr.error("修改保存失败");
	        	}else{
	        		var log=json.log;
	        		$("#mainContent2").DataTable().row(logdom).data(log).draw(false);
	        		$(".logEdit").show();
	        		$(".logLook").show();
	        		toastr.success("修改保存成功");
					$("#edit_modal").modal("hide");
	        	}
	        }
		});
	}
	
	
	/* function edit_submit_log(){
		var prjName=$("#edit_prj_name_log").val();
		var manageNo=$("#edit_business_no_log").val();
		var clientName=$("#edit_client_name").val();
		var sponsorDepartment=$("#edit_main_department").val();
		var ptlLog=$("#edit_log").val();
		if(prjName==''){
			toastr.error("项目名称不能为空");
			return;
		}
		if(sponsorDepartment==''){
			toastr.error("主办部门不能为空");
			return;
		}
		$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/traceLog/updateProjectTraceLogBySubmit',
	        dataType: 'json',
	        data: {
	        	manageNo:manageNo,
	        	prjName:prjName,
	        	clientName:clientName,
	        	sponsorDepartment:sponsorDepartment,
	        	ptlLog:ptlLog,
	        	ptlId:ptlId
	        },
	        success: function (json) {
	        	if(json==0){
	        		toastr.error("修改提交失败");
	        	}else{
	        		toastr.success("修改提交成功");
					$("#edit_modal").modal("hide");
	        	}
	        }
		});
	} */
	
    function getCreat(bb){
        var EnterpriseRating= $(bb).parent().prev().text();
        var Remarks= $(bb).parent().prev().prev().text();
        var ContactPhone1= $(bb).parent().prev().prev().prev().text();
        var Contacts= $(bb).parent().prev().prev().prev().prev().text();
        var address= $(bb).parent().prev().prev().prev().prev().prev().text();
        var ProprietorUnit= $(bb).parent().prev().prev().prev().prev().prev().prev().text();
        var Code= $(bb).parent().prev().prev().prev().prev().prev().prev().prev().text();
        $("#CEnterprise-rating").val(EnterpriseRating);
        $("#CRemarks").val(Remarks);
        $("#CContact-phone1").val(ContactPhone1);
        $("#CContacts").val(Contacts);
        $("#Caddress").val(address);
        $("#CProprietor-unit").val(ProprietorUnit);
        $("#CCode").val(Code);
        rowIndex = bb.parentNode.parentNode.rowIndex; 
    }

    // $("#mainContent tbody tr").click(function (){
    //     $(this).addClass('selected')
    //     .siblings().removeClass('selected')
    //     .end();
    // })

    $(".quxiao").click(function(){
        if(confirm("确定要撤销吗？")){
            return true;
        }
        else{
            return false;
        }
    })
    
    var gzTr;
    var gzData;
    function addGzEnd(obj){
    	gzTr=$(obj).parents("tr");
    	gzData=$("#mainContent").DataTable().row(gzTr).data();
    	$("#gz_end_modal").modal("show");
    }
    
    function saveGzEnd(){
    	var gzEnd=$("#gz_end").val();
    	$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/trace/updateTraceEnd',
	        dataType: 'json',
	        data: {
	        	gzEnd:gzEnd,
	        	id:gzData.ptId
	        },
	        success: function (json) {
	        	if(json==0){
	        		toastr.error("提交失败");
	        	}else{
	        		toastr.success("提交成功");
	        		gzData.gzEnd=gzEnd;
	        		$("#mainContent").DataTable().row(gzTr).data(gzData).draw(false);
					$("#gz_end_modal").modal("hide");
	        	}
	        }
		});
    }

</script>
</html>