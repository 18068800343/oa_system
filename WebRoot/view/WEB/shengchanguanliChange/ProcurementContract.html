<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="../../font2/iconfont.css">
    <link rel="stylesheet" href="../../font3/iconfont.css">
	<link href="../../style/bootstrap.min.css" rel="stylesheet">
    <link href="../../style/style.css" rel="stylesheet">
    <link href="../../toastr/toastr.css" rel="stylesheet">
    <link href="../../font3/bootstrap-select.css" rel="stylesheet">
    <link rel="stylesheet" href="../../style/jquery.dataTables.min.css">
    <link rel="stylesheet" href="../../style/jquery-editable-select.css"> 
    <link href="../../select/css/select2.min.css" rel="stylesheet">
    <style lang="">
        
        .UpperPart{
            display: flex;
            justify-content:space-between;
            border-bottom: 1px solid #ccc;
            padding-bottom: 12px;
        }
        .UpperPartL{
            font-size: 16px;
        }
        .selected{
            background: rgba(247, 161, 3,0.2);
        }
        #mainContent th{
            cursor: pointer;
            font-size: 14px;
        }
        body{ font:12px/1.125 Arial, Helvetica, sans-serif; background:#fff; }
        .none{ display:none }
        .wrap{ width:1000px;overflow-y:scroll}
    </style>
</head>
<body>
    
    <!-- 面包屑 -->
    <div class="mianbao">
    	<ul class="breadcrumb">
    		<li><i class="iconfont icon-knowledgebase"></i></li>
            <li>生产管理</li>
            <li>合同管理</li>
            <li>项目合同管理</li>
            <li>采购合同管理</li>
			<li class="active">采购合同审签</li>
		</ul>
    </div>

    <div class="zhuti-content">
        <div class="UpperPart">
            
<!-- Modal -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="myModal">
    <div class="modal-dialog modal-lg" role="document" style="width:70%;">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>填报采购合同</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form id="new_form" class="form-inline"  method="post" enctype="multipart/form-data">
                        <table class="table table-bordered table-condensed">
                            <tr>
                                <td style="width:15%;">采购合同名称  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td style="width:30%;">
                                	<input type="text" id="cghetongming" class="form-control" style="width:60%;">
                                </td>
                                <td style="width:15%;">采购合同编号</td>
                                <td style="width:30%;">
                              		<input type="text" id="cgNo" class="form-control" disabled style="width:60%;">
                                </td> 
                            </tr>
                            <tr>
                                <td style="width:15%;">采购单号</td>
                                <td style="width:30%;">
                              		<input type="text" id="cgdNo" class="form-control" disabled style="width:60%;">
                              		<button type="button" class="btn btn-primary" onclick="chooseNo()">选择采购单号</button>
                                </td>
                                <td style="width:15%;">采购合同类型</td>
                                <td style="width:30%;">
                                    <select class="form-control" id="cghetongType" style="width:60%;">
                                        <option>A 材料采购</option>
                                        <option>B 设备采购</option>
                                        <option>C 其他采购</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td style="width:15%;">项目名称:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td style="width:30%;">
                                	<input type="text" id="prjName" class="form-control" style="width:60%;">
                                    <!-- <select class="form-control" style="width:180px;" id="prjName">
                                    </select> -->
                                </td>
                                <td style="width:15%;">任务单号</td>
                                <td style="width:30%;">
                                	<input type="text" id="task_no" class="form-control" style="width:60%;">
                                	<!-- <div class="form-group">
                                        <select class="form-control" style="width:180px;" id="task_no">
                                        </select>
                                    </div> -->
                                </td>
                            </tr>
                            <tr>
                            	<td style="width:15%;">是否代购</td>
                                <td style="width:30%;">
                                    <select class="form-control" id="isdaigou" style="width:60%;">
                                        <option>是</option>
                                        <option>否</option>
                                    </select>
                                </td>
                                <td style="width:15%;">分包合同</td>
                                <td style="width:30%;">
                                	<!-- <input type="text" id="fbhetong" class="form-control" style="width:60%;" disabled>
                                	<button type="button" class="btn btn-primary weui-uploader__input" data-toggle="modal" data-target="#fbcontract">关联分包合同</button> -->
                                	<input type="text" class="form-control" id="fbhetong" disabled style="width:60%;">
                                    <button type="button" id="chooseFb" class="btn btn-primary weui-uploader__input" onclick="chooseFb()">关联分包</button>
                                </td>
                            </tr>
                            <tr>
                                <td style="width:15%;">代购类型</td>
                                <td style="width:30%;">
                                    <select class="form-control" id="daigouType" style="width:60%;">
                                    </select>
                                </td>
                                <td style="width:15%;">代购金额(元)</td>
                                <td style="width:30%;"><input type="text" id="daigouMoney" class="form-control" style="width:60%;"></td>
                            </tr>
                            <tr>
                                <td style="width:15%;">采购合同金额(元)</td>
                                <td style="width:30%;"><input type="text" id="cghetongMoney" class="form-control" placeholder="元" disabled style="width:60%;"></td>
                                <td style="width:15%;">合同甲方名称  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td style="width:30%;">
                                    <select class="form-control" id="hetongjiafang" style="width:60%;">
                                        <option>江苏华通工程检测有限公司</option>
                                        <option>江苏华汇工程检测有限公司</option>
                                    </select>  
                                </td>
                            </tr>
                            <tr>
                                <td style="width:15%;">乙方  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td style="width:30%;">
                                    <select class="form-control" id="yifang" style="width:60%;">
                                        
                                    </select>
                                </td>
                                <td style="width:15%;">付款方式</td>
                                <td style="width:30%;">
                                    <input type="text" class="form-control" id="fukuangfangshi" style="width:60%;">
                                </td>
                            </tr>
                            <tr>
                                <td style="width:15%;">采购合同签订时间</td>
                                <td style="width:30%;"><input type="text" class="form-control" id="year" style="width:60%;"></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>采购合同概述</td>
                                <td colspan="3"><textarea class="form-control" id="hetonggaishu" rows="4" style="width:100%;"></textarea></td>
                            </tr>
                            <tr>
                                <td>主要概况及工作内容</td>
                                <td colspan="3"><textarea class="form-control" id="gaikuang" rows="4" style="width:100%;"></textarea></td>
                            </tr>
                            
                        </table> 
                        <table class="table table-bordered table-condensed" id="new_accessory">
                        	<thead>
                        		<tr>
                                	<td style="width:15%;">采购合同文本  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                	<td colspan="3"><button type="button" class="btn btn-primary weui-uploader__input" onclick="addFile()">添加附件</button></td>
                            	</tr>
                        	</thead>
                        	<tbody></tbody>
                        </table>
                        <table class="table table-bordered table-condensed" id="new_accessory1">
                        	<thead>
                        		<tr>
                                	<td style="width:15%;">法律顾问签字  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                	<td colspan="3"><button type="button" class="btn btn-primary weui-uploader__input" onclick="addFile1()">添加附件</button></td>
                            	</tr>
                        	</thead>
                        	<tbody></tbody>
                        </table>
                        
                        <!--材料信息表格  -->
                        <div id="cailiaobiaoDiv">
                        	<button type='button' id="yijianjiesuanMoney" onclick='yijianjiesuan(1)' class='btn btn-primary' >一键结算金额</button>
                        </div>
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-default" onclick="saveCg()">保存</button>
            <button type="button" class="btn btn-success" onclick="submitCg()" data-dismiss="modal" data-toggle="modal" data-target="#tijiaogei">提交</button>
        </div>
        </div>
    </div>
</div>
<!-- model结束 -->
<!-- Modal选择分包合同 -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="choose_fb">
    <div class="modal-dialog modal-lg" role="document" style="width:60%;">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>选择分包合同</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline">
                        <table class="table table-bordered table-condensed" id="fb_table">
                            <thead>
                            	<tr>
                            		<th></th>
                            		<th>分包合同名称</th>
                                    <th>分包合同编号</th>
                                    <th>甲方单位</th>
                                    <th>合同起日期</th>
                                    <th>合同讫日期</th>
                            	</tr>
                            </thead>
                            <tbody>
                                
                            </tbody>
                        </table> 
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-success" onclick="saveFbName()">保存</button>
        </div>
        </div>
    </div>
</div>
<!-- model项目结束 -->
<!-- 提交 modal -->
<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="tijiaogei">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="gridSystemModalLabel">提交给</h4>
            </div>
            <div class="modal-body">
                <form class="form-inline">
                    
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-success" data-dismiss="modal">提交</button>
            </div>
        </div>
    </div>
</div>
<!-- 提交 modal结束 -->
<!-- 修改Modal -->
				<form id="edit_form" class="form-inline"  method="post" enctype="multipart/form-data" style="width:100%;">
                        <table class="table table-bordered table-condensed">
                            <tr>
                                <td style="width:15%;">采购合同名称  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td style="width:30%;">
                                	<input type="text" id="xgcghetongming" class="form-control"  style="width:60%;">
                                </td>
                                <td style="width:15%;">采购合同编号</td>
                                <td style="width:30%;">
                                	<input type="text" id="xgcgNo" class="form-control" disabled  style="width:60%;">
                                </td>
                            </tr>
                            <tr>
                            	<td>采购单号  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                              		<input type="text" id="xgcgdNo" class="form-control" disabled style="width:60%;">
                              		<button type="button" class="btn btn-primary" onclick="chooseNo2()">选择采购单号</button>
                                </td>
                                <td>采购合同类型  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                    <select class="form-control" id="xgcghetongType" style="width:60%;">
                                        <option>A 材料采购</option>
                                        <option>B 设备采购</option>
                                        <option>C 其他采购</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                            	<td>项目名称:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                	 <input type="text" id="xgprjName" class="form-control" style="width:60%;">
                                    <button type="button" style="margin-left: 5px;" class="btn btn-primary"  id="xgchosexm">选择项目</button>
                                </td>
                                <td>任务单号</td>
                                <td>
                                	 <input type="text" id="xgtask_no" class="form-control" style="width:60%;" disabled> 
                                </td>
                            </tr>
                            <tr>
                            	<td>是否代购</td>
                                <td>
                                    <select class="form-control" id="xgisdaigou" style="width:60%;">
                                        <option>是</option>
                                        <option>否</option>
                                    </select>
                                </td>
                                <td style="width:15%;">分包合同</td>
                                <td style="width:30%;">
                                	<input type="text" class="form-control" id="xgfbhetong" disabled style="width:60%;">
                                    <button type="button" id="xgchooseFbbutton" class="btn btn-primary weui-uploader__input" onclick="xgchooseFb()">关联分包</button>
                                </td>
                            </tr>
                            <tr>
                            	<td style="width:15%;">借款合同号</td>
                                <td style="width:30%;">
                                    <select class="form-control" id="xgborrow_no" style="width:60%;">
                                    </select>
                                </td>
                                <td>代购类型</td>
                                <td>
                                    <select class="form-control" id="xgdaigouType" style="width:60%;">
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td class="jinqianyanse">代购金额(元)</td>
                                <td><input type="text" id="xgdaigouMoney" class="form-control" style="width:60%;"></td>
                                <td class="jinqianyanse">采购合同金额(元)</td>
                                <td><input type="text" id="xgcghetongMoney" class="form-control" placeholder="元" style="width:60%;"></td>
                            </tr>
                            <tr>
                                <td>合同甲方名称  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                    <select class="form-control" id="xghetongjiafang" style="width:60%;">
                                        <option value="江苏华通工程检测有限公司">江苏华通工程检测有限公司</option>
                                        <option value="江苏华汇工程检测有限公司">江苏华汇工程检测有限公司</option>
                                        <option value="宿迁分公司">宿迁分公司</option>
                                    </select>  
                                </td>
                                <td>乙方  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                    <select class="form-control" id="xgyifang" style="width:60%;">
                                        
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>付款方式</td>
                                <td>
                                    <input type="text" class="form-control" id="xgfukuangfangshi" style="width:60%;">
                                </td>
                                <td>采购合同签订时间</td>
                                <td><input type="text" class="form-control" id="xgyear" style="width:60%;"></td>
                            </tr>
                             <tr>
                                <td>采购部门</td>
                                <td>
                                	<select class="form-control" id="xgcg_bumen" style="width:60%;">
                                        
                                    </select>
                                </td>
                            </tr> 
                            <tr>
                                <td>采购合同概述</td>
                                <td colspan="3"><textarea class="form-control" id="xghetonggaishu" rows="4" style="width:100%;"></textarea></td>
                            </tr>
                            <tr>
                                <td>主要概况及工作内容</td>
                                <td colspan="3"><textarea class="form-control" id="xggaikuang" rows="4" style="width:100%;"></textarea></td>
                            </tr>
                            
                        </table> 
                        <table class="table table-bordered table-condensed" id="edit_accessory">
                        	<thead>
                        		<tr>
                                	<td style="width:15%;">采购合同文本  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                               	 	<td colspan="3"><button type="button" class="btn btn-primary weui-uploader__input" onclick="addFile2()">添加附件</button></td>
                           		</tr>
                        	</thead>
                        	<tbody>
                        	</tbody>
                        </table>
                        
                        <div class="wrap">
                        <div><button type='button' id="xgyijianjiesuanMoney" onclick='yijianjiesuan(2)' class='btn btn-primary' >一键结算金额</button></div>
                        <div>
		                    <table class="table table-bordered table-condensed" style="width:1580px;border=1"  id="edit_cl_table">
		                    	<thead>
		                    		<tr>
			                            <td style="font-size:24px;" colspan="10">添加材料需求  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
			                        	<td style="width:5%;"><button type="button" class="btn btn btn-primary" onclick="add2()">添加</button></td>
		                        	</tr>
		                        	<tr>
			                            <th>材料名称</th>
			                            <th style='width:10%;'>材料类型</th>
			                            <th>规格型号</th>
			                            <th style='width:8%;'>单位</th>
			                            <th>数量</th>
			                            <th>单价</th>
			                            <th>金额</th>
			                            <th>项目部推荐供应商</th>
			                            <th>公司确定供应商</th>
			                            <th style="width:10%;">备注</th>
			                            <th style="width:5%;">操作</th>
		                        	</tr>
		                        </thead>
		                        <tbody>
		                        	
		                        </tbody>
		                    </table>
		                </div>
                        <!--材料信息表格  -->
                        <div id="xgcailiaobiaoDiv">
                        	
                        </div>
                        </div>
                    </form> 
<!-- 修改model结束 -->
<!-- Modal选择分包合同 -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="xgchoose_fb">
    <div class="modal-dialog modal-lg" role="document" style="width:60%;">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>选择分包合同</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline">
                        <table class="table table-bordered table-condensed" id="xgfb_table">
                            <thead>
                            	<tr>
                            		<th></th>
                            		<th>分包合同名称</th>
                                    <th>分包合同编号</th>
                                    <th>甲方单位</th>
                                    <th>合同起日期</th>
                                    <th>合同讫日期</th>
                            	</tr>
                            </thead>
                            <tbody>
                                
                            </tbody>
                        </table> 
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-success" onclick="xgsaveFbName()">保存</button>
        </div>
        </div>
    </div>
</div>
<!-- model项目结束 -->
<!-- Modal2 -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="myModal2">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>采购合同取消</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline">
                        <table class="table table-bordered table-condensed">
                            <tr>
                                <td>合同取消原因</td>
                                <td colspan="3"><textarea class="form-control" rows="4" cols="50"></textarea></td>
                            </tr>
                        </table> 
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-default">保存</button>
            <button type="button" class="btn btn-success">提交</button>
        </div>
        </div>
    </div>
</div>
<!-- model2结束 -->
<!-- Modal3 -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="myModal3">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>采购合同重启</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline">
                        <table class="table table-bordered table-condensed">
                            <tr>
                                <td>合同重启原因</td>
                                <td colspan="3"><textarea class="form-control" rows="4" cols="50"></textarea></td>
                            </tr>
                        </table> 
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-default">保存</button>
            <button type="button" class="btn btn-success">提交</button>
        </div>
        </div>
    </div>
</div>
<!-- model3结束 -->
        </div>
        
    </div>
<!-- allMsg -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="allMsg1">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>所有信息</b></h4>
        </div>
        <div class="modal-body">
            <div>     
                <form class="form-inline">
                    <table class="table table-bordered table-condensed">
                        <tr>
                            <td>采购合同名称</td>
                            <td id="lookcghetongming"></td>
                            <td style="width:100px;">采购合同编号</td>
                            <td id="lookcgNo"></td>
                        </tr>
                        <tr>
                        	<td>采购单号</td>
                            <td id="lookcgdNo"></td>
                            <td style="width:100px;">采购合同类型</td>
                            <td id="lookcgType"></td>
                        </tr>
                        <tr>
                            <td>项目名称</td>
                            <td id="lookprjName"></td>
                            <td>任务单号</td>
                            <td id="looktask_no"></td>
                        </tr>
                        <tr>
                            <td>是否代购</td>
                            <td id="lookisdaigou"></td>
                            <td>分包合同</td>
                            <td id="lookfbhetong"></td>
                        </tr>
                        <tr>
                            <td>代购类型</td>
                            <td id="lookdaigouType"></td>
                            <td>代购金额(元)</td>
                            <td id="lookdaigouMoney"></td>
                        </tr>
                        <tr>
                            <td>采购合同金额(元)</td>
                            <td id="lookcghetongMoney"></td>
                            <td>合同甲方名称</td>
                            <td id="lookjiafang"></td>
                        </tr>
                        <tr>
                            <td>乙方</td>
                            <td id="lookyifang"></td>
                            <td>付款方式</td>
                            <td id="lookfukuanfangshi"></td>
                        </tr>
                        <tr>
                            <td>采购合同签订时间</td>
                            <td id="lookyear"></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>采购合同概述</td>
                            <td colspan="3" id="lookcghetonggaishu"></td>
                        </tr>
                        <tr>
                            <td>主要概况及工作内容</td>
                            <td colspan="3" id="lookgaikuang"></td>
                        </tr>
                        <!-- <tr>
                            <td>采购合同文本</td>
                            <td colspan="3"></td>
                        </tr> -->
                    </table>
                    <table class="table table-bordered table-condensed"  id="look_all_table">
				                        		
				    </table>
				    <table class="table table-bordered table-condensed"  id="look_all_table1">
				                        		
				    </table>
				    
				    <div id="lookcailiaobiaoDiv">
				    
                    </div>
				    
				    <!-- 历史信息表格 -->
				    <table style="width:100%;" class="table table-bordered table-condensed" id="lookHistory">
                        <thead>
                            <tr>
                                <th colspan="6">历史信息</th>
                            </tr>
                            <tr>
                                <td>采购合同编号</td>
                                <td>采购合同名称</td>
                                <td>合同类型</td>
                                <td>修改时间</td>
                                <td>操作</td>
                            </tr>
                        </thead>
                        <tbody>
                            
                        </tbody>
                    </table>
                </form>  
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        </div>
        </div>
    </div>
</div>
<!-- allMsg结束 -->
<!-- 历史详细信息 -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="History">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>所有信息</b></h4>
        </div>
        <div class="modal-body">
            <div>     
                <form class="form-inline">
                    <table class="table table-bordered table-condensed">
                        <tr>
                            <td>采购合同名称</td>
                            <td id="Historycghetongming"></td>
                            <td style="width:100px;">采购合同编号</td>
                            <td id="HistorycgNo"></td>
                        </tr>
                        <tr>
                        	<td style="width:100px;">采购单号</td>
                            <td id="HistorycgdNo"></td>
                             <td style="width:100px;">采购合同类型</td>
                            <td id="HistorycgType"></td>
                        </tr>
                        <tr>
                            <td>项目名称</td>
                            <td id="HistoryprjName"></td>
                            <td>任务单号</td>
                            <td id="Historytask_no"></td>
                        </tr>
                        <tr>
                        	<td>是否代购</td>
                            <td id="Historyisdaigou"></td>
                            <td>分包合同</td>
                            <td id="Historyfbhetong"></td>
                        </tr>
                        <tr>
                            <td>代购类型</td>
                            <td id="HistorydaigouType"></td>
                            <td>代购金额(元)</td>
                            <td id="HistorydaigouMoney"></td>
                        </tr>
                        <tr>
                            <td>采购合同金额(元)</td>
                            <td id="HistorycghetongMoney"></td>
                            <td>合同甲方名称</td>
                            <td id="Historyjiafang"></td>
                        </tr>
                        <tr>
                            <td>乙方</td>
                            <td id="Historyyifang"></td>
                            <td>付款方式</td>
                            <td id="Historyfukuanfangshi"></td>
                        </tr>
                        <tr>
                            <td>采购合同签订时间</td>
                            <td id="Historyyear"></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>采购合同概述</td>
                            <td colspan="3" id="Historycghetonggaishu"></td>
                        </tr>
                        <tr>
                            <td>主要概况及工作内容</td>
                            <td colspan="3" id="Historygaikuang"></td>
                        </tr>
                        <!-- <tr>
                            <td>采购合同文本</td>
                            <td colspan="3"></td>
                        </tr> -->
                    </table>
                    
                    <div id="HistorycailiaobiaoDiv">
				    
                    </div>
                    
                    <table class="table table-bordered table-condensed"  id="History_all_table">
				                        		
				    </table>
				    <table class="table table-bordered table-condensed"  id="History_all_table1">
				                        		
				    </table>
                </form>  
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        </div>
        </div>
    </div>
</div>

<!-- Modal -->
<!-- 添加 -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="chooseNo">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>选择采购单号</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline" method="post"  enctype="multipart/form-data">
                        <table class="table table-bordered table-condensed">
                        	<tr>
                        		<td style="width:20%;">采购单号：</td>
                        		<td>
                        			<select class="selectpicker show-tick form-control"  style="width:100%;"  id="selectpicker_no" multiple data-live-search="true">
                        				
                                    </select>
                        		</td>
                        	</tr>
                        </table>
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" onclick="quxiao()">取消</button>
            <button type="button" class="btn btn-success" onclick="saveNo()">保存</button>
        </div>
        </div>
    </div>
</div>
<!-- 修改 -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="chooseNo2">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>选择采购单号</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline" method="post"  enctype="multipart/form-data">
                        <table class="table table-bordered table-condensed">
                        	<tr>
                        		<td style="width:20%;">采购单号：</td>
                        		<td>
                        			<select class="selectpicker2 show-tick form-control"  style="width:100%;"  id="selectpicker_no2" multiple data-live-search="true">
                        				
                                    </select>
                        		</td>
                        	</tr>
                        </table>
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" onclick="quxiao2()">取消</button>
            <button type="button" class="btn btn-success" onclick="saveNo2()">保存</button>
        </div>
        </div>
    </div>
</div>
<!-- model结束 -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="fbcontract">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>选择分包合同</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline" method="post"  enctype="multipart/form-data">
                        <table class="table table-bordered table-condensed">
                        	<tr>
                        		<td style="width:15%;">分包合同编号：</td>
                        		<td style="width:35%;">
                        			<select style="width:80%;" class="selectpicker show-tick form-control" id="fbNo">
                        				
                                    </select>
                        		</td>
                        		<td style="width:15%;">分包合同名称：</td>
                        		<td style="width:35%;">
                        			<select style="width:80%;" class="selectpicker show-tick form-control" id="fbName">
                        				
                                    </select>
                        		</td>
                        	</tr>
                        </table>
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" onclick="quxiaofb()">取消</button>
            <button type="button" class="btn btn-success" onclick="savefb()">保存</button>
        </div>
        </div>
    </div>
</div>
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="xgfbcontract">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>选择分包合同</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline" method="post"  enctype="multipart/form-data">
                        <table class="table table-bordered table-condensed">
                        	<tr>
                        		<td style="width:15%;">分包合同编号：</td>
                        		<td style="width:35%;">
                        			<select style="width:80%;" class="selectpicker show-tick form-control" id="xgfbNo">
                        				
                                    </select>
                        		</td>
                        		<td style="width:15%;">分包合同名称：</td>
                        		<td style="width:35%;">
                        			<select style="width:80%;" class="selectpicker show-tick form-control" id="xgfbName">
                        				
                                    </select>
                        		</td>
                        	</tr>
                        </table>
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" onclick="quxiaofb2()">取消</button>
            <button type="button" class="btn btn-success" onclick="savefb2()">保存</button>
        </div>
        </div>
    </div>
</div>
<!-- 查看取消原因modal -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="look_cancel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
	        <div class="modal-header">
	            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	            <h4 class="modal-title" id="myModalLabel"><b>分包合同取消原因</b></h4>
	        </div>
	        <div class="modal-body">
	                <div>     
	                    <form class="form-inline">
	                        <table class="table table-bordered table-condensed">
	                            <thead>
	                            	<tr>
	                            		<th style="width:8%;">序号</th>
	                            		<th style="width:70%;">取消原因</th>
	                            		<th style="width:22%;">取消时间</th>
	                            	</tr>
	                            </thead>
	                            <tbody>
	                            	<tr>
	                            		<td></td>
	                            		<td></td>
	                            		<td></td>
	                            	</tr>
	                            </tbody>
	                        </table>
	                    </form>  
	                </div>
	        </div>
	        <div class="modal-footer">
	            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
	        </div>
        </div>
    </div>
</div>
<!-- model结束 -->
</body>
<script src="../../js/jquery.js"></script>
<script src="../../js/common-scripts.js"></script>
<script src="../../js/jquery.dataTables.min.js"></script>
<script src="../../js/bootstrap.min.js"></script>
<script src="../../js/laydate/laydate.js"></script>
<script src="../../js/jquery-editable-select.js"></script>
<script src="../../js/jquery-form.min.js"></script>
<script src="../../toastr/toastr.js"></script>
<script src="../../js/bootstrap-select.js"></script>
<script src="../../js/quanxian.js"></script>
<script src="../../select/js/select2.min.js"></script>
<script>
    $(document).ready( function () {
    	initMaterialCompany();
    	initSelect();
    	//initbumen();
    	inityifang();
    	//initSelectfb();
    	selectDepartment();
        laydate.render({
            elem: '#year' //指定元素
        });
        laydate.render({
            elem: '#xgyear' //指定元素
        });
        laydate.render({
            elem: '#seach_time_min' //指定元素
        });
        laydate.render({
            elem: '#seach_time_max' //指定元素
        });
        
        $("#isdaigou").trigger("change");
        
        
       	initTable();
	});
    function GetQueryString(name){
        var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if(r!=null)return  unescape(r[2]); return null;
   }
   // 调用方法
   	id=GetQueryString("prjId");
   
    <!-- 历史表格 -->
    var table2=$('#lookHistory').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 10,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
            { "data": "cgNo"}, 
            { "data": "contractName"}, 
            { "data": "cgcType"}, 
            { "data": "makeTime"}, 
        ],
        "columnDefs": [
						{	
								 "class": "tcenter",
								    "targets": 4,
								    "searchable": true,
								    "render": function(data, type, full) {
								  	  		return '<i class="iconfont icon-icon-test" style="font-size:20px;cursor:pointer;" title="查看详细信息" onclick="lookHistoryDetails(this)" data-toggle="modal" data-target="#History"   id="lookDetall"></i>'
								        }
								  }
						],
        "order": [[1, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
	});
    var table3=$('#fb_table').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 5,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
            { "data": null}, 
            { "data": "contractName"},
            { "data": "fbNo"}, 
            { "data": "ccName"}, 
            { "data": "contractStartTime"},
            { "data": "contractEndTime"}
        ],
        "columnDefs": [
						{
								 "class": "tcenter",
								    "targets": 0,
								    "searchable": true,
								    "render": function(data, type, full) {
								  	  		return '<input type="radio" name="fbName" style="width:16px;height:16px;">'
								        }
								  }
						],
        "order": [[0, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
        
	});
    var xgtable3=$('#xgfb_table').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 5,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
            { "data": null}, 
            { "data": "contractName"},
            { "data": "fbNo"}, 
            { "data": "ccName"}, 
            { "data": "contractStartTime"},
            { "data": "contractEndTime"}
        ],
        "columnDefs": [
						{
								 "class": "tcenter",
								    "targets": 0,
								    "searchable": true,
								    "render": function(data, type, full) {
								  	  		return '<input type="radio" name="xgfbName" style="width:16px;height:16px;">'
								        }
								  }
						],
        "order": [[0, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
        
	});



    
    function chooseFb(){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/subcontract/getFBNameAndNo',
            dataType: 'json',
            async:false,
            data: {
            },
            success: function (json) {
                $('#fb_table').dataTable().fnClearTable();
                $('#fb_table').DataTable().rows.add(json).draw(false);
            }
        });
    	$("#choose_fb").modal("show");
    	$('#choose_fb').on('hidden.bs.modal', function () {//解决模态框页面滚动问题
            if ($('.modal.in').size() >= 1) {
                $('body').addClass('modal-open')
            }
        })
    }

    function saveFbName(){
    	var tr=$("input[name='fbName']:checked").parents("tr");
    	var data=$("#fb_table").DataTable().row(tr).data();
    	console.log(data)
    	if(data==null){
    		toastr.error("请选择")
    		return;
    	}
        $('#fbhetong').val(data.fbNo);
    	$("#choose_fb").modal("hide");
    }
    
    function xgchooseFb(){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/subcontract/getFBNameAndNo',
            dataType: 'json',
            async:false,
            data: {
            },
            success: function (json) {
                $('#xgfb_table').dataTable().fnClearTable();
                $('#xgfb_table').DataTable().rows.add(json).draw(false);
            }
        });
    	$("#xgchoose_fb").modal("show");
    	$('#xgchoose_fb').on('hidden.bs.modal', function () {//解决模态框页面滚动问题
            if ($('.modal.in').size() >= 1) {
                $('body').addClass('modal-open')
            }
        })
    }

    function xgsaveFbName(){
    	var tr=$("input[name='xgfbName']:checked").parents("tr");
    	var data=$("#xgfb_table").DataTable().row(tr).data();
    	if(data==null){
    		toastr.error("请选择")
    		return;
    	}
        $('#xgfbhetong').val(data.fbNo);
    	$("#xgchoose_fb").modal("hide");
    }
    

		
		function lookCancel(obj){
	  		$("#look_cancel").modal("show");
	  	}
    
    
		//初始化部门
	    function selectDepartment(){
	    	$.ajax({
		        type: 'POST',
		        url: getContextPath()+'/organizationManagement/getAllOrganizationManagement',
		        dataType: 'json',
		        data: {
		           
		        },
		        success: function (json) {
		        	//console.log(json)
	        		 $("#cg_bumen").empty();
	        		$("#xgcg_bumen").empty();
		        	 for(var i=0;i<json.length;i++){
		        		$("#cg_bumen").append("<option value="+json[i].omName+" selected>"+json[i].omName+"</option>")
		        		$("#xgcg_bumen").append("<option value="+json[i].omName+" selected>"+json[i].omName+"</option>")
		        	} 
		        }
		    });
		}
    //初始化采购单号
    function initSelect(){
  		$.ajax({
            type: 'POST',
            url: getContextPath()+'/PrjMaterialBuy/selectBuyCode',
            dataType: 'json',
            data: {
            },
            error: function (msg) {
            	toastr.error("请求失败");
            },
            success: function (json) {
            	//console.log(json)
            	$("#selectpicker_no").html('');
            	$("#selectpicker_no2").html('');
            	for(var i=0;i<json.length;i++){
            		$("#selectpicker_no").append("<option  value="+json[i].taskCode+">"+json[i].taskCode+"</option>");
            		$("#selectpicker_no2").append("<option  value="+json[i].taskCode+">"+json[i].taskCode+"</option>");
            	}
            	$('#selectpicker_no').selectpicker('refresh');
            	$('#selectpicker_no2').selectpicker('refresh');
            }
  		});
  	}  
	
	
	function chooseNo(){
		$('.selectpicker').selectpicker('deselectAll'); 
		$("#chooseNo").modal("show");
	}
	function chooseNo2(){
		$('.selectpicker2').selectpicker('deselectAll'); 
		$("#chooseNo2").modal("show");
	}
	
	function quxiao(){
		$('#chooseNo').on('hidden.bs.modal', function () {//解决模态框页面滚动问题
            if ($('.modal.in').size() >= 1) {
                $('body').addClass('modal-open')
            }
        })
        $('#chooseNo').modal("hide");
	}
	function quxiao2(){
		$('#chooseNo2').on('hidden.bs.modal', function () {//解决模态框页面滚动问题
            if ($('.modal.in').size() >= 1) {
                $('body').addClass('modal-open')
            }
        })
        $('#chooseNo2').modal("hide");
	}
	
	
	//保存选择采购单号
	$("#yijianjiesuanMoney").hide();
	function saveNo(){
		$('#chooseNo').on('hidden.bs.modal', function () {//解决模态框页面滚动问题
            if ($('.modal.in').size() >= 1) {
                $('body').addClass('modal-open')
            }
        })
		
		var no_list=$("#selectpicker_no").val();
		if(no_list!=null){
			$("#cghetongMoney").val("");
			$("#cailiaobiaoDiv table").remove();
			$("#yijianjiesuanMoney").show();
			for(var i=0;i<no_list.length;i++){
        		$("#cailiaobiaoDiv").append(
        				"<table  class='table table-bordered table-condensed' id='cailiaobiao"+i+"'>"+
                    	"<thead>"+
                    		"<tr>"+
                            	"<td>采购部门</td>"+
                                "<td dataId='' id='cgbumen"+i+"'></td>"+
                                "<td  colspan='2'>部门采购金额</td>"+
                                "<td id='bumencgMoney"+i+"' colspan='2'></td>"+
                            	"<th colspan='4' style='text-align:right;'></th>"+
                        	"</tr>"+
                        	"<tr>"+
                            	"<th>材料名称</th>"+
                            	"<th>材料类型</th>"+
	                            "<th>材料型号</th>"+
	                            "<th style='width:5%;'>单位</th>"+
	                            "<th>数量</th>"+
	                            "<th style='width:6%;'>单价</th>"+
	                            "<th style='width:7%;'>金额</th>"+
	                            "<th>项目部推荐供应商</th>"+
	                            "<th>公司确定供应商</th>"+
	                            "<th style='width:5%;'>备注</th>"+
                        	"</tr>"+
                    	"</thead>"+
                    	"<tbody>"+
                    	"</tbody>"+
                    "</table>"
                    )}
		  		$.ajax({
		            type: 'POST',
		            url: getContextPath()+'/PrjMaterialBuy/selectBuyByIds',
		            dataType: 'json',
		            async:false,
		            data: {
		            	ids:no_list.toString()
		            },
		            success: function (json) {
		            	//console.log(json)
		            	var array1=new Array();
		            	var array2=new Array();
		            	for(var i=0;i<json.length;i++){
		            		var applyCode=json[i].applyCode
		            		var applyPrj=json[i].applyPrj
		            		var omName=json[i].omName
		            		var sumPrice=json[i].sumPrice;
		            		var pmbId=json[i].pmbId;
		            		if($.inArray(applyCode, array1)==-1){
		            			array1.push(applyCode)
		            		}
		            		if($.inArray(applyPrj, array2)==-1){
		            			array2.push(applyPrj)
		            		}
		            		$("#cgbumen"+i+"").text(json[i].omName)
		            		$("#cgbumen"+i+"").attr("dataId",pmbId)
		            		
		            		$.ajax({
		                        type: 'POST',
		                        url: getContextPath()+'/cgcontract/getMdById',
		                        dataType: 'json',
		                        async:false,
		                        data: {
		                        	id:pmbId
		                        },
		                        success: function (json) {
		                        	//console.log(json)
		                        	for(var k=0;k<json.length;k++){
		                        		$("#cailiaobiao"+i+" tbody").append("<tr dataId="+json[k].mdlId+"><td style='width:10%;'>"
		                		  				+'<input type="text" class="form-control" value='+json[k].materialName+' style="width:100%;">'
		                		  				+"</td><td style='width:10%;'>"
		                		  				+'<input type="text" class="form-control" value='+json[k].materialType+' style="width:100%;">'
		                		  				+"</td><td style='width:10%;'>"
		                		  				+'<input type="text" class="form-control" value='+json[k].modeType+' style="width:100%;">'
		                		  				+"</td><td style='width:10%;'>"
		                		  				+'<input type="text" class="form-control" value='+json[k].buyCompany+' style="width:100%;">'
		                		  				+"</td><td style='width:10%;'>"
		                		  				+'<input type="text" class="form-control" value='+json[k].num+' style="width:100%;">'
		                		  				+"</td><td style='width:10%;'>"
		                		  				+'<input type="text" class="form-control"  style="width:80%;">'
		                		  				+"</td><td style='width:10%;'>"
		                		  				+'<input type="text" class="form-control" value='+json[k].price+' style="width:100%;">'
		                		  				+"</td><td style='width:10%;'>"
		                		  				+'<select style="width:150px;" class="form-control" id=xm'+json[k].mdlId+'></select>'
		                		  				+"</td><td style='width:10%;'>"
		                		  				+'<select style="width:150px;" class="form-control" id=gs'+json[k].mdlId+'></select>'
		                		  				+"</td><td style='width:10%;'>"
		                		  				+'<input type="text" class="form-control" value='+json[k].infos+' style="width:100%;">'
		                		  				+"</td></tr>")
		                		  				
		                		  				initName1(json[k].provideCompany,json[k].mdlId);
		                        				initName2(json[k].sureMaterialMode,json[k].mdlId);
		                		  				
		                		  				
		                        	} 
		                        }
		              		});
		            		
		            	}
	            		$("#cgdNo").val(no_list)
	            		$('#task_no').val(array1.toString())
		            	$('#prjName').val(array2.toString())
		            	$("#chooseNo").modal("hide");
		            }
		  		});
		  		
	  		}else{
	  			toastr.error("采购单号为空");
	  		}
	}
	
	function initClType(obj1,obj2){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/MaterialType/selectMaterialType',
            dataType: 'json',
            data: {
            },
            success: function (json) {
            	$("#cl_type"+obj2).empty();
            	$("#xgcl_type"+obj2).empty();
            	for(var i=0;i<json.length;i++){
            		$("#cl_type"+obj2).append("<option value="+json[i].materialType+">"+json[i].materialType+"</option>");
            		$("#xgcl_type"+obj2).append("<option value="+json[i].materialType+">"+json[i].materialType+"</option>");
            	}
            	$("#cl_type"+obj2).val(obj1)
            	$("#xgcl_type"+obj2).val(obj1)
            }
  		});
    }
	//初始化供应商
	function initName1(obj1,obj2){
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/supplier/selectIdAndName',
            dataType: 'json',
            data: {

            },
            success: function (json) {
            	$("#xm"+obj2).empty();
            	$("#xgxm"+obj2).empty();
                for(var i=0;i<json.length;i++){
                	$("#xm"+obj2).append("<option value="+json[i].spId+">"+json[i].spName+"</option>");
                	$("#xgxm"+obj2).append("<option value="+json[i].spId+">"+json[i].spName+"</option>");
                }
                $("#xm"+obj2).val(obj1);
                $("#xgxm"+obj2).val(obj1);
            }
		});
	}
	function initName2(obj1,obj2){
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/supplier/selectIdAndName',
            dataType: 'json',
            data: {

            },
            success: function (json) {
            	$("#gs"+obj2).empty();
            	$("#xggs"+obj2).empty();
                for(var i=0;i<json.length;i++){
                	$("#gs"+obj2).append("<option value="+json[i].spId+">"+json[i].spName+"</option>");
                	$("#xggs"+obj2).append("<option value="+json[i].spId+">"+json[i].spName+"</option>");
                }
                $("#gs"+obj2).val(obj1);
                $("#xggs"+obj2).val(obj1);
            }
		});
	}
	
	
    //一键结算金额
	function yijianjiesuan(type){
		//console.log(obj)
		if(type==1){
			var hetongMoney=0;
			$("#cailiaobiaoDiv table").each(function(){
				var bumenMoney=0;
				$(this).find("tbody").eq(0).find("tr").each(function(){
					var danjia=$(this).find("td").eq(5).find("input").val();
					var num=$(this).find("td").eq(4).find("input").val();
					if(danjia==''||danjia==null){
						toastr.error("单价不能为空");
						return;
					}
					var money=danjia*num
					$(this).find("td").eq(6).find("input").val(money);
					bumenMoney+=money;
				})
				$(this).find("thead").eq(0).find("tr").eq(0).find("td").eq(3).text(bumenMoney)
				hetongMoney+=bumenMoney;
			})
			$("#cghetongMoney").val(hetongMoney);
		}else if(type==2){
			var hetongMoney=0;
			$("#xgcailiaobiaoDiv table").each(function(){
				var bumenMoney=0;
				$(this).find("tbody").eq(0).find("tr").each(function(){
					var danjia=$(this).find("td").eq(5).find("input").val();
					var num=$(this).find("td").eq(4).find("input").val();
					if(danjia==''||danjia==null){
						toastr.error("单价不能为空");
						return;
					}
					var money=danjia*num
					$(this).find("td").eq(6).find("input").val(money);
					bumenMoney+=money;
				})
				$(this).find("thead").eq(0).find("tr").eq(0).find("td").eq(3).text(bumenMoney)
				hetongMoney+=bumenMoney;
			})
			$("#xgcghetongMoney").val(hetongMoney);
		}
	}
	
	//修改保存选择采购单号
	$("#xgyijianjiesuanMoney").hide();
	function saveNo2(){
		$('#chooseNo2').on('hidden.bs.modal', function () {//解决模态框页面滚动问题
            if ($('.modal.in').size() >= 1) {
                $('body').addClass('modal-open')
            }
        })
		
		var no_list2=$("#selectpicker_no2").val();
		if(no_list2!=null){
			$("#xgcghetongMoney").val("");
			$("#xgcailiaobiaoDiv table").remove();
			$("#xgyijianjiesuanMoney").show();
			for(var i=0;i<no_list2.length;i++){
        		$("#xgcailiaobiaoDiv").append(
        				"<table  class='table table-bordered table-condensed' id='xgcailiaobiao"+i+"'>"+
                    	"<thead>"+
                    		"<tr>"+
                            	"<td>采购部门</td>"+
                                "<td dataId='' id='xgcgbumen"+i+"'></td>"+
                                "<td  colspan='2'>部门采购金额</td>"+
                                "<td id='xgbumencgMoney"+i+"' colspan='2'></td>"+
                            	"<th colspan='4' style='text-align:right;'></th>"+
                        	"</tr>"+
                        	"<tr>"+
                            	"<th>材料名称</th>"+
                            	"<th>材料类型</th>"+
	                            "<th>材料型号</th>"+
	                            "<th style='width:6%;'>单位</th>"+
	                            "<th>数量</th>"+
	                            "<th style='width:8%;'>单价</th>"+
	                            "<th style='width:8%;'>金额</th>"+
	                            "<th>项目部推荐供应商</th>"+
	                            "<th>公司确定供应商</th>"+
	                            "<th>备注</th>"+
	                            "<th style='width:5%;'>操作</th>"+
                        	"</tr>"+
                    	"</thead>"+
                    	"<tbody>"+
                    	"</tbody>"+
                    "</table>"
                    )}
			$.ajax({
	            type: 'POST',
	            url: getContextPath()+'/PrjMaterialBuy/selectBuyByIds',
	            dataType: 'json',
	            data: {
	            	ids:no_list2.toString()
	            },
	            success: function (json) {
	            	$("#xgprjName").empty()
	            	$("#xgtask_no").empty()
	            	for(var i=0;i<json.length;i++){
	            		$("#xgprjName").append("<option value="+json[i].applyPrj+">"+json[i].applyPrj+"</option>")
                		$("#xgtask_no").append("<option value="+json[i].applyCode+">"+json[i].applyCode+"</option>")
	            		var omName=json[i].omName
	            		var pmbId=json[i].pmbId;
	            		$("#xgcg_bumen").val(json[i].omName)
	            		
	            		$.ajax({
	                        type: 'POST',
	                        url: getContextPath()+'/cgcontract/getMdById',
	                        dataType: 'json',
	                        async:false,
	                        data: {
	                        	id:pmbId
	                        },
	                        success: function (json) {
	                        	//console.log(json)
	                        	for(var k=0;k<json.length;k++){
	                        		$("#xgcailiaobiao"+i+" tbody").append("<tr dataId="+json[k].mdlId+"><td style='width:10%;'>"
	                		  				+'<input type="text" class="form-control" value='+json[k].materialName+' style="width:100%;">'
	                		  				+"</td><td style='width:10%;'>"
	                		  				//+'<input type="text" class="form-control" value='+json[k].materialType+' style="width:100%;">'
	                		  				+'<select class="form-control" id="xgcl_type'+json[k].mdlId+'"></select>'
	                		  				+"</td><td style='width:10%;'>"
	                		  				+'<input type="text" class="form-control" value='+json[k].modeType+' style="width:100%;">'
	                		  				+"</td><td style='width:10%;'>"
	                		  				//+'<input type="text" class="form-control" value='+json[k].buyCompany+' style="width:100%;">'
	                		  				+'<select class="form-control"  id=xgcl_danwei'+json[k].mdlId+'>'
														+'<option value="个">个</option>'
														+'<option value="只">只</option>'
														+'<option value="套">套</option>'
														+'<option value="副">副</option>'
														+'<option value="双">双</option>'
														+'<option value="元">元</option>'
														+'<option value="桶">桶</option>'
													+'</select>'
	                		  				+"</td><td style='width:10%;'>"
	                		  				+'<input type="text" class="form-control" value='+json[k].num+' style="width:100%;">'
	                		  				+"</td><td style='width:10%;'>"
	                		  				+'<input type="text" class="form-control"  style="width:80%;">'
	                		  				+"</td><td style='width:10%;'>"
	                		  				+'<input type="text" class="form-control" value='+json[k].price+' style="width:100%;">'
	                		  				+"</td><td style='width:10%;'>"
	                		  				+'<select style="width:150px;" class="form-control" id=xgxm'+json[k].mdlId+'></select>'
	                		  				+"</td><td style='width:10%;'>"
	                		  				+'<select style="width:150px;" class="form-control" id=xggs'+json[k].mdlId+'></select>'
	                		  				+"</td><td style='width:10%;'>"
	                		  				+'<input type="text" class="form-control" value='+json[k].infos+' style="width:100%;">'
	                		  				+"</td><td style='width:9%;'>"
	                		  				+'<button type="button" class="btn btn-primary" onclick="removeThis(this)">删除</button>'
	                		  				+"</td></tr>")
	                		  				initClType(json[k].materialType,json[k].mdlId);
	                        				$("#xgcl_danwei"+json[k].mdlId).val(json[k].buyCompany);
	                		  				initName1(json[k].provideCompany,json[k].mdlId);
                    						initName2(json[k].sureMaterialMode,json[k].mdlId);
	                        	} 
	                        }
	              		});
	            		
	            	}
            		$('#xgcgdNo').val(no_list2)
	            	$("#xgprjName").trigger("change")
	            	$("#xgtask_no").trigger("change")
	            	$("#chooseNo2").modal("hide");
	            	
	            }
	  		});
		  		
	  		}else{
	  			toastr.error("采购单号为空");
	  		}
	}
	
	
	
	//初始化乙方
    function inityifang(){
	    $.ajax({
	        type: 'POST',
	        url: getContextPath()+'/supplier/selectIdAndName',
	        dataType: 'json',
	        data: {
	        },
	        success: function (json) {
	        	$("#yifang").html('');
	        	$("#xgyifang").html('');
	        	 for(var i=0;i<json.length;i++){
	        		$("#yifang").append( "<option value='" + json[i].spId + "'>"
		                    + json[i].spName + "</option>")
		            $("#xgyifang").append( "<option value='" + json[i].spId + "'>"
		                    + json[i].spName + "</option>")
	        	}
	        }
	    });
	}
	
	
	//填报保存
	function saveCg(){
		var cghetongming=$("#cghetongming").val();
		var cgdNo=$("#cgdNo").val();
		var task_no=$("#task_no").val();
		var prjName=$("#prjName").val();
		var isdaigou=$("#isdaigou").val();
		var fbhetong=$("#fbhetong").val();
		var daigouType=$("#daigouType").val();
		var cghetongType=$("#cghetongType").val();
		var daigouMoney=$("#daigouMoney").val();
		var cghetongMoney=$("#cghetongMoney").val();
		var hetongjiafang=$("#hetongjiafang").val();
		var yifang=$("#yifang").val();
		var fukuangfangshi=$("#fukuangfangshi").val();
		var year=$("#year").val();
		var hetonggaishu=$("#hetonggaishu").val();
		var gaikuang=$("#gaikuang").val();
		
		if(cghetongming==''){
			toastr.error("采购合同名称为空");
			return;
		}
		if(cghetongMoney==''){
			toastr.error("采购合同金额为空");
			return;
		} 
		if(cghetongMoney==0){
			toastr.error("采购合同金额不能为0");
			return;
		}
		if($("#new_accessory").find('tbody tr').length<1 || $("#file").val()==''){
			toastr.error("采购合同文本附件为空")
			return;
		} 
		if($("#new_accessory1").find('tbody tr').length<1 || $("#file1").val()==''){
			toastr.error("法律顾问签字附件为空")
			return;
		}
		if(isdaigou=='是'){
			if(fbhetong==''){
				toastr.error("分包合同不能为空")
				return;
			}
			var reg=/^\d+(\.\d{0,2})?$/;//只能输入数字或含两位小数的正则
			if(!reg.test(daigouMoney)){
				toastr.error("代购金额只能输入数字且只能有两位小数");
				return;
			}
		}
		
		var options={
	            type: 'POST',
	            url: getContextPath()+'/cgcontract/addCgContractSave',
	            dataType: 'json',
	            data: { 
	            	contractName:cghetongming,
	            	cgdNo:cgdNo,
	            	workNo:task_no,
	            	prjName:prjName,
	            	cgcType:cghetongType,
	            	isProgram:isdaigou,
	            	fbNo:fbhetong,
	            	programType:daigouType,
	            	programMoney:daigouMoney,
	            	cgContractMoney:cghetongMoney,
	            	contractNameJia:hetongjiafang,
	            	contractNameYi:yifang,
	            	payMode:fukuangfangshi,
	            	contractSignTime:year,
	            	contractSummary:hetonggaishu,
	            	workContent:gaikuang,
	            },
	            success: function (json) {
	            	//console.log(json);
	            	if(json==0){
						toastr.error("添加失败")
					}else if(json>0){
						//location.reload([true]);
						toastr.success("添加成功")
						$("#myModal").modal("hide")
					
						
						$("#cailiaobiaoDiv table").each(function(){
							//保存部门采购金额
							$(this).find("thead").eq(0).find("tr").eq(0).each(function(){
								var id=$(this).find("td").eq(1).attr("dataId");
								var bumenMoney=$(this).find("td").eq(3).text();
								//console.log(id)
								$.ajax({
							        type: 'POST',
							        url: getContextPath()+'/cgcontract/updateDepartmentMoney',
							        dataType: 'json',
							        data: {
							        	id:id,
							        	price:bumenMoney
							        },
							        success: function (json) {
							        	//console.log(json)
							        	if(json=0){
							        		toastr.error("部门采购金额添加失败")
							        	}
							        }
							    });
							})
							//保存材料信息
							$(this).find("tbody").find("tr").each(function(){
								var mdlId=$(this).eq(0).attr("dataId")
								//console.log(mdlId)
								var clname=$(this).find("td").eq(0).find("input").val();
								var cltype=$(this).find("td").eq(1).find("input").val();
								var clxinghao=$(this).find("td").eq(2).find("input").val();
								var danwei=$(this).find("td").eq(3).find("input").val();
								var danjia=$(this).find("td").eq(5).find("input").val();
								var num=$(this).find("td").eq(4).find("input").val();
								var xm=$(this).find("td").eq(7).find("option:selected").val();
								var gs=$(this).find("td").eq(8).find("option:selected").val();
								var beizhu=$(this).find("td").eq(9).find("input").val();
								$.ajax({
							        type: 'POST',
							        url: getContextPath()+'/cgcontract/updateMaterial',
							        dataType: 'json',
							        data: {
							        	mdlId:mdlId,
							        	materialName:clname,
							        	materialType:cltype,
							        	modeType:clxinghao,
							        	buyCompany:danwei,
							        	price:danjia,
							        	num:num,
							        	provideCompany:xm,
							        	sureMaterialMode:gs,
							        	infos:beizhu
							        },
							        success: function (json) {
							        	//console.log(json)
							        	if(json=0){
							        		toastr.error("材料单价修改失败")
							        	}
							        }
							    });
								
							})
						})
						
					}
	            }
	        };
			$("#new_form").ajaxSubmit(options);
	}
	//填报提交
	function submitCg(){
		var cghetongming=$("#cghetongming").val();
		var cgdNo=$("#cgdNo").val();
		var task_no=$("#task_no").val();
		var prjName=$("#prjName").val();
		var isdaigou=$("#isdaigou").val();
		var fbhetong=$("#fbhetong").val();
		var daigouType=$("#daigouType").val();
		var cghetongType=$("#cghetongType").val();
		var daigouMoney=$("#daigouMoney").val();
		var cghetongMoney=$("#cghetongMoney").val();
		var hetongjiafang=$("#hetongjiafang").val();
		var yifang=$("#yifang").val();
		var fukuangfangshi=$("#fukuangfangshi").val();
		var year=$("#year").val();
		var hetonggaishu=$("#hetonggaishu").val();
		var gaikuang=$("#gaikuang").val();
		
		if(cghetongming==''){
			toastr.error("采购合同名称为空");
			return;
		}
		if(cghetongMoney==''){
			toastr.error("采购合同金额为空");
			return;
		}
		if(cghetongMoney==0){
			toastr.error("采购合同金额不能为0");
			return;
		}
		if($("#new_accessory").find('tbody tr').length<1 || $("#file").val()==''){
			toastr.error("采购合同文本附件为空")
			return;
		} 
		if($("#new_accessory1").find('tbody tr').length<1 || $("#file1").val()==''){
			toastr.error("法律顾问签字附件为空")
			return;
		}
		if(isdaigou=='是'){
			if(fbhetong==''){
				toastr.error("分包合同不能为空")
				return;
			}
			var reg=/^\d+(\.\d{0,2})?$/;//只能输入数字或含两位小数的正则
			if(!reg.test(daigouMoney)){
				toastr.error("代购金额只能输入数字且只能有两位小数");
				return;
			}
		}	
		
		var options={
	            type: 'POST',
	            url: getContextPath()+'/cgcontract/addCgContractSubmit',
	            dataType: 'json',
	            data: { 
	            	contractName:cghetongming,
	            	cgdNo:cgdNo,
	            	workNo:task_no,
	            	prjName:prjName,
	            	cgcType:cghetongType,
	            	isProgram:isdaigou,
	            	fbNo:fbhetong,
	            	programType:daigouType,
	            	programMoney:daigouMoney,
	            	cgContractMoney:cghetongMoney,
	            	contractNameJia:hetongjiafang,
	            	contractNameYi:yifang,
	            	payMode:fukuangfangshi,
	            	contractSignTime:year,
	            	contractSummary:hetonggaishu,
	            	workContent:gaikuang,
	            },
	            success: function (json) {
	            	//console.log(json);
	            	if(json==0){
						toastr.error("添加失败")
					}else if(json>0){
						//location.reload([true]);
						toastr.success("添加成功")
						$("#myModal").modal("hide")
						
						
						$("#cailiaobiaoDiv table").each(function(){
							//保存部门采购金额
							$(this).find("thead").eq(0).find("tr").eq(0).each(function(){
								var id=$(this).find("td").eq(1).attr("dataId");
								var bumenMoney=$(this).find("td").eq(3).text();
								$.ajax({
							        type: 'POST',
							        url: getContextPath()+'/cgcontract/updateDepartmentMoney',
							        dataType: 'json',
							        data: {
							        	id:id,
							        	price:bumenMoney
							        },
							        success: function (json) {
							        	//console.log(json)
							        	if(json=0){
							        		toastr.error("部门采购金额添加失败")
							        	}
							        }
							    });
							})
							//保存材料单价
							$(this).find("tbody").find("tr").each(function(){
								var mdlId=$(this).eq(0).attr("dataId2")
								var clname=$(this).find("td").eq(0).find("input").val();
								var cltype=$(this).find("td").eq(1).find("input").val();
								var clxinghao=$(this).find("td").eq(2).find("input").val();
								var danwei=$(this).find("td").eq(3).find("input").val();
								var danjia=$(this).find("td").eq(5).find("input").val();
								var num=$(this).find("td").eq(4).find("input").val();
								var xm=$(this).find("td").eq(7).find("option:selected").val();
								var gs=$(this).find("td").eq(8).find("option:selected").val();
								var beizhu=$(this).find("td").eq(9).find("input").val();
								$.ajax({
							        type: 'POST',
							        url: getContextPath()+'/cgcontract/updateMaterial',
							        dataType: 'json',
							        data: {
							        	mdlId:mdlId,
							        	materialName:clname,
							        	materialType:cltype,
							        	modeType:clxinghao,
							        	buyCompany:danwei,
							        	price:danjia,
							        	num:num,
							        	provideCompany:xm,
							        	sureMaterialMode:gs,
							        	infos:beizhu
							        },
							        success: function (json) {
							        	if(json=0){
							        		toastr.error("材料单价修改失败")
							        	}
							        }
							    });
							})
						})
						
					}
	            }
	        };
			$("#new_form").ajaxSubmit(options);
	}
	
	$("#isdaigou").on("change",function(){
		var isdaigou=$("#isdaigou").val();
		if(isdaigou=="是"){
			$("#daigouType").html("");
			$("#daigouType").append("<option value='无息代购'>无息代购</option><option value='有息代购'>有息代购</option><option value='对方打款'>对方打款</option>")
			$("#chooseFb").attr("disabled",false);
			$("#daigouType").attr("disabled",false);
			$("#daigouMoney").attr("disabled",false);
		}else if(isdaigou=="否"){
			$("#daigouType").html("");
			$("#fbhetong").val("");
			$("#daigouMoney").val("0");
			$("#daigouType").append("<option value='无'>无</option>")
			$("#chooseFb").attr("disabled",true);
			$("#daigouType").attr("disabled",true);
			$("#daigouMoney").attr("disabled",true);
		}
	})
	
	$("#xgisdaigou").on("change",function(){
		var isdaigou=$("#xgisdaigou").val();
		if(isdaigou=="是"){
			$("#xgdaigouType").html("");
			$("#xgdaigouType").append("<option value='无息代购'>无息代购</option><option value='有息代购'>有息代购</option><option value='对方打款'>对方打款</option>")
			$("#xgchooseFbbutton").attr("disabled",false);
			$("#xgdaigouType").attr("disabled",false);
			$("#xgdaigouMoney").attr("disabled",false);
		}else if(isdaigou=="否"){
			$("#xgdaigouType").html("");
			$("#xgfbhetong").val("");
			$("#xgdaigouMoney").val("0");
			$("#xgdaigouType").append("<option value='无'>无</option>")
			$("#xgchooseFbbutton").attr("disabled",true);
			$("#xgdaigouType").attr("disabled",true);
			$("#xgdaigouMoney").attr("disabled",true);
		}
	})
	function xgselectBorrowByFbNo(obj,obj2){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/cgcontract/getRateAndMoney',
            dataType: 'json',
            async:false,
            data: {
            	no:obj,
            },
            success: function (json) {
                $('#borrow_no').html("");
            	$('#borrow_no').append("<option data-id='请选择' value='请选择'>--请选择--</option>")
            	 $('#xgborrow_no').html("");
            	$('#xgborrow_no').append("<option data-id='请选择' value='请选择'>--请选择--</option>")
                for(var i=0;i<json.length;i++){
                	 $('#borrow_no').append("<option data-id="+json[i].rate+" value="+json[i].bNo+">"+json[i].bNo+"</option>")
                	 $('#xgborrow_no').append("<option data-id="+json[i].rate+" value="+json[i].bNo+">"+json[i].bNo+"</option>")
                }
            	$('#xgborrow_no').val(obj2)
                /* $('#borrow_no').trigger("change");
                $('#xgborrow_no').trigger("change"); */
            }
        });
    }
	function initMaterialCompany(obj1,obj2){
	    	$.ajax({
		        type: 'POST',
		        url: getContextPath()+'/MaterialCompany/getAllMaterialCompany',
		        dataType: 'json',
		        data: {
		        },
		        success: function (json) {
		        	//console.log(json)
		        	$("#cl_danwei"+obj2).empty();
            		$("#xgcl_danwei"+obj2).empty();
		        	for(var i=0;i<json.length;i++){
	            		$("#cl_danwei"+obj2).append("<option value="+json[i].mcName+">"+json[i].mcName+"</option>");
	            		$("#xgcl_danwei"+obj2).append("<option value="+json[i].mcName+">"+json[i].mcName+"</option>");
	            	}
		        	$("#cl_danwei"+obj2).val(obj1);
            		$("#xgcl_danwei"+obj2).val(obj1);
		        }
		    });
		}
	//修改回显
	function initTable(){
		$.ajax({
			type:"post",
			url:getContextPath()+"/cgcontract/selectCgContractById",
			dataType:"json",
			async:false,
			data:{
				id:id,
			},
			success:function(json){
				console.log(json)
				$("#xgcghetongming").val(json.contractName);
				$("#xgcgNo").val(json.cgNo)
				$("#xgcgdNo").val(json.cgdNo)
				$("#xgtask_no").val(json.workNo);
				$("#xgprjName").val(json.prjName); 
        		
				$("#xgisdaigou").val(json.isProgram);
				if(json.isProgram=="否"){
					$("#xgchooseFbbutton").attr("disabled",true);
					$("#xgdaigouType").attr("disabled",true);
					$("#xgdaigouMoney").attr("disabled",true);
				}else if(json.isProgram=="是"){
					$("#xgdaigouType").html("");
					$("#xgdaigouType").append("<option value='对方打款'>对方打款</option><option value='无息代购'>无息代购</option><option value='有息代购'>有息代购</option>")
					$("#xgchooseFbbutton").attr("disabled",false);
					$("#xgdaigouType").attr("disabled",false);
					$("#xgdaigouMoney").attr("disabled",false);
				}
				$("#xgfbhetong").val(json.fbNo);
				$("#xgdaigouType").val(json.programType);
				$("#xgcghetongType").val(json.cgcType);
				$("#xgdaigouMoney").val(json.programMoney);
				$("#xgcghetongMoney").val(json.cgContractMoney);
				$("#xghetongjiafang").val(json.contractNameJia);
				$("#xgyifang").val(json.contractNameYi).select2();
				$("#xgfukuangfangshi").val(json.payMode);
				$("#xgyear").val(json.contractSignTime);
				$("#xghetonggaishu").val(json.contractSummary);
				$("#xggaikuang").val(json.workContent);
				$("#xgcg_bumen").val(json.cgDepartment);
				$("#xgyunfei").val(json.freight)
				xgselectBorrowByFbNo(json.fbNo,json.borrowNo)
				$("#edit_cl_table tbody").empty();
				if(json.cgcl!=null){
					for(var k=0;k<json.cgcl.length;k++){
                   		$("#edit_cl_table tbody").append("<tr><td>"
           		  				+'<input type="text" class="form-control" style="width:100%;" value='+json.cgcl[k].clName+' >'
           		  				+"</td><td>"
           		  				+'<select style="width:100%;" class="form-control" id="cl_type'+k+'"></select>'
           		  				+"</td><td>"
           		  				+'<input type="text" class="form-control" style="width:100%;" value='+json.cgcl[k].clMode+' >' 
           		  				+"</td><td>"
           		  				+'<select class="form-control"style="width:100%;" id=xgcl_danwei'+k+'>'
										+'</select>'
           		  				+"</td><td>"
           		  				+'<input type="text" class="form-control" style="width:100%;" value='+json.cgcl[k].clNumber+' >'
           		  				+"</td><td>"
           		  				+'<input type="text" class="form-control" style="width:100%;" value='+json.cgcl[k].clPrice+'  >'
           		  				+"</td><td>"
           		  				+'<input type="text" class="form-control" style="width:100%;" value='+json.cgcl[k].clMoney+' >'
           		  				+"</td><td>"
           		  				+'<select style="width:100%;" class="form-control" id=xm'+k+'></select>'
           		  				+"</td><td>"
           		  				+'<select style="width:100%;" class="form-control" id=gs'+k+'></select>'
           		  				+"</td><td>"
           		  				+'<input type="text" class="form-control" style="width:100%;" value='+json.cgcl[k].clDesc+' >'
           		  				+"</td><td style='width:10%;'>"
           		  				+'<button type="button" class="btn btn-primary" onclick="removeThis(this)">删除</button>'
           		  				+"</td></tr>")
           		  				initClType(json.cgcl[k].clType,k);
           		  				initName1(json.cgcl[k].clPrjSupplier,k);
                   				initName2(json.cgcl[k].clGsSupplier,k);
                   				//$("#cl_danwei"+k).val(json.cgcl[k].clUnit);
                   				initMaterialCompany(json.cgcl[k].clUnit,k)
           		  				
                    	} 
				}
				
			}
		}) 
		$.ajax({
			type:"post",
			url:getContextPath()+"/cgcontract/selectAccessoryById",
			dataType:"json",
			async:false,
			data:{
				id:id,
			},
			success:function(json){
	            for(var i=0;i<json.length;i++){
	            	   if(json[i].aType=="采购合同文本"){
		            	   $("#edit_accessory thead").append("<tr>"+
	      	   										"<td>采购合同文本</td>"+
							            	    	"<td><input type='text' class='form-control' style='width:100%;' value='"+json[i].acName+"' disabled></td>"+
							            	    	"<td colspan='2'><a class='btn btn-primary' href='"+getLocalPath()+"/oa_file/"+json[i].acUrl+"' target='view_window'>查看附件</a>  <button type='button' class='btn btn-primary' data1='"+json[i].aId+"' data2='"+json[i].acUrl+"' onclick='delete_all(this)'>删除附件</button></td>"+
							            	    "</tr>");
	            	   }
	               }
			}
		})
	}
	function huixianPrjNameAndNo(obj1,obj2,obj3){
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/PrjMaterialBuy/selectBuyByIds',
            dataType: 'json',
            data: {
            	ids:obj1
            },
            success: function (json) {
            	$("#xgprjName").empty()
            	$("#xgtask_no").empty()
            	for(var i=0;i<json.length;i++){
            		$("#xgprjName").append("<option value="+json[i].applyPrj+">"+json[i].applyPrj+"</option>")
            		$("#xgtask_no").append("<option value="+json[i].applyCode+">"+json[i].applyCode+"</option>")
            	}
            	$("#xgprjName").val(obj2)
            	$("#xgtask_no").val(obj3)
            }
		});
		
	}
	
	
	function delete_all(obj){
		var id=$(obj).attr("data1");
		var name=$(obj).parents("tr").find("td").eq(1).find("input").val();
		var url=$(obj).attr("data2");
		var statu = confirm("确认删除吗?");
		  if(!statu){
		   return false;
		  }
		$.ajax({
			type: 'POST',
            url: getContextPath()+'/announcement/deleteAccessory',
            dataType: 'json',
            data: {
            	aId:id,
            	acName:name,
            	acUrl:url
            },
            success: function (json) {
            	if(json==0){
            		toastr.error("删除附件失败");
            	}else{
            		$(obj).parents("tr").remove();
            		toastr.success("删除附件成功");
            	}
            }
		});
	}
	
	function huixianPrjNameAndNo(obj1,obj2,obj3){
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/PrjMaterialBuy/selectBuyByIds',
            dataType: 'json',
            data: {
            	ids:obj1
            },
            success: function (json) {
            	$("#xgprjName").empty()
            	$("#xgtask_no").empty()
            	for(var i=0;i<json.length;i++){
            		$("#xgprjName").append("<option value="+json[i].applyPrj+">"+json[i].applyPrj+"</option>")
            		$("#xgtask_no").append("<option value="+json[i].applyCode+">"+json[i].applyCode+"</option>")
            	}
            	$("#xgprjName").val(obj2)
            	$("#xgtask_no").val(obj3)
            }
		});
		
	}
	
	//删除附件
	function deletefile(obj){
		var id=$(obj).attr("data1");
		var name=$(obj).parents("tr").find("td").eq(1).find("input").val();
		var url=$(obj).attr("data2");
		$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/cgcontract/deleteAccessory',
	        dataType: 'json',
	        data: {
	        	aId:id,
	        	acName:name,
	        	acUrl:url
	        },
	        success: function (json) {
	        	if(json==0){
	        		toastr.error("删除失败");
	        	}else{
	        		toastr.success("删除成功");
	        		$(obj).parent().parent().remove();
	        		//$('#change').modal('hide');
	        	}
	        }
		});
	}
	
	
	//修改保存
	function liuchengGaibian(){
		//保存材料信息
		var xgcgclArr=new Array();
		$("#xgcailiaobiaoDiv table").find("tbody").find("tr").each(function(){
				var clname=$(this).find("td").eq(0).find("input").val();
				var cltype=$(this).find("td").eq(1).find("option:selected").val();
				var clxinghao=$(this).find("td").eq(2).find("input").val();
				var danwei=$(this).find("td").eq(3).find("option:selected").val();
				var num=$(this).find("td").eq(4).find("input").val();
				var danjia=$(this).find("td").eq(5).find("input").val();
				var jine=$(this).find("td").eq(6).find("input").val();
				var xm=$(this).find("td").eq(7).find("option:selected").val();
				var gs=$(this).find("td").eq(8).find("option:selected").val();
				var beizhu=$(this).find("td").eq(9).find("input").val();
				var cgcl={
						 cgId:undefined,       
						 clName:undefined,         
						 clType:undefined,         
						 clMode:undefined,         
						 clUnit:undefined,         
						 clNumber:undefined,       
						 clPrice:0,         
						 clMoney:0,         
						 clPrjSupplier:undefined,  
						 clGsSupplier:undefined,   
						 clDesc:undefined,         
				}
				cgcl.clName=clname;
				cgcl.clType=cltype;        
				cgcl.clMode=clxinghao;         
				cgcl.clUnit=danwei;         
				cgcl.clNumber=num;     
				cgcl.clPrice=danjia;         
				cgcl.clMoney=jine;         
				cgcl.clPrjSupplier=xm;
				cgcl.clGsSupplier=gs;
				cgcl.clDesc=beizhu; 
				xgcgclArr.push(cgcl)
		})
		$("#edit_cl_table tbody").find("tr").each(function(){
				var clname=$(this).find("td").eq(0).find("input").val();
				var cltype=$(this).find("td").eq(1).find("option:selected").val();
				var clxinghao=$(this).find("td").eq(2).find("input").val();
				var danwei=$(this).find("td").eq(3).find("option:selected").val();
				var num=$(this).find("td").eq(4).find("input").val();
				var danjia=$(this).find("td").eq(5).find("input").val();
				var jine=$(this).find("td").eq(6).find("input").val();
				var xm=$(this).find("td").eq(7).find("option:selected").val();
				var gs=$(this).find("td").eq(8).find("option:selected").val();
				var beizhu=$(this).find("td").eq(9).find("input").val();
				var cgcl={
						 cgId:undefined,       
						 clName:undefined,         
						 clType:undefined,         
						 clMode:undefined,         
						 clUnit:undefined,         
						 clNumber:undefined,       
						 clPrice:0,         
						 clMoney:0,         
						 clPrjSupplier:undefined,  
						 clGsSupplier:undefined,   
						 clDesc:undefined,         
				}
				cgcl.clName=clname;
				cgcl.clType=cltype;        
				cgcl.clMode=clxinghao;         
				cgcl.clUnit=danwei;         
				cgcl.clNumber=num;     
				cgcl.clPrice=danjia;         
				cgcl.clMoney=jine;         
				cgcl.clPrjSupplier=xm;
				cgcl.clGsSupplier=gs;
				cgcl.clDesc=beizhu; 
				xgcgclArr.push(cgcl)
		})
		
		var xgcghetongming=$("#xgcghetongming").val();
		var xgcgNo=$("#xgcgNo").val();
		var xgcgdNo=$("#xgcgdNo").val();
		var xgtask_no=$("#xgtask_no").val();
		var xgprjName=$("#xgprjName").val();
		var xgisdaigou=$("#xgisdaigou").val();
		var xgfbhetong=$("#xgfbhetong").val();
		var xgdaigouType=$("#xgdaigouType").val();
		var xgcghetongType=$("#xgcghetongType").val();
		var xgdaigouMoney=$("#xgdaigouMoney").val();
		var xgcghetongMoney=$("#xgcghetongMoney").val();
		var xghetongjiafang=$("#xghetongjiafang").val();
		var xgyifang=$("#xgyifang").val();
		var xgfukuangfangshi=$("#xgfukuangfangshi").val();
		var xgyear=$("#xgyear").val();
		var xghetonggaishu=$("#xghetonggaishu").val();
		var xggaikuang=$("#xggaikuang").val();
		var xgcg_bumen=$("#xgcg_bumen").val()
		var xgyunfei=$("#xgyunfei").val();
		var xgborrowNo=$("#xgborrow_no").val();
		var reg=/^\d+(\.\d{0,2})?$/;//只能输入数字或含两位小数的正则
		/* if(!reg.test(xgdaigouMoney)){
			toastr.error("代购金额只能输入数字且只能有两位小数");
			return;
		}
		
		if(xgcghetongming==''){
			toastr.error("采购合同名称为空");
			return;
		}
		if(xgcgdNo==''){
			toastr.error("采购单号不能为空");
			return;
		}
		if(xgcghetongType==''){
			toastr.error("采购合同类型不能为空");
			return;
		}
		if(xgprjName==''){
			toastr.error("项目名称不能为空");
			return;
		}
		if(xghetongjiafang==''){
			toastr.error("合同甲方名称不能为空");
			return;
		}
		if(xgyifang==''){
			toastr.error("乙方不能为空");
			return;
		}
		
		if(xgcghetongMoney==0){
			toastr.error("采购合同金额不能为0");
			return;
		}
		if($("#edit_accessory").find('tr').length<2 || $("#xgfile").val()==''){
			toastr.error("采购合同文本附件为空")
			return;
		} */
		
		
		var cgContract={
				cgId:undefined,   //编号                   
				 contractName:undefined,   // 采购合同名称      
				 cgNo:undefined,   //采购合同编号               
				 cgdNo:undefined,   //采购单号                
				 workNo:undefined,   // 任务单号              
				 prjName:undefined,   //项目名称              
				 isProgram:undefined,   // 是否代购           
				 programType:undefined,   // 代购类型         
				 cgcType:undefined,   // 采购合同类型           
				 programMoney:0,   // 代购金额         
				 cgContractMoney:0,   // 采购合同金额    
				 contractNameJia:undefined,   // 合同甲方名称   
				 contractNameYi:undefined,   // 乙方        
				 payMode:undefined,   // 付款方式             
				 contractSignTime:undefined,   // 采购合同签订时间
				 contractSummary:undefined,   // 采购合同概述   
				 workContent:undefined,   // 主要概况及工作内容    
				 makeTime:undefined,    //当前时间            
				 history:undefined,   //历史状态              
				 fbNo:undefined,   //关联的分保合同编号    
				 cgcl:undefined,
				 cgDepartment:undefined,
				 freight:0,
				 borrowNo:undefined,
		}
		cgContract.contractName=xgcghetongming;
		cgContract.cgNo=xgcgNo;
		cgContract.cgdNo=xgcgdNo;
		cgContract.workNo=xgtask_no;
		cgContract.prjName=xgprjName;
		cgContract.cgcType=xgcghetongType;
		cgContract.isProgram=xgisdaigou;
		cgContract.fbNo=xgfbhetong;
		cgContract.programType=xgdaigouType;
		cgContract.programMoney=xgdaigouMoney;
		cgContract.cgContractMoney=xgcghetongMoney;
		cgContract.contractNameJia=xghetongjiafang;
		cgContract.contractNameYi=xgyifang;
		cgContract.payMode=xgfukuangfangshi;
		cgContract.contractSignTime=xgyear;
		cgContract.contractSummary=xghetonggaishu;
		cgContract.workContent=xggaikuang;
		cgContract.cgcl=xgcgclArr;
		cgContract.cgDepartment=xgcg_bumen;
		//cgContract.freight=xgyunfei;
		cgContract.borrowNo=xgborrowNo;
		
		var formData = new FormData();
 		formData.append("cgContract", JSON.stringify(cgContract));
 		
 		$("#edit_accessory tbody").find("tr").each(function(){
 			formData.append("file", $(this).find("input")[0].files[0]);
 		})
 		$("#edit_accessory1 tbody").find("tr").each(function(){
 			formData.append("file1", $(this).find("input")[0].files[0]);
 		})
 		
		 $.ajax({
	            type: 'POST',
	            url: getContextPath()+'/cgcontract/updateCgContractById',
	            data: formData,  
	            processData: false,
	            contentType: false,
	            success: function (json) {
	            	if(json==0){
						toastr.error("修改失败")
					}else if(json>0){
						
						toastr.success("修改成功")
						
					}
	            }
	        }); 
	}
	
	
	//修改提交cgcontract/updateMaterial
	function checksubmitCgC(){
		var xgcghetongming=$("#xgcghetongming").val();
		var xgcgNo=$("#xgcgNo").val();
		var xgcgdNo=$("#xgcgdNo").val();
		var xgtask_no=$("#xgtask_no").val();
		var xgprjName=$("#xgprjName").val();
		var xgisdaigou=$("#xgisdaigou").val();
		var xgfbhetong=$("#xgfbhetong").val();
		var xgdaigouType=$("#xgdaigouType").val();
		var xgcghetongType=$("#xgcghetongType").val();
		var xgdaigouMoney=$("#xgdaigouMoney").val();
		var xgcghetongMoney=$("#xgcghetongMoney").val();
		var xghetongjiafang=$("#xghetongjiafang").val();
		var xgyifang=$("#xgyifang").val();
		var xgfukuangfangshi=$("#xgfukuangfangshi").val();
		var xgyear=$("#xgyear").val();
		var xghetonggaishu=$("#xghetonggaishu").val();
		var xggaikuang=$("#xggaikuang").val();
		
		var reg=/^\d+(\.\d{0,2})?$/;//只能输入数字或含两位小数的正则
		if(!reg.test(xgdaigouMoney)){
			toastr.error("代购金额只能输入数字且只能有两位小数");
			return;
		}
		if(xgcghetongming==''){
			toastr.error("采购合同名称为空");
			return;
		}
		if(xgcghetongMoney==''){
			toastr.error("采购合同金额为空");
			return;
		}
		if(xgcghetongMoney==0){
			toastr.error("采购合同金额不能为0");
			return;
		}
		if($("#edit_accessory").find('tbody tr').length<1 || $("#xgfile").val()==''){
			toastr.error("采购合同文本附件为空")
			return;
		}
		
		var options={
	            type: 'POST',
	            url: getContextPath()+'/cgcontract/updateCgContractSubmit',
	            dataType: 'json',
	            data: {
	            	cgId:editId,
	            	contractName:xgcghetongming,
	            	cgNo:xgcgNo,
	            	cgdNo:xgcgdNo,
	            	workNo:xgtask_no,
	            	prjName:xgprjName,
	            	isProgram:xgisdaigou,
	            	fbNo:xgfbhetong,
	            	programType:xgdaigouType,
	            	cgcType:xgcghetongType,
	            	programMoney:xgdaigouMoney,
	            	cgContractMoney:xgcghetongMoney,
	            	contractNameJia:xghetongjiafang,
	            	contractNameYi:xgyifang,
	            	payMode:xgfukuangfangshi,
	            	contractSignTime:xgyear,
	            	contractSummary:xghetonggaishu,
	            	workContent:xggaikuang,
	            },
	            success: function (json) {
	            	console.log(json);
	            	if(json==0){
						toastr.error("修改失败")
					}else if(json>0){
						//location.reload([true]);
						toastr.success("修改成功")
						$("#change").modal("hide")
						//initTable();
						
						$("#xgcailiaobiaoDiv table").each(function(){
							//保存部门采购金额
							$(this).find("thead").eq(0).find("tr").eq(0).each(function(){
								var xgid=$(this).find("td").eq(1).attr("dataId");
								var xgbumenMoney=$(this).find("td").eq(3).text();
								$.ajax({
							        type: 'POST',
							        url: getContextPath()+'/cgcontract/updateDepartmentMoney',
							        dataType: 'json',
							        data: {
							        	id:xgid,
							        	price:xgbumenMoney
							        },
							        success: function (json) {
							        	//console.log(json)
							        	if(json=0){
							        		toastr.error("部门采购金额添加失败")
							        	}
							        }
							    });
							})
							//保存材料单价
							$(this).find("tbody").find("tr").each(function(){
								var xgmdlId=$(this).eq(0).attr("dataId")
								var xgclname=$(this).find("td").eq(0).find("input").val();
								var xgcltype=$(this).find("td").eq(1).find("input").val();
								var xgclxinghao=$(this).find("td").eq(2).find("input").val();
								var xgdanwei=$(this).find("td").eq(3).find("input").val();
								var xgdanjia=$(this).find("td").eq(5).find("input").val();
								var xgnum=$(this).find("td").eq(4).find("input").val();
								var xgxm=$(this).find("td").eq(7).find("option:selected").val();
								var xggs=$(this).find("td").eq(8).find("option:selected").val();
								var xgbeizhu=$(this).find("td").eq(9).find("input").val();
								$.ajax({
							        type: 'POST',
							        url: getContextPath()+'/cgcontract/updateMaterial',
							        dataType: 'json',
							        data: {
							        	mdlId:xgmdlId,
							        	materialName:xgclname,
							        	materialType:xgcltype,
							        	modeType:xgclxinghao,
							        	buyCompany:xgdanwei,
							        	price:xgdanjia,
							        	num:xgnum,
							        	provideCompany:xgxm,
							        	sureMaterialMode:xggs,
							        	infos:xgbeizhu
							        },
							        success: function (json) {
							        	//console.log(json)
							        	if(json=0){
							        		toastr.error("材料单价修改失败")
							        	}
							        }
							    });
							})
						})
						
					}
	            }
	        };
			$("#edit_form").ajaxSubmit(options);
	}
	
	
	
	//查看详细信息
	var cgNo;
	function lookCgC(obj){
		var dom=$(obj).parents('tr');
		var data=$('#mainContent').DataTable().row(dom).data();
		//console.log(data)
		cgNo=data.cgNo;
		initTableHistory();
		
		$("#lookcghetongming").text(data.contractName);
		$("#lookcgNo").text(data.cgNo);
		$("#lookcgdNo").text(data.cgdNo);
		$("#lookcgbianhao").text(data.cgId)
		$("#looktask_no").text(data.workNo);
		$("#lookprjName").text(data.prjName)
		$("#lookisdaigou").text(data.isProgram);
		$("#lookfbhetong").text(data.fbNo==''||data.fbNo==null?"无":data.fbNo);
		$("#lookdaigouType").text(data.programType),
		$("#lookcgType").text(data.cgcType);
		$("#lookdaigouMoney").text(data.programMoney);
		$("#lookcghetongMoney").text(data.cgContractMoney);
		$("#lookjiafang").text(data.contractNameJia);
		$("#lookyifang").text(data.spName);
		$("#lookfukuanfangshi").text(data.payMode);
		$("#lookyear").text(data.contractSignTime);
		$("#lookcghetonggaishu").text(data.contractSummary);
		$("#lookgaikuang").text(data.workContent);
		
		var list=new Array();
		if(data.cgdNo.indexOf(",")){
			var no=data.cgdNo.split(",");
			for(var i=0;i<no.length;i++){
				list.push(no[i])
			}
		}else{
			list.push(data.cgdNo)
		}
		if(list!=null){
			$("#lookcghetongMoney").val("");
			$("#lookcailiaobiaoDiv table").remove();
			for(var i=0;i<list.length;i++){
				//console.log(list[i])
        		$("#lookcailiaobiaoDiv").append(
        				"<table  class='table table-bordered table-condensed' id='lookcailiaobiao"+i+"'>"+
                    	"<thead>"+
                    		"<tr>"+
                            	"<td>采购部门</td>"+
                                "<td dataId='' id='lookcgbumen"+i+"'></td>"+
                                "<td  colspan='2'>部门采购金额</td>"+
                                "<td id='lookbumencgMoney"+i+"' colspan='2'></td>"+
                            	"<th colspan='3' style='text-align:right;'></th>"+
                        	"</tr>"+
                        	"<tr>"+
                            	"<th>材料名称</th>"+
                            	"<th>材料类型</th>"+
	                            "<th>材料型号</th>"+
	                            "<th style='width:6%;'>单位</th>"+
	                            "<th>数量</th>"+
	                            "<th style='width:8%;'>单价</th>"+
	                            "<th style='width:8%;'>金额</th>"+
	                            "<th>项目部推荐供应商</th>"+
	                            "<th>公司确定供应商</th>"+
	                            "<th>备注</th>"+
                        	"</tr>"+
                    	"</thead>"+
                    	"<tbody>"+
                    	"</tbody>"+
                    "</table>"
                    )}
		  		$.ajax({
		            type: 'POST',
		            url: getContextPath()+'/PrjMaterialBuy/selectBuyByIds',
		            dataType: 'json',
		            data: {
		            	ids:list.toString()
		            },
		            success: function (json) {
		            	//console.log(json)
		            	for(var i=0;i<json.length;i++){
		            		var omName=json[i].omName
		            		var sumPrice=json[i].sumPrice;
		            		var pmbId=json[i].pmbId;
		            		$("#lookcgbumen"+i+"").text(json[i].omName)
		            		$("#lookcgbumen"+i+"").attr("dataId",pmbId)
		            		$("#lookbumencgMoney"+i+"").text(json[i].sumPrice)
		            		
		            		$.ajax({
		                        type: 'POST',
		                        url: getContextPath()+'/cgcontract/getMdById',
		                        dataType: 'json',
		                        async:false,
		                        data: {
		                        	id:pmbId
		                        },
		                        success: function (json) {
		                        	//console.log(json)
		                        	for(var k=0;k<json.length;k++){
		                        		$("#lookcailiaobiao"+i+" tbody").append("<tr dataId="+json[k].mdlId+"><td>"
		                		  				+""+json[k].materialName+""
		                		  				+"</td><td>"
		                		  				+""+json[k].materialType+""
		                		  				+"</td><td>"
		                		  				+""+json[k].modeType+""
		                		  				+"</td><td>"
		                		  				+""+json[k].buyCompany+""
		                		  				+"</td><td>"
		                		  				+""+json[k].num+""
		                		  				+"</td><td>"
		                		  				+""+json[k].price+""
		                		  				+"</td><td>"
		                		  				+""+json[k].price+""
		                		  				+"</td><td>"
		                		  				+""+json[k].name+""
		                		  				+"</td><td>"
		                		  				+""+json[k].name2+""
		                		  				+"</td><td>"
		                		  				+""+json[k].infos+""
		                		  				+"</td></tr>")
		                        	} 
		                        }
		              		});
		            		
		            	}
		            }
		  		});
		  		
	  		}
		
		
		$.ajax({
			type:"post",
			url:getContextPath()+"/cgcontract/selectAccessoryById",
			dataType:"json",
			async:false,
			data:{
				id:data.cgId,
			},
			success:function(json){
				//console.log(json);
				$("#look_all_table").empty();
				$("#look_all_table1").empty();
	            for(var i=0;i<json.length;i++){
	            	   if(json[i].aType=="采购合同文本"){
		            	   $("#look_all_table").append("<tr>"+
	      	   										"<td style='width:20%;'>采购合同文本</td>"+
	      	   										"<td colspan='3'><a href='"+getLocalPath()+"/oa_file/"+json[i].acUrl+"' target='view_window' style='color:blue'>"+json[i].acName+"</a></td>"+
							            	    	/* "<td colspan='2'><input type='text' class='form-control' style='width:100%;' value='"+json[i].acName+"' disabled></td>"+
							            	    	"<td><button type='button' class='btn btn-primary' data1='"+json[i].acUrl+"' onclick='download_all(this)'>下载附件</button></td>"+ */
							            	    "</tr>");
	            	   }
	            	   if(json[i].aType=="法律顾问签字"){
		            	   $("#look_all_table1").append("<tr>"+
	      	   										"<td style='width:20%;'>法律顾问签字</td>"+
	      	   										"<td colspan='3'><a href='"+getLocalPath()+"/oa_file/"+json[i].acUrl+"' target='view_window' style='color:blue'>"+json[i].acName+"</a></td>"+
							            	    	/* "<td colspan='2'><input type='text' class='form-control' style='width:100%;' value='"+json[i].acName+"' disabled></td>"+
							            	    	"<td><button type='button' class='btn btn-primary' data1='"+json[i].acUrl+"' onclick='download_all(this)'>下载附件</button></td>"+ */
							            	    "</tr>");
	            	   }
	               }
			}
		})
		
	}
	
	function getLocalPath(){
		var pathArray = window.location.pathname.split('/');
		var secondLevelLocation = pathArray[1];
		var loginUrl = window.location.protocol + "//"  + window.location.host ;
		return loginUrl;
	}
	
	//下载附件
	function download_all(obj){
		var url=$(obj).attr("data1");
		var name=$(obj).parents("tr").find("td").eq(1).find("input").val();
		
		window.location.href=encodeURI(getContextPath()+"/FileDownLoad?fileName="+name+"&filePath="+url);
	}
	
	//初始化历史列表
	function initTableHistory(){
        $.ajax({
            type: 'POST',
            url: getContextPath()+'/cgcontract/selectHistoryByNo',
            dataType: 'json',
            data: {
            	cgNo:cgNo,
            },
            error: function (msg) {
                errMessage("请求失败");
            },
            success: function (json) {
            	//console.log(json)
                $('#lookHistory').dataTable().fnClearTable();
                $('#lookHistory').DataTable().rows.add(json).draw(false);
            }
        });
    }
	
	//超级链接
	 function GetQueryString(name){
        var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if(r!=null)return  unescape(r[2]); return null;
   }
	// 调用方法
   	id=GetQueryString("prjId");
   	no=GetQueryString("prjNo");
   	//var title = decodeURI(id)
   	console.log(id,no)
   	if(id!=null&&no!=null){
   		$("#allMsg1").modal("show");
   		var cgNo;
   		$.ajax({
			type:"POST",
			url:getContextPath()+"/cgcontract/selectByCgNo",
			dataTyepe:"json",
			async:false,
			data:{ 
				no:no
				},
			success:function(json){
				var data=json;
				//console.log(data)
				cgNo=data.cgNo;
				initTableHistory();
				
				$("#lookcghetongming").text(data.contractName);
				$("#lookcgNo").text(data.cgNo);
				$("#lookcgdNo").text(data.cgdNo);
				$("#lookcgbianhao").text(data.cgId)
				$("#looktask_no").text(data.workNo);
				$("#lookprjName").text(data.prjName)
				$("#lookisdaigou").text(data.isProgram);
				$("#lookfbhetong").text(data.fbNo==''||data.fbNo==null?"无":data.fbNo);
				$("#lookdaigouType").text(data.programType),
				$("#lookcgType").text(data.cgcType);
				$("#lookdaigouMoney").text(data.programMoney);
				$("#lookcghetongMoney").text(data.cgContractMoney);
				$("#lookjiafang").text(data.contractNameJia);
				$("#lookyifang").text(data.spName);
				$("#lookfukuanfangshi").text(data.payMode);
				$("#lookyear").text(data.contractSignTime);
				$("#lookcghetonggaishu").text(data.contractSummary);
				$("#lookgaikuang").text(data.workContent);
				
				var list=new Array();
				if(data.cgdNo.indexOf(",")){
					var no=data.cgdNo.split(",");
					for(var i=0;i<no.length;i++){
						list.push(no[i])
					}
				}else{
					list.push(data.cgdNo)
				}
				if(list!=null){
					$("#lookcghetongMoney").val("");
					$("#lookcailiaobiaoDiv table").remove();
					for(var i=0;i<list.length;i++){
						//console.log(list[i])
		        		$("#lookcailiaobiaoDiv").append(
		        				"<table  class='table table-bordered table-condensed' id='lookcailiaobiao"+i+"'>"+
		                    	"<thead>"+
		                    		"<tr>"+
		                            	"<td>采购部门</td>"+
		                                "<td dataId='' id='lookcgbumen"+i+"'></td>"+
		                                "<td  colspan='2'>部门采购金额</td>"+
		                                "<td id='lookbumencgMoney"+i+"' colspan='2'></td>"+
		                            	"<th colspan='3' style='text-align:right;'></th>"+
		                        	"</tr>"+
		                        	"<tr>"+
		                            	"<th>材料名称</th>"+
		                            	"<th>材料类型</th>"+
			                            "<th>材料型号</th>"+
			                            "<th style='width:6%;'>单位</th>"+
			                            "<th>数量</th>"+
			                            "<th style='width:8%;'>单价</th>"+
			                            "<th style='width:8%;'>金额</th>"+
			                            "<th>项目部推荐供应商</th>"+
			                            "<th>公司确定供应商</th>"+
			                            "<th>备注</th>"+
		                        	"</tr>"+
		                    	"</thead>"+
		                    	"<tbody>"+
		                    	"</tbody>"+
		                    "</table>"
		                    )}
				  		$.ajax({
				            type: 'POST',
				            url: getContextPath()+'/PrjMaterialBuy/selectBuyByIds',
				            dataType: 'json',
				            data: {
				            	ids:list.toString()
				            },
				            success: function (json) {
				            	//console.log(json)
				            	for(var i=0;i<json.length;i++){
				            		var omName=json[i].omName
				            		var sumPrice=json[i].sumPrice;
				            		var pmbId=json[i].pmbId;
				            		$("#lookcgbumen"+i+"").text(json[i].omName)
				            		$("#lookcgbumen"+i+"").attr("dataId",pmbId)
				            		$("#lookbumencgMoney"+i+"").text(json[i].sumPrice)
				            		
				            		$.ajax({
				                        type: 'POST',
				                        url: getContextPath()+'/cgcontract/getMdById',
				                        dataType: 'json',
				                        async:false,
				                        data: {
				                        	id:pmbId
				                        },
				                        success: function (json) {
				                        	//console.log(json)
				                        	for(var k=0;k<json.length;k++){
				                        		$("#lookcailiaobiao"+i+" tbody").append("<tr dataId="+json[k].mdlId+"><td>"
				                		  				+""+json[k].materialName+""
				                		  				+"</td><td>"
				                		  				+""+json[k].materialType+""
				                		  				+"</td><td>"
				                		  				+""+json[k].modeType+""
				                		  				+"</td><td>"
				                		  				+""+json[k].buyCompany+""
				                		  				+"</td><td>"
				                		  				+""+json[k].num+""
				                		  				+"</td><td>"
				                		  				+""+json[k].price+""
				                		  				+"</td><td>"
				                		  				+""+json[k].price+""
				                		  				+"</td><td>"
				                		  				+""+json[k].name+""
				                		  				+"</td><td>"
				                		  				+""+json[k].name2+""
				                		  				+"</td><td>"
				                		  				+""+json[k].infos+""
				                		  				+"</td></tr>")
				                        	} 
				                        }
				              		});
				            		
				            	}
				            }
				  		});
				  		
			  		}
				
				
				$.ajax({
					type:"post",
					url:getContextPath()+"/cgcontract/selectAccessoryById",
					dataType:"json",
					async:false,
					data:{
						id:data.cgId,
					},
					success:function(json){
						//console.log(json);
						$("#look_all_table").empty();
						$("#look_all_table1").empty();
			            for(var i=0;i<json.length;i++){
			            	   if(json[i].aType=="采购合同文本"){
				            	   $("#look_all_table").append("<tr>"+
			      	   										"<td style='width:20%;'>采购合同文本</td>"+
			      	   										"<td colspan='3'><a href='"+getLocalPath()+"/oa_file/"+json[i].acUrl+"' target='view_window' style='color:blue'>"+json[i].acName+"</a></td>"+
									            	    	/* "<td colspan='2'><input type='text' class='form-control' style='width:100%;' value='"+json[i].acName+"' disabled></td>"+
									            	    	"<td><button type='button' class='btn btn-primary' data1='"+json[i].acUrl+"' onclick='download_all(this)'>下载附件</button></td>"+ */
									            	    "</tr>");
			            	   }
			            	   if(json[i].aType=="法律顾问签字"){
				            	   $("#look_all_table1").append("<tr>"+
			      	   										"<td style='width:20%;'>法律顾问签字</td>"+
			      	   										"<td colspan='3'><a href='"+getLocalPath()+"/oa_file/"+json[i].acUrl+"' target='view_window' style='color:blue'>"+json[i].acName+"</a></td>"+
									            	    	/* "<td colspan='2'><input type='text' class='form-control' style='width:100%;' value='"+json[i].acName+"' disabled></td>"+
									            	    	"<td><button type='button' class='btn btn-primary' data1='"+json[i].acUrl+"' onclick='download_all(this)'>下载附件</button></td>"+ */
									            	    "</tr>");
			            	   }
			               }
					}
				})
			}
		}) 
   	}
	//查看历史信息的详细信息
	function lookHistoryDetails(obj){
		var dom=$(obj).parents('tr');
		var data=$('#lookHistory').DataTable().row(dom).data();
		//console.log(data)
		$('#History').on('hidden.bs.modal', function () {//解决模态框页面滚动问题
            if ($('.modal.in').size() >= 1) {
                $('body').addClass('modal-open')
            }
        })
		
		$("#Historycghetongming").text(data.contractName);
		$("#HistorycgNo").text(data.cgNo);
		$("#HistorycgdNo").text(data.cgdNo);
		$("#Historycgbianhao").text(data.cgId)
		$("#Historytask_no").text(data.workNo);
		$("#HistoryprjName").text(data.prjName)
		$("#Historyisdaigou").text(data.isProgram);
		$("#Historyfbhetong").text(data.fbNo==''||data.fbNo==null?"无":data.fbNo);
		$("#HistorydaigouType").text(data.programType),
		$("#HistorycgType").text(data.cgcType);
		$("#HistorydaigouMoney").text(data.programMoney);
		$("#HistorycghetongMoney").text(data.cgContractMoney);
		$("#Historyjiafang").text(data.contractNameJia);
		$("#Historyyifang").text(data.spName);
		$("#Historyfukuanfangshi").text(data.payMode);
		$("#Historyyear").text(data.contractSignTime);
		$("#Historycghetonggaishu").text(data.contractSummary);
		$("#Historygaikuang").text(data.workContent);
		
		
		var list=new Array();
		if(data.cgdNo.indexOf(",")){
			var no=data.cgdNo.split(",");
			for(var i=0;i<no.length;i++){
				list.push(no[i])
			}
		}else{
			list.push(data.cgdNo)
		}
		if(list!=null){
			$("#HistorycghetongMoney").val("");
			$("#HistorycailiaobiaoDiv table").remove();
			for(var i=0;i<list.length;i++){
				//console.log(list[i])
        		$("#HistorycailiaobiaoDiv").append(
        				"<table  class='table table-bordered table-condensed' id='Historycailiaobiao"+i+"'>"+
                    	"<thead>"+
                    		"<tr>"+
                            	"<td>采购部门</td>"+
                                "<td dataId='' id='Historycgbumen"+i+"'></td>"+
                                "<td  colspan='2'>部门采购金额</td>"+
                                "<td id='HistorybumencgMoney"+i+"' colspan='2'></td>"+
                            	"<th colspan='3' style='text-align:right;'></th>"+
                        	"</tr>"+
                        	"<tr>"+
                            	"<th>材料名称</th>"+
                            	"<th>材料类型</th>"+
	                            "<th>材料型号</th>"+
	                            "<th style='width:6%;'>单位</th>"+
	                            "<th>数量</th>"+
	                            "<th style='width:8%;'>单价</th>"+
	                            "<th style='width:8%;'>金额</th>"+
	                            "<th>项目部推荐供应商</th>"+
	                            "<th>公司确定供应商</th>"+
	                            "<th>备注</th>"+
                        	"</tr>"+
                    	"</thead>"+
                    	"<tbody>"+
                    	"</tbody>"+
                    "</table>"
                    )}
		  		$.ajax({
		            type: 'POST',
		            url: getContextPath()+'/PrjMaterialBuy/selectBuyByIds',
		            dataType: 'json',
		            data: {
		            	ids:list.toString()
		            },
		            success: function (json) {
		            	//console.log(json)
		            	for(var i=0;i<json.length;i++){
		            		var omName=json[i].omName
		            		var sumPrice=json[i].sumPrice;
		            		var pmbId=json[i].pmbId;
		            		$("#Historycgbumen"+i+"").text(json[i].omName)
		            		$("#Historycgbumen"+i+"").attr("dataId",pmbId)
		            		$("#HistorybumencgMoney"+i+"").text(json[i].sumPrice)
		            		
		            		$.ajax({
		                        type: 'POST',
		                        url: getContextPath()+'/cgcontract/getMdById',
		                        dataType: 'json',
		                        async:false,
		                        data: {
		                        	id:pmbId
		                        },
		                        success: function (json) {
		                        	//console.log(json)
		                        	for(var k=0;k<json.length;k++){
		                        		$("#Historycailiaobiao"+i+" tbody").append("<tr dataId="+json[k].mdlId+"><td>"
		                		  				+""+json[k].materialName+""
		                		  				+"</td><td>"
		                		  				+""+json[k].materialType+""
		                		  				+"</td><td>"
		                		  				+""+json[k].modeType+""
		                		  				+"</td><td>"
		                		  				+""+json[k].buyCompany+""
		                		  				+"</td><td>"
		                		  				+""+json[k].num+""
		                		  				+"</td><td>"
		                		  				+""+json[k].price+""
		                		  				+"</td><td>"
		                		  				+""+json[k].price+""
		                		  				+"</td><td>"
		                		  				+""+json[k].name+""
		                		  				+"</td><td>"
		                		  				+""+json[k].name2+""
		                		  				+"</td><td>"
		                		  				+""+json[k].infos+""
		                		  				+"</td></tr>")
		                        	} 
		                        }
		              		});
		            		
		            	}
		            }
		  		});
		  		
	  		}
		
		
		$.ajax({
			type:"post",
			url:getContextPath()+"/cgcontract/selectAccessoryById",
			dataType:"json",
			async:false,
			data:{
				id:data.cgId,
			},
			success:function(json){
				//console.log(json);
				$("#History_all_table").empty();
				$("#History_all_table1").empty();
	               for(var i=0;i<json.length;i++){
	            	   if(json[i].aType=="采购合同文本"){
		            	   $("#History_all_table").append("<tr>"+
	      	   										"<td style='width:20%;'>采购合同文本</td>"+
							            	    	"<td colspan='2'><input type='text' class='form-control' style='width:100%;' value='"+json[i].acName+"' disabled></td>"+
							            	    	"<td><button type='button' class='btn btn-primary' data1='"+json[i].acUrl+"' onclick='download_all(this)'>下载附件</button></td>"+
							            	    "</tr>");
	            	   }
	            	   if(json[i].aType=="法律顾问签字"){
		            	   $("#History_all_table1").append("<tr>"+
	      	   										"<td style='width:20%;'>法律顾问签字</td>"+
							            	    	"<td colspan='2'><input type='text' class='form-control' style='width:100%;' value='"+json[i].acName+"' disabled></td>"+
							            	    	"<td><button type='button' class='btn btn-primary' data1='"+json[i].acUrl+"' onclick='download_all(this)'>下载附件</button></td>"+
							            	    "</tr>");
	            	   }
	               }
			}
		})
		
	}
	
	
	
	
	//点击填报采购合同时默认添加的一个附件
	/*function newFile(){
		$("#new_accessory tbody").html('');
		$("#new_accessory tbody").append("<tr><td>新附件</td><td><input type='file' name='file' id='file'><td style='width:150px;'></td></tr>")
		 
	} */
	
	function addFile(){
		$("#new_accessory tbody").append("<tr><td>新附件</td><td><input type='file' name='file' id='file' style='width:70%;' class='form-control'></td><td style='width:150px;'><button type='button' class='btn btn-primary' onclick='removeFile(this)'>移除附件</button></td></tr>");
	}
	function addFile1(){
		$("#new_accessory1 tbody").append("<tr><td>新附件</td><td><input type='file' name='file1' id='file1' style='width:70%;' class='form-control'></td><td style='width:150px;'><button type='button' class='btn btn-primary' onclick='removeFile(this)'>移除附件</button></td></tr>");
	}
	
	function addFile2(){
		$("#edit_accessory tbody").append("<tr><td>新附件</td><td colspan='2'><input  type='file' name='file' id='xgfile'  class='form-control'></td><td><button type='button' class='btn btn-primary' onclick='removeFile(this)'>移除附件</button></td></tr>");
	}
	function addFile3(){
		$("#edit_accessory1 tbody").append("<tr><td>新附件</td><td colspan='2'><input style='width:70%;' type='file' name='file1' id='xgfile1' style='width:70%;' class='form-control'></td><td style='width:150px;'><button type='button' class='btn btn-primary' onclick='removeFile(this)'>移除附件</button></td></tr>");
	}
	
	function removeFile(obj){
  		var tr=$(obj).parents("tr");
  		$(tr).remove();
  	}
	
	
	
	
    function getCreat(bb){
        var EnterpriseRating= $(bb).parent().prev().text();
        var Remarks= $(bb).parent().prev().prev().text();
        var ContactPhone1= $(bb).parent().prev().prev().prev().text();
        var Contacts= $(bb).parent().prev().prev().prev().prev().text();
        var address= $(bb).parent().prev().prev().prev().prev().prev().text();
        var ProprietorUnit= $(bb).parent().prev().prev().prev().prev().prev().prev().text();
        var Code= $(bb).parent().prev().prev().prev().prev().prev().prev().prev().text();
        $("#CEnterprise-rating").val(EnterpriseRating);
        $("#CRemarks").val(Remarks);
        $("#CContact-phone1").val(ContactPhone1);
        $("#CContacts").val(Contacts);
        $("#Caddress").val(address);
        $("#CProprietor-unit").val(ProprietorUnit);
        $("#CCode").val(Code);
        rowIndex = bb.parentNode.parentNode.rowIndex; 
    }

    // $("#mainContent tbody tr").click(function (){
    //     $(this).addClass('selected')
    //     .siblings().removeClass('selected')
    //     .end();
    // })
//数组去重
Array.prototype.unique3 = function(){
 var res = [];
 var json = {};
 for(var i = 0; i < this.length; i++){
  if(!json[this[i]]){
   res.push(this[i]);
   json[this[i]] = 1;
  }
 }
 return res;
}

    var arr=[];
    // $('#renwuDanhao')[0].selectedIndex = -1;
    $("#renwuDanhao").change(function(){
        arr.push($("#renwuDanhao").val())
        $("#rwdh").text(arr.unique3())
    })
    var arr2=[];
    // $('#renwuDanhao2')[0].selectedIndex = -1;
    $("#renwuDanhao2").change(function(){
        arr2.push($("#renwuDanhao2").val())
        $("#rwdh2").text(arr2.unique3())
    })

    $(".zhuangtai").change(function(){
        var zt=$(".zhuangtai").val();
        if(zt=="合同终止"){
            $(".quxiao").hide();
            $(".chongqi").show()
        }else{
            $(".quxiao").show();
            $(".chongqi").hide();
        }
    })

</script>
</html>