<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="../../font2/iconfont.css">
    <link rel="stylesheet" href="../../font3/iconfont.css">
	<link href="../../style/bootstrap.min.css" rel="stylesheet">
    <link href="../../style/style.css" rel="stylesheet">
    <link href="../../toastr/toastr.css" rel="stylesheet">
    <link rel="stylesheet" href="../../style/jquery.dataTables.min.css">
    <link rel="stylesheet" href="../../style/jquery-editable-select.css">
    <style lang="">
        .UpperPart{
            display: flex;
            justify-content:space-between;
            border-bottom: 1px solid #ccc;
            padding-bottom: 12px;
        }
    </style>
</head>
<body>
<!-- 面包屑 -->
    <div class="mianbao">
    	<ul class="breadcrumb">
    		<li><i class="iconfont icon-knowledgebase"></i></li>
            <li>经营管理</li>
            <li>项目投标</li>
			<li class="active">投标审批单</li>
		</ul>
    </div>
    

    <div class="zhuti-content">

				<table class="table table-bordered table-condensed">
                    <tr>
                    	<td>项目名称</td>
                    	<td id="lookprjName"></td>
                    	<td>项目编号</td>
                    	<td id="lookprjNo"></td>
                    </tr>
                    <tr>
                    	<td>业主单位</td>
                    	<td id="lookyezhudanwei"></td>
                    	<td>项目类型</td>
                    	<td id="lookprjType"></td>
                    </tr>
                    <tr>
                    	<td>投标人</td>
                    	<td id="looktoubiaoren"></td>
                    	<td>资格预审递交时间</td>
                    	<td id="lookyear"></td>
                    </tr>
                    <tr>
                    	<td>现场考察时间</td>
                    	<td id="lookyear2"></td>
                    	<td>标前会时间</td>
                    	<td id="lookyear3"></td>
                    </tr>
                    <tr>
                    	<td>投标文件递交时间</td>
                    	<td id="lookyear4"></td>
                    	<td>项目报名人员</td>
                    	<td id="lookbaomingren"></td>
                    </tr>
                    <tr>
                    	<td>项目购买标书人员</td>
                    	<td id="lookgoumairen"></td>
                    	<td></td>
                    	<td></td>
                    </tr>
                </table> 
                
        		<table class="table table-bordered table-condensed" id="look_xieban_table">
                    	<thead>
                    		<tr>
                    			<th colspan="8">查看承接信息</th>
                    		</tr>
                    	</thead>
                    	<tbody>
                    	</tbody>
                 </table>
    </div>
</body>
<script src="../../js/jquery.js"></script>
<script src="../../js/common-scripts.js"></script>
<script src="../../js/jquery.dataTables.min.js"></script>
<script src="../../js/bootstrap.min.js"></script>
<script src="../../js/laydate/laydate.js"></script>
<script src="../../js/jquery-editable-select.js">
</script><script src="../../toastr/toastr.js"></script>
<script>
    $(document).ready( function () {
    	initTable();
    	
	});
    
    function GetQueryString(name){
        var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if(r!=null)return  unescape(r[2]); return null;
   }
   // 调用方法
   	id=GetQueryString("prjId");
   	editOrView=GetQueryString("editOrView");
   	
	function initTable(){
		$.ajax({
			type:"POST",
			url:getContextPath()+"/BidApproval/selectBidApprovalById",
			dataType:"json",
			async:false,
			data:{
				id:id,
			},
			success:function(json){
				//console.log(json)
				$("#lookprjName").text(json.prjName);
				$("#lookprjNo").text(json.prjNo);
				$("#lookyezhudanwei").text(json.ownerUnit);
				$("#lookprjType").text(json.prjType);
				$("#looktoubiaoren").text(json.bidder);
				$("#lookyear").text(json.pretrialSubmissionTime);
				$("#lookyear2").text(json.fieldTime);
				$("#lookyear3").text(json.pretenderMeetingTime);
				$("#lookyear4").text(json.submissionTime);
				$("#lookbaomingren").text(json.projectApplicants);
				$("#lookgoumairen").text(json.purchaseTenderPersonnel);
				
				if(editOrView=="view"){
            		$("#baocuna").hide();
            		$("#look_xieban_table tbody").html('');
                	$("#look_xieban_table tbody").append("<tr><td style='width:80px;'>协作部门分管领导</td><td style='width:100px;'>"
                			+'<select class="form-control" style="width:100%;" id="xmfzr" disabled></select>'
                			+"</td></tr>")
                		editzhubanren(task.mainPrjLeader,1)	
                		editzhubanren(task.mainEngineer,2)
                		editzhubanren(task.mainOther,3)
                		if(task.name1!=null&&task.name1!=''){
                    		$("#look_xieban_table tbody").append("<tr><td>协办部门</td><td>"
                        			+'<select class="form-control" style="width:100%;" id="xbxmfzr1" disabled></select>'
                    				+"</td></tr>")
                    				
                    		editxb1ren(task.assist1PrjLeader,1);
                    		editxb1ren(task.assist1Engineer,2);
                    		editxb1ren(task.assist1Other,3);
                    	}
        				
        				
                    	
            	}
            	if(editOrView=="edit"){
            		$("#baocuna").hide();
            		$("#look_xieban_table tbody").html('');
                	$("#look_xieban_table tbody").append("<tr><td style='width:80px;'>协作部门分管领导</td><td style='width:100px;'>"
                			+'<select class="form-control" style="width:100%;" id="xmfzr"></select>'
                			+"</td></tr>")
                		editzhubanren(task.mainPrjLeader,1)	
                		editzhubanren(task.mainEngineer,2)
                		editzhubanren(task.mainOther,3)
                		if(task.name1!=null&&task.name1!=''){
                    		$("#look_xieban_table tbody").append("<tr><td>协办部门</td><td>"
                        			+'<select class="form-control" style="width:100%;" id="xbxmfzr1"></select>'
                    				+"</td></tr>")
                    				
                    		editxb1ren(task.assist1PrjLeader,1);
                    		editxb1ren(task.assist1Engineer,2);
                    		editxb1ren(task.assist1Other,3);
                    	}
        				
                    	
            	}
            	
            	
			}
		})
    }

	
	//项目负责人，主任工程师其他负责人
	function inithuman(){
		//console.log(zhubanbumen)
		//主办
		$.ajax({
			type:"POST",
			url:getContextPath()+"/user/selectUserByomId",
			dataTyepe:"json",
			data:{ 
				omId:zhubanbumen
				},
			success:function(json){
				$("#guanliren").empty();
				for(var i=0;i<json.length;i++){
					$("#xmfzr").append("<option value='" + json[i].userId + "'>"
		                    + json[i].uName + "</option>")
                    $("#zrgcs").append("<option value='" + json[i].userId + "'>"
                    + json[i].uName + "</option>")
                    $("#qtfzr").append("<option value='" + json[i].userId + "'>"
                    + json[i].uName + "</option>")
				}
			}
		})
		//协办1
		$.ajax({
			type:"POST",
			url:getContextPath()+"/user/selectUserByomId",
			dataTyepe:"json",
			data:{ 
				omId:xiebanbumen1
				},
			success:function(json){
				$("#guanliren").empty();
				for(var i=0;i<json.length;i++){
					$("#xbxmfzr1").append("<option value='" + json[i].userId + "'>"
		                    + json[i].uName + "</option>")
                    $("#xbzrgcs1").append("<option value='" + json[i].userId + "'>"
                    + json[i].uName + "</option>")
                    $("#xbqtfzr1").append("<option value='" + json[i].userId + "'>"
                    + json[i].uName + "</option>")
				}
			}
		})
		//协办2
		$.ajax({
			type:"POST",
			url:getContextPath()+"/user/selectUserByomId",
			dataTyepe:"json",
			data:{ 
				omId:xiebanbumen2
				},
			success:function(json){
				$("#guanliren").empty();
				for(var i=0;i<json.length;i++){
					$("#xbxmfzr2").append("<option value='" + json[i].userId + "'>"
		                    + json[i].uName + "</option>")
                    $("#xbzrgcs2").append("<option value='" + json[i].userId + "'>"
                    + json[i].uName + "</option>")
                    $("#xbqtfzr2").append("<option value='" + json[i].userId + "'>"
                    + json[i].uName + "</option>")
				}
			}
		})
		//协办3
		$.ajax({
			type:"POST",
			url:getContextPath()+"/user/selectUserByomId",
			dataTyepe:"json",
			data:{ 
				omId:xiebanbumen3
				},
			success:function(json){
				$("#guanliren").empty();
				for(var i=0;i<json.length;i++){
					$("#xbxmfzr3").append("<option value='" + json[i].userId + "'>"
		                    + json[i].uName + "</option>")
                    $("#xbzrgcs3").append("<option value='" + json[i].userId + "'>"
                    + json[i].uName + "</option>")
                    $("#xbqtfzr3").append("<option value='" + json[i].userId + "'>"
                    + json[i].uName + "</option>")
				}
			}
		}) 
	}
  
  
  //回显主办三个人
  function editzhubanren(obj,obj2){
	  //console.log(obj)
	  $.ajax({
			type:"POST",
			url:getContextPath()+"/user/selectUserByomId",
			dataTyepe:"json",
			data:{ 
				omId:zhubanbumen
				},
			success:function(json){
				if(obj2==1){
					$("#xmfzr").empty();
					for(var i=0;i<json.length;i++){
						$("#xmfzr").append("<option value='" + json[i].userId + "'>"
			                    + json[i].uName + "</option>")
					}
					$("#xmfzr").val(obj)
				}else if(obj2==2){
					$("#zrgcs").empty();
					for(var i=0;i<json.length;i++){
			            $("#zrgcs").append("<option value='" + json[i].userId + "'>"
	                    + json[i].uName + "</option>")
					$("#zrgcs").val(obj)
					}
				}else if(obj2==3){
					$("#qtfzr").empty();
					for(var i=0;i<json.length;i++){
	                    $("#qtfzr").append("<option value='" + json[i].userId + "'>"
	                    + json[i].uName + "</option>")
					$("#qtfzr").val(obj)
					}
				}
			}
		})
  }
  
  //回显协办1三个人
  function editxb1ren(obj,obj2){
	  $.ajax({
			type:"POST",
			url:getContextPath()+"/user/selectUserByomId",
			dataTyepe:"json",
			data:{ 
				omId:xiebanbumen1
				},
			success:function(json){
				if(obj2==1){
					$("#xbxmfzr1").empty();
					for(var i=0;i<json.length;i++){
						$("#xbxmfzr1").append("<option value='" + json[i].userId + "'>"
			                    + json[i].uName + "</option>")
					}
					$("#xbxmfzr1").val(obj)
				}else if(obj2==2){
					$("#xbzrgcs1").empty();
					for(var i=0;i<json.length;i++){
			            $("#xbzrgcs1").append("<option value='" + json[i].userId + "'>"
	                    + json[i].uName + "</option>")
					$("#xbzrgcs1").val(obj)
					}
				}else if(obj2==3){
					$("#xbqtfzr1").empty();
					for(var i=0;i<json.length;i++){
	                    $("#xbqtfzr1").append("<option value='" + json[i].userId + "'>"
	                    + json[i].uName + "</option>")
					$("#xbqtfzr1").val(obj)
					}
				}
			}
		})
  }
  
//回显协办2三个人
  function editxb2ren(obj,obj2){
	  $.ajax({
			type:"POST",
			url:getContextPath()+"/user/selectUserByomId",
			dataTyepe:"json",
			data:{ 
				omId:xiebanbumen2
				},
			success:function(json){
				if(obj2==1){
					$("#xbxmfzr2").empty();
					for(var i=0;i<json.length;i++){
						$("#xbxmfzr2").append("<option value='" + json[i].userId + "'>"
			                    + json[i].uName + "</option>")
					}
					$("#xbxmfzr2").val(obj)
				}else if(obj2==2){
					$("#xbzrgcs2").empty();
					for(var i=0;i<json.length;i++){
			            $("#xbzrgcs2").append("<option value='" + json[i].userId + "'>"
	                    + json[i].uName + "</option>")
					$("#xbzrgcs2").val(obj)
					}
				}else if(obj2==3){
					$("#xbqtfzr2").empty();
					for(var i=0;i<json.length;i++){
	                    $("#xbqtfzr2").append("<option value='" + json[i].userId + "'>"
	                    + json[i].uName + "</option>")
					$("#xbqtfzr2").val(obj)
					}
				}
			}
		})
  }
  
//回显协办3三个人
  function editxb3ren(obj,obj2){
	  $.ajax({
			type:"POST",
			url:getContextPath()+"/user/selectUserByomId",
			dataTyepe:"json",
			data:{ 
				omId:xiebanbumen3
				},
			success:function(json){
				if(obj2==1){
					$("#xbxmfzr3").empty();
					for(var i=0;i<json.length;i++){
						$("#xbxmfzr3").append("<option value='" + json[i].userId + "'>"
			                    + json[i].uName + "</option>")
					}
					$("#xbxmfzr3").val(obj)
				}else if(obj2==2){
					$("#xbzrgcs3").empty();
					for(var i=0;i<json.length;i++){
			            $("#xbzrgcs3").append("<option value='" + json[i].userId + "'>"
	                    + json[i].uName + "</option>")
					$("#xbzrgcs3").val(obj)
					}
				}else if(obj2==3){
					$("#xbqtfzr3").empty();
					for(var i=0;i<json.length;i++){
	                    $("#xbqtfzr3").append("<option value='" + json[i].userId + "'>"
	                    + json[i].uName + "</option>")
					$("#xbqtfzr3").val(obj)
					}
				}
			}
		})
  }
  
  
  
  //保存
  function save(){
	  var xmfzr=$("#xmfzr").val()
	  var zrgcs=$("#zrgcs").val();
	  var qtfzr=$("#qtfzr").val();
	  var xbxmfzr1=$("#xbxmfzr1").val();
	  var xbzrgcs1=$("#xbzrgcs1").val();
	  var xbqtfzr1=$("#xbqtfzr1").val();
	  var xbxmfzr2=$("#xbxmfzr2").val();
	  var xbzrgcs2=$("#xbzrgcs2").val();
	  var xbqtfzr2=$("#xbqtfzr2").val();
	  var xbxmfzr3=$("#xbxmfzr3").val();
	  var xbzrgcs3=$("#xbzrgcs3").val();
	  var xbqtfzr3=$("#xbqtfzr3").val();
	  
	  $.ajax({
			type:"POST",
			url:getContextPath()+"/task/updateById",
			dataTyepe:"json",
			data:{ 
				prjId:id,
				mainPrjLeader:xmfzr,
				mainEngineer:zrgcs,
				mainOther:qtfzr,
				assist1PrjLeader:xbxmfzr1,
				assist1Engineer:xbzrgcs1,
				assist1Other:xbqtfzr1,
				assist2PrjLeader:xbxmfzr2,
				assist2Engineer:xbzrgcs2,
				assist2Other:xbqtfzr2,
				assist3PrjLeader:xbxmfzr3,
				assist3Engineer:xbzrgcs3,
				assist3Other:xbqtfzr3
				},
			success:function(json){
				if(json>0){
					toastr.success("修改成功")
				}else{
					toastr.error("修改失败")
				}
			}
		}) 
  }
  
  
	function changeData(){
		$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/',
	        dataType: 'json',
	        data:{
	        	id:id
	        },
	        success: function (json) {
	        	//console.log(json)
	        	
	        }
	    });
	}

</script>
</html>