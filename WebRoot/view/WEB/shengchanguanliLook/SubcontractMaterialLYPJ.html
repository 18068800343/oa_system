<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="../../font2/iconfont.css">
    <link rel="stylesheet" href="../../font3/iconfont.css">
	<link href="../../style/bootstrap.min.css" rel="stylesheet">
    <link href="../../style/style.css" rel="stylesheet">
    <link href="../../toastr/toastr.css" rel="stylesheet">
    <link rel="stylesheet" href="../../style/jquery.dataTables.min.css">
    <link rel="stylesheet" href="../../style/jquery-editable-select.css">
    <style lang="">
        
    </style>
</head>
<body>
    

    <div>
			<table class="table table-bordered table-condensed">
                        <tr>   
                            <td style="width:100px;">项目名称</td>
                            <td id="lookprjName"></td>
                            <td style="width:100px;">任务单号</td>
                            <td id="looktaskNo"></td>
                        </tr>
                        <tr>
                            <td>部门</td>
                            <td id="lookdepartment"></td>
                            <td>项目负责人</td>
                            <td id="lookprjfuzeren"></td>
                        </tr>
                        <tr>
                            <td>材料采购合同编号</td>
                            <td id="lookclcgbianhao"></td>
                            <td>合同累计金额(万元)</td>
                            <td id="lookhetongleijiMoney"></td>
                        </tr>
                        <tr>
                            <td>合同实际结算金额(万元)</td>
                            <td id="lookhetongshijijiesuanMoney"></td>
                            <td>付款方式</td>
                            <td id="lookfukuantype"></td>
                        </tr>
                        <tr>
                            <td>实际负责人</td>
                            <td id="lookshijifuzeren"></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td rowspan="6">评价内容</td>
                            <td>产品质量及易用情况（25%）</td>
                            <td colspan="2" id="lookpj1"></td>
                        </tr>
                        <tr>
                            <td>交货周期（20%）</td>
                            <td colspan="2" id="lookpj2"></td>
                        </tr>
                        <tr>
                            <td>材料合格证书检测报告完备（15%）</td>
                            <td colspan="2" id="lookpj3"></td>
                        </tr>
                        <tr>
                            <td>咨询及对顾客使用、维护的指导情况等售后服务（15%）</td>
                            <td colspan="2" id="lookpj4"></td>
                        </tr>
                        <tr>
                            <td>付款方式（15%）</td>
                            <td colspan="2" id="lookpj5"></td>
                        </tr>
                        <tr>
                            <td>安全文明与环保（10%）</td>
                            <td colspan="2" id="lookpj6"></td>
                        </tr>
                        <tr>
                            <td>综合评价</td>
                            <td colspan="3" id="lookpj7"></td>
                        </tr>
                    </table>
                    <!-- 历史信息表格 -->
				    <table style="width:100%;" class="table table-bordered table-condensed" id="lookHistory">
                        <thead>
                            <tr>
                                <th colspan="6">历史信息</th>
                            </tr>
                            <tr>
                                <td>材料采购合同编号</td>
                                <td>任务单号</td>
                                <td>项目名称</td>
                                <td>修改时间</td>
                                <td>操作</td>
                            </tr>
                        </thead>
                        <tbody>
                            
                        </tbody>
                    </table>
                    
                    
<!-- 历史详细信息 -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="History">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>历史信息</b></h4>
        </div>
        <div class="modal-body">
            <div>     
                <form class="form-inline">
                    <table class="table table-bordered table-condensed">
                        <tr>   
                            <td style="width:100px;">项目名称</td>
                            <td id="HistoryprjName"></td>
                            <td style="width:100px;">任务单号</td>
                            <td id="HistorytaskNo"></td>
                        </tr>
                        <tr>
                            <td>部门</td>
                            <td id="Historydepartment"></td>
                            <td>项目负责人</td>
                            <td id="Historyprjfuzeren"></td>
                        </tr>
                        <tr>
                            <td>材料采购合同编号</td>
                            <td id="Historyclcgbianhao"></td>
                            <td>合同累计金额(万元)</td>
                            <td id="HistoryhetongleijiMoney"></td>
                        </tr>
                        <tr>
                            <td>合同实际结算金额(万元)</td>
                            <td id="HistoryhetongshijijiesuanMoney"></td>
                            <td>付款方式</td>
                            <td id="Historyfukuantype"></td>
                        </tr>
                        <tr>
                            <td>实际负责人</td>
                            <td id="Historyshijifuzeren"></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td rowspan="6">评价内容</td>
                            <td>产品质量及易用情况（25%）</td>
                            <td colspan="2" id="Historypj1"></td>
                        </tr>
                        <tr>
                            <td>交货周期（20%）</td>
                            <td colspan="2" id="Historypj2"></td>
                        </tr>
                        <tr>
                            <td>材料合格证书检测报告完备（15%）</td>
                            <td colspan="2" id="Historypj3"></td>
                        </tr>
                        <tr>
                            <td>咨询及对顾客使用、维护的指导情况等售后服务（15%）</td>
                            <td colspan="2" id="Historypj4"></td>
                        </tr>
                        <tr>
                            <td>付款方式（15%）</td>
                            <td colspan="2" id="Historypj5"></td>
                        </tr>
                        <tr>
                            <td>安全文明与环保（10%）</td>
                            <td colspan="2" id="Historypj6"></td>
                        </tr>
                        <tr>
                            <td>综合评价</td>
                            <td colspan="3" id="Historypj7"></td>
                        </tr>
                    </table>
                </form> 
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        </div>
        </div>
    </div>
</div>
<!-- 历史信息结束 -->

    </div>
     
</body>
<script src="../../js/jquery.js"></script>
<script src="../../js/common-scripts.js"></script>
<script src="../../js/jquery.dataTables.min.js"></script>
<script src="../../js/bootstrap.min.js"></script>
<script src="../../js/laydate/laydate.js"></script>
<script src="../../js/jquery-editable-select.js"></script>
<script src="../../js/jquery-form.min.js"></script>
<script src="../../toastr/toastr.js"></script>
<script>
    $(document).ready( function () {
    	initTable();
    	
	});
    <!-- 履约评价的历史表格 -->
    var table1=$('#lookHistory').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 10,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
            { "data": "materialContractCode"}, 
            { "data": "taskNo"}, 
            { "data": "prjName"}, 
            { "data": "makeTime"}, 
        ],
        "columnDefs": [
						{	
								 "class": "tcenter",
								    "targets": 4,
								    "searchable": true,
								    "render": function(data, type, full) {
								  	  		return '<i class="iconfont icon-icon-test" style="font-size:20px;cursor:pointer;" title="查看详细信息" onclick="lookHistorylypingjia(this)" data-toggle="modal" data-target="#History"  id="lookDetall"></i>'
								        }
								  }
						],
        "order": [[1, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
	});

<!-- **************************************履约评价******************************************** -->
function GetQueryString(name){
    var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
    var r = window.location.search.substr(1).match(reg);
    if(r!=null)return  unescape(r[2]); return null;
}
// 调用方法
	id=GetQueryString("prjId");
	
	//查看详细信息
	var code;
	function initTable(){
		
		code=data.materialContractCode
		
		$("#lookprjName").text(data.prjName);
		$("#looktaskNo").text(data.taskNo);
		$("#lookprjfuzeren").text(data.prjPerson);
		$("#lookdepartment").text(data.omName);
		$("#lookclcgbianhao").text(data.materialContractCode);
		$("#lookhetongleijiMoney").text(data.contractAllMoney);
		$("#lookhetongshijijiesuanMoney").text(data.contractEndMoney);
		$("#lookfukuantype").text(data.payMode);
		$("#lookshijifuzeren").text(data.actualChargePerson);
		
		$("#lookpj1").text(data.scoreProductQualityEase);
		$("#lookpj2").text(data.scoreGiveProductionTime)
		$("#lookpj3").text(data.scoreMaterialReport)
		$("#lookpj4").text(data.scoreCustomerUse)
		$("#lookpj5").text(data.scorePayModeEvaluate)
		$("#lookpj6").text(data.scoreSafetyCivilizationEnvironment)
		$("#lookpj7").text(data.allScore)
		
		initTableHistory();
	}
	
	//初始化历史列表
	function initTableHistory(){
        $.ajax({
            type: 'POST',
            url: getContextPath()+'/MaterialSubcontract/selectHistoryBypayCode',
            dataType: 'json',
            data: {
            	code:code,
            },
            error: function (msg) {
                errMessage("请求失败");
            },
            success: function (json) {
            	console.log(json)
                $('#lookHistory').dataTable().fnClearTable();
                $('#lookHistory').DataTable().rows.add(json).draw(false);
            }
        });
    }
	
	//查看历史详细信息
	function lookHistorylypingjia(obj){
		var dom=$(obj).parents('tr');
		var data=$('#lookHistory').DataTable().row(dom).data();
		console.log(data)
		$('#History').on('hidden.bs.modal', function () {//解决模态框页面滚动问题
            if ($('.modal.in').size() >= 1) {
                $('body').addClass('modal-open')
            }
        }) 
        
        $("#HistoryprjName").text(data.prjName);
		$("#HistorytaskNo").text(data.taskNo);
		$("#Historyprjfuzeren").text(data.prjPerson);
		$("#Historydepartment").text(data.omName);
		$("#Historyclcgbianhao").text(data.materialContractCode);
		$("#HistoryhetongleijiMoney").text(data.contractAllMoney);
		$("#HistoryhetongshijijiesuanMoney").text(data.contractEndMoney);
		$("#Historyfukuantype").text(data.payMode);
		$("#Historyshijifuzeren").text(data.actualChargePerson);
		
		$("#Historypj1").text(data.scoreProductQualityEase);
		$("#Historypj2").text(data.scoreGiveProductionTime)
		$("#Historypj3").text(data.scoreMaterialReport)
		$("#Historypj4").text(data.scoreCustomerUse)
		$("#Historypj5").text(data.scorePayModeEvaluate)
		$("#Historypj6").text(data.scoreSafetyCivilizationEnvironment)
		$("#Historypj7").text(data.allScore)
        
	}


			    
</script>
</html>