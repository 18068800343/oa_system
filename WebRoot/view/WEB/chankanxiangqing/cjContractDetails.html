<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="../../font2/iconfont.css">
    <link rel="stylesheet" href="../../font3/iconfont.css">
	<link href="../../style/bootstrap.min.css" rel="stylesheet">
    <link href="../../style/style.css" rel="stylesheet">
    <link href="../../toastr/toastr.css" rel="stylesheet">
    <link rel="stylesheet" href="../../style/jquery.dataTables.min.css">
    <!-- <link rel="stylesheet" href="../../style/jquery-editable-select.css"> -->
    <link href="../../select/css/select2.min.css" rel="stylesheet">
    <style lang="">
        body{
            background: #fff;
        }
        .UpperPart{
            display: flex;
            justify-content:space-between;
            border-bottom: 1px solid #ccc;
            padding-bottom: 12px;
        }
        .selected{
            background: rgba(247, 161, 3,0.2);
        }
        #mainContent th{
            cursor: pointer;
            font-size: 14px;
        }
       /*  #tijiaoren{
                display: flex;
                flex-wrap:wrap;
        } */
        .tab-content>div{
            margin-top:18px;
        }
    </style>
</head>
<body>
	<div role="tabpanel" class="tab-pane" id="settings">
	    		<table class="table table-bordered table-condensed">
	                    <thead>
	                    		<tr>
	                    			<th colspan="10" style="text-align:center;font-size:30px;" height="60px">承接合同</th>
	                    		</tr>	                    
	                    		<tr>
	                    			<th colspan="10">项目基本信息</th>
	                    		</tr>
	                    </thead>
                    	<tbody>
                    			<tr>
		                        	<td style="width:20%;">项目名称:</td>
		                            <td id="look_prj_name"  style="width:30%;"></td>
		                            <td style="width:20%;">任务单号:</td>
		                            <td  id="look_work_no"  style="width:30%;"></td>
		                        </tr>
		                        <tr>
		                        	<td>项目类型:</td>
		                            <td id="look_prj_type"></td>
		                            <td>经营模式:</td>
		                            <td id="look_prj_jyms"></td>
		                        </tr>
                    	</tbody>
                </table>
	    		<table class="table table-bordered">
	    				<thead>
	                    		<tr>
	                    			<th colspan="10">承接合同信息</th>
	                    		</tr>
	                    </thead>
                    	<tbody>
                    			<tr>
		                            <td style="width:20%;">承接合同名称:</td>
		                            <td id="look_contract_name"  style="width:30%;"></td>
		                            <td style="width:20%;">承接合同编号:</td>
		                            <td id="look_contract_no"  style="width:30%;"></td>
		                        </tr>
		                        <tr>
		                            <td>合同甲方名称:</td>
		                            <td id="look_jiafangName" colspan="3"></td>
		                        </tr>
		                        <tr>
		                        	<td>合同乙方名称:</td>
		                            <td id="look_yifangName"></td>
		                        	<td>承接部门:</td>
		                            <td id="look_yifang_department"></td>
		                        </tr>
		                        <tr>
		                        	<td>合同起讫日期:</td>
		                            <td>
		                            	<div class="yihang"><div id="look_year"></div> -- <div id="look_year2"></div></div>
		                            </td>
		                            <td class="shuziyanse">合同工期(天):</td>
		                            <td id="look_work_date"></td>
		                        </tr>
		                        <tr>
		                        	<td class="jinqianyanse">合同金额(元):</td>
		                            <td id="look_contract_money"></td>
		                            <td class="jinqianyanse">暂定金(元):</td>
		                            <td id="look_temporary_money"></td>
		                        </tr>
		                        <tr>
		                        	<td>合同签订时间:</td>
		                            <td id="look_year3"></td>
		                            <td></td>
		                            <td></td>
		                        </tr>
		                        <tr>
		                            <td>收款条件:</td>
		                            <td colspan="3" id="look_receieve_money_condition"></td>
		                        </tr>
		                        <tr>
		                            <td>主要概况及工作内容:</td>
		                            <td colspan="3" id="look_work_info"></td>
		                        </tr>
                    	</tbody>
	                        
	                    </table>
	                    <table class="table table-bordered table-condensed" id="look_accessory">
	                    	<thead>
                        		<tr>
                                	<td  style="width:20%;">合同文本附件  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                	<td colspan="3"></td>
                            	</tr>
                        	</thead>
                        	<tbody></tbody>
	                    </table>
	                    <table class="table table-bordered table-condensed" id="look_accessory2">
	                    	<thead>
                        		<tr>
                                	<td  style="width:20%;">法律顾问签字  </td>
                                	<td colspan="3"></td>
                            	</tr>
                        	</thead>
                        	<tbody></tbody>
	                    </table>
	                    <table class="table table-bordered table-condensed" id="look_saomainHT">
                    	<thead>
                        		<tr>
                                	<td style="width:15%;">合同扫描件 </td>
                                	<td colspan="3"></td>
                            	</tr>
                        </thead>
                        <tbody></tbody>
                    </table>
	                    <div id="look_renwudanFenpei"></div>
	                   
	               <br/>

                   <div class="modal-footer">
                        <button type="button" class="btn btn-default" onclick="details_close()">关闭本页</button>
                   </div>               
	 </div> 
       
</body>
<script src="../../js/jquery.js"></script>
<script src="../../js/common-scripts.js"></script>
<script src="../../js/bootstrap.min.js"></script>
<script src="../../js/laydate/laydate.js"></script>
<!-- <script src="../../js/jquery-editable-select.js"></script> -->
<script src="../../toastr/toastr.js"></script>
<script src="../../js/city-picker.data.js"></script>
<script src="../../js/city-picker.js"></script>
<script src="../../js/quanxian.js"></script>


<script src="../../js/datatables/jquery.dataTables.min.js"></script>
<script src="../../js/datatables/dataTables.colVis.min.js"></script>
<script src="../../js/datatables/dataTables.tableTools.min.js"></script>
<!-- <script src="../../js/datatables/dataTables.bootstrap.min.js"></script> -->
<script src="../../js/datatables/datatables.responsive.min.js"></script>
<script src="../../js/datatables/dataTables.buttons.min.js" ></script>
<script src="../../js/datatables/buttons.html5.min.js" ></script>
<script src="../../js/datatables/buttons.flash.min.js" ></script>
<script src="../../js/datatables/jszip.min.js"></script>
<script src="../../js/jquery.cookie.js"></script>

<script src="../../select/js/select2.min.js"></script>
<script>  
    $(document).ready( function () {
    	initTable();
    });
    
    function getParam(paramName) { 
        paramValue = "", isFound = !1; 
        if (this.location.search.indexOf("?") == 0 && this.location.search.indexOf("=") > 1) { 
            arrSource = unescape(this.location.search).substring(1, this.location.search.length).split("&"), i = 0; 
            while (i < arrSource.length && !isFound) arrSource[i].indexOf("=") > 0 && arrSource[i].split("=")[0].toLowerCase() == paramName.toLowerCase() && (paramValue = arrSource[i].split("=")[1], isFound = !0), i++ 
        } 
        return paramValue == "" && (paramValue = null), paramValue 
    } 
    
    var cjCNo=getParam("cjCNo");
    function initTable(){
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/showDetailsPanel/cjContract',
            dataType: 'json',
            async:false,
            data: {
            	cjCNo:cjCNo
            },
            success: function (json) {
            	var result = json.result;
            	if(result>0){
          		var data=json.cjc;
          		$("#look_contract_name").text(data.contractName);
          		$("#look_contract_no").text(data.contractNo);
          		$("#look_work_no").text(data.taskCode);
          		$("#look_prj_name").text(data.prjName);
          		var prjNameArray = data.prjName.split(",");
          		var taskCodeArray = data.taskCode.split(",");
          		var tasks = getTaskBytaskCode(data.taskCode);
          		lookpinjieRenwudanChaifen(prjNameArray,taskCodeArray,tasks);
          		$("#look_prj_type").text(data.prjType);
          		$("#look_prj_jyms").text(data.jyms);
          		$("#look_jiafangName").text(data.ccName);
          		$("#look_yifangName").text(data.contractNameYi);
          		$("#look_year").text(data.contractStartTime);
          		$("#look_year2").text(data.contractEndTime);
          		$("#look_yifang_department").text(data.omName);
          		$("#look_work_date").text(data.contractLongTime);
          		$("#look_receieve_money_condition").text(data.receieveMoneyCondition);
          		$("#look_contract_money").text(data.contractMoney);
          		$("#look_temporary_money").text(data.temporaryMoney);
          		$("#look_year3").text(data.contractSignTime);
          		$("#look_work_info").text(data.workInfo);
          		var cs=data.cjSplitMoney;
            	$("#look_split_table tbody").empty();
            	for(var i=0;i<cs.length;i++){
        				$("#look_split_table tbody").append("<tr><td>"
        						+""+cs[i].year+""
        						+"</td><td>"
        						+""+cs[i].money+""
        						+"</td></tr>")
        		}
            	
            	
          		$.ajax({
        	        type: 'POST',
        	        url: getContextPath()+'/announcement/selectAccessoryById',
        	        dataType: 'json',
        	        data: {
        	           id:data.cjId
        	        },
        	        success: function (json) {
        	        	$("#look_accessory tbody").html('');
        	        	$("#look_accessory2 tbody").html('');
        	        	$("#look_saomainHT tbody").html('');
        	        	for(var i=0;i<json.length;i++){
        	          		if(json[i].aType=="承接合同文本"){
        		            	   $("#look_accessory tbody").append("<tr>"+
        									"<td>附件</td>"+
        									"<td colspan='2'><a href='"+getLocalPath()+"/oa_file/"+json[i].acUrl+"' target='view_window' style='color:blue;'>"+json[i].acName+"</a></td>"+
        				         	    	/* "<td ><input type='text' class='form-control' style='width:70%;' value='"+json[i].acName+"' disabled></td>"+
        				         	    	"<td style='width:150px;'><button type='button' class='btn btn-primary' data='"+json[i].acUrl+"' data2='"+json[i].acName+"' onclick='downloadFile(this)'>下载附件</button></td>"+ */
        				         	    "</tr>");
        	            	   }
        	          		if(json[i].aType=="法律顾问签字"){
        		            	   $("#look_accessory2 tbody").append("<tr>"+
        									"<td>附件</td>"+
        									"<td colspan='2'><a href='"+getLocalPath()+"/oa_file/"+json[i].acUrl+"' target='view_window' style='color:blue;'>"+json[i].acName+"</a></td>"+
        				         	    	/* "<td ><input type='text' class='form-control' style='width:70%;' value='"+json[i].acName+"' disabled></td>"+
        				         	    	"<td style='width:150px;'><button type='button' class='btn btn-primary' data='"+json[i].acUrl+"' data2='"+json[i].acName+"' onclick='downloadFile(this)'>下载附件</button></td>"+ */
        				         	    "</tr>");
	        	            	   }
        	          		if(json[i].aType=="合同扫描件"){
     		            	   $("#look_saomainHT tbody").append("<tr>"+
     	      	   										"<td style='width:20%;'>附件</td>"+
     	      	   										"<td colspan='3'><a href='"+getLocalPath()+"/oa_file/"+json[i].acUrl+"' target='view_window' style='color:blue'>"+json[i].acName+"</a></td>"+	            	    	
     							            	    "</tr>");
     		            	   }
	        	        	}
	        	        }
	            	});
	            }else{
	            	toastr.error('出现错误');
	            }
            }
        });
    }
    
    //查看单个具体信息
  	$('#mainContent').delegate('#lookDetall','click', function () {
  		var dom = $(this).parents('tr');
		var data=$('#mainContent').DataTable().row(dom).data();
  		
  	});
    
   	function getLocalPath(){
		var pathArray = window.location.pathname.split('/');
		var secondLevelLocation = pathArray[1];
		var loginUrl = window.location.protocol + "//"  + window.location.host ;
		return loginUrl;
	}
    function getTaskBytaskCode(taskNos){
    	var array ;
    	$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/task/selectTaskPrjName',
	        dataType: 'json',
	        async:false,
	        data: {
	        	prjNo:taskNos
	        },
	        success: function (json) {
	        	array = json;
	        }
    	})
    	return array;
    }
   	
	function lookpinjieRenwudanChaifen(namelist,array,tasks){
		var namestr = namelist;
		pageNameList=namelist;
		pageTaskNoArray=array;
		$("#look_renwudanFenpei").empty();
		if(namelist.length!=array.length){
			toastr.error("任务单编号信息有误");
			return false;
		}
	}
    
  	function details_close(){
  		if(confirm("您确定要关闭本页吗？")){
  			window.opener=null;
  			window.open('','_self'); 
  			window.close();
  			} 
  		}    

</script>

</html>