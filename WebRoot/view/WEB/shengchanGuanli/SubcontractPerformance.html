<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="../../font2/iconfont.css">
    <link rel="stylesheet" href="../../font3/iconfont.css">
	<link href="../../style/bootstrap.min.css" rel="stylesheet">
    <link href="../../style/style.css" rel="stylesheet">
    <link href="../../toastr/toastr.css" rel="stylesheet">
    <link rel="stylesheet" href="../../style/jquery.dataTables.min.css">
    <link rel="stylesheet" href="../../style/jquery-editable-select.css">
    <style lang="">
        .UpperPart{
            display: flex;
            justify-content:space-between;
            border-bottom: 1px solid #ccc;
            padding-bottom: 12px;
        }
        .selected{
            background: rgba(247, 161, 3,0.2);
        }
        #mainContent th{
            cursor: pointer;
        }
        
        
		div input[type=radio]{
			width:20px;
			height:20px;
			margin-left: 8px;
		}
    </style>
</head>
<body>
    
    <!-- 面包屑 -->
    <div class="mianbao">
    	<ul class="breadcrumb">
    		<li><i class="iconfont icon-knowledgebase"></i></li>
            <li>生产管理</li>
            <li>项目合同管理</li>
            <li>分包合同管理</li>
			<li class="active">分包履约</li>
		</ul>
    </div>

    <div>
        <!-- Nav tabs -->
        <ul class="nav nav-tabs" role="tablist" style="background:#fff;">
            <li role="presentation" class="active"><a href="#home" aria-controls="home" role="tab" data-toggle="tab">履约评价</a></li>
            <li role="presentation" onclick="initTable2()"><a href="#profile" aria-controls="profile" role="tab" data-toggle="tab">分包结算申请</a></li>
           <!--  <li role="presentation" onclick="initTable3()"><a href="#messages" aria-controls="messages" role="tab" data-toggle="tab">分包合同履约</a></li> -->
        </ul>     
        <!-- Tab panes -->
        <div class="tab-content">
            <div role="tabpanel" class="tab-pane active" id="home">
                <div class="zhuti-content">
                    <div class="UpperPart">
                        <div class="UpperPartL">
                            <select id="state" class="form-control" style="width:180px;">
                            	<option value="2">审批结束</option>
                            	<option value="1">审批中</option>
                            	<option value="0">审批未通过</option>
                            </select>
                        </div>
                        <div class="UpperPartR">
                        	<div class="yihang">
                        		<form class="form-inline">
                                <label>评价年份:</label>
                                <select id="this_year" class="form-control" style="width:180px;margin-right:5px;"></select>
                            	</form>
                        		<form class="form-inline">
                                <label>部门筛选:</label>
                                <select id="bumenshaixuan" class="form-control" style="width:180px;margin-right:5px;"></select>
                            	</form>
		            			<button type="button" class="btn btn-primary Pecgca" data-toggle="modal" data-target="#myModal">填报履约评价表</button>
				                <div id="tabBtn" style="margin-left: 10px;"></div>
				            </div>
                        </div>
            <!-- Modal -->
            <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="myModal">
                <div class="modal-dialog modal-lg" role="document" style="width:60%;">
                    <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel"><b>填报履约评价表</b></h4>
                    </div>
                    <div class="modal-body">
                            <div>     
                                <form class="form-inline">
                                    <table class="table table-bordered table-condensed">
                                        <tr>   
                                            <td style="width:15%;">承接合同名称  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                            <td>
                                                <!-- <select class="form-control"  style="width:80%;" id="new_cj_name">
                                                </select> -->
                                                <input type="text" class="form-control" style="width:60%;" disabled id="new_cj_name">
                                            	 <button type="button" class="btn btn-primary weui-uploader__input" onclick="select_cj()">选择承接合同</button>
                                            </td>
                                            <td style="width:15%;">承接合同编号</td>
                                            <td><select class="form-control"  style="width:60%;" id="new_cj_no">
                                                </select>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>任务单号</td>
                                            <td>
                                                <input type="text" class="form-control" style="width:60%;" disabled id="new_prj_no">
                                            </td>
                                            <td>分包合同名称  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                            <td>
                                                <!-- <select class="form-control" style="width:80%;" id="new_fb_name">
                                                </select> -->
                                                <input type="text" class="form-control" id="new_fb_name" disabled style="width:60%;">
                                    			<button type="button" class="btn btn-primary weui-uploader__input" onclick="chooseFb()">选择分包</button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>分包合同编号</td>
                                            <td>
                                            	<select class="form-control" style="width:60%;" id="new_fb_no">
                                                </select>
                                            </td>
                                            <td>分包单位</td>
                                            <td>
                                                <input type="text" class="form-control" style="width:60%;" disabled id="new_fb_department">
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>实际负责人</td>
                                            <td>
                                                <input type="text" id="leader" style="width:60%;" class="form-control" disabled>
                                    			<button type="button" class="btn btn-default" data-toggle="modal" data-target="#addGuanliren">选择负责人</button>
                                            </td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td rowspan="5">评价内容  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                            <td>人员、材料和设备配置情况（20%）</td>
                                            <td colspan="2">
                                                <!-- <input type="radio" name="pj" value="90">90
                                                <input type="radio" name="pj" value="75">75
                                                <input type="radio" name="pj" value="60">60 -->
                                                <input type="text" placeholder="0-100" class="form-control" id="pj"  style="width:60%;">
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>施工经验、施工组织管理能力（20%）</td>
                                            <td colspan="2">
                                                <!-- <input type="radio" name="pj2" value="90">90
                                                <input type="radio" name="pj2" value="75">75
                                                <input type="radio" name="pj2" value="60">60 -->
                                                <input type="text" placeholder="0-100" class="form-control" id="pj2"  style="width:60%;">
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>质量控制（20%）</td>
                                            <td colspan="2">
                                               <!--  <input type="radio" name="pj3" value="90">90
                                                <input type="radio" name="pj3" value="75">75
                                                <input type="radio" name="pj3" value="60">60 -->
                                                <input type="text" placeholder="0-100" class="form-control" id="pj3"  style="width:60%;">
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>个人信誉（20%）</td>
                                            <td colspan="2">
                                                <!-- <input type="radio" name="pj4" value="90">90
                                                <input type="radio" name="pj4" value="75">75
                                                <input type="radio" name="pj4" value="60">60 -->
                                                <input type="text" placeholder="0-100" class="form-control" id="pj4"  style="width:60%;">
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>进度控制（20%）</td>
                                            <td colspan="2">
                                                <!-- <input type="radio" name="pj5" value="90">90
                                                <input type="radio" name="pj5" value="75">75
                                                <input type="radio" name="pj5" value="60">60 -->
                                                <input type="text" placeholder="0-100" class="form-control" id="pj5"  style="width:60%;">
                                            </td>
                                        </tr>
                                        <!-- <tr>
                                            <td>安全文明与环保（10%）</td>
                                            <td colspan="2">
                                                <input type="radio" name="pj6" value="90">90
                                                <input type="radio" name="pj6" value="75">75
                                                <input type="radio" name="pj6" value="60">60
                                            </td>
                                        </tr> -->
                                        <tr>
                                            <td>综合评价</td>
                                            <td colspan="3">
                                                <!-- <input type="radio" name="pj7" value="90">90
                                                <input type="radio" name="pj7" value="75">75
                                                <input type="radio" name="pj7" value="60">60 -->
                                                <input type="text" class="form-control" id="pj7"  style="width:40%;" disabled>
                                                <button type="button"  class="btn btn-primary" onclick="get_all()">计算</button>
                                            </td>
                                        </tr>
                                    </table> 
                                </form> 
                            </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                        <!-- <button type="button" class="btn btn-success" onclick="save()">保存</button> -->
                        <button type="button" class="btn btn-success" onclick="submit()">提交</button>
                    </div>
                    </div>
                </div>
            </div>
            <!-- model结束 -->
            

           <!-- 提交 modal -->
<!-- <div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="tijiaogei2">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="gridSystemModalLabel">提交给</h4>
            </div>
            <div class="modal-body">
                <table class="table table-bordered table-condensed" id="tijiaoren2">
                        	<thead>
                        			<tr>
		                            	<th></th>
		                                <th>部门</th>
		                                <th>职务</th>
		                                <th>审批人</th>
		                            </tr>
                        	</thead>
                            <tbody>
                            	
                            </tbody>
                        </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-success" data-dismiss="modal" onclick="submitPerson2()">提交</button>
            </div>
        </div>
    </div>
</div> -->
<!-- 提交 modal结束 -->

 <!-- 提交 modal -->
<!-- <div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="tijiaogei3">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="gridSystemModalLabel">提交给</h4>
            </div>
            <div class="modal-body">
                <table class="table table-bordered table-condensed" id="tijiaoren3">
                        	<thead>
                        			<tr>
		                            	<th></th>
		                                <th>部门</th>
		                                <th>职务</th>
		                                <th>审批人</th>
		                            </tr>
                        	</thead>
                            <tbody>
                            	
                            </tbody>
                        </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-success" data-dismiss="modal" onclick="submitPerson3()">提交</button>
            </div>
        </div>
    </div>
</div> -->
<!-- 提交 modal结束 -->

		<!-- Modal选择分包合同 -->
		<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="choose_fb">
		    <div class="modal-dialog modal-lg" role="document" style="width:60%;">
		        <div class="modal-content">
		        <div class="modal-header">
		            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		            <h4 class="modal-title" id="myModalLabel"><b>选择分包合同</b></h4>
		        </div>
		        <div class="modal-body">
		                <div>     
		                    <form class="form-inline">
		                        <table class="table table-bordered table-condensed" id="fb_table">
		                            <thead>
		                            	<tr>
		                            		<th></th>
		                            		<th>分包合同名称</th>
		                                    <th>分包合同编号</th>
		                                    <th>甲方单位</th>
		                                    <th>合同起日期</th>
		                                    <th>合同讫日期</th>
		                            	</tr>
		                            </thead>
		                            <tbody>
		                                
		                            </tbody>
		                        </table> 
		                    </form>  
		                </div>
		        </div>
		        <div class="modal-footer">
		            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
		            <button type="button" class="btn btn-success" onclick="saveFbName()">保存</button>
		        </div>
		        </div>
		    </div>
		</div>
		<!-- model项目结束 -->

            <!-- 修改Modal -->
            <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="change">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel"><b>修改履约评价表</b></h4>
                    </div>
                    <div class="modal-body">
                            <div>     
                                <form class="form-inline">
                                    <table class="table table-bordered table-condensed">
                                        <tr>   
                                            <td style="width:100px;">承接合同名称  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                            <td>
                                                <select class="form-control" style="width:180px;">
                                                    <option>1</option>
                                                    <option>2</option>
                                                    <option>3</option>
                                                    <option>4</option>
                                                    <option>5</option>
                                                </select>
                                            </td>
                                            <td style="width:100px;">承接合同编号</td>
                                            <td><input type="text" class="form-control" disabled></td>
                                        </tr>
                                        <tr>
                                            <td>任务单号</td>
                                            <td>
                                                <select class="form-control" style="width:180px;"  id="editable-select">
                                                    <option>1</option>
                                                    <option>2</option>
                                                    <option>3</option>
                                                    <option>4</option>
                                                    <option>5</option>
                                                </select>
                                            </td>
                                            <td>分包合同名称  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                            <td>
                                                <select class="form-control" style="width:180px;"  id="editable-select3">
                                                    <option>1</option>
                                                    <option>2</option>
                                                    <option>3</option>
                                                    <option>4</option>
                                                    <option>5</option>
                                                </select>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>分包合同编号</td>
                                            <td><input type="text" class="form-control" disabled></td>
                                            <td>分包单位</td>
                                            <td>
                                                <select class="form-control" style="width:180px;"  id="editable-select2">
                                                    <option>1</option>
                                                    <option>2</option>
                                                    <option>3</option>
                                                    <option>4</option>
                                                    <option>5</option>
                                                </select>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>实际负责人</td>
                                            <td>
                                                <select class="form-control" style="width:180px;"  id="editable-select4">
                                                    <option>1</option>
                                                    <option>2</option>
                                                    <option>3</option>
                                                    <option>4</option>
                                                    <option>5</option>
                                                </select>
                                            </td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td rowspan="5">评价内容  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                            <td>人员、材料和设备配置情况（20%）</td>
                                            <td colspan="2">
                                                <input type="radio" name="pj">90
                                                <input type="radio" name="pj">75
                                                <input type="radio" name="pj">60
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>施工经验、施工组织管理能力（20%）</td>
                                            <td colspan="2">
                                                <input type="radio" name="pj2">90
                                                <input type="radio" name="pj2">75
                                                <input type="radio" name="pj2">60
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>质量控制（20%）</td>
                                            <td colspan="2">
                                                <input type="radio" name="pj3">90
                                                <input type="radio" name="pj3">75
                                                <input type="radio" name="pj3">60
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>个人信誉（20%）</td>
                                            <td colspan="2">
                                                <input type="radio" name="pj4">90
                                                <input type="radio" name="pj4">75
                                                <input type="radio" name="pj4">60
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>进度控制（20%）</td>
                                            <td colspan="2">
                                                <input type="radio" name="pj5">90
                                                <input type="radio" name="pj5">75
                                                <input type="radio" name="pj5">60
                                            </td>
                                        </tr>
                                        <!-- <tr>
                                            <td>安全文明与环保（10%）</td>
                                            <td colspan="2">
                                                <input type="radio" name="pj6">90
                                                <input type="radio" name="pj6">75
                                                <input type="radio" name="pj6">60
                                            </td>
                                        </tr> -->
                                        <tr>
                                            <td>综合评价</td>
                                            <td colspan="3">
                                                <input type="radio" name="pj7">90
                                                <input type="radio" name="pj7">75
                                                <input type="radio" name="pj7">60
                                            </td>
                                        </tr>
                                    </table> 
                                </form> 
                            </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-success">保存</button>
                    </div>
                    </div>
                </div>
            </div>
            <!-- 修改model结束 -->

                    </div>
                    <div class="LowerPart" style="margin-top:3px;">
                        <table class="table table-bordered table-condensed" id="mainContent">
                            <thead>
                                <tr>
                                    <th>评价年份</th>
                                    <th>任务单号</th>
                                    <th>承接合同编号</th>
                                    <th>承接合同名称</th>
                                    <th>分包合同编号</th>
                                    <th>分包合同名称</th>
                                    <th>分包单位</th>
                                    <th>实际负责人</th>
                                    <th>综合评价</th>
                                    <th style="width:75px;">操作</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>   
                        </table>

<!--选人 modal -->
<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="addGuanliren">
    <div class="modal-dialog" role="document" style="width:60%;">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="gridSystemModalLabel">选择实际负责人</h4>
            </div>
            <div class="modal-body">
                <form class="form-inline">
                    <div class="form-group">
                        <div>
                            <span>部门:</span>
                            <select style="width:180px;" id="bumen" class="form-control" >
                                
                            </select>
                        </div>
                    </div>
                </form>
                <div>
                     <table class="table table-bordered table-condensed"  id="bmmingzibiao" style="width:100%;">
                     	<thead>
		   					<tr>
		   						<th></th>
		   						<th>姓名</th>
		   						<th>工号</th>
		   						<th>出生日期</th>
		   						<th>性别</th>
		   						<th>职务</th>
		   					</tr>
		   				</thead>
		   				<tbody></tbody>
                     </table>
              </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="saveGuanliren()" data-dismiss="modal">确定</button>
            </div>
        </div>
    </div>
</div>
<!-- 选人 modal结束 --> 


                       
<!-- allMsg -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="allMsg1">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>所有信息</b></h4>
        </div>
        <div class="modal-body">
            <div>     
                <form class="form-inline">
                    <table class="table table-bordered table-condensed">
                        <tr>   
                            <td style="width:15%;">承接合同名称</td>
                            <td id="look_cj_name"></td>
                            <td style="width:15%;">承接合同编号</td>
                            <td id="look_cj_no"></td>
                        </tr>
                        <tr>
                            <td>任务单号</td>
                            <td id="look_prj_no"></td>
                            <td>分包合同名称</td>
                            <td id="look_fb_name"></td>
                        </tr>
                        <tr>
                            <td>分包合同编号</td>
                            <td id="look_fb_no"></td>
                            <td>分包单位</td>
                            <td id="look_fb_department"></td>
                        </tr>
                        <tr>
                            <td>实际负责人</td>
                            <td id="look_leader"></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td rowspan="6">评价内容</td>
                            <td>人员、材料和设备配置情况（20%）</td>
                            <td colspan="2" id="score"></td>
                        </tr>
                        <tr>
                            <td>施工经验、施工组织管理能力（20%）</td>
                            <td colspan="2" id="score2"></td>
                        </tr>
                        <tr>
                            <td>质量控制（20%）</td>
                            <td colspan="2" id="score3"></td>
                        </tr>
                        <tr>
                            <td>个人信誉（20%）</td>
                            <td colspan="2" id="score4"></td>
                        </tr>
                        <tr>
                            <td>进度控制（20%）</td>
                            <td colspan="2" id="score5"></td>
                        </tr>
                        <!-- <tr>
                            <td>安全文明与环保（10%）</td>
                            <td colspan="2" id="score6"></td>
                        </tr> -->
                        <tr>
                            <td>综合评价</td>
                            <td colspan="3" id="score7"></td>
                        </tr>
                    </table> 
                </form> 
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        </div>
        </div>
    </div>
</div>
<!-- allMsg结束 -->
                    </div>
                </div>
            </div>

            <div role="tabpanel" class="tab-pane" id="profile">
    <div class="zhuti-content">
        <div class="UpperPart">
            <div class="UpperPartL">
                <select id="state2" class="form-control" style="width:180px;">
                 	<option value="2">审批结束</option>
                 	<option value="1">审批中</option>
                 	<option value="0">审批未通过</option>
                </select>
            </div>
            <div class="UpperPartR">
            	<div class="yihang">
           			<button type="button" class="btn btn-primary Pecgcc" data-toggle="modal" data-target="#myModal2">新建分包结算申请</button>
	                <div id="tabBtn2" style="margin-left: 10px;"></div>
	            </div>
            </div>
<!-- Modal -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="myModal2">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>新建分包结算申请</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline" id="form_fb" method="post" enctype="multipart/form-data">
                        <table class="table table-bordered table-condensed">
                        	<tr>
                                <td style="width:18%;">分包合同名称  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                    <!-- <select class="form-control" style="width:80%;"  id="fbContractName">
                                    </select> -->
                                    <input type="text" class="form-control" id="fbContractName2" disabled style="width:60%;">
                                    <button type="button" class="btn btn-primary weui-uploader__input" onclick="chooseFb2()">选择分包</button>
                                </td>
                                <td style="width:18%;">分包合同号</td>
                                <td>
                                	<select class="form-control" style="width:75%;"  id="fbContract2">
                                    </select>
                                </td>
                            </tr>
                            <tr>
                            	<td>分包合同金额</td>
                            	<td><input type="text" class="form-control" id="fb_money2" disabled style="width:60%;"></td>
                            	<td>结算金额</td>
                            	<td><input type="text" class="form-control" id="fb_end_money2" style="width:75%;"></td>
                            </tr>
                            <tr>
                                <td>承接合同名称  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                    <!-- <select class="form-control" style="width:80%;" id="cjContractName">
                                    </select> -->
                                    <input type="text" class="form-control" style="width:60%;" disabled id="cjContractName2">
                                    <!-- <button type="button" class="btn btn-primary weui-uploader__input" onclick="select_cj3()">选择承接</button> -->
                                </td>
                                <td>承接合同编号</td>
                                <td>
                                	<input type="text" class="form-control" style="width:75%;" disabled id="cjContract2">
                                	<!-- <select class="form-control" style="width:60%;" id="cjContract">
                                    </select> -->
                                </td>
                            </tr>
                            <tr>
                                <td>任务单号</td>
                                <td><input type="text" class="form-control" style="width:60%;" id="prjCode2" disabled></td>
                                <!-- <td>审计结算类型</td>
                                <td>
                                    <select class="form-control" style="width:75%;" id="sj_type">
                                        <option value="中间结算">中间结算</option>
                                        <option value="最终结算">最终结算</option>
                                    </select>
                                </td> -->
                                <td>时间</td>
                                <td><input type="text" style="width:75%;" class="form-control" id="year"></td>
                            </tr>
                            <tr>
                            	<td>前期经营费用(元)</td>
                                <td><input type="text" style="width:60%;" class="form-control" id="qianqijyfy">
                                	<input type="checkbox" style="width:15px;height:15px;"  name="sfkouchu">是否扣除
                                </td>
                            </tr>
                            <!-- <tr>
                                <td style="width:15%;">项目名称  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td style="width:35%;">
                                    <select class="form-control" style="width:80%;"  id="prj_name">
                                    </select>
                                    <input type="text" class="form-control" id="prj_name" disabled  style="width:65%;">
                               		<button type="button"  class="btn btn-primary"  id="chosexm">选择项目</button>
                                </td>
                                <td style="width:15%;">任务单号</td>
                                <td style="width:35%;">
                                	<select class="form-control" style="width:65%;"  id="prj_no2">
                                		
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>分包合同  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                    <select class="form-control" style="width:65%;" id="fb_name2">
                                    </select>
                                    <input type="text" class="form-control" id="fb_name2" disabled style="width:65%;">
                                    <button type="button" class="btn btn-primary weui-uploader__input" onclick="chooseFb2()">选择分包</button>
                                </td>
                                <td>承接合同  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                    <select class="form-control" style="width:65%;"  id="cj_name2">
                                    </select>
                                    <input type="text" class="form-control" style="width:65%;" disabled id="cj_name2">
                                    <button type="button" class="btn btn-primary weui-uploader__input" onclick="select_cj2()">选择承接</button>
                                </td>
                            </tr> -->
                            <tr>
                                <td>内容概述</td>
                                <td colspan="3">
                                     <textarea class="form-control" rows="4" style="width:100%;" id="work_info2"></textarea>
                                </td>
                            </tr>
                        </table>
                        <table class="table table-bordered table-condensed" id="new_accessory">
							<thead>
								<tr>
	                                <td style="width:15%;">分包结算单:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
	                                <td colspan="2">
	                                    <button type="button" class="btn btn-primary" onclick="new_accessory()">增加附件</button>
	                                </td>
                            	</tr>
							</thead>
							<tbody></tbody>
						</table>
						<!-- <table class="table table-bordered table-condensed" id="new_accessory1">
							<thead>
								<tr>
	                                <td style="width:15%;">法律顾问签字:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
	                                <td colspan="2">
	                                    <button type="button" class="btn btn-primary" onclick="new_accessory1()">增加附件</button>
	                                </td>
                            	</tr>
							</thead>
							<tbody></tbody>
						</table> -->
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <!-- <button type="button" class="btn btn-success" onclick="save2()">保存</button> -->
            <button type="button" class="btn btn-success" onclick="submit2()">提交</button>
        </div>
        </div>
    </div>
</div>
<!-- model结束 -->
<!-- Modal选择分包合同 -->
		<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="choose_fb2">
		    <div class="modal-dialog modal-lg" role="document" style="width:60%;">
		        <div class="modal-content">
		        <div class="modal-header">
		            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		            <h4 class="modal-title" id="myModalLabel"><b>选择分包合同</b></h4>
		        </div>
		        <div class="modal-body">
		                <div>     
		                    <form class="form-inline">
		                        <table class="table table-bordered table-condensed" id="fb_table2">
		                            <thead>
		                            	<tr>
		                            		<th></th>
		                            		<th>分包合同名称</th>
		                                    <th>分包合同编号</th>
		                                    <th>甲方单位</th>
		                                    <th>合同起日期</th>
		                                    <th>合同讫日期</th>
		                            	</tr>
		                            </thead>
		                            <tbody>
		                                
		                            </tbody>
		                        </table> 
		                    </form>  
		                </div>
		        </div>
		        <div class="modal-footer">
		            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
		            <button type="button" class="btn btn-success" onclick="saveFbName2()">保存</button>
		        </div>
		        </div>
		    </div>
		</div>
		<!-- model项目结束 -->
<!-- Modal项目 -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="xiangmumd">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>选择项目</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline">
                        <table class="table table-bordered table-condensed" id="xiangmubiao">
                            <thead>
                            	<tr>
                            		<th></th>
                            		<th>编号</th>
                                    <th>项目名称</th>
                                    <th>项目所属公司</th>
                                    <th>项目类型</th>
                                    <th>甲方单位</th>
                            	</tr>
                            </thead>
                            <tbody>
                                
                            </tbody>
                        </table> 
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-success" id="quedingxm">保存</button>
        </div>
        </div>
    </div>
</div>
<!-- model项目结束 -->
<!-- Modal选择承接合同 -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="choose_cj2">
    <div class="modal-dialog modal-lg" role="document" style="width:60%;">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>选择承接合同</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline">
                        <table class="table table-bordered table-condensed" id="cj_table2">
                            <thead>
                            	<tr>
                            		<th></th>
                            		<th>承接合同名称</th>
                                    <th>承接合同编号</th>
                                    <th>甲方单位</th>
                                    <th>合同起日期</th>
                                    <th>合同讫日期</th>
                            	</tr>
                            </thead>
                            <tbody>
                                
                            </tbody>
                        </table> 
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-success" onclick="saveCjName2()">保存</button>
        </div>
        </div>
    </div>
</div>
<!-- model项目结束 -->
<!-- 修改Modal -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="change2">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>修改分包结算申请</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline">
                        <table class="table table-bordered table-condensed">
                            <tr>
                                <td>项目名称  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                    <select class="form-control" style="width:180px;"  id="editable-select2x2">
                                        <option>1</option>
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5</option>
                                    </select>
                                </td>
                                <td style="width:100px;">任务单号</td>
                                <td><input type="text" class="form-control" disabled></td>
                            </tr>
                            <tr>
                                <td style="width:100px;">分包合同  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                    <select class="form-control" style="width:180px;">
                                        <option>1</option>
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5</option>
                                    </select>
                                </td>
                                <td>承接合同  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                    <select class="form-control" style="width:180px;"  id="editable-select3x2">
                                        <option>1</option>
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>审计结算类型</td>
                                <td>
                                    <select class="form-control" style="width:180px;">
                                        <option>1</option>
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5</option>
                                    </select>
                                </td>
                                <td>时间</td>
                                <td><input type="text" class="form-control"></td>
                            </tr>
                            <tr>
                                <td>内容概述</td>
                                <td colspan="3">
                                    <div class="form-group">
                                        <textarea class="form-control" rows="4" cols="50"></textarea>
                                    </div> 
                                </td>
                            </tr>
                        </table>
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-success">保存</button>
        </div>
        </div>
    </div>
</div>
<!-- 修改model结束 -->

        </div>
        <div class="LowerPart" style="margin-top:3px;">
            <table class="table table-bordered table-condensed" id="mainContent2" style="width:100%;">
                <thead>
                    <tr>
                    	<th>分包合同号</th>
                    	<th>分包合同名称</th>
                        <th>承接合同</th>
                        <th>承接合同名称</th>
                        <th>任务单号</th>
                        <th>分包合同金额(元)</th>
                        <th>分包结算金额(元)</th>
                        <th>时间</th>
                        <th style="width:80px;">操作</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>   
            </table>
<!-- allMsg -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="allMsg2">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>所有信息</b></h4>
        </div>
        <div class="modal-body">
            <div>     
                <form class="form-inline">
                    <table class="table table-bordered table-condensed">
                        <tr>
                            <td style="width:15%;">分包合同名称</td>
                            <td id="look_fb_name2"></td>
                            <td style="width:15%;">分包合同编号</td>
                            <td id="look_fb_no2"></td>
                        </tr>
                         <tr>
                            <td>分包合同金额</td>
                            <td id="look_fb_money2"></td>
                            <td>结算金额</td>
                            <td id="look_end_money2"></td>
                        </tr>
                        <tr>
                            <td>承接合同名称</td>
                            <td id="look_cj_name2"></td>
                            <td>承接合同编号</td>
                            <td id="look_cj_no2"></td>
                        </tr>
                        <tr>
                        	<td>任务单编号</td>
                            <td id="look_prj_code2"></td>
                            <!-- <td>审计结算类型</td>
                            <td id="look_sj_type"></td> -->
                            <td>时间</td>
                            <td id="look_year"></td>
                        </tr>
                        <tr>
                           	<td>前期经营费用(元)</td>
                            <td id="look_qianqijyfy"></td>
                            <td>是否扣除</td>
                            <td id="look_sfkouchu"></td>
                         </tr>
                        <tr>
                            <td>内容概述</td>
                            <td colspan="3" id="look_work_info2"></td>
                        </tr>
                    </table>
                    <br/>
					 <table class="table table-bordered table-condensed" id="look_accessory">
                        <thead>
								<tr>
	                                <td style="width:18%;">分包结算单:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
	                                <td colspan="3"></td>
                            	</tr>
						</thead>
                        <tbody></tbody>
                    </table>
                    <!-- <table class="table table-bordered table-condensed" id="look_accessory2">
                        <thead>
								<tr>
	                                <td style="width:18%;">法律顾问签字:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
	                                <td colspan="3"></td>
                            	</tr>
						</thead>
                        <tbody></tbody>
                    </table> -->
                </form>  
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        </div>
        </div>
    </div>
</div>
<!-- allMsg结束 -->
        </div>
    </div>
            </div>

            <div role="tabpanel" class="tab-pane" id="messages">
                <div class="zhuti-content">
        <div class="UpperPart">
            <div class="UpperPartL">
                 <select id="state3" class="form-control" style="width:180px;">
                    	<option value="2">审批结束</option>
                    	<option value="1">审批中</option>
                    	<option value="0">审批未通过</option>
                  </select>
            </div>
            <div class="UpperPartR">
            	<div class="yihang">
           			<button type="button" class="btn btn-primary Pecgce" data-toggle="modal" data-target="#myModal3">新建合同履约申请表</button>
	                <div id="tabBtn3" style="margin-left: 10px;"></div>
	            </div>
                <!-- <button type="button" class="btn btn-primary Pecgcf" onclick="exportThis()">导出打印</button> -->
            </div>
<!-- Modal -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="myModal3">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>新建合同履约申请表</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline" id="form_fb2" method="post" enctype="multipart/form-data">
                        <table class="table table-bordered table-condensed">
                            <tr>
                                <td style="width:18%;">分包合同名称  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                    <!-- <select class="form-control" style="width:80%;"  id="fbContractName">
                                    </select> -->
                                    <input type="text" class="form-control" id="fbContractName" disabled style="width:60%;">
                                    <button type="button" class="btn btn-primary weui-uploader__input" onclick="chooseFb3()">选择分包</button>
                                </td>
                                <td style="width:18%;">分包合同号</td>
                                <td>
                                	<select class="form-control" style="width:75%;"  id="fbContract">
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>承接合同名称  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                    <!-- <select class="form-control" style="width:80%;" id="cjContractName">
                                    </select> -->
                                    <input type="text" class="form-control" style="width:60%;" disabled id="cjContractName">
                                    <!-- <button type="button" class="btn btn-primary weui-uploader__input" onclick="select_cj3()">选择承接</button> -->
                                </td>
                                <td>承接合同编号</td>
                                <td>
                                	<input type="text" class="form-control" style="width:75%;" disabled id="cjContract">
                                	<!-- <select class="form-control" style="width:60%;" id="cjContract">
                                    </select> -->
                                </td>
                            </tr>
                            <tr>
                                <td>任务单号</td>
                                <td><input type="text" class="form-control" style="width:60%;" id="prjCode" disabled></td>
                                <td>项目负责人</td>
                                <td>
                                    <input type="text" id="prjChargePerson" style="width:75%;" class="form-control" disabled>
                                    <!-- <button type="button" class="btn btn-default" data-toggle="modal" data-target="#addGuanliren2">项目负责人</button> -->
                                </td>
                            </tr>
                            <tr>
                                <td>合同乙方</td>
                                <td>
                                    <select class="form-control" style="width:60%;" id="contractNameYi">
                                    </select>
                                </td>
                                <td>分包负责人</td>
                                <td>
                                     <input type="text" id="fbChargePerson" style="width:75%;" class="form-control" disabled>
                                    <!-- <button type="button" class="btn btn-default" data-toggle="modal" data-target="#addGuanliren3">分包负责人</button> -->
                                </td>
                            </tr>
                            <tr>
                                <td>合同金额(元)</td>
                                <td><input type="text" class="form-control" style="width:60%;" id="contractMoney" disabled></td>
                                <td>暂定金(元)</td>
                                <td><input type="text" class="form-control" style="width:75%;" id="provisionalMoney" disabled></td>
                            </tr>
                            <tr>
                                <td>累计付款(元)</td>
                                <td><input type="text" class="form-control" style="width:60%;" id="allPayMoney" disabled></td>
                                <td>结算说明</td>
                                <td><input type="text" class="form-control" style="width:75%;" id="overWorkExplain"></td>
                            </tr>
                            <tr>
                            	<td>结算金额(元)</td>
                                <td><input type="text" class="form-control" style="width:60%;" id="overWorkMoney"></td>
                                <td>履约评级</td>
                                <td><input type="text" class="form-control" style="width:75%;" id="doAppointScore"></td>
                            </tr>
                            <tr>
                                <td>项目概况、工作内容、实际工期</td>
                                <td colspan="3">
                                   <textarea class="form-control" rows="4" style="width:100%;" id="prjProbablyText"></textarea>
                                </td>
                            </tr>
                        </table>
						<table class="table table-bordered table-condensed" id="new_accessory2">
							<thead>
								<tr>
	                                <td style="width:15%;">合同文本:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
	                                <td colspan="2">
	                                    <button type="button" class="btn btn-primary" onclick="new_accessory2()">增加附件</button>
	                                </td>
                            	</tr>
							</thead>
							<tbody></tbody>
						</table>
						<table class="table table-bordered table-condensed" id="new_accessory3">
							<thead>
								<tr>
	                                <td style="width:15%;">法律顾问签字:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
	                                <td colspan="2">
	                                    <button type="button" class="btn btn-primary" onclick="new_accessory3()">增加附件</button>
	                                </td>
                            	</tr>
							</thead>
							<tbody></tbody>
						</table>
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <!-- <button type="button" class="btn btn-success" onclick="save3()">保存</button> -->
            <button type="button" class="btn btn-success" onclick="submit3()">提交</button>
        </div>
        </div>
    </div>
</div>
<!-- model结束 -->
<!-- Modal选择承接合同 -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="choose_fb3">
    <div class="modal-dialog modal-lg" role="document" style="width:60%;">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>选择分包合同</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline">
                        <table class="table table-bordered table-condensed" id="fb_table3">
                            <thead>
                            	<tr>
                            		<th></th>
                            		<th>分包合同名称</th>
                                    <th>分包合同编号</th>
                                    <th>甲方单位</th>
                                    <th>合同起日期</th>
                                    <th>合同讫日期</th>
                            	</tr>
                            </thead>
                            <tbody>
                                
                            </tbody>
                        </table> 
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-success" onclick="saveFbName3()">保存</button>
        </div>
        </div>
    </div>
</div>
<!-- model项目结束 -->
<!--选人 modal -->
<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="addGuanliren2">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="gridSystemModalLabel">选择项目负责人</h4>
            </div>
            <div class="modal-body">
                <form class="form-inline">
                    <div class="form-group">
                        <div>
                            <span>部门:</span>
                            <select style="width:180px;" id="bumen2" class="form-control" >
                                
                            </select>
                        </div>
                    </div>
                </form>
                <div>
                     <table class="table table-bordered table-condensed"  id="bmmingzibiao2" style="width:100%;">
                     	<thead>
		   					<tr>
		   						<th></th>
		   						<th>姓名</th>
		   						<th>工号</th>
		   						<th>出生日期</th>
		   						<th>性别</th>
		   						<th>职务</th>
		   					</tr>
		   				</thead>
		   				<tbody></tbody>
                     </table>
              </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="savePrj()" data-dismiss="modal">确定</button>
            </div>
        </div>
    </div>
</div>
<!-- 选人 modal结束 -->
<!--选人 modal -->
<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="addGuanliren3">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="gridSystemModalLabel">选择分包负责人</h4>
            </div>
            <div class="modal-body">
                <form class="form-inline">
                    <div class="form-group">
                        <div>
                            <span>部门:</span>
                            <select style="width:180px;" id="bumen3" class="form-control" >
                                
                            </select>
                        </div>
                    </div>
                </form>
                <div>
                     <table class="table table-bordered table-condensed"  id="bmmingzibiao3"  style="width:100%;">
                     	<thead>
		   					<tr>
		   						<th></th>
		   						<th>姓名</th>
		   						<th>工号</th>
		   						<th>出生日期</th>
		   						<th>性别</th>
		   						<th>职务</th>
		   					</tr>
		   				</thead>
		   				<tbody></tbody>
                     </table>
              </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="saveFb()" data-dismiss="modal">确定</button>
            </div>
        </div>
    </div>
</div>
<!-- 选人 modal结束 --> 
<!-- 修改Modal -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="change3">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>修改合同履约申请表</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline">
                        <table class="table table-bordered table-condensed">
                            <tr>
                                <td>分包合同名称  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                    <select class="form-control" style="width:180px;"  id="editable-select2x3">
                                        <option>1</option>
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5</option>
                                    </select>
                                </td>
                                <td style="width:100px;">分包合同号</td>
                                <td><input type="text" class="form-control" disabled></td>
                            </tr>
                            <tr>
                                <td style="width:100px;">承接合同名称  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                    <select class="form-control" style="width:180px;">
                                        <option>1</option>
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5</option>
                                    </select>
                                </td>
                                <td>承接合同编号</td>
                                <td><input type="text" class="form-control" disabled></td>
                            </tr>
                            <tr>
                                <td>任务单号</td>
                                <td><input type="text" class="form-control" disabled></td>
                                <td>项目负责人</td>
                                <td>
                                    <select class="form-control" style="width:180px;">
                                        <option>1</option>
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>合同乙方</td>
                                <td>
                                    <select class="form-control" style="width:180px;">
                                        <option>1</option>
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5</option>
                                    </select>
                                </td>
                                <td>分包负责人</td>
                                <td><input type="text" class="form-control"></td>
                            </tr>
                            <tr>
                                <td>合同金额(元)</td>
                                <td><input type="text" class="form-control" disabled></td>
                                <td>暂定金(元)</td>
                                <td><input type="text" class="form-control" disabled></td>
                            </tr>
                            <tr>
                                <td>结算金额(元)</td>
                                <td><input type="text" class="form-control"></td>
                                <td>结算说明</td>
                                <td><input type="text" class="form-control"></td>
                            </tr>
                            <tr>
                                <td>累计付款(元)</td>
                                <td><input type="text" class="form-control"></td>
                                <td>履约评级</td>
                                <td><input type="text" class="form-control" disabled></td>
                            </tr>
                            <tr>
                                <td>附件</td>
                                <td colspan="3"><input type="file" class="form-control"></td>
                            </tr>
                            <tr>
                                <td>项目概况、工作内容、实际工期</td>
                                <td colspan="3">
                                    <div class="form-group">
                                        <textarea class="form-control" rows="4" cols="50"></textarea>
                                    </div> 
                                </td>
                            </tr>
                        </table>
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-success">保存</button>
        </div>
        </div>
    </div>
</div>
<!-- 修改model结束 -->

        </div>
        <div class="LowerPart" style="margin-top:3px;">
            <table class="table table-bordered table-condensed" id="mainContent3" style="width:100%;">
                <thead>
                    <tr>
                        <th>分包合同号</th>
                        <th>分包合同名称</th>
                        <th>任务单号</th>
                        <th>承接合同编号</th>
                        <th>承接合同名称</th>
                        <th>合同金额(元)</th>
                        <th style="width:75px;">操作</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>   
            </table>
<!-- allMsg -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="allMsg3">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>所有信息</b></h4>
        </div>
        <div class="modal-body">
            <div>     
                <form class="form-inline">
                    <table class="table table-bordered table-condensed">
                        <tr>
                            <td style="width:15%;">分包合同名称</td>
                            <td id="look_fbContractName"></td>
                            <td style="width:15%;">分包合同号</td>
                            <td id="look_fbContract"></td>
                        </tr>
                        <tr>
                            <td>承接合同名称</td>
                            <td id="look_cjContractName"></td>
                            <td>承接合同编号</td>
                            <td id="look_cjContract"></td>
                        </tr>
                        <tr>
                            <td>任务单号</td>
                            <td id="look_prjCode"></td>
                            <td>项目负责人</td>
                            <td id="look_prjChargePerson"></td>
                        </tr>
                        <tr>
                            <td>合同乙方</td>
                            <td id="look_contractNameYi"></td>
                            <td>分包负责人</td>
                            <td id="look_fbChargePerson"></td>
                        </tr>
                        <tr>
                            <td>合同金额(元)</td>
                            <td id="look_contractMoney"></td>
                            <td>暂定金(元)</td>
                            <td id="look_provisionalMoney"></td>
                        </tr>
                        <tr>
                            <td>结算金额(元)</td>
                            <td id="look_overWorkMoney"></td>
                            <td>结算说明</td>
                            <td id="look_overWorkExplain"></td>
                        </tr>
                        <tr>
                            <td>累计付款(元)</td>
                            <td id="look_allPayMoney"></td>
                            <td>履约评级</td>
                            <td id="look_doAppointScore"></td>
                        </tr>
                        <tr>
                            <td>项目概况、工作内容、实际工期</td>
                            <td colspan="3" id="look_prjProbablyText"></td>
                        </tr>
                    </table>
					 <br/>
					 <table class="table table-bordered table-condensed" id="look_accessory3">
                        <thead>
								<tr>
	                                <td style="width:18%;">合同文本附件:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
	                                <td colspan="3"></td>
                            	</tr>
							</thead>
                        <tbody></tbody>
                    </table>
                    <table class="table table-bordered table-condensed" id="look_accessory4">
                        <thead>
								<tr>
	                                <td style="width:18%;">法律顾问签字:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
	                                <td colspan="3"></td>
                            	</tr>
							</thead>
                        <tbody></tbody>
                    </table>
					<br/>
                </form>  
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        </div>
        </div>
    </div>
</div>
<!-- allMsg结束 -->
        </div>
    </div>
            </div>
        </div>
    </div>
    <!-- Modal选择承接合同 -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="choose_cj">
    <div class="modal-dialog modal-lg" role="document" style="width:60%;">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>选择承接合同</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline">
                        <table class="table table-bordered table-condensed" id="cj_table">
                            <thead>
                            	<tr>
                            		<th></th>
                            		<th>承接合同名称</th>
                                    <th>承接合同编号</th>
                                    <th>甲方单位</th>
                                    <th>合同起日期</th>
                                    <th>合同讫日期</th>
                            	</tr>
                            </thead>
                            <tbody>
                                
                            </tbody>
                        </table> 
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-success" onclick="saveCjName()">保存</button>
        </div>
        </div>
    </div>
</div>
<!-- model项目结束 -->

  <!-- Modal选择承接合同 -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="choose_cj3">
    <div class="modal-dialog modal-lg" role="document" style="width:60%;">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>选择承接合同</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline">
                        <table class="table table-bordered table-condensed" id="cj_table3">
                            <thead>
                            	<tr>
                            		<th></th>
                            		<th>承接合同名称</th>
                                    <th>承接合同编号</th>
                                    <th>甲方单位</th>
                                    <th>合同起日期</th>
                                    <th>合同讫日期</th>
                            	</tr>
                            </thead>
                            <tbody>
                                
                            </tbody>
                        </table> 
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-success" onclick="saveCjName3()">保存</button>
        </div>
        </div>
    </div>
</div>
<!-- model项目结束 -->
 
         <!-- 提交 modal -->
<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="tijiaogei">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="gridSystemModalLabel">提交给</h4>
            </div>
            <div class="modal-body">
                <table class="table table-bordered table-condensed" id="tijiaoren">
                        	<thead>
                        			<tr>
		                            	<th></th>
		                                <th>部门</th>
		                                <th>职务</th>
		                                <th>审批人</th>
		                            </tr>
                        	</thead>
                            <tbody>
                            	
                            </tbody>
                        </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-success" data-dismiss="modal" onclick="submitPerson()">提交</button>
            </div>
        </div>
    </div>
</div>
<!-- 提交 modal结束 -->
</body>
<script src="../../js/jquery.js"></script>
<script src="../../js/common-scripts.js"></script>
<script src="../../js/bootstrap.min.js"></script>
<script src="../../js/laydate/laydate.js"></script>
<script src="../../js/jquery-editable-select.js"></script>
<script src="../../toastr/toastr.js"></script>
<script src="../../js/jquery-form.min.js"></script>
<script src="../../js/quanxian.js"></script>

<script src="../../js/datatables/jquery.dataTables.min.js"></script>
<script src="../../js/datatables/dataTables.colVis.min.js"></script>
<script src="../../js/datatables/dataTables.tableTools.min.js"></script>
<!-- <script src="../../js/datatables/dataTables.bootstrap.min.js"></script> -->
<script src="../../js/datatables/datatables.responsive.min.js"></script>
<script src="../../js/datatables/dataTables.buttons.min.js" ></script>
<script src="../../js/datatables/buttons.html5.min.js" ></script>
<script src="../../js/datatables/buttons.flash.min.js" ></script>
<script src="../../js/datatables/jszip.min.js"></script>
<script>
    $(document).ready( function () {
    	laydate.render({
            elem: '#year' //指定元素
        });
    	initSelect();
    	initFb3();
    	/* initUser(); */
    	initTable();
    	$("#state").trigger("change");
    	initDepartment();
    	initPrj();
    	initFb();
    	initCj();
    	initbumen();
    });
    
    $.fn.dataTable.Buttons.swfPath = '../../js/datatables/swf/flashExport.swf';
    var table=$('#mainContent').DataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 10,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
					{ "data": "thisYear"},
					{ "data": "taskListCode"}, 
		            { "data": "cjContractCode"}, 
		            { "data": null}, 
		            { "data": "fbContractCode"}, 
		            { "data": null}, 
		            { "data": "fbDepartment"}, 
		            { "data": "actualChargePerson"}, 
		            { "data": "allScore"}, 
		            { "data": null},
		        ],
		        "columnDefs": [
								{	
								  "class": "tcenter",
								   "targets":3,
								   "searchable": true,
								   "render": function(data, type, full) {
										return '<a onclick="gotoCj(this)" style="color:	#4876FF;cursor: pointer;">'+data.cjContractName+'</a>'
								   }
								},
								{	
									  "class": "tcenter",
									  "targets":5,
									  "searchable": true,
									  "render": function(data, type, full) {
											return '<a onclick="gotoFb(this)" style="color:	#4876FF;cursor: pointer;">'+data.fbContractName+'</a>'
									  }
								},
								{	
										 "class": "tcenter",
										    "targets": 9,
										    "searchable": true,
										    "render": function(data, type, full) {
										    	return '<i class="iconfont icon-icon-test Pecgcb" style="font-size:18px;cursor:pointer;display:none;" onclick="look1(this)" title="查看"></i>';
										        }
										  }
								],
								"fnDrawCallback" : function() {
									$.ajax({
				                		type:"post",
				                		url:getContextPath()+"/login/getUser",
				                		async:false,
				                		data:{
				                		},
				                		success:function(json){
				                			
				                			if(json!=null &&json!=""){
				                				var arr = json.uPermissions.split(',');
				                				
				                				for(var i=0;i<arr.length;i++){
				                					var arr2 = arr[i].replace("+","");
				                					//console.log(arr2);
				                					if(arr[i].indexOf("Pecgcb") >= 0 ){
				                						$(".Pecgcb").show();
				                					}
				                				}
				                				
				                			}
				                			
				                		}
				                	});
									
								},
        "order": [[0, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
        "buttons": [
		        	{
		                extend: "csv",
		                text: "导出csv",
		                bom: true,
		                filename: '履约评价',
		                fieldSeparator: ',',
		                exportOptions: {
		                	format: {
		                        header: function ( data) {
		                            return data;
		                        },
		                        body: function ( data, columnIdx, rowIdx, code ) {
					                if(rowIdx==3){
					                	data=$(code).find("a").eq(0).text();
					                }
					                if(rowIdx==5){
					                	data=$(code).find("a").eq(0).text();
					                }
		                        	return data;
					            }
		                    },
		                    columns:[0,1,2,3,4,5,6,7,8]
		                }
		            }
		        ]
	});
    table.buttons().container().appendTo( $('#tabBtn') );
    
    var table1=$('#fb_table').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 5,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
            { "data": null}, 
            { "data": "contractName"},
            { "data": "fbNo"}, 
            { "data": "ccName"}, 
            { "data": "contractStartTime"},
            { "data": "contractEndTime"}
        ],
        "columnDefs": [
						{
								 "class": "tcenter",
								    "targets": 0,
								    "searchable": true,
								    "render": function(data, type, full) {
								  	  		return '<input type="radio" name="fbName" style="width:16px;height:16px;">'
								        }
								  }
						],
        "order": [[0, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
        
	});
    var table2=$('#mainContent2').DataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 10,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
		            { "data": "fbContract"}, 
		            { "data": null}, 
		            { "data": "cjContract"}, 
		            { "data": null}, 
		            { "data": "prjCode"}, 
		            { "data": "fbMoney"}, 
		            { "data": "fbEndMoney"}, 
		            { "data": "settlementTime"}, 
		            { "data": null},
		        ],
		        "columnDefs": [
								{	
								  "class": "tcenter",
								   "targets":1,
								   "searchable": true,
								   "render": function(data, type, full) {
										return '<a onclick="gotoFb2(this)" style="color:#4876FF;cursor: pointer;">'+data.fbName+'</a>'
								   }
								},
								{	
									  "class": "tcenter",
									  "targets":3,
									  "searchable": true,
									  "render": function(data, type, full) {
											return '<a onclick="gotoCj2(this)" style="color:	#4876FF;cursor: pointer;">'+data.cjName+'</a>'
									  }
								},
								{	
										 "class": "tcenter",
										    "targets": 8,
										    "searchable": true,
										    "render": function(data, type, full) {
										    	return '<i class="iconfont icon-icon-test Pecgcd" style="font-size:18px;cursor:pointer;display:none;" onclick="look2(this)" title="查看"></i>';
										        }
										  }
								],
								"fnDrawCallback" : function() {
									$.ajax({
				                		type:"post",
				                		url:getContextPath()+"/login/getUser",
				                		async:false,
				                		data:{
				                		},
				                		success:function(json){
				                			
				                			if(json!=null &&json!=""){
				                				var arr = json.uPermissions.split(',');
				                				
				                				for(var i=0;i<arr.length;i++){
				                					var arr2 = arr[i].replace("+","");
				                					//console.log(arr2);
				                					if(arr[i].indexOf("Pecgcd") >= 0 ){
				                						$(".Pecgcd").show();
				                					}
				                				}
				                				
				                			}
				                			
				                		}
				                	});
									
								},
        "order": [[0, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
        "buttons": [
		        	{
		                extend: "csv",
		                text: "导出csv",
		                bom: true,
		                filename: '分包结算',
		                fieldSeparator: ',',
		                exportOptions: {
		                	format: {
		                        header: function ( data) {
		                            return data;
		                        },
		                        body: function ( data, columnIdx, rowIdx, code ) {
					                if(rowIdx==1){
					                	data=$(code).find("a").eq(0).text();
					                }
					                if(rowIdx==3){
					                	data=$(code).find("a").eq(0).text();
					                }
		                        	return data;
					            }
		                    },
		                    columns:[0,1,2,3,4,5,6,7]
		                }
		            }
		        ]
	});
    table2.buttons().container().appendTo( $('#tabBtn2') );
    
    var table22=$('#xiangmubiao').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 5,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
					{ "data": null},
		            { "data": "prjNo"},
		            { "data": "prjName"},
		            { "data": "prjCompany"},
		            { "data": "prjType2"},
		            { "data": "ccName"},
		            
		        ],
		        "columnDefs": [
								{
										 "class": "tcenter",
										    "targets": 0,
										    "searchable": true,
										    "render": function(data, type, full) {
										  	  		return '<input type="radio" name="xiangmuName" style="width:16px;height:16px;">'
										        }
										  }
								],
        "order": [[1, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
        
	});
    var table222=$('#cj_table2').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 5,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
            { "data": null}, 
            { "data": "contractName"},
            { "data": "contractNo"}, 
            { "data": "ccName"}, 
            { "data": "contractStartTime"},
            { "data": "contractEndTime"}
        ],
        "columnDefs": [
						{
								 "class": "tcenter",
								    "targets": 0,
								    "searchable": true,
								    "render": function(data, type, full) {
								  	  		return '<input type="radio" name="cjName2" style="width:16px;height:16px;">'
								        }
								  }
						],
        "order": [[0, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
        
	});
    var table2222=$('#fb_table2').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 5,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
            { "data": null}, 
            { "data": "contractName"},
            { "data": "fbNo"}, 
            { "data": "ccName"}, 
            { "data": "contractStartTime"},
            { "data": "contractEndTime"}
        ],
        "columnDefs": [
						{
								 "class": "tcenter",
								    "targets": 0,
								    "searchable": true,
								    "render": function(data, type, full) {
								  	  		return '<input type="radio" name="fbName2" style="width:16px;height:16px;">'
								        }
								  }
						],
        "order": [[0, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
        
	});
    var table3=$('#mainContent3').DataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 10,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
		            { "data": "fbContract"}, 
		            { "data": null}, 
		            { "data": "prjCode"}, 
		            { "data": "cjContract"}, 
		            { "data": null}, 
		            { "data": "contractMoney"}, 
		            { "data": null},
		        ],
		        "columnDefs": [
								{	
									  "class": "tcenter",
									  "targets":1,
									  "searchable": true,
									  "render": function(data, type, full) {
											return '<a onclick="gotoFb3(this)" style="color:	#4876FF;cursor: pointer;">'+data.fbContractName+'</a>'
									  }
								},
								{	
								  "class": "tcenter",
								   "targets":4,
								   "searchable": true,
								   "render": function(data, type, full) {
										return '<a onclick="gotoCj3(this)" style="color:#4876FF;cursor: pointer;">'+data.cjContractName+'</a>'
								   }
								},
								{	
										 "class": "tcenter",
										    "targets": 6,
										    "searchable": true,
										    "render": function(data, type, full) {
										    	return '<i class="iconfont icon-icon-test Pecgcg" style="font-size:18px;cursor:pointer;display:none;" onclick="look3(this)" title="查看"></i>';
										        }
										  }
								],
								"fnDrawCallback" : function() {
									$.ajax({
				                		type:"post",
				                		url:getContextPath()+"/login/getUser",
				                		async:false,
				                		data:{
				                		},
				                		success:function(json){
				                			
				                			if(json!=null &&json!=""){
				                				var arr = json.uPermissions.split(',');
				                				
				                				for(var i=0;i<arr.length;i++){
				                					var arr2 = arr[i].replace("+","");
				                					//console.log(arr2);
				                					if(arr[i].indexOf("Pecgcg") >= 0 ){
				                						$(".Pecgcg").show();
				                					}
				                				}
				                				
				                			}
				                			
				                		}
				                	});
									
								},
        "order": [[0, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
        "buttons": [
		        	{
		                extend: "csv",
		                text: "导出csv",
		                bom: true,
		                filename: '分包合同履约',
		                fieldSeparator: ',',
		                exportOptions: {
		                	format: {
		                        header: function ( data) {
		                            return data;
		                        },
		                        body: function ( data, columnIdx, rowIdx, code ) {
		                        	if(rowIdx==1){
		                        		data=$(code).find("a").eq(0).text();
		                        	}
		                        	if(rowIdx==4){
		                        		data=$(code).find("a").eq(0).text();
		                        	}
					                return data;
					            }
		                    },
		                    columns:[0,1,2,3,4,5]
		                }
		            }
		        ]
	});
    table3.buttons().container().appendTo( $('#tabBtn3') );
    $('.buttons-csv').addClass('btn btn-primary');
    
    var table4=$('#cj_table').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 5,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
            { "data": null}, 
            { "data": "contractName"},
            { "data": "contractNo"}, 
            { "data": "ccName"}, 
            { "data": "contractStartTime"},
            { "data": "contractEndTime"}
        ],
        "columnDefs": [
						{
								 "class": "tcenter",
								    "targets": 0,
								    "searchable": true,
								    "render": function(data, type, full) {
								  	  		return '<input type="radio" name="cjName" style="width:16px;height:16px;">'
								        }
								  }
						],
        "order": [[0, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
        
	});
    var table44=$('#fb_table3').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 5,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
            { "data": null}, 
            { "data": "contractName"},
            { "data": "fbNo"}, 
            { "data": "ccName"}, 
            { "data": "contractStartTime"},
            { "data": "contractEndTime"}
        ],
        "columnDefs": [
						{
								 "class": "tcenter",
								    "targets": 0,
								    "searchable": true,
								    "render": function(data, type, full) {
								  	  		return '<input type="radio" name="fbName3" style="width:16px;height:16px;">'
								        }
								  }
						],
        "order": [[0, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
        
	});
    
    var table444=$('#cj_table3').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 5,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
            { "data": null}, 
            { "data": "contractName"},
            { "data": "contractNo"}, 
            { "data": "ccName"}, 
            { "data": "contractStartTime"},
            { "data": "contractEndTime"}
        ],
        "columnDefs": [
						{
								 "class": "tcenter",
								    "targets": 0,
								    "searchable": true,
								    "render": function(data, type, full) {
								  	  		return '<input type="radio" name="cjName3" style="width:16px;height:16px;">'
								        }
								  }
						],
        "order": [[0, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
        
	});
    //选部门选人1
    var bmtableren=$('#bmmingzibiao').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 6,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
					{ "data": null}, 
		            { "data": "uName"}, 
		            { "data": "workId"},
		            { "data": "birthday"}, 
		            { "data": "sex"}, 
		            { "data": "dutyName"}, 
		        ],
		        "columnDefs": [
								{	
										 "class": "tcenter",
										    "targets": 0,
										    "searchable": true,
										    "render": function(data, type, full) {
										  	  		return '<input type="radio" name="mingzi" style="width:16px;height:16px;">'
										        }
										  }
								],
        "order": [[2, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
        
	});

    //选部门选人2
    var bmtableren=$('#bmmingzibiao2').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 6,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
					{ "data": null}, 
		            { "data": "uName"}, 
		            { "data": "workId"},
		            { "data": "birthday"}, 
		            { "data": "sex"}, 
		            { "data": "dutyName"}, 
		        ],
		        "columnDefs": [
								{	
										 "class": "tcenter",
										    "targets": 0,
										    "searchable": true,
										    "render": function(data, type, full) {
										  	  		return '<input type="radio" name="mingzi2" style="width:16px;height:16px;">'
										        }
										  }
								],
        "order": [[2, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
        
	});

    //选部门选人3
    var bmtableren=$('#bmmingzibiao3').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 6,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
					{ "data": null}, 
		            { "data": "uName"}, 
		            { "data": "workId"},
		            { "data": "birthday"}, 
		            { "data": "sex"}, 
		            { "data": "dutyName"}, 
		        ],
		        "columnDefs": [
								{	
										 "class": "tcenter",
										    "targets": 0,
										    "searchable": true,
										    "render": function(data, type, full) {
										  	  		return '<input type="radio" name="mingzi3" style="width:16px;height:16px;">'
										        }
										  }
								],
        "order": [[2, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
        
	});

    $("#state").on("change",function(){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/fbScore/selectFbContractDoAppointScore',
            dataType: 'json',
            data: {
            	state:$("#state").val(),
            	depart:$("#bumenshaixuan").val(),
            	thisYear:$("#this_year").val()
            },
            success: function (json) {
                $('#mainContent').dataTable().fnClearTable();
                $('#mainContent').DataTable().rows.add(json).draw(false);
            }
        });
    })
	function initTable(){
        $.ajax({
            type: 'POST',
            url: getContextPath()+'/fbScore/selectFbContractDoAppointScore',
            dataType: 'json',
            data: {
            	state:$("#state").val()
            },
            success: function (json) {
            	console.log(json)
            	$("#bumenshaixuan").html("");
            	$("#this_year").html("");
            	$("#bumenshaixuan").append("<option value='%%'>全部</option>");
            	$("#this_year").append("<option value='%%'>全部</option>");
            	var arr=[];
                for(var i=0;i<json.length;i++){
                 	$("#bumenshaixuan").append("<option value="+json[i].fbDepartment+">"+json[i].fbDepartment+"</option>");
                 	if($.inArray(json[i].thisYear, arr)==-1){
                 		arr.push(json[i].thisYear)
                 	}
                 }
                for(var j=0;j<arr.length;j++){
                 	$("#this_year").append("<option value="+arr[j]+">"+arr[j]+"</option>");
                	
                }
                 $("#bumenshaixuan").trigger("change");
                 $("#this_year").trigger("change");
            }	
        });
    }
    
    $("#bumenshaixuan").change(function(){
    	$("#state").trigger("change");
    }) ;
    $("#this_year").change(function(){
    	$("#state").trigger("change");
    }) ;
    
   function initTable2(){
   	 $("#state2").trigger("change");
   }
    
   function initTable3(){
   	 $("#state3").trigger("change");
   }
	
    $("#state2").on("change",function(){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/fbOver/selectFbContractOver',
            dataType: 'json',
            data: {
            	state:$("#state2").val()
            },
            success: function (json) {
                $('#mainContent2').dataTable().fnClearTable();
                $('#mainContent2').DataTable().rows.add(json).draw(false);
            }
        });
    })
    
    
	/* function initTable2(){
        $.ajax({
            type: 'POST',
            url: getContextPath()+'/fbOver/selectFbContractOver',
            dataType: 'json',
            data: {
            },
            success: function (json) {
                $('#mainContent2').dataTable().fnClearTable();
                $('#mainContent2').DataTable().rows.add(json).draw(false);
            }
        });
    } */
	
    $("#state3").on("change",function(){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/fbOverWj/selectFbContractOverWj',
            dataType: 'json',
            data: {
            	state:$("#state3").val()
            },
            success: function (json) {
                $('#mainContent3').dataTable().fnClearTable();
                $('#mainContent3').DataTable().rows.add(json).draw(false);
            }
        });
    })
	/* function initTable3(){
        $.ajax({
            type: 'POST',
            url: getContextPath()+'/fbOverWj/selectFbContractOverWj',
            dataType: 'json',
            data: {
            },
            success: function (json) {
                $('#mainContent3').dataTable().fnClearTable();
                $('#mainContent3').DataTable().rows.add(json).draw(false);
            }
        });
    } */

    function getCreat(bb){
        var EnterpriseRating= $(bb).parent().prev().text();
        var Remarks= $(bb).parent().prev().prev().text();
        var ContactPhone1= $(bb).parent().prev().prev().prev().text();
        var Contacts= $(bb).parent().prev().prev().prev().prev().text();
        var address= $(bb).parent().prev().prev().prev().prev().prev().text();
        var ProprietorUnit= $(bb).parent().prev().prev().prev().prev().prev().prev().text();
        var Code= $(bb).parent().prev().prev().prev().prev().prev().prev().prev().text();
        $("#CEnterprise-rating").val(EnterpriseRating);
        $("#CRemarks").val(Remarks);
        $("#CContact-phone1").val(ContactPhone1);
        $("#CContacts").val(Contacts);
        $("#Caddress").val(address);
        $("#CProprietor-unit").val(ProprietorUnit);
        $("#CCode").val(Code);
        rowIndex = bb.parentNode.parentNode.rowIndex; 
    }

    $(".quxiao").click(function(){
        if(confirm("确定要撤销吗？")){
            return true;
        }
        else{
            return false;
        }
    })
    
    //初始化承接合同名称和承接合同号
	 function initSelect(){
			$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/cj/selectNameAndNo',
	        dataType: 'json',
	        data: {
	        },
	        error: function (msg) {
	        	toastr.error("请求失败");
	        },
	        success: function (json) {
	        	$("#new_cj_name").html('');
	        	$("#new_cj_no").html('');
	        	/* $("#cjContractName").html('');
	        	$("#cjContract").html(''); */
	        	for(var i=0;i<json.length;i++){
	        		$("#new_cj_name").append("<option value="+json[i].contractName+">"+json[i].contractName+"</option>");
	        		$("#new_cj_no").append("<option value="+json[i].contractNo+">"+json[i].contractNo+"</option>");
	        		/* $("#cjContractName").append("<option value="+json[i].contractName+">"+json[i].contractName+"</option>");
	        		$("#cjContract").append("<option value="+json[i].contractNo+">"+json[i].contractNo+"</option>"); */
	        	}
	        	$('#new_cj_name').editableSelect().on('select.editable-select', function (e, dom) {
	        		$.ajax({
	                    type: 'POST',
	                    url: getContextPath()+'/cj/selectCjContractByName',
	                    dataType: 'json',
	                    data: {
	                    	name:$('#new_cj_name').val()
	                    },
	                    success: function (json) {
	                    	$('#new_cj_no').val(json.contractNo);
	                    	$('#new_prj_no').val(json.taskCode);
	                    }
	          		});
	          	})
	          	$('#new_cj_no').editableSelect().on('select.editable-select', function (e, dom) {
	          		$.ajax({
	                    type: 'POST',
	                    url: getContextPath()+'/cj/selectCjContractByNo',
	                    dataType: 'json',
	                    data: {
	                    	no:$('#new_cj_no').val()
	                    },
	                    success: function (json) {
	                    	$('#new_cj_name').val(json.contractName);
	                    	$('#new_prj_no').val(json.taskCode);
	                    }
	          		});
			  	})
			  	
			  	/* $('#cjContractName').editableSelect().on('select.editable-select', function (e, dom) {
	        		$.ajax({
	                    type: 'POST',
	                    url: getContextPath()+'/cj/selectCjContractByName',
	                    dataType: 'json',
	                    data: {
	                    	name:$('#cjContractName').val()
	                    },
	                    success: function (json) {
	                    	$('#cjContract').val(json.contractNo);
	                    	$('#prjCode').val(json.taskCode);
	                    }
	          		});
	          	})
	          	$('#cjContract').editableSelect().on('select.editable-select', function (e, dom) {
	          		$.ajax({
	                    type: 'POST',
	                    url: getContextPath()+'/cj/selectCjContractByNo',
	                    dataType: 'json',
	                    data: {
	                    	no:$('#cjContract').val()
	                    },
	                    success: function (json) {
	                    	$('#cjContractName').val(json.contractName);
	                    	$('#prjCode').val(json.taskCode);
	                    }
	          		});
			  	}) */
			  	
	        }
			});
		}
    
    
    function initFb3(){
    	$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/subcontract/getFBNameAndNo',
	        dataType: 'json',
	        data: {
	        },
	        error: function (msg) {
	        	toastr.error("请求失败");
	        },
	        success: function (json) {
	        	console.log(json)
	        	$("#new_fb_name").html('');
	        	$("#new_fb_no").html('');
	        	$("#fbContractName").html('');
	        	$("#fbContract").html('');
	        	$("#fbContract2").html('');
	        	for(var i=0;i<json.length;i++){
	        		$("#new_fb_name").append("<option value="+json[i].contarctName+">"+json[i].contractName+"</option>");
	        		$("#new_fb_no").append("<option value="+json[i].fbNo+">"+json[i].fbNo+"</option>");
	        		/* $("#fbContractName").append("<option value="+json[i].contarctName+">"+json[i].contractName+"</option>"); */
	        		$("#fbContract").append("<option value="+json[i].fbNo+">"+json[i].fbNo+"</option>");
	        		$("#fbContract2").append("<option value="+json[i].fbNo+">"+json[i].fbNo+"</option>");
	        	}
	        	
	        	/* $('#new_fb_name').editableSelect().on('select.editable-select', function (e, dom) {
	        		$.ajax({
	                    type: 'POST',
	                    url: getContextPath()+'/subcontract/getFBNoByName',
	                    dataType: 'json',
	                    data: {
	                    	contractName:$('#new_fb_name').val()
	                    },
	                    success: function (json) {
	                    	$('#new_fb_no').val(json.fbNo);
	                    	$('#new_fb_department').val(json.ccName);
	                    }
	          		});
	          	}) */
	          	$('#new_fb_no').editableSelect().on('select.editable-select', function (e, dom) {
	          		$.ajax({
	                    type: 'POST',
	                    url: getContextPath()+'/subcontract/getFBNameByNo',
	                    dataType: 'json',
	                    data: {
	                    	fbNo:$('#new_fb_no').val()
	                    },
	                    success: function (json) {
	                    	$('#new_fb_name').val(json.contractName);
	                    	$('#new_fb_department').val(json.ccName);
	                    }
	          		});
			  	})
			  	
			  	/* $('#fbContractName').editableSelect().on('select.editable-select', function (e, dom) {
	        		$.ajax({
	                    type: 'POST',
	                    url: getContextPath()+'/subcontract/getFBNoByName',
	                    dataType: 'json',
	                    data: {
	                    	contractName:$('#fbContractName').val()
	                    },
	                    success: function (json) {
	                    	$('#fbContract').val(json.fbNo);
	                    }
	          		});
	          	}) */
	          	$('#fbContract').editableSelect().on('select.editable-select', function (e, dom) {
	          		$.ajax({
	                    type: 'POST',
	                    url: getContextPath()+'/subcontract/getFBNameByNo',
	                    dataType: 'json',
	                    data: {
	                    	fbNo:$('#fbContract').val()
	                    },
	                    success: function (json) {
	                    	getAllPayMoney($('#fbContract').val());
	                    	$('#fbContractName').val(json.contractName);
	                    	$("#contractMoney").val(json.contractMoney);
	                    	$("#provisionalMoney").val(json.temporaryMoney);
	                    	$("#cjContractName").val(json.cjContractName);
	                    	$("#cjContract").val(json.cjContractCode);
	                    	$("#prjCode").val(json.workNo);
	                    	selectAllPrjLeader(json.workNo);
	                    }
	          		});
			  	})
	        	$('#fbContract2').editableSelect().on('select.editable-select', function (e, dom) {
	          		$.ajax({
	                    type: 'POST',
	                    url: getContextPath()+'/subcontract/getFBNameByNo',
	                    dataType: 'json',
	                    data: {
	                    	fbNo:$('#fbContract2').val()
	                    },
	                    success: function (json) {
	                    	$('#fbContractName2').val(json.contractName);
	                    	$("#cjContractName2").val(json.cjContractName);
	                    	$("#cjContract2").val(json.cjContractCode);
	                    	$("#prjCode2").val(json.workNo);
	                    	$("#fb_money2").val(json.contractMoney);
	                    }
	          		});
			  	})
			  	
	        }
    	});
    }
    
    function selectAllPrjLeader(obj){
		 $.ajax({
	           type: 'POST',
	         	url: getContextPath()+'/task/selectPrjLeaderByPrjNo',
	           dataType: 'json',
	           data: {
	        	   nos:obj
	           },
	           success: function (json) {
	              var leader=json.leader;
	              $("#prjChargePerson").val(leader);
	           }
	       });
	}
    
    /* function initUser(){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/user/selectAllUser',
            dataType: 'json',
            data: {
            },
            success: function (json) {
            	for(var i=0;i<json.length;i++){
	            	 $("#leader").append("<option value="+json[i].uName+">"+json[i].uName+"</option>")
	            	$("#prjChargePerson").append("<option value="+json[i].uName+">"+json[i].uName+"</option>")
	            	$("#fbChargePerson").append("<option value="+json[i].uName+">"+json[i].uName+"</option>")
            	}
            }
    	});
    } */
    
  //初始化提交部门
	function initDepartment(){
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/cooperator/selectCooperatorIdAndName',
            dataType: 'json',
            data: {

            },
            error: function (msg) {
            	toastr.error("请求失败");
            },
            success: function (json) {
            	$("#contractNameYi").html("");
                for(var i=0;i<json.length;i++){
                	$("#contractNameYi").append("<option value="+json[i].ccId+">"+json[i].ccName+"</option>");
                }
                $("#contractNameYi").trigger("change");
            }
		});
	}
  
    $("#contractNameYi").on("change",function(){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/cooperator/selectOneCooperator',
            dataType: 'json',
            data: {
				id:$("#contractNameYi").val()
            },
            success: function (json) {
            	$("#fbChargePerson").val(json.legalPersonName);
            }
		});
    })
    
	//初始化实际负责人部门
	function initbumen(){
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/organizationManagement/getOrgIdAndName',
            dataType: 'json',
            data: {
            },
            success: function (json) {
            	for(var i=0;i<json.length;i++){
	            	$("#bumen").append("<option value='"+json[i].omId+"'>" + json[i].omName+ "</option>");
	            	$("#bumen2").append("<option value='"+json[i].omId+"'>" + json[i].omName+ "</option>");
	            	$("#bumen3").append("<option value='"+json[i].omId+"'>" + json[i].omName+ "</option>");
            	}
            	$("#bumen").trigger('change');
            	$("#bumen2").trigger('change');
            	$("#bumen3").trigger('change');
            }
        });
	}
	
	$("#bumen").change(function(){
		var bumen=$("#bumen").val();
		$('#addGuanliren').on('hidden.bs.modal', function () {//解决模态框页面滚动问题
            if ($('.modal.in').size() >= 1) {
                $('body').addClass('modal-open')
            }
        })
		$.ajax({
			type:"POST",
			url:getContextPath()+"/user/selectUserByomId",
			dataTyepe:"json",
			async:false,
			data:{ 
				omId:bumen 
				},
			success:function(json){
				$('#bmmingzibiao').dataTable().fnClearTable();
                $('#bmmingzibiao').DataTable().rows.add(json).draw(false);
			}
		})
	})
	//保存添加保管人
	function saveGuanliren(){
		var tr=$("input[name='mingzi']:checked").parents("tr");
		var data=$("#bmmingzibiao").DataTable().row(tr).data();
		//console.log(data)
		$("#leader").val(data.uName);
	}
	
	$("#bumen2").change(function(){
		var bumen=$("#bumen2").val();
		$('#addGuanliren2').on('hidden.bs.modal', function () {//解决模态框页面滚动问题
            if ($('.modal.in').size() >= 1) {
                $('body').addClass('modal-open')
            }
        })
		$.ajax({
			type:"POST",
			url:getContextPath()+"/user/selectUserByomId",
			dataTyepe:"json",
			async:false,
			data:{ 
				omId:bumen 
				},
			success:function(json){
				$('#bmmingzibiao2').dataTable().fnClearTable();
                $('#bmmingzibiao2').DataTable().rows.add(json).draw(false);
			}
		})
	})
	//保存添加保管人
	function savePrj(){
		var tr=$("input[name='mingzi2']:checked").parents("tr");
		var data=$("#bmmingzibiao2").DataTable().row(tr).data();
		//console.log(data)
		$("#prjChargePerson").val(data.uName);
	}
	
	$("#bumen3").change(function(){
		var bumen=$("#bumen3").val();
		$('#addGuanliren3').on('hidden.bs.modal', function () {//解决模态框页面滚动问题
            if ($('.modal.in').size() >= 1) {
                $('body').addClass('modal-open')
            }
        })
		$.ajax({
			type:"POST",
			url:getContextPath()+"/user/selectUserByomId",
			dataTyepe:"json",
			async:false,
			data:{ 
				omId:bumen 
				},
			success:function(json){
				$('#bmmingzibiao3').dataTable().fnClearTable();
                $('#bmmingzibiao3').DataTable().rows.add(json).draw(false);
			}
		})
	})
	//保存添加保管人
	function saveFb(){
		var tr=$("input[name='mingzi3']:checked").parents("tr");
		var data=$("#bmmingzibiao3").DataTable().row(tr).data();
		//console.log(data)
		$("#fbChargePerson").val(data.uName);
	}
	
	
  
    
    function save(){
    	var cj_name=$("#new_cj_name").val();
    	var cj_no=$("#new_cj_no").val();
    	var prj_no=$("#new_prj_no").val();
    	var fb_name=$("#new_fb_name").val();
    	var fb_no=$("#new_fb_no").val();
    	var fb_department=$("#new_fb_department").val();
    	var leader=$("#leader").val();
    	var score=$("input[name='pj']:checked").val();
    	var score2=$("input[name='pj2']:checked").val();
    	var score3=$("input[name='pj3']:checked").val();
    	var score4=$("input[name='pj4']:checked").val();
    	var score5=$("input[name='pj5']:checked").val();
    	/* var score6=$("input[name='pj6']:checked").val(); */
    	var all_score=$("input[name='pj7']:checked").val();
    	
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/fbScore/addFbContractDoAppointScoreBySave',
            dataType: 'json',
            data: {
            	taskListCode:prj_no,
            	cjContractCode:cj_no,
            	cjContractName:cj_name,
            	fbContractCode:fb_no,
            	fbContractName:fb_name,
            	fbDepartment:fb_department,
            	actualChargePerson:leader,
            	scoreMaterialSituation:score,
            	scoreManageAbility:score2,
            	scoreQualityControl:score3,
            	scoreCompanyReputation:score4,
            	scoreJinduControl:score5,
            	/* safetyCivilizationEnvironment:score6, */
            	allScore:all_score
            },
            success: function (json) {
            	if(json>0){
            		$("#myModal").modal("hide");
            		toastr.success("保存成功")
            	}else{
            		toastr.error("保存失败")
            	}
            }
    	});
    }
    
    function submit(){
    	var cj_name=$("#new_cj_name").val();
    	var cj_no=$("#new_cj_no").val();
    	var prj_no=$("#new_prj_no").val();
    	var fb_name=$("#new_fb_name").val();
    	var fb_no=$("#new_fb_no").val();
    	var fb_department=$("#new_fb_department").val();
    	var leader=$("#leader").val();
    	var score=$("#pj").val();
    	var score2=$("#pj2").val();
    	var score3=$("#pj3").val();
    	var score4=$("#pj4").val();
    	var score5=$("#pj5").val();
    	/* var score6=$("input[name='pj6']:checked").val(); */
    	var all_score=$("#pj7").val();
    	if(cj_name==''){
    		toastr.error("承接合同为空");
    		return;
    	}
    	if(fb_name==''){
    		toastr.error("分包合同为空");
    		return;
    	}
    	if(leader==''){
    		toastr.error("实际负责人为空");
    		return;
    	}
    	if(all_score==''){
    		toastr.error("综合评价为空");
    		return;
    	}
    	var myDate = new Date();
    	//获取当前年
    	var thisYear=myDate.getFullYear();
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/fbScore/addFbContractDoAppointScoreBySubmit',
            dataType: 'json',
            data: {
            	taskListCode:prj_no,
            	cjContractCode:cj_no,
            	cjContractName:cj_name,
            	fbContractCode:fb_no,
            	fbContractName:fb_name,
            	fbDepartment:fb_department,
            	actualChargePerson:leader,
            	scoreMaterialSituation:score,
            	scoreManageAbility:score2,
            	scoreQualityControl:score3,
            	scoreCompanyReputation:score4,
            	scoreJinduControl:score5,
            	/* safetyCivilizationEnvironment:score6, */
            	allScore:all_score,
            	thisYear:thisYear
            },
            success: function (json) {
            	if(json=='0'){
	        		toastr.error("保存失败");
	        	}else{
	        		$("#myModal").modal("hide");
	        		lianjie=json.url;
	            	if(json.receiver!=null&&json.receiver.length>=1){
		        		  $("#tijiaogei").modal('show');
		        		  $("#tijiaoren tbody").empty("");
		        		  for(var i=0;i<json.receiver.length;i++){
		        			  $("#tijiaoren tbody").append('<tr><td>'
		        					  +'<input type="radio" name="tijiaorenming" data-id="'+json.receiver[i].userId+'" data-id2="'+json.receiver[i].omId+'" data-id3="'+json.receiver[i].dutyId+'">'
		        					  +'</td><td>'
		        					  +json.receiver[i].omName
		        					  +'</td><td>'
		        					  +json.receiver[i].dutyName
		        					  +'</td><td>'
		        					  +json.receiver[i].uName
		        					  +'</td></tr>');
		        		  }
		        	  }else if(json.receiver.length==1){
		        		  $.ajax({
		        	          type: 'POST',
		        	          url: getContextPath()+'/task/addTask4',
		        	          dataType: 'json',
		        	          data:{
		        	        	  url:json.url,
		        	        	  userId:json.receiver.userId,
		        	        	  uName:json.receiver.uName,
		        	        	  omName:json.receiver.omName,
		        	        	  dutyName:json.receiver.dutyName,
		        	        	  omId:json.receiver.omId,
		        	        	  dutyId:json.receiver.dutyId
		        	          },
		        	          success: function (json) {
		        	        	  toastr.success('提交成功');
		        	          }
		        	      }); 
		        	  }
	        	}
            	
            	/* if(json>0){
            		$("#myModal").modal("hide");
            		toastr.success("提交成功")
            	}else{
            		toastr.error("提交失败")
            	} */
            }
    	});
    }
    
    
    function submitPerson(){
  		var uid=$("input[name='tijiaorenming']:checked").attr("data-id");
  	  var omid=$("input[name='tijiaorenming']:checked").attr("data-id2");
  	  var dutyid=$("input[name='tijiaorenming']:checked").attr("data-id3");
  	  var bmmc=$("input[name='tijiaorenming']:checked").parent().next().text();
  	  var zw=$("input[name='tijiaorenming']:checked").parent().next().next().text();
  	  var uname=$("input[name='tijiaorenming']:checked").parent().next().next().next().text();
  	  //var uname=$("input[name='tijiaorenming']:checked").val();
  	  $.ajax({
            type: 'POST',
            url: getContextPath()+'/task/addTask4',
            dataType: 'json',
            data:{
          	  url:lianjie,
          	  userId:uid,
          	  uName:uname,
          	  omName:bmmc,
          	  dutyName:zw,
          	  omId:omid,
          	  dutyId:dutyid
            },
            success: function (json) {
          	  toastr.success('提交成功');
            }
        });  
  	}
    
    
    function look1(obj){
    	var tr=$(obj).parents("tr");
    	var data=$("#mainContent").DataTable().row(tr).data();
    	
    	$("#look_cj_name").text(data.cjContractName);
    	$("#look_cj_no").text(data.cjContractCode);
    	$("#look_prj_no").text(data.taskListCode);
    	$("#look_fb_name").text(data.fbContractName);
    	$("#look_fb_no").text(data.fbContractCode);
    	$("#look_fb_department").text(data.fbDepartment);
    	$("#look_leader").text(data.actualChargePerson);
    	$("#score").text(data.scoreMaterialSituation);
    	$("#score2").text(data.scoreManageAbility);
    	$("#score3").text(data.scoreQualityControl);
    	$("#score4").text(data.scoreCompanyReputation);
    	$("#score5").text(data.scoreJinduControl);
    	/* $("#score6").text(data.safetyCivilizationEnvironment); */
    	$("#score7").text(data.allScore);
    	
    	$("#allMsg1").modal("show");
    }
    
    function look2(obj){
    	var tr=$(obj).parents("tr");
    	var data=$("#mainContent2").DataTable().row(tr).data();
    	
    	$("#look_fb_name2").text(data.fbName);
    	$("#look_fb_no2").text(data.fbContract);
    	$("#look_cj_name2").text(data.cjName);
    	$("#look_cj_no2").text(data.cjContract);
    	$("#look_prj_code2").text(data.prjCode);
    	/* $("#look_sj_type").text(data.settlementType); */
    	$("#look_year").text(data.settlementTime);
    	$("#look_work_info2").text(data.workInfo);
    	$("#look_fb_money2").text(data.fbMoney);
    	$("#look_end_money2").text(data.fbEndMoney);
    	$("#look_qianqijyfy").text(data.qianqijyMoney)
    	$("#look_sfkouchu").text(data.isKouchu)
    	
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/work/selectDepartmentAndPerson',
            dataType: 'json',
            async:false,
            data: {
            	id:data.fcoId
            },
            success: function (json) {
            	var accessory=json.accessory;
            	$("#look_accessory tbody").html('');
            	/* $("#look_accessory2 tbody").html(''); */
				for(var j=0;j<accessory.length;j++){
					//$("#look_accessory tbody").append("<tr><td>附件"+(j+1)+"</td><td>"+accessory[j].acName+"</td><td><button type='button' data="+accessory[j].acUrl+" class='btn btn-primary' onclick='downLoadFile(this)'>下载附件</button></td></tr>")
					if(accessory[j].aType=="合同文本"){
		            	   $("#look_accessory tbody").append("<tr>"+
	      	   										"<td>附件</td>"+
							            	    	"<td colspan='2'><a href='"+getLocalPath()+"/oa_file/"+accessory[i].acUrl+"' target='view_window' style='color:blue;'>"+accessory[i].acName+"</a></td>"+
							            	    	"<td></td>"+
							            	    "</tr>");
	            	   }
	            	/* if(accessory[j].aType=="法律顾问签字"){
		            	   $("#look_accessory2 tbody").append("<tr>"+
	      	   										"<td>附件</td>"+
							            	    	"<td colspan='2'><input type='text' class='form-control' style='width:70%;' value='"+accessory[j].acName+"' disabled></td>"+
							            	    	"<td><button type='button' class='btn btn-primary' data='"+accessory[j].acUrl+"' onclick='downLoadFile(this)'>下载附件</button></td>"+
							            	    "</tr>");
	            	   } */
            	}
            }
  		});
    	
    	$("#allMsg2").modal("show");
    }
    
    function new_accessory(){
			var length=$("#new_accessory tr").length;
			$("#new_accessory tbody").append("<tr><td>新附件</td><td><input type='file' id='file"+length+"' name='file' class='form-control'></td><td><button type='button' class='btn btn-primary' onclick='removeThis(this)'>移除</button></td></tr>")
	}
    function new_accessory1(){
		var length=$("#new_accessory1 tr").length;
		$("#new_accessory1 tbody").append("<tr><td>新附件</td><td><input type='file' id='file"+length+"' name='file1' class='form-control'></td><td><button type='button' class='btn btn-primary' onclick='removeThis(this)'>移除</button></td></tr>")
}
    
    function new_accessory2(){
		var length=$("#new_accessory2 tr").length;
		$("#new_accessory2 tbody").append("<tr><td>新附件</td><td><input type='file' id='file"+length+"' name='file' class='form-control'></td><td><button type='button' class='btn btn-primary' onclick='removeThis(this)'>移除</button></td></tr>")
	}
    function new_accessory3(){
		var length=$("#new_accessory3 tr").length;
		$("#new_accessory3 tbody").append("<tr><td>新附件</td><td><input type='file' id='file"+length+"' name='file1' class='form-control'></td><td><button type='button' class='btn btn-primary' onclick='removeThis(this)'>移除</button></td></tr>")
	}
    
    function removeThis(obj){
    	var tr=$(obj).parent().parent();
  		$(tr).remove();
    }
    
    function  save2(){
    	var fbName=$("#fbContractName2").val();
    	var fbNo=$("#fbContract2").val();
    	var cjName=$("#cjContractName2").val();
    	var cjNo=$("#cjContract2").val();
    	var prjNo=$("#prjCode2").val();
    	/* var sj_type=$("#sj_type").val(); */
    	var fbMoney=$("#fb_money2");
    	var fbEndMoney=$("#fb_end_money2").val();
    	var sj_type=$("#sj_type").val();
    	var year=$("#year").val();
    	var work_info2=$("#work_info2").val();
    	
    	var options={
    			type: 'POST',
                url: getContextPath()+'/fbOver/addFbContractOverBySave',
                dataType: 'json',
                data: {
                	prjCode:prjNo,
                	cjContract:cjNo,
                	cjName:cjName,
                	fbContract:fbNo,
                	fbName:fbName,
                	/* settlementType:sj_type, */
                	fbMoney:fbMoney,
                	fbEndMoney:fbEndMoney,
                	settlementTime:year,
                	workInfo:work_info2
                },
                success: function (json) {
                	if(json>0){
                		$("#myModal2").modal("hide");
                		toastr.success("提交成功")
                	}else{
                		toastr.error("提交失败")
                	}
                }
    	}
    	$("#form_fb").ajaxSubmit(options);
    }
    
    function  submit2(){
    	var fbName=$("#fbContractName2").val();
    	var fbNo=$("#fbContract2").val();
    	var cjName=$("#cjContractName2").val();
    	var cjNo=$("#cjContract2").val();
    	var prjNo=$("#prjCode2").val();
    	/* var sj_type=$("#sj_type").val(); */
    	var fbMoney=$("#fb_money2").val();
    	var fbEndMoney=$("#fb_end_money2").val();
    	var year=$("#year").val();
    	var work_info2=$("#work_info2").val();
    	var qianqijyfy=$("#qianqijyfy").val();//前期经营费用
    	var isKouchu="";
    	if($("input[type='checkbox']").is(':checked')){//为true是选中
    		isKouchu="是";
    	}else{
    		isKouchu="否";
    	}
    	
    	var options={
    			type: 'POST',
                url: getContextPath()+'/fbOver/addFbContractOverBySubmit',
                dataType: 'json',
                data: {
                	prjCode:prjNo,
                	cjContract:cjNo,
                	cjName:cjName,
                	fbContract:fbNo,
                	fbName:fbName,
                	/* settlementType:sj_type, */
                	fbMoney:fbMoney,
                	fbEndMoney:fbEndMoney,
                	settlementTime:year,
                	workInfo:work_info2,
                	qianqijyMoney:qianqijyfy,
                	isKouchu:isKouchu
                },
                success: function (json) {
                	if(json=='0'){
		        		toastr.error("保存失败");
		        	}else{
		        		$("#myModal2").modal("hide");
		        		lianjie=json.url;
		            	if(json.receiver!=null&&json.receiver.length>=1){
			        		  $("#tijiaogei").modal('show');
			        		  $("#tijiaoren tbody").empty("");
			        		  for(var i=0;i<json.receiver.length;i++){
			        			  $("#tijiaoren tbody").append('<tr><td>'
			        					  +'<input type="radio" name="tijiaorenming" data-id="'+json.receiver[i].userId+'" data-id2="'+json.receiver[i].omId+'" data-id3="'+json.receiver[i].dutyId+'">'
			        					  +'</td><td>'
			        					  +json.receiver[i].omName
			        					  +'</td><td>'
			        					  +json.receiver[i].dutyName
			        					  +'</td><td>'
			        					  +json.receiver[i].uName
			        					  +'</td></tr>');
			        		  }
			        	  }else if(json.receiver.length==1){
			        		  $.ajax({
			        	          type: 'POST',
			        	          url: getContextPath()+'/task/addTask4',
			        	          dataType: 'json',
			        	          data:{
			        	        	  url:json.url,
			        	        	  userId:json.receiver.userId,
			        	        	  uName:json.receiver.uName,
			        	        	  omName:json.receiver.omName,
			        	        	  dutyName:json.receiver.dutyName,
			        	        	  omId:json.receiver.omId,
			        	        	  dutyId:json.receiver.dutyId
			        	          },
			        	          success: function (json) {
			        	        	  toastr.success('提交成功');
			        	          }
			        	      }); 
			        	  }
		        	}
                	/* if(json>0){
                		$("#myModal2").modal("hide");
                		toastr.success("提交成功")
                	}else{
                		toastr.error("提交失败")
                	} */
                }
    	}
    	$("#form_fb").ajaxSubmit(options);
    }
    
    function downLoadFile(obj){
			var filePath=$(obj).attr("data");
			var fileName=$(obj).parents("tr").find("td").eq(1).find("input").eq(0).val();
			window.location.href=encodeURI(getContextPath()+"/FileDownLoad?fileName="+fileName+"&filePath="+filePath);
	}
    
    function save3(){
    	var options={
    			type: 'POST',
                url: getContextPath()+'/fbOverWj/addFbContractOverWjBySave',
                dataType: 'json',
                data: {
                	fbContractName:$("#fbContractName").val(),
                	fbContract:$("#fbContract").val(),
                	prjCode:$("#prjCode").val(),
                	prjChargePerson:$("#prjChargePerson").val(),
                	cjContractName:$("#cjContractName").val(),
                	cjContract:$("#cjContract").val(),
                	contractNameYi:$("#contractNameYi").val(),
                	fbChargePerson:$("#fbChargePerson").val(),
                	prjProbablyText:$("#prjProbablyText").val(),
                	contractMoney:$("#contractMoney").val(),
                	provisionalMoney:$("#provisionalMoney").val(),
                	overWorkMoney:$("#overWorkMoney").val(),
                	overWorkExplain:$("#overWorkExplain").val(),
                	allPayMoney:$("#allPayMoney").val(),
                	doAppointScore:$("#doAppointScore").val()
                },
                success: function (json) {
                	if(json>0){
                		$("#myModal3").modal("hide");
                		toastr.success("保存成功")
                	}else{
                		toastr.error("保存失败")
                	}
                }
    	}
    	$("#form_fb2").ajaxSubmit(options);
    }

    function submit3(){
    	var options={
    			type: 'POST',
                url: getContextPath()+'/fbOverWj/addFbContractOverWjBySubmit',
                dataType: 'json',
                data: {
                	fbContractName:$("#fbContractName").val(),
                	fbContract:$("#fbContract").val(),
                	prjCode:$("#prjCode").val(),
                	prjChargePerson:$("#prjChargePerson").val(),
                	cjContractName:$("#cjContractName").val(),
                	cjContract:$("#cjContract").val(),
                	contractNameYi:$("#contractNameYi").val(),
                	fbChargePerson:$("#fbChargePerson").val(),
                	prjProbablyText:$("#prjProbablyText").val(),
                	contractMoney:$("#contractMoney").val(),
                	provisionalMoney:$("#provisionalMoney").val(),
                	overWorkMoney:$("#overWorkMoney").val(),
                	overWorkExplain:$("#overWorkExplain").val(),
                	allPayMoney:$("#allPayMoney").val(),
                	doAppointScore:$("#doAppointScore").val()
                },
                success: function (json) {
                	if(json=='0'){
		        		toastr.error("保存失败");
		        	}else{
		        		$("#myModal3").modal("hide");
		        		lianjie=json.url;
		            	if(json.receiver!=null&&json.receiver.length>=1){
			        		  $("#tijiaogei").modal('show');
			        		  $("#tijiaoren tbody").empty("");
			        		  for(var i=0;i<json.receiver.length;i++){
			        			  $("#tijiaoren tbody").append('<tr><td>'
			        					  +'<input type="radio" name="tijiaorenming" data-id="'+json.receiver[i].userId+'" data-id2="'+json.receiver[i].omId+'" data-id3="'+json.receiver[i].dutyId+'">'
			        					  +'</td><td>'
			        					  +json.receiver[i].omName
			        					  +'</td><td>'
			        					  +json.receiver[i].dutyName
			        					  +'</td><td>'
			        					  +json.receiver[i].uName
			        					  +'</td></tr>');
			        		  }
			        	  }else if(json.receiver.length==1){
			        		  $.ajax({
			        	          type: 'POST',
			        	          url: getContextPath()+'/task/addTask4',
			        	          dataType: 'json',
			        	          data:{
			        	        	  url:json.url,
			        	        	  userId:json.receiver.userId,
			        	        	  uName:json.receiver.uName,
			        	        	  omName:json.receiver.omName,
			        	        	  dutyName:json.receiver.dutyName,
			        	        	  omId:json.receiver.omId,
			        	        	  dutyId:json.receiver.dutyId
			        	          },
			        	          success: function (json) {
			        	        	  toastr.success('提交成功');
			        	          }
			        	      }); 
			        	  }
		        	}
                	/* if(json>0){
                		$("#myModal3").modal("hide");
                		toastr.success("提交成功")
                	}else{
                		toastr.error("提交失败")
                	} */
                }
    	}
    	$("#form_fb2").ajaxSubmit(options);
    }
    
    function look3(obj){
    	var tr=$(obj).parents("tr");
    	var data=$("#mainContent3").DataTable().row(tr).data();
    	
    	$("#look_fbContractName").text(data.fbContractName);
    	$("#look_fbContract").text(data.fbContract);
    	$("#look_prjCode").text(data.prjCode);
    	$("#look_prjChargePerson").text(data.prjChargePerson);
    	$("#look_cjContractName").text(data.cjContractName);
    	$("#look_cjContract").text(data.cjContract);
    	$("#look_contractNameYi").text(data.yiFang);
    	$("#look_fbChargePerson").text(data.fbChargePerson);
    	$("#look_prjProbablyText").text(data.prjProbablyText);
    	$("#look_contractMoney").text(data.contractMoney);
    	$("#look_provisionalMoney").text(data.provisionalMoney);
    	$("#look_overWorkMoney").text(data.overWorkMoney);
    	$("#look_overWorkExplain").text(data.overWorkExplain);
    	$("#look_allPayMoney").text(data.allPayMoney);
    	$("#look_doAppointScore").text(data.doAppointScore);
    	
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/work/selectDepartmentAndPerson',
            dataType: 'json',
            async:false,
            data: {
            	id:data.fcowId
            },
            success: function (json) {
            	var accessory=json.accessory;
            	$("#look_accessory3 tbody").html('');
            	$("#look_accessory4 tbody").html('');
				for(var j=0;j<accessory.length;j++){
					if(accessory[j].aType=="合同文本"){
		            	   $("#look_accessory3 tbody").append("<tr>"+
	      	   										"<td>附件</td>"+
							            	    	"<td colspan='2'><input type='text' class='form-control' style='width:70%;' value='"+accessory[j].acName+"' disabled></td>"+
							            	    	"<td><button type='button' class='btn btn-primary' data='"+accessory[j].acUrl+"' onclick='downLoadFile(this)'>下载附件</button></td>"+
							            	    "</tr>");
	            	   }
	            	if(accessory[j].aType=="法律顾问签字"){
		            	   $("#look_accessory4 tbody").append("<tr>"+
	      	   										"<td>附件</td>"+
							            	    	"<td colspan='2'><input type='text' class='form-control' style='width:70%;' value='"+accessory[j].acName+"' disabled></td>"+
							            	    	"<td><button type='button' class='btn btn-primary' data='"+accessory[j].acUrl+"' onclick='downLoadFile(this)'>下载附件</button></td>"+
							            	    "</tr>");
	            	   }
            	}
            }
  		});
    	
    	$("#allMsg3").modal("show");
    }
    
    function exportThis(){
    	var state=$("#state3").val();
    	window.location.href=encodeURI(getContextPath()+'/fbOverWj/exportFbOverWj?state='+state);
    }
    
    
  //选择项目
	$("#chosexm").click(function(){
		$("#xiangmumd").modal("show");
		 $.ajax({
	            type: 'POST',
	            url: getContextPath()+'/task/selectPrjNameAndWorkNo',
	            dataType: 'json',
	            async:false,
	            data: {
	            },
	            success: function (json) {
	            	//console.log(json)
	                $('#xiangmubiao').dataTable().fnClearTable();
	                $('#xiangmubiao').DataTable().rows.add(json).draw(false);
	            }
	        });
	})
	$("#quedingxm").click(function(){
		var prjname=$("input[name='xiangmuName']:checked").parent().next().next().text();
		var prjNo=$("input[name='xiangmuName']:checked").parent().next().text();
		$("#prj_name").val(prjname);
		$("#prj_no2").val(prjNo);
		$("#xiangmumd").modal("hide");
	})
    
    function initPrj(){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/task/selectPrjNameAndWorkNo',
            dataType: 'json',
            data: {
            },
            error: function (msg) {
            	toastr.error("请求失败");
            },
            success: function (json) {
                for(var i=0;i<json.length;i++){
                	//$("#prj_name").append("<option value="+json[i].prjName+">"+json[i].prjName+"</option>");
                	$("#prj_no2").append("<option value="+json[i].prjNo+">"+json[i].prjNo+"</option>");
                }
                
                /* $('#prj_name').editableSelect().on('select.editable-select', function (e, dom) {
	        		$.ajax({
	                    type: 'POST',
	                    url: getContextPath()+'/task/selectCjByTaskName',
	                    dataType: 'json',
	                    data: {
	                    	name:$('#prj_name').val()
	                    },
	                    success: function (json) {
	                    	var task=json.task;
	                    	$('#prj_no2').val(task.prjNo);
	                    }
	        		})
                }) */
                
                $('#prj_no2').editableSelect().on('select.editable-select', function (e, dom) {
		          		$.ajax({
		                    type: 'POST',
		                    url: getContextPath()+'/task/selectCjByTaskNo',
		                    dataType: 'json',
		                    data: {
		                    	no:$('#prj_no2').val()
		                    },
		                    success: function (json) {
		                    	var task=json.task;
		                    	$('#prj_name').val(task.prjName);
		                    }
		          		})
                })
                
            }
    	})
    }
    
    function initCj(){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/cj/selectIdAndName',
            dataType: 'json',
            data: {
            },
            error: function (msg) {
            	toastr.error("请求失败");
            },
            success: function (json) {
            	for(var i=0;i<json.length;i++){
            		$("#cj_name2").append("<option value="+json[i].cjId+">"+json[i].contractName+"</option>")
            	}
            }
    	})
    }
    
    function initFb(){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/subcontract/getFBNameAndNo',
            dataType: 'json',
            data: {
            },
            error: function (msg) {
            	toastr.error("请求失败");
            },
            success: function (json) {
            	for(var i=0;i<json.length;i++){
            		$("#fb_name2").append("<option value="+json[i].fbId+">"+json[i].contractName+"</option>")
            	}
            }
    	})
    }
    
    function select_cj(){
   	 $.ajax({
	            type: 'POST',
	            url: getContextPath()+'/cj/selectNameAndNo',
	            dataType: 'json',
	            async:false,
	            data: {
	            },
	            success: function (json) {
	                $('#cj_table').dataTable().fnClearTable();
	                $('#cj_table').DataTable().rows.add(json).draw(false);
	            }
	        });
   			$("#choose_cj").modal("show");
   }
    
    function saveCjName(){
    	var tr=$("input[name='cjName']:checked").parents("tr");
    	var data=$("#cj_table").DataTable().row(tr).data();
    	if(data==null){
    		toastr.error("请选择")
    		return;
    	}
    	$("#new_cj_name").val(data.contractName);
    	$("#new_cj_no").val(data.contractNo);
    	$("#new_prj_no").val(data.taskCode);
    	$("#choose_cj").modal("hide");
    }
    
    //履约评价选择分包
    function chooseFb(){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/subcontract/getFBNameAndNo',
            dataType: 'json',
            async:false,
            data: {
            },
            success: function (json) {
                $('#fb_table').dataTable().fnClearTable();
                $('#fb_table').DataTable().rows.add(json).draw(false);
            }
        });
    	$("#choose_fb").modal("show");
    }

    function saveFbName(){
    	var tr=$("input[name='fbName']:checked").parents("tr");
    	var prjname=$("input[name='fbName']:checked").parent().next().text();
		var prjNo=$("input[name='fbName']:checked").parent().next().next().text();
		var jiafang=$("input[name='fbName']:checked").parent().next().next().next().text();
    	$('#new_fb_name').val(prjname);
    	$('#new_fb_no').val(prjNo);
    	$("#new_fb_department").val(jiafang)
    	$("#choose_fb").modal("hide");
    }
    
  //分包结算申请选择分包
    function chooseFb2(){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/subcontract/getFBNameAndNo',
            dataType: 'json',
            async:false,
            data: {
            },
            success: function (json) {
                $('#fb_table2').dataTable().fnClearTable();
                $('#fb_table2').DataTable().rows.add(json).draw(false);
            }
        });
    	$("#choose_fb2").modal("show");
    }
    function saveFbName2(){
    	var tr=$("input[name='fbName2']:checked").parents("tr");
    	var data=$('#fb_table2').DataTable().row(tr).data();
    	$('#fbContractName2').val(data.contractName);
    	$('#fbContract2').val(data.fbNo);
    	$("#cjContractName2").val(data.cjContractName);
    	$("#cjContract2").val(data.cjContractCode);
    	$("#prjCode2").val(data.workNo);
    	$("#fb_money2").val(data.contractMoney);
    	$("#choose_fb2").modal("hide");
    }
    
  //分包结算申请选择承接
    function select_cj2(){
      	 $.ajax({
   	            type: 'POST',
   	            url: getContextPath()+'/cj/selectNameAndNo',
   	            dataType: 'json',
   	            async:false,
   	            data: {
   	            },
   	            success: function (json) {
   	                $('#cj_table2').dataTable().fnClearTable();
   	                $('#cj_table2').DataTable().rows.add(json).draw(false);
   	            }
   	        });
      			$("#choose_cj2").modal("show");
      }
       
       function saveCjName2(){
       	var tr=$("input[name='cjName2']:checked").parents("tr");
       	var data=$("#cj_table2").DataTable().row(tr).data();
       	if(data==null){
       		toastr.error("请选择")
       		return;
       	}
       	$("#cj_name2").val(data.contractName);
       	$("#choose_cj2").modal("hide");
       }
    
  //合同履约选择分包
    function chooseFb3(){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/subcontract/getFBNameAndNo',
            dataType: 'json',
            async:false,
            data: {
            },
            success: function (json) {
                $('#fb_table3').dataTable().fnClearTable();
                $('#fb_table3').DataTable().rows.add(json).draw(false);
            }
        });
    	$("#choose_fb3").modal("show");
    }

    function saveFbName3(){
    	var tr=$("input[name='fbName3']:checked").parents("tr");
    	var data=$('#fb_table3').DataTable().row(tr).data();
    	$('#fbContractName').val(data.contractName);
    	$('#fbContract').val(data.fbNo);
    	getAllPayMoney(data.fbNo);
    	$("#contractMoney").val(data.contractMoney);
    	$("#provisionalMoney").val(data.temporaryMoney);
    	$("#cjContractName").val(data.cjContractName);
    	$("#cjContract").val(data.cjContractCode);
    	$("#prjCode").val(data.workNo);
    	selectAllPrjLeader(data.workNo)
    	$("#choose_fb3").modal("hide");
    }
    
    function getAllPayMoney(obj){
    	$.ajax({
	            type: 'POST',
	            url: getContextPath()+'/pay/getTotalPayMoney',
	            dataType: 'json',
	            data: {
	            	no:obj
	            },
	            success: function (json) {
	                $("#allPayMoney").val(json.alreadyAccumulateMoney)
	            }
	        });
    }
    
    
    //合同履约选择承接
    function select_cj3(){
      	 $.ajax({
   	            type: 'POST',
   	            url: getContextPath()+'/cj/selectNameAndNo',
   	            dataType: 'json',
   	            async:false,
   	            data: {
   	            },
   	            success: function (json) {
   	                $('#cj_table3').dataTable().fnClearTable();
   	                $('#cj_table3').DataTable().rows.add(json).draw(false);
   	            }
   	        });
      			$("#choose_cj3").modal("show");
      }
       
       function saveCjName3(){
       	var tr=$("input[name='cjName3']:checked").parents("tr");
       	var data=$("#cj_table3").DataTable().row(tr).data();
       	if(data==null){
       		toastr.error("请选择")
       		return;
       	}
       	$("#cjContractName").val(data.contractName);
       	$("#cjContract").val(data.contractNo);
       	$("#prjCode").val(data.taskCode);
       	$("#choose_cj3").modal("hide");
       }
       
       function gotoCj(obj){
	    	dom=$(obj).parents("tr");
			var data=$('#mainContent').DataTable().row(dom).data();
			//var t = encodeURI(encodeURI(data.prjId));
			//console.log(data)
			 $.ajax({
				type:"POST",
				url:getContextPath()+"/cj/selectCjByCjNo",
				dataTyepe:"json",
				async:false,
				data:{ 
					no:data.cjContractCode
					},
				success:function(json){
					//console.log(json)
					$(obj).attr("href",'../shengchanGuanli/ContractManagement.html?cjId='+json.cjId+'');
				}
			})  
	    }
       
       function gotoFb(obj){
       	dom=$(obj).parents("tr");
   		var data=$('#mainContent').DataTable().row(dom).data();
   		//console.log(data)
   		$.ajax({
               type: 'POST',
               url: getContextPath()+'/subcontract/getFBNameByNo',
               dataType: 'json',
               async:false,
               data: {
               	fbNo:data.fbContractCode
               },
               success: function (json) {
               	//console.log(json);
               	$(obj).attr('href', '../shengchanGuanli/SubcontractManagement.html?prjId='+json.fbId+'');
               }
     		});
       }
       
       function gotoPrj2(obj){
       	dom=$(obj).parents("tr");
   		var data=$('#mainContent2').DataTable().row(dom).data();
   		//console.log(data);
   		//var t = encodeURI(encodeURI(data.prjId));
   		$.ajax({
   			type:"POST",
   			url:getContextPath()+"/task/selectIdByNameAndNo",
   			dataTyepe:"json",
   			async:false,
   			data:{ 
   				name:data.prjName,
   				no:data.prjCode
   				},
   			success:function(json){
   				$(obj).attr('href', '../shengchanGuanli/TaskManagement.html?prjId='+json.prjId+'&prjNo='+data.prjCode+'');
   			}
   		})
       }
       
       function gotoCj2(obj){
	    	dom=$(obj).parents("tr");
			var data=$('#mainContent2').DataTable().row(dom).data();
			//var t = encodeURI(encodeURI(data.prjId));
			//console.log(data)
			$(obj).attr("href",'../shengchanGuanli/ContractManagement.html?cjId='+data.cjContract+''); 
	    }
       
       function gotoFb2(obj){
          	dom=$(obj).parents("tr");
      		var data=$('#mainContent2').DataTable().row(dom).data();
      		console.log(data)
      		$(obj).attr('href', '../shengchanGuanli/SubcontractManagement.html?prjId='+data.fbContract+'');
          }
       
       function gotoFb3(obj){
          	dom=$(obj).parents("tr");
      		var data=$('#mainContent3').DataTable().row(dom).data();
      		//console.log(data)
      		$.ajax({
                  type: 'POST',
                  url: getContextPath()+'/subcontract/getFBNameByNo',
                  dataType: 'json',
                  async:false,
                  data: {
                  	fbNo:data.fbContract
                  },
                  success: function (json) {
                  	//console.log(json);
                  	$(obj).attr('href', '../shengchanGuanli/SubcontractManagement.html?prjId='+json.fbId+'');
                  }
        		}); 
          }
       
       function gotoCj3(obj){
	    	dom=$(obj).parents("tr");
			var data=$('#mainContent').DataTable().row(dom).data();
			//var t = encodeURI(encodeURI(data.prjId));
			console.log(data)
			$.ajax({
				type:"POST",
				url:getContextPath()+"/cj/selectCjByCjNo",
				dataTyepe:"json",
				async:false,
				data:{ 
					no:data.cjContractCode
					},
				success:function(json){
					//console.log(json)
					$(obj).attr("href",'../shengchanGuanli/ContractManagement.html?cjId='+json.cjId+'');
				}
			})
	    }
       
       function get_all(){
    	   var pj=$("#pj").val();
    	   var pj2=$("#pj2").val();
    	   var pj3=$("#pj3").val();
    	   var pj4=$("#pj4").val();
    	   var pj5=$("#pj5").val();
    	   var reg = new RegExp("^[0-9]*$");
    	   
    	   if(pj==''){
    		   toastr.error("人员、材料和设备配置情况为空");
    		   return;
    	   }else{
    		   if(!(reg.test(pj)&&pj>0&&pj<=100)){
        		   toastr.error("人员、材料和设备配置情况请填写0-100整数");
        		   return;
        	   }
    	   }
    	   
    	   if(pj2==''){
    		   toastr.error("施工经验、施工组织管理能力为空");
    		   return;
    	   }else{
    		   if(!(reg.test(pj2)&&pj2>0&&pj2<=100)){
        		   toastr.error("施工经验、施工组织管理能力请填写0-100整数");
        		   return;
        	   }
    	   }
    	   
    	   if(pj3==''){
    		   toastr.error("质量控制为空");
    		   return;
    	   }else{
    		   if(!(reg.test(pj3)&&pj3>0&&pj3<=100)){
        		   toastr.error("质量控制请填写0-100整数");
        		   return;
        	   }
    	   }
    	   
    	   if(pj4==''){
    		   toastr.error("个人信誉为空");
    		   return;
    	   }else{
    		   if(!(reg.test(pj4)&&pj4>0&&pj4<=100)){
        		   toastr.error("个人信誉请填写0-100整数");
        		   return;
        	   }
    	   }
    	   
    	   if(pj5==''){
    		   toastr.error("进度控制为空");
    		   return;
    	   }else{
    		   if(!(reg.test(pj5)&&pj5>0&&pj5<=100)){
        		   toastr.error("进度控制请填写0-100整数");
        		   return;
        	   }
    	   }
    	   
    	   var all=parseInt(pj)*0.2+parseInt(pj2)*0.2+parseInt(pj3)*0.2+parseInt(pj4)*0.2+parseInt(pj5)*0.2;
    	   $("#pj7").val(all.toFixed(2));
       }
       
       function getLocalPath(){
 			var pathArray = window.location.pathname.split('/');
 			var secondLevelLocation = pathArray[1];
 			var loginUrl = window.location.protocol + "//"  + window.location.host ;
 			return loginUrl;
 		}
</script>
</html>