<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="../../font2/iconfont.css">
    <link rel="stylesheet" href="../../font3/iconfont.css">
	<link href="../../style/bootstrap.min.css" rel="stylesheet">
    <link href="../../style/style.css" rel="stylesheet">
    <link href="../../toastr/toastr.css" rel="stylesheet">
    <link href="../../font3/bootstrap-select.css" rel="stylesheet">
    <link rel="stylesheet" href="../../style/jquery.dataTables.min.css">
    <link rel="stylesheet" href="../../style/jquery-editable-select.css"> 
    <link href="../../select/css/select2.min.css" rel="stylesheet">
    <!-- SmartAdmin Styles : Caution! DO NOT change the order -->
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/smartadmin-production-plugins.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/smartadmin-production.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/smartadmin-skins.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/font.css">
    <!-- SmartAdmin RTL Support  -->
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/smartadmin-rtl.min.css">
    <style lang="">
        
        .UpperPart{
            display: flex;
            justify-content:space-between;
            border-bottom: 1px solid #ccc;
            padding-bottom: 4px;
        }
        .UpperPartL{
            font-size: 16px;
        }
        .selected{
            background: rgba(247, 161, 3,0.2);
        }
        #mainContent th{
            cursor: pointer;
            font-size: 14px; 
        }
        
       /*  body{ font:12px/1.125 Arial, Helvetica, sans-serif; background:#fff; }
        .none{ display:none }
        .wrap{ width:100%;overflow-y:scroll} */
    </style>
</head>
<body>
    
    <!-- 面包屑 -->
    <div class="mianbao">
    	<ul class="breadcrumb">
    		<li><i class="iconfont icon-knowledgebase"></i></li>
            <li>生产管理</li>
            <li>合同管理</li>
            <li>项目合同管理</li>
            <li>采购合同管理</li>
			<li class="active">其他采购合同审签</li>
		</ul>
    </div>

    <div class="zhuti-content">
        <div class="UpperPart">
            <div class="UpperPartL" style="font-size:18px;">
                <!-- <form class="form-inline">
                    <label>状态筛选:</label>
                    <select class="zhuangtai form-control" style="width:160px;">
                        <option>审批结束</option>
                        <option>审批中</option>
                        <option>合同取消</option>
                    </select>
                </form> -->
            </div>
            <div class="UpperPartR">
            	
			    </div>
            </div>
            
            <div class="LowerPart" style="margin-top:3px;">
        			<div class="chaojisousuo" style="margin-bottom:4px;">
                    		<div class="sousuoClick" style="display:flex;justify-content: space-between;margin-bottom:4px;">
                    				<div class="yihang">
					           			<button type="button" class="btn btn-primary Pecacba" style="margin-left: 10px;"  data-toggle="modal" data-target="#myModal" >填报其他采购合同</button>
						                <div id="tabBtn" style="margin-left: 10px;"></div>
                   						<button type="button" class="btn btn-info" style="margin-left: 10px;" onclick="seachAll()"><span class="glyphicon glyphicon-search" aria-hidden="true"></span>搜索</button>
                    					<button type="button" class="btn btn-primary" style="width:100px;margin-left: 10px;" id="zhedieBtn"><span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span></button>
                    				</div>
                    				<div class="yihang">
										<input class="form-control" id="searchData" value="" placeholder="搜索" type="text">
									</div>	
                    		</div>
                    		<div class="sousuoInput" id="sousuodiv">
                    			<div id="sousuoTable"  style="border:1px solid #eee;padding:5px;">
                    			
                    				<div class="yihang2">
                    					<div style="width:50%;">
                    							<form class="form-inline">
														  <div class="form-group" style="display:flex;align-items:center;">
														    	<label for="exampleInput">合同签订时间:&nbsp;</label>
														    	<input type="text" class="form-control" id="seach_time_min"  style="width:30%;">
														    	<label>-</label>
														    	<input type="text" class="form-control" id="seach_time_max"  style="width:30%;">
														  </div>
													</form>
                    					</div>
                    					<div style="width:50%;">
                    							<form class="form-inline">
														  <div class="form-group" style="display:flex;align-items:center;">
														    	<label for="exampleInput">采购合同金额:&nbsp;</label>
														  		<input type="text" class="form-control" id="seach_cg_min"  style="width:30%;">
														    	<label>-</label>
														    	<input type="text" class="form-control" id="seach_cg_max"  style="width:30%;">
														  </div>
													</form>
                    					</div>
                   					</div>
                    			</div>
                    		</div>
                    	</div>
            <table class="table table-bordered table-condensed" id="mainContent">
                <thead>
                    <tr>
                        <th style="width:4%;">序号</th>
                        <th style="width:10%;">采购合同编号</th>
                        <th style="width:20%;">采购合同名称</th>
                        <th style="width:10%;">采购合同类型</th>
                        <th style="width:15%;">合同乙方</th>
                        <th style="width:10%;" class="jinqianyanse">采购合同金额(元)</th>
                        <th style="width:10%;">签订时间</th>
                        <th style="width:60px;">发起人</th>
                        <th style="width:70px;">审批状态</th>
                        <th style="width:110px;">操作</th>
                    </tr>
                </thead>
                <tbody>
                   
                </tbody>   
            </table>
        </div>
<!-- Modal -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="myModal">
    <div class="modal-dialog modal-lg" role="document" style="width:75%;">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>填报其他采购合同</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form id="new_form" class="form-inline"  method="post" enctype="multipart/form-data">
                        <table class="table table-bordered table-condensed">
                            <tr>
                                <td style="width:15%;">采购合同名称  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td style="width:30%;">
                                	<input type="text" id="cghetongming" class="form-control" style="width:60%;">
                                </td>
                                <td style="width:15%;">采购合同编号</td>
                                <td style="width:30%;">
                              		<input type="text" id="cgoNo" class="form-control" disabled style="width:60%;">
                                </td> 
                            </tr>
                            <tr>
                                <td style="width:15%;">采购合同类型  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td style="width:30%;">
                                    <select class="form-control" id="cghetongType" style="width:60%;">
                                        <option>A 技术服务</option>
                                        <option>B 其他</option>
                                    </select>
                                </td>
                                <td style="width:15%;">项目名称:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td style="width:30%;">
                                	<input type="text" id="prjName" class="form-control" style="width:60%;"> 
                                    <button type="button" style="margin-left: 5px;" class="btn btn-primary"  id="chosexm">选择项目</button>
                                </td>
                            </tr>
                            <tr>
                                <td style="width:15%;">任务单号</td>
                                <td style="width:30%;">
                                	 <input type="text" id="task_no" class="form-control" style="width:60%;" disabled> 
                                       <!-- <select class="form-control" style="width:60%;" id="task_no">
                                       </select> -->
                                </td>
                                <td style="width:15%;" class="jinqianyanse">采购合同金额(元)</td>
                                <td style="width:30%;"><input type="text" id="cghetongMoney" class="form-control" placeholder="元"  style="width:60%;"></td>
                            </tr>
                            <tr>
                                <td style="width:15%;">合同甲方名称  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td style="width:30%;">
                                    <select class="form-control" id="hetongjiafang" style="width:60%;">
                                    </select>  
                                </td>
                                <td style="width:15%;">乙方  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td style="width:30%;">
                                    <select class="form-control" id="yifang" style="width:60%;">
                                        
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td style="width:15%;">付款方式</td>
                                <td style="width:30%;">
                                    <input type="text" class="form-control" id="fukuangfangshi" style="width:60%;">
                                </td>
                                <td style="width:15%;">采购合同签订时间</td>
                                <td style="width:30%;"><input type="text" class="form-control" id="year" style="width:60%;"></td>
                            </tr>
                            <tr>
                                <td style="width:15%;">采购部门</td>
                                <td style="width:30%;">
                                	<!-- <input type="text" class="form-control" id="cg_bumen" style="width:60%;" disabled> -->
                                	<select class="form-control" id="cg_bumen" style="width:60%;">
                                    </select>
                                </td>
                            	 <td style="width:15%;" class="jinqianyanse">运费(元)</td>
                            	<td style="width:30%;"><input type="text" class="form-control" id="yunfei" style="width:60%;"></td> 
                            </tr> 
                            <tr>
                                <td class="jinqianyanse" style="width:15%;">税率</td>
                                <td style="width:30%;">
                                	<input type="text" placeholder="小数" class="form-control" id="shuilv" style="width:60%;" onchange="getRateMoney(this)">
                                	<!-- <button type="button" class="btn btn-primary weui-uploader__input" onclick="jisuanshuijin()">计算税金</button> -->
                                </td>
                            	 <td class="jinqianyanse" style="width:15%;">税金</td>
                            	<td style="width:30%;"><input type="text" class="form-control" id="shuijin" style="width:60%;" disabled></td> 
                            </tr>
                            <tr>
                                <td>采购合同概述</td>
                                <td colspan="3"><textarea class="form-control" id="hetonggaishu" rows="4" style="width:100%;"></textarea></td>
                            </tr>
                            <!-- <tr>
                                <td>主要概况及工作内容</td>
                                <td colspan="3"><textarea class="form-control" id="gaikuang" rows="4" style="width:100%;"></textarea></td>
                            </tr> -->
                            
                        </table> 
                        <table class="table table-bordered table-condensed" id="new_accessory">
                        	<thead>
                        		<tr>
                                	<td style="width:15%;">采购合同文本  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                	<td colspan="3"><button type="button" class="btn btn-primary weui-uploader__input" onclick="addFile()">添加附件</button></td>
                            	</tr>
                        	</thead>
                        	<tbody></tbody>
                        </table>

                        
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal" onclick="clearP()">取消</button>
            <button type="button" class="btn btn-default" onclick="saveCg()">保存</button>
            <button type="button" class="btn btn-success" onclick="submitCg()" >提交</button>
        </div>
        </div>
    </div>
</div>
<!-- model结束 -->
<!-- Modal项目 -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="xiangmumd">
    <div class="modal-dialog modal-lg" role="document" style="width:60%;">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>选择项目</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline">
                        <table class="table table-bordered table-condensed" id="xiangmubiao" style="width:100%;">
                            <thead>
                            	<tr>
                            		<th style="width:8%;"></th>
                            		<th style="width:12%;">编号</th>
                                    <th style="width:30%;">项目名称</th>
                                    <th style="width:15%;">项目所属公司</th>
                                    <th style="width:15%;">项目类型</th>
                                    <th style="width:20%;">甲方单位</th>
                            	</tr>
                            </thead>
                            <tbody>
                                
                            </tbody>
                        </table> 
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-success" id="quedingxm">保存</button>
        </div>
        </div>
    </div>
</div>
<!-- model项目结束 -->

<!-- 提交 modal -->
<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="tijiaogei">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="gridSystemModalLabel">提交给</h4>
            </div>
            <div class="modal-body">
                <table class="table table-bordered table-condensed" id="tijiaoren">
                        	<thead>
                        			<tr>
		                            	<th></th>
		                                <th>部门</th>
		                                <th>职务</th>
		                                <th>审批人</th>
		                            </tr>
                        	</thead>
                            <tbody>
                            	
                            </tbody>
                        </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-success" data-dismiss="modal" onclick="submitPerson()">提交</button>
            </div>
        </div>
    </div>
</div>
<!-- 提交 modal结束 -->


<!-- 修改Modal -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="change">
    <div class="modal-dialog modal-lg" role="document" style="width:75%;">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>修改其他采购合同</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form id="edit_form" class="form-inline"  method="post" enctype="multipart/form-data">
                        <table class="table table-bordered table-condensed">
                            <tr>
                                <td style="width:15%;">采购合同名称  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td style="width:30%;">
                                	<input type="text" id="xgcghetongming" class="form-control"  style="width:60%;">
                                </td>
                                <td style="width:15%;">采购合同编号</td>
                                <td style="width:30%;">
                                	<input type="text" id="xgcgoNo" class="form-control" disabled  style="width:60%;">
                                </td>
                            </tr>
                            <tr>
                                <td>采购合同类型  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                    <select class="form-control" id="xgcghetongType" style="width:60%;">
                                        <option>A 技术服务</option>
                                        <option>B 其他</option>
                                    </select>
                                </td>
                             	<td>项目名称:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                	 <input type="text" id="xgprjName" class="form-control" style="width:60%;">
                                	<!-- <select class="form-control" id="xgprjName" style="width:60%;">
                                    </select> -->
                                    <button type="button" style="margin-left: 5px;" class="btn btn-primary"  id="xgchosexm">选择项目</button>
                                </td>                               
                            </tr>
                            <tr>
                                <td>任务单号</td>
                                <td>
                                	 <input type="text" id="xgtask_no" class="form-control" style="width:60%;" disabled> 
                                	<!-- <select class="form-control" id="xgtask_no" style="width:60%;">
                                    </select> -->
                                </td>
                                <td class="jinqianyanse">采购合同金额(元)</td>
                                <td><input type="text" id="xgcghetongMoney" class="form-control" placeholder="元" style="width:60%;"></td>
                            </tr>
                            <tr>
                                </tr>
                            <tr>
                                <td>合同甲方名称  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                    <select class="form-control" id="xghetongjiafang" style="width:60%;">
                                    </select>  
                                </td>
                                <td>乙方  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                    <select class="form-control" id="xgyifang" style="width:60%;">
                                        
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>付款方式</td>
                                <td>
                                    <input type="text" class="form-control" id="xgfukuangfangshi" style="width:60%;">
                                </td>
                                <td>采购合同签订时间</td>
                                <td><input type="text" class="form-control" id="xgyear" style="width:60%;"></td>
                            </tr>
                             <tr>
                                <td>采购部门</td>
                                <td>
                                	<!-- <input type="text" class="form-control" id="xgcg_bumen" style="width:60%;" disabled> -->
                                	<select class="form-control" id="xgcg_bumen" style="width:60%;">
                                        
                                    </select>
                                </td>
                            	<td style="width:15%;" class="jinqianyanse">运费(元)</td>
                            	<td style="width:30%;"><input type="text" class="form-control" id="xgyunfei" style="width:60%;"></td>
                            </tr> 
                            <tr>
                                <td class="jinqianyanse" style="width:15%;">税率</td>
                                <td style="width:30%;">
                                	<input type="text" placeholder="小数" class="form-control" id="xgshuilv" style="width:60%;" onchange="xggetRateMoney(this)">
                                </td>
                            	 <td class="jinqianyanse" style="width:15%;">税金</td>
                            	<td style="width:30%;"><input type="text" class="form-control" id="xgshuijin" style="width:60%;"></td> 
                            </tr>
                            <tr>
                                <td>采购合同概述</td>
                                <td colspan="3"><textarea class="form-control" id="xghetonggaishu" rows="4" style="width:100%;"></textarea></td>
                            </tr>
                            <!-- <tr>
                                <td>主要概况及工作内容</td>
                                <td colspan="3"><textarea class="form-control" id="xggaikuang" rows="4" style="width:100%;"></textarea></td>
                            </tr> -->
                            
                        </table> 
                        <table class="table table-bordered table-condensed" id="edit_accessory">
                        	<thead>
                        		<tr>
                                	<td style="width:15%;">采购合同文本  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                               	 	<td colspan="3"><button type="button" class="btn btn-primary weui-uploader__input" onclick="addFile2()">添加附件</button></td>
                           		</tr>
                        	</thead>
                        	<tbody>
                        	</tbody>
                        </table>

                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-default" onclick="checksaveCgC()">保存</button>
             <button type="button" class="btn btn-success" onclick="checksubmitCgC()">提交</button>
        </div>
        </div>
    </div>
</div>
<!-- 修改model结束 -->
<!-- xg项目 Modalxg -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="xgxiangmumd">
    <div class="modal-dialog modal-lg" role="document" style="width:60%;">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>选择项目</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline">
                        <table class="table table-bordered table-condensed" id="xgxiangmubiao" style="width:100%;">
                            <thead>
                            	<tr>
                            		<th></th>
                            		<th>编号</th>
                                    <th>项目名称</th>
                                    <th>项目所属公司</th>
                                    <th>项目类型</th>
                                    <th>甲方单位</th>
                            	</tr>
                            </thead>
                            <tbody>
                                
                            </tbody>
                        </table> 
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-success" id="xgquedingxm">保存</button>
        </div>
        </div>
    </div>
</div>
<!--xg项目  modelxg结束 --> 

<!-- Modal2 -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="myModal2">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>其他采购合同取消</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline">
                        <table class="table table-bordered table-condensed">
                            <tr>
                                <td>采购合同取消原因</td>
                                <td colspan="3"><textarea class="form-control" id="cancel_reason" rows="4" cols="50"></textarea></td>
                            </tr>
                        </table> 
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-success" onclick="submitCgCancel()">提交</button>
        </div>
        </div>
    </div>
</div>
<!-- model2结束 -->
<!-- Modal3 -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="myModal3">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>其他采购合同重启</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline">
                    	<table class="table table-bordered table-condensed">
                            <tr>
                                <td>采购合同取消原因</td>
                                <td colspan="3"><textarea class="form-control" id="look_cancel_reason" rows="4" cols="50" disabled></textarea></td>
                            </tr>
                        </table> 
                        <table class="table table-bordered table-condensed">
                            <tr>
                                <td>采购合同重启原因</td>
                                <td colspan="3"><textarea class="form-control" id="restart_reason" rows="4" cols="50"></textarea></td>
                            </tr>
                        </table> 
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-success" onclick="submitCgRestart()">提交</button>
        </div>
        </div>
    </div>
</div>
</div>
<!-- model3结束 -->
       
        
    </div>
    
<!-- allMsg -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="allMsg1">
    <div class="modal-dialog modal-lg" role="document"style="width:75%;">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>所有信息</b></h4>
        </div>
        <div class="modal-body">
            <div>     
                <form class="form-inline">
                    <table class="table table-bordered table-condensed">
                        <tr>
                            <td style="width:20%">采购合同名称</td>
                            <td style="width:30%" id="lookcghetongming"></td>
                            <td style="width:20%">采购合同编号</td>
                            <td style="width:30%" id="lookcgoNo"></td>
                        </tr>
                        <tr>
                            <td style="width:100px;">采购合同类型</td>
                            <td id="lookcgType"></td>
                            <td>项目名称</td>
                            <td id="lookprjName"></td>
                        </tr>
                        <tr>
                            <td>任务单号</td>
                            <td id="looktask_no"></td>
                            <td class="jinqianyanse">采购合同金额(元)</td>
                            <td id="lookcghetongMoney"></td>
                        </tr>
                        <tr>
                            <td>合同甲方名称</td>
                            <td id="lookjiafang"></td>
                            <td>乙方</td>
                            <td id="lookyifang"></td>
                        </tr>
                        <tr>
                            <td>付款方式</td>
                            <td id="lookfukuanfangshi"></td>
                            <td>采购合同签订时间</td>
                            <td id="lookyear"></td>
                        </tr>
                        <tr>
                            <td>采购部门</td>
                            <td id="lookcg_bumen"></td>
                           	<td class="jinqianyanse">运费(元)</td>
                           	<td id="lookyunfei"></td>
                         </tr> 
                         <tr>
                             <td class="jinqianyanse" style="width:15%;">税率</td>
                             <td id="look_shuilv"></td>
                           	 <td class="jinqianyanse" style="width:15%;">税金</td>
                           	 <td id="look_shuijin"></td> 
                          </tr>
                        <tr>
                            <td>采购合同概述</td>
                            <td colspan="3" id="lookcghetonggaishu"></td>
                        </tr>
                        <!-- <tr>
                            <td>主要概况及工作内容</td>
                            <td colspan="3" id="lookgaikuang"></td>
                        </tr> -->
                        <!-- <tr>
                            <td>采购合同文本</td>
                            <td colspan="3"></td>
                        </tr> -->
                    </table>
                    <table class="table table-bordered table-condensed"  id="look_all_table">
				                        		
				    </table>
				   <!--  <table class="table table-bordered table-condensed"  id="look_all_table1">
				                        		
				    </table> -->

				    <!-- 历史信息表格 -->
				    <table style="width:100%;" class="table table-bordered table-condensed" id="lookHistory">
                        <thead>
                            <tr>
                                <th colspan="6">历史信息</th>
                            </tr>
                            <tr>
                                <td style="width:20%;">采购合同编号</td>
                                <td style="width:20%;">采购合同名称</td>
                                <td style="width:20%;">合同类型</td>
                                <td style="width:20%;">修改时间</td>
                                <td style="width:20%;">操作</td>
                            </tr>
                        </thead>
                        <tbody>
                            
                        </tbody>
                    </table>
                    <br/>
					<h2 style="color:red;">审批详情</h2>
					<table class="table table-bordered table-condensed" id="d_table">
                    		<thead>
                    			<tr>
                    				<th style="width:30%;">业务名称</th>
                    				<th style="width:12%;">操作人</th>
                    				<th style="width:23%;">意见</th>
                    				<th style="width:12%;">操作类型</th>
                    				<th style="width:23%;">操作时间</th>
                    			</tr>
                    		</thead>
                    		<tbody></tbody>
                    	</table>
                    
                </form>  
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-success" onclick="dayinyulan()">打印预览</button>
        </div>
        </div>
    </div>
</div>
<!-- allMsg结束 -->
<!-- 历史详细信息 -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="History">
    <div class="modal-dialog modal-lg" role="document"style="width:75%;">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>所有信息</b></h4>
        </div>
        <div class="modal-body">
            <div>     
                <form class="form-inline">
                    <table class="table table-bordered table-condensed">
                        <tr>
                            <td>采购合同名称</td>
                            <td id="Historycghetongming"></td>
                            <td style="width:100px;">采购合同编号</td>
                            <td id="HistorycgoNo"></td>
                        </tr>
                        <tr>
                            <td style="width:100px;">采购合同类型</td>
                            <td id="HistorycgType"></td>
                            <td>项目名称</td>
                            <td id="HistoryprjName"></td>
                        </tr>
                        <tr>
                            <td>任务单号</td>
                            <td id="Historytask_no"></td>
                            <td>采购合同金额(元)</td>
                            <td id="HistorycghetongMoney"></td>
                        </tr>
                        <tr>
                            <td>合同甲方名称</td>
                            <td id="Historyjiafang"></td>
                            <td>乙方</td>
                            <td id="Historyyifang"></td>
                        </tr>
                        <tr>
                            <td>付款方式</td>
                            <td id="Historyfukuanfangshi"></td>
                            <td>采购合同签订时间</td>
                            <td id="Historyyear"></td>
                        </tr>
                         <tr>
                            <td>采购部门</td>
                            <td id="Historycg_bumen"></td>
                           	<td class="jinqianyanse">运费(元)</td>
                           	<td id="Historyyunfei"></td>
                          </tr> 
                        <tr>
                            <td>采购合同概述</td>
                            <td colspan="3" id="Historycghetonggaishu"></td>
                        </tr>
                        <!-- <tr>
                            <td>主要概况及工作内容</td>
                            <td colspan="3" id="Historygaikuang"></td>
                        </tr> -->
                        <!-- <tr>
                            <td>采购合同文本</td>
                            <td colspan="3"></td>
                        </tr> -->
                    </table>
                    <table class="table table-bordered table-condensed"  id="History_all_table">
				                        		
				    </table>
				    
                </form>  
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        </div>
        </div>
    </div>
</div>

<!-- 补录Modal -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="blue">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>补录项目</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline">
                        <table class="table table-bordered">
                        	<!-- <tr>
                        		<td style="width:25%;">发票编号</td>
                        		<td style="width:75%;"><input type="text" id="fp_no" class="form-control" style="width:80%;"></td>
                        	</tr> -->
                        	<tr>
                                <td>项目名称  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                    <!-- <select class="form-control" style="width:70%;" id="prj_name">
                                    </select> -->  
                                    <input type="text" class="form-control" id="prj_name_bl"  style="width:70%;" disabled>
                               		<button type="button" class="btn btn-primary"  id="chosexm_bl">选择</button>  
                                </td>
                                <td>任务单号</td>
                                <td>
                                	<select class="form-control" style="width:70%;" id="prj_no_bl">
                                    </select>
                                </td>
                            </tr>
                        </table>
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-success"  onclick="saveBule()">保存</button>
        </div>
        </div>
    </div>
</div>
<!-- model结束 -->
<!-- Modal项目 -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="xiangmumd_bl">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>选择项目</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline">
                        <table class="table table-bordered table-condensed" style="width:100%;" id="xiangmubiao_bl">
                            <thead>
                            	<tr>
                            		<th></th>
                            		<th>编号</th>
                                    <th>项目名称</th>
                                    <th>项目所属公司</th>
                                    <th>项目类型</th>
                                    <th>甲方单位</th>
                            	</tr>
                            </thead>
                            <tbody>
                                
                            </tbody>
                        </table> 
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-success" id="quedingxm_bl">保存</button>
        </div>
        </div>
    </div>
</div>
<!-- model项目结束 -->

<!-- Modal合同扫描件开始 -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="addSaoMiaohtModel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>合同扫描件</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form id="new_form" class="form-inline" method="post" enctype="multipart/form-data">
                        <table class="table table-bordered table-condensed">
		                	<tr >
		                		<td style="width:15%;">合同扫描件文件名</td>
		                		<td style="width:35%;">
		                			<input type="file" id="saomiaofileUrl" name="file" class="form-control" style="width:75%;" multiple="multiple">
		                			<!--<button type="button" style="margin-left: 5px;" class="btn btn-primary" id="chosexm">选择文件</button>-->
		                		</td>
		                		
		                	</tr>
		            	</table>
                    </form> 
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-primary" onclick="savesaomiaohetongjian(this)">上传文件</button>
        </div>
        </div>
    </div>
</div>
<!-- model结束 合同扫描件 -->
</body>
<script src="../../js/jquery.js"></script>
<script src="../../js/common-scripts.js"></script>
<script src="../../js/bootstrap.min.js"></script>
<script src="../../js/laydate/laydate.js"></script>
<script src="../../js/jquery-editable-select.js"></script> 
<script src="../../js/jquery-form.min.js"></script>
<script src="../../toastr/toastr.js"></script>
<script src="../../js/bootstrap-select.js"></script>
<script src="../../js/quanxian.js"></script>

<script src="../../js/datatables/jquery.dataTables.min.js"></script>
<script src="../../js/datatables/dataTables.colVis.min.js"></script>
<script src="../../js/datatables/dataTables.tableTools.min.js"></script>
<!-- <script src="../../js/datatables/dataTables.bootstrap.min.js"></script> -->
<script src="../../js/datatables/datatables.responsive.min.js"></script>
<script src="../../js/datatables/dataTables.buttons.min.js" ></script>
<script src="../../js/datatables/buttons.html5.min.js" ></script>
<script src="../../js/datatables/buttons.flash.min.js" ></script>
<script src="../../js/datatables/jszip.min.js"></script>

<script src="../../select/js/select2.min.js"></script>
<script src="../../js/SmartNotification.min.js"></script>
<script src="../../js/myTool.js"></script>

<script>
    $(document).ready( function () {
    	initTable();
    	$("[aria-label*='审批状态']").trigger("click");
    	//初始化部門
    	selectDepartment();
    	//初始化乙方單位
    	inityifang();
    	//初始化任务单
    	initPrj();
    	//初始化甲方
    	initFenGs();
        laydate.render({
            elem: '#year' //指定元素
        });
        laydate.render({
            elem: '#xgyear' //指定元素
        });
        laydate.render({
            elem: '#seach_time_min' //指定元素
        });
        laydate.render({
            elem: '#seach_time_max' //指定元素
        });
    	
        $("#sousuodiv").hide();//超级搜索折叠div
        
	});
    
  //超级搜索折叠div
    var zhediepanduan=true;
    $("#zhedieBtn").click(function(){
    	if(zhediepanduan==true){
    		$("#sousuodiv").show(300);
    		zhediepanduan=false;
    	}else{
    		$("#sousuodiv").hide(300);
    		zhediepanduan=true;
    	}
    })
    
    $.fn.dataTable.Buttons.swfPath = '../../js/datatables/swf/flashExport.swf';
    var table=$('#mainContent').DataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 10,
        "sDom": 
			"t"+
			"<'dt-toolbar-footer'<'col-sm-6 col-xs-12 hidden-xs'i><'col-xs-12 col-sm-6'p>>",
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
            { "data": null}, 
            { "data": "cgoNo"},
            { "data": "contractName"}, 
            { "data": "cgocType"}, 
            { "data": "spName"}, 
            { "data": "cgoContractMoney",render: $.fn.dataTable.render.number( ',', '.', 2, '' )}, 
            { "data": "contractSignTime"},
            { "data": "starterName"},
            { "data": "status"},
            { "data": "status"},
        ],
        "columnDefs": [			{
									 "class": "tcenter",
								     "targets": 8,
								     "searchable": true,
								     "render": function(data, type, full) {
								    	 if(data=='2'){
									    		return '<span class="label label-success state">审批结束</span>';
								    	}else if(data=='1'){
								    		return '<span class="label label-info state">审批中</span>';
								    	}else if(data=='3'){
								    		return '<span class="label label-danger state">终止</span>';
								    	}else{
								    		return '';
								    	}
						            }
						          },
								{	
								 "class": "tcenter",
								    "targets": 9,
								    "searchable": true,
								    "render": function(data, type, full) {
								    	var html='<i class="iconfont icon-icon-test Pecacbb" style="font-size:20px;cursor:pointer;margin-left:5px;display:none;" title="查看详细信息" onclick="lookCgC(this)" data-toggle="modal" data-target="#allMsg1"   id="lookDetall"></i>'
								    		+'<i class="iconfont icon-xiugai iconxiugai Pecacbc" style="font-size:20px;cursor:pointer;margin-left:5px;display:none;" title="合同变更" onclick="checkCgC(this)" data-toggle="modal" data-target="#change"  id="Changedanwei"></i>'
								    		+'<i class="iconfont icon-arrow chongqi Pecacbe" style="font-size:20px;cursor:pointer;display:none;margin-left:5px;" title="重启" onclick="openModal3(this)"></i>'
								    		+'<i class="iconfont icon-tuichu iconzhongzhi Pecacbd" style="font-size:20px;cursor:pointer;margin-left:5px;display:none;" title="采购合同取消"  onclick="openModal2(this)"></i>'
								    		+'<i class="iconfont icon-kaibiao Pecacbb" style="font-size:18px;cursor:pointer;display:none;" title="补录扫描合同件"  onclick="addsaomiaohetongjian(this)"></i>';
								    	if(full.workNo==""||full.workNo==null){								  	  		 
								  	  		html+='<i class="iconfont icon-icon_edit bulu" style="font-size:18px;cursor:pointer;display:none;" title="补录项目" onclick="buluxiangmu(this)"></i>';
								  	  		return html;
								    	}else{
								    		return html;
								    	}
								  	  	
								        
								    	
								    }
								  }
						],
        "order": [[0, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
        "fnDrawCallback"  : function(){
          　　this.api().column(0).nodes().each(function(cell, i) {
          　　　　cell.innerHTML =  i + 1;
         });
	        $.ajax({
	     		type:"post",
	     		url:getContextPath()+"/login/getUser",
	     		async:false,
	     		data:{
	     		},
	     		success:function(json){
	     			
	     			if(json!=null &&json!=""){
	     				var arr = json.uPermissions.split(',');
	     				for(var i=0;i<arr.length;i++){
	     					var arr2 = arr[i].replace("+","");
	     					if(arr[i].indexOf("Pecacbb") >= 0 ){
	     						$(".Pecacbb").show();
	     						$(".bulu").show();
	     					}
	     					if(arr[i].indexOf("Pecacbc") >= 0 ){
	     						$(".Pecacbc").show();
	     						$(".bulu").show();
	     					}
	     					if(arr[i].indexOf("Pecacbd") >= 0 ){
	     						$(".Pecacbd").show();
	     						$(".bulu").show();
	     					}
	     				}
	     			}
	     		}
	     	});
        },
        "buttons": [
		        	{
		                extend: "csv",
		                text: "导出csv",
		                bom: true,
		                filename: '其他采购合同',
		                fieldSeparator: ',',
		                exportOptions: {
		                	format: {
		                        header: function ( data) {
		                            return data;
		                        },
		                        body: function ( data, columnIdx, rowIdx, code ) {
					                return data;
					            }
		                    },
		                    columns:[1,2,3,4,5,6]
		                }
		            }
		        ]
	});
    
    $(".hasinput").on( 'change', function () {
        table
            .column( $(this).parent().index()+':visible' )
            .search( this.value )
            .draw(false);
    } );
 
 
  table.buttons().container().appendTo( $('#tabBtn') );
   $('.buttons-csv').addClass('btn btn-primary');
    
    <!-- 历史表格 -->
    var table2=$('#lookHistory').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 5,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
            { "data": "cgoNo"}, 
            { "data": "contractName"}, 
            { "data": "cgocType"}, 
            { "data": "makeTime"}, 
        ],
        "columnDefs": [
						{	
								 "class": "tcenter",
								    "targets": 4,
								    "searchable": true,
								    "render": function(data, type, full) {
								  	  		return '<i class="iconfont icon-icon-test" style="font-size:20px;cursor:pointer;" title="查看详细信息" onclick="lookHistoryDetails(this)" data-toggle="modal" data-target="#History"   id="lookDetall"></i>'
								        }
								  }
						],
        "order": [[1, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
	});

    var tablexm=$('#xiangmubiao').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 5,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
					{ "data": null},
		            { "data": "prjNo"},
		            { "data": "prjName"},
		            { "data": "prjCompany"},
		            { "data": "prjType2"},
		            { "data": "ccName"},
		            
		        ],
		        "columnDefs": [
								{
										 "class": "tcenter",
										    "targets": 0,
										    "searchable": true,
										    "render": function(data, type, full) {
										  	  		return '<input type="radio" name="xiangmuName" style="width:16px;height:16px;">'
										        }
										  }
								],
        "order": [[1, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
	});
    var tablexmxg=$('#xgxiangmubiao').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 5,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
					{ "data": null},
		            { "data": "prjNo"}, 
		            { "data": "prjName"},
		            { "data": "prjCompany"}, 
		            { "data": "prjType2"},
		            { "data": "ccName"},
		        ],
		        "columnDefs": [
								{	
										 "class": "tcenter",
										    "targets": 0,
										    "searchable": true,
										    "render": function(data, type, full) {
										  	  		return '<input type="radio" name="xgxiangmuName" style="width:16px;height:16px;">'
										        }
										  }
								],
        "order": [[1, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
        
	});
    var table3_bl=$('#xiangmubiao_bl').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 5,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
					{ "data": null},
		            { "data": "prjNo"},
		            { "data": "prjName"},
		            { "data": "prjCompany"},
		            { "data": "prjType2"},
		            { "data": "ccName"},
		            
		        ],
		        "columnDefs": [
								{
										 "class": "tcenter",
										    "targets": 0,
										    "searchable": true,
										    "render": function(data, type, full) {
										  	  		return '<input type="radio" name="xiangmuName_bl" style="width:16px;height:16px;">'
										        }
										  }
								],
        "order": [[1, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
        
	});

	function initTable(){
        $.ajax({
            type: 'POST',
            url:getContextPath()+'/cgOtherContract/selectCgOtherContractByStatus2',
            dataType: 'json',
            data: {
            	
            },
            success: function (json) {
                $('#mainContent').dataTable().fnClearTable();
                $('#mainContent').DataTable().rows.add(json).draw(false);
            }
        });
    }
	
	/* 初始化任务单号，项目名称 以及承接编号 承接名称 change事件 */
    function initPrj(){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/task/selectPrjNameAndWorkNo',
            dataType: 'json',
            data: {
            },
            error: function (msg) {
            	toastr.error("请求失败");
            },
            success: function (json) {
            	$("#prj_no_bl").empty();
                for(var i=0;i<json.length;i++){
                	//$("#prj_name").append("<option value="+json[i].prjName+">"+json[i].prjName+"</option>");
                	//$("#prj_no").append("<option value="+json[i].prjNo+">"+json[i].prjNo+"</option>");
                	$("#prj_no_bl").append("<option value="+json[i].prjNo+">"+json[i].prjNo+"</option>");
                }
		        /* $('#prj_no').editableSelect().on('select.editable-select', function (e, dom) {
		          		$.ajax({
		                    type: 'POST',
		                    url: getContextPath()+'/task/selectCjByTaskNo',
		                    dataType: 'json',
		                    data: {
		                    	no:$('#prj_no').val()
		                    },
		                    success: function (json) {
		                    	var task=json.task;
		                    	var cj=json.cj;
		                    	$('#prj_name').val(task.prjName);
		                    	$("#cj_name").val(cj[0].contractName);
		                    	$("#cj_no").val(cj[0].contractNo);
				  		}
	            	})
				}) */
				
				$('#prj_no_bl').editableSelect().on('select.editable-select', function (e, dom) {
		          		$.ajax({
		                    type: 'POST',
		                    url: getContextPath()+'/task/selectCjByTaskNo',
		                    dataType: 'json',
		                    data: {
		                    	no:$('#prj_no_bl').val()
		                    },
		                    success: function (json) {
		                    	var task=json.task;
		                    	var cj=json.cj;
		                    	$('#prj_name_bl').val(task.prjName);
		                    	$("#cj_name_bl").val(cj[0].contractName);
		                    	$("#cj_no_bl").val(cj[0].contractNo);
				  		}
	            	})
				})
            }
    	})
    }
	
	//选择项目
	$("#chosexm_bl").click(function(){
		$("#xiangmumd_bl").modal("show");
		 $.ajax({
	            type: 'POST',
	            url: getContextPath()+'/task/selectPrjNameAndWorkNo',
	            dataType: 'json',
	            async:false,
	            data: {
	            },
	            success: function (json) {
	            	//console.log(json)
	                $('#xiangmubiao_bl').dataTable().fnClearTable();
	                $('#xiangmubiao_bl').DataTable().rows.add(json).draw(false);
	            }
	        });
	})

	$("#quedingxm_bl").click(function(){
		var tr=$("input[name='xiangmuName_bl']:checked").parents("tr");
  		var data=$("#xiangmubiao_bl").DataTable().row(tr).data();
		$("#prj_name_bl").val(data.prjName);
		$("#prj_no_bl").val(data.prjNo);
		$("#xiangmumd_bl").modal("hide");
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/task/selectCjByTaskName',
            dataType: 'json',
            data: {
            	name:$('#prj_name_bl').val()
            },
            success: function (json) {
            	var task=json.task;
            	var cj=json.cj;
            	$('#prj_no_bl').val(task.prjNo);
            	$("#cj_name_bl").val(cj[0].contractName);
            	$("#cj_no_bl").val(cj[0].contractNo);
            }
  		})
	})
	
	
	function saveBule(){
		var prj_name_bl=$('#prj_name_bl').val()
		var prj_no_bl=$('#prj_no_bl').val();

		 $.ajax({
				type:"POST",
				url:getContextPath()+"/cgOtherContract/updatePrjNameAndNoById",
				dataType:"json",
				data:{ 
					cgoId:data_bl.cgoId,
					workNo:prj_no_bl,
					prjName:prj_name_bl,
				},
				success:function(json){
					if(json>0){
						data_bl.workNo=prj_no_bl;
						data_bl.prjName=prj_name_bl;
						$("#mainContent").DataTable().row(tr_bl).data(data_bl).draw(false);
						toastr.success("补录成功")
						$("#blue").modal("hide");
					}else{
						toastr.error("补录失败")
					}
				}
			}) 
	 }
	
	//初始化
    /* $(".zhuangtai").change(function(){
        var zt=$(".zhuangtai").val();
        if(zt=="审批结束"){
        	$.ajax({
                type: 'POST',
                url: getContextPath()+'/cgOtherContract/selectCgOtherContractByStatus',
                dataType: 'json',
                data: {
                	status:2,
                },
                success: function (json) {
                    $('#mainContent').dataTable().fnClearTable();
                    $('#mainContent').DataTable().rows.add(json).draw(false);
                    $(".chongqi").hide();
                    $(".iconxiugai").show();
                    $(".iconzhongzhi").show();
                    $(".iconlywj").show();
                    $(".icon-icon_edit").show()
                }
            });
            
        }else if(zt=="合同取消"){
        	$.ajax({
                type: 'POST',
                url: getContextPath()+'/cgOtherContract/selectCgOtherContractByStatus',
                dataType: 'json',
                data: {
                	status:3,
                },
                success: function (json) {
                    $('#mainContent').dataTable().fnClearTable();
                    $('#mainContent').DataTable().rows.add(json).draw(false);
                    $(".chongqi").show();
                    $(".iconxiugai").hide();
                    $(".iconzhongzhi").hide();
                    $(".iconlywj").hide();
                    $(".icon-icon_edit").hide()
                }
            });
            
        }else if(zt=="审批中"){
        	$.ajax({
                type: 'POST',
                url: getContextPath()+'/cgOtherContract/selectCgOtherContractByStatus',
                dataType: 'json',
                data: {
                	status:1,
                },
                success: function (json) {
                    $('#mainContent').dataTable().fnClearTable();
                    $('#mainContent').DataTable().rows.add(json).draw(false);
                    $(".chongqi").hide();
                	$(".iconxiugai").hide();
                	$(".iconzhongzhi").hide();
                    $(".iconlywj").hide();
                    $(".icon-icon_edit").hide()
                }
            });
        	
        }
    })
     */
    //初始化甲方
    function initFenGs(){
  		$.ajax({
            type: 'POST',
            url: getContextPath()+'/job/selectAllJobLv',
            dataType: 'json',
            data: {
            },
            success: function (json) {
            	 $("#hetongjiafang").html("");
            	 $("#xghetongjiafang").html("");
                 for(var i=0;i<json.length;i++){
                 	$("#hetongjiafang").append("<option value='"+json[i].jobLvName+"'>"+json[i].jobLvName+"</option>")
                 	$("#xghetongjiafang").append("<option value='"+json[i].jobLvName+"'>"+json[i].jobLvName+"</option>")
                 }
            }
      });
  	 }
    
    //计算税金
    function getRateMoney(obj){
		var shuilv=$(obj).val();
		var money=$("#cghetongMoney").val();
		if(money==''||money==null){
    		toastr.error('采购合同金额为空');
    		$(obj).val('');
    		return;
    	}
		var sum=shuilv/1*money/1;
    	$("#shuijin").val(sum);
	}
    
	function xggetRateMoney(obj){
		var xgshuilv=$(obj).val();
		var xgmoney=$("#xgcghetongMoney").val();
		if(xgmoney==''||xgmoney==null){
    		toastr.error('采购合同金额为空');
    		$(obj).val('');
    		return;
    	}
		var sum=xgshuilv/1*xgmoney/1;
    	$("#xgshuijin").val(sum);
	}
	
    //初始化部门
    function selectDepartment(){
    	$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/organizationManagement/getAllOrganizationManagement',
	        dataType: 'json',
	        data: {
	           
	        },
	        success: function (json) {
	        	//console.log(json)
        		 $("#cg_bumen").empty();
        		$("#xgcg_bumen").empty();
	        	 for(var i=0;i<json.length;i++){
	        		$("#cg_bumen").append("<option value="+json[i].omName+" selected>"+json[i].omName+"</option>")
	        		$("#xgcg_bumen").append("<option value="+json[i].omName+" selected>"+json[i].omName+"</option>")
	        	} 
	        }
	    });
	}
    
  //初始化材料单位
    function selectMaterialCompany(obj){
    	$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/MaterialCompany/getAllMaterialCompany',
	        dataType: 'json',
	        data: {
	        },
	        success: function (json) {
	        	//console.log(json)
	        	for(var i=0;i<json.length;i++){
            		$("#cl_dw"+obj).append("<option value="+json[i].mcName+">"+json[i].mcName+"</option>");
            		$("#edit_cl_dw"+obj).append("<option value="+json[i].mcName+">"+json[i].mcName+"</option>");
            	}
	        }
	    });
	}
	
    //选择项目
	$("#chosexm").click(function(){
		$('#xiangmumd').on('hidden.bs.modal', function () {//解决模态框页面滚动问题
            if ($('.modal.in').size() >= 1) {
                $('body').addClass('modal-open')
            }
        })
		 $.ajax({
	            type: 'POST',
	            url: getContextPath()+'/task/selectPrjNameAndWorkNo',
	            dataType: 'json',
	            data: {
	            },
	            success: function (json) {
	                $('#xiangmubiao').dataTable().fnClearTable();
	                $('#xiangmubiao').DataTable().rows.add(json).draw(false);
	                $("#xiangmumd").modal("show");
	            }
	        });
	})
    
	$("#quedingxm").click(function(){
		var tr=$("input[name='xiangmuName']:checked").parents("tr");
		var data=$('#xiangmubiao').DataTable().row(tr).data();
		//console.log(data)
		$("#prjName").val(data.prjName);
		$("#task_no").val(data.prjNo);
		//$("#prjName").append("<option value="+data.prjName+" selected>"+data.prjName+"</option>")
		//$("#task_no").append("<option value="+data.prjNo+" selected>"+data.prjNo+"</option>")
		$("#xiangmumd").modal("hide");
	})
		var tr_bl;
	var data_bl;
	function buluxiangmu(obj){
		tr_bl=$(obj).parents("tr");
		data_bl=$("#mainContent").DataTable().row(tr_bl).data();
		//console.log(data_bl)
		$('#prj_name_bl').val(data_bl.prjName)
		$('#prj_no_bl').val(data_bl.workNo);
    	$("#blue").modal("show");
	}
	
	function saveBule(){
		var prj_name_bl=$('#prj_name_bl').val()
		var prj_no_bl=$('#prj_no_bl').val();
		 $.ajax({
				type:"POST",
				url:getContextPath()+"/cgOtherContract/updatePrjNameAndNoById",
				dataType:"json",
				data:{ 
					cgoId:data_bl.cgoId,
					workNo:prj_no_bl,
					prjName:prj_name_bl,
				},
				success:function(json){
					if(json>0){
						data_bl.workNo=prj_no_bl;
						data_bl.prjName=prj_name_bl;
						$("#mainContent").DataTable().row(tr_bl).data(data_bl).draw(false);
						toastr.success("补录成功")
						$("#blue").modal("hide");
					}else{
						toastr.error("补录失败")
					}
				}
			}) 
	 }
	
	$("#xgchosexm").click(function(){
		 $.ajax({
	            type: 'POST',
	            url: getContextPath()+'/task/selectPrjNameAndWorkNo',
	            dataType: 'json',
	            async:false,
	            data: {
	            },
	            success: function (json) {
	            	$("#xgxiangmumd").modal("show");
	                $('#xgxiangmubiao').dataTable().fnClearTable();
	                $('#xgxiangmubiao').DataTable().rows.add(json).draw(false);
	            }
	        });
		   $('#xgxiangmumd').on('hidden.bs.modal', function () {//解决模态框页面滚动问题
	            if ($('.modal.in').size() >= 1) {
	                $('body').addClass('modal-open')
	            }
	        })
	})
	$("#xgquedingxm").click(function(){
		var tr=$("input[name='xgxiangmuName']:checked").parents("tr");
		var data=$('#xgxiangmubiao').DataTable().row(tr).data();
		/* var prjName=$("input[name='xgxiangmuName']:checked").parent().next().next().text();
		var prjNo=$("input[name='xgxiangmuName']:checked").parent().next().text();
		var jiafang=$("input[name='xgxiangmuName']:checked").parent().next().next().next().next().next().text(); */
		$("#xgprjName").val(data.prjName);
		$("#xgtask_no").val(data.prjNo);
		//$("#xgprjName").append("<option value="+data.prjName+" selected>"+data.prjName+"</option>")
		//$("#xgtask_no").append("<option value="+data.prjNo+" selected>"+data.prjNo+"</option>")
		//$("#xgcg_bumen").val(data.omName)
		$("#xgxiangmumd").modal("hide");
		 
	})
	
    function initSupplier2(obj,obj2,obj3){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/supplier/selectIdAndName',
            dataType: 'json',
            async:false,
            data: {
            	
            },
            success: function (json) {
            	for(var i=0;i<json.length;i++){
            		$("#department_tj"+obj).append("<option value="+json[i].spId+">"+json[i].spName+"</option>");
            		$("#company_sure"+obj).append("<option value="+json[i].spId+">"+json[i].spName+"</option>");
            	}
            	$.fn.modal.Constructor.prototype.enforceFocus = function () { }
           	 $("#department_tj"+obj).select2({
                    tags: true,
                    placeholder: '请搜索或选择语言',
                    allowClear: true,
                });
           	 $.fn.modal.Constructor.prototype.enforceFocus = function () { }
                $("#company_sure"+obj).select2({
                    tags: true,
                    placeholder: '请搜索或选择语言',
                    allowClear: true,
                });
                if(obj2!=undefined && obj3!=undefined){
             	   $("#department_tj"+obj).val(obj2).select2()
             	   $("#company_sure"+obj).val(obj3).select2()
                }
            }
  		});
    }
    function initClType2(obj){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/MaterialType/selectMaterialType',
            dataType: 'json',
            data: {
            },
            success: function (json) {
            	for(var i=0;i<json.length;i++){
            		$("#cl_type"+obj).append("<option value="+json[i].materialType+">"+json[i].materialType+"</option>");
            		$("#edit_cl_type"+obj).append("<option value="+json[i].materialType+">"+json[i].materialType+"</option>");
            	}
            }
  		});
    }

    function initSupplier3(obj,obj2,obj3){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/supplier/selectIdAndName',
            dataType: 'json',
            data: {
            	
            },
            success: function (json) {
            	for(var i=0;i<json.length;i++){
            		$("#edit_department_tj"+obj).append("<option value="+json[i].spId+">"+json[i].spName+"</option>");
            		$("#edit_company_sure"+obj).append("<option value="+json[i].spId+">"+json[i].spName+"</option>");
            	}
            	$.fn.modal.Constructor.prototype.enforceFocus = function () { }
              	 $("#edit_department_tj"+obj).select2({
                       tags: true,
                       placeholder: '请搜索或选择语言',
                       allowClear: true,
                   });
                   $("#edit_company_sure"+obj).select2({
                       tags: true,
                       placeholder: '请搜索或选择语言',
                       allowClear: true,
                   });
                   if(obj2!=undefined && obj3!=undefined){
                	   $("#edit_department_tj"+obj).val(obj2).select2()
                	   $("#edit_company_sure"+obj).val(obj3).select2()
                   }
            	
            }
  		});
    }
      

	$("#prjName").change(function(){
		var name=$('#prjName').val()
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/task/selectTaskPrjNo',
            dataType: 'json',
            data: {
            	prjName:name
            },
            success: function (json) {
            	for(var i=0;i<json.length;i++){
	                $('#task_no').val(json[i].prjNo);
            	}
            }
  		});
	})
	$("#task_no").on("change",function(){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/task/selectTaskPrjName',
            dataType: 'json',
            data: {
            	prjNo:$('#task_no').val()
            },
            success: function (json) {
            	for(var i=0;i<json.length;i++){
                	$('#prjName').val(json[i].prjName);
            	}
            }
  		});
    })
	
	function removeThis(obj){
    	var tr=$(obj).parent().parent();
    	$(tr).remove();
    	toastr.success("移除成功");
	}
	
	 function initMaterialCompany(obj1,obj2){
	    	$.ajax({
		        type: 'POST',
		        url: getContextPath()+'/MaterialCompany/getAllMaterialCompany',
		        dataType: 'json',
		        data: {
		        },
		        success: function (json) {
		        	//console.log(json)
		        	$("#cl_danwei"+obj2).empty();
            		$("#xgcl_danwei"+obj2).empty();
		        	for(var i=0;i<json.length;i++){
	            		$("#cl_danwei"+obj2).append("<option value="+json[i].mcName+">"+json[i].mcName+"</option>");
	            		$("#xgcl_danwei"+obj2).append("<option value="+json[i].mcName+">"+json[i].mcName+"</option>");
	            	}
		        	$("#cl_danwei"+obj2).val(obj1);
            		$("#xgcl_danwei"+obj2).val(obj1);
		        }
		    });
		}
	
	function initClType(obj1,obj2){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/MaterialType/selectMaterialType',
            dataType: 'json',
            data: {
            },
            success: function (json) {
            	$("#cl_type"+obj2).empty();
            	$("#xgcl_type"+obj2).empty();
            	for(var i=0;i<json.length;i++){
            		$("#cl_type"+obj2).append("<option value="+json[i].materialType+">"+json[i].materialType+"</option>");
            		$("#xgcl_type"+obj2).append("<option value="+json[i].materialType+">"+json[i].materialType+"</option>");
            	}
            	$("#cl_type"+obj2).val(obj1)
            	$("#xgcl_type"+obj2).val(obj1)
            }
  		});
    }
	//初始化供应商
	function initName1(obj1,obj2){
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/supplier/selectIdAndName',
            dataType: 'json',
            data: {

            },
            success: function (json) {
            	$("#xm"+obj2).empty();
            	$("#xgxm"+obj2).empty();
            	$("#edit_department_tj"+obj2).empty()
                for(var i=0;i<json.length;i++){
                	$("#xm"+obj2).append("<option value="+json[i].spId+">"+json[i].spName+"</option>");
                	$("#xgxm"+obj2).append("<option value="+json[i].spId+">"+json[i].spName+"</option>");
                	$("#edit_department_tj"+obj2).append("<option value="+json[i].spId+">"+json[i].spName+"</option>");
                }
                $("#xm"+obj2).val(obj1);
                $("#xgxm"+obj2).val(obj1);
                $("#edit_department_tj"+obj2).val(obj1);
                $.fn.modal.Constructor.prototype.enforceFocus = function () { }
                $("#xm"+obj2).select2({
	                 tags: true,
	                 placeholder: '请搜索或选择语言',
	                 allowClear: true
	             });
                $("#xgxm"+obj2).select2({
	                 tags: true,
	                 placeholder: '请搜索或选择语言',
	                 allowClear: true
	             });
                $("#edit_department_tj"+obj2).select2({
	                 tags: true,
	                 placeholder: '请搜索或选择语言',
	                 allowClear: true
	             });
            }
		});
	}
	function initName2(obj1,obj2){
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/supplier/selectIdAndName',
            dataType: 'json',
            data: {

            },
            success: function (json) {
            	$("#gs"+obj2).empty();
            	$("#xggs"+obj2).empty();
            	$("#edit_company_sure"+obj2).empty();
                for(var i=0;i<json.length;i++){
                	$("#gs"+obj2).append("<option value="+json[i].spId+">"+json[i].spName+"</option>");
                	$("#xggs"+obj2).append("<option value="+json[i].spId+">"+json[i].spName+"</option>");
                	$("#edit_company_sure"+obj2).append("<option value="+json[i].spId+">"+json[i].spName+"</option>");
                }
                $("#gs"+obj2).val(obj1);
                $("#xggs"+obj2).val(obj1);
                $("#edit_company_sure"+obj2).val(obj1);
                $.fn.modal.Constructor.prototype.enforceFocus = function () { }
                $("#gs"+obj2).select2({
	                 tags: true,
	                 placeholder: '请搜索或选择语言',
	                 allowClear: true
	             });
                $("#xggs"+obj2).select2({
	                 tags: true,
	                 placeholder: '请搜索或选择语言',
	                 allowClear: true
	             });
                $("#edit_company_sure"+obj2).select2({
	                 tags: true,
	                 placeholder: '请搜索或选择语言',
	                 allowClear: true
	             });
            }
		});
	}

	
	$("#xgprjName").change(function(){
		var name=$('#xgprjName').val()
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/task/selectTaskPrjNo',
            dataType: 'json',
            data: {
            	prjName:name
            },
            success: function (json) {
            	for(var i=0;i<json.length;i++){
	                $('#xgtask_no').val(json[i].prjNo);
            	}
            }
  		});
	})
	$("#xgtask_no").on("change",function(){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/task/selectTaskPrjName',
            dataType: 'json',
            data: {
            	prjNo:$('#xgtask_no').val()
            },
            success: function (json) {
            	for(var i=0;i<json.length;i++){
                	$('#xgprjName').val(json[i].prjName);
            	}
            }
  		});
    })
	
	//初始化乙方
    function inityifang(){
	    $.ajax({
	        type: 'POST',
	        url: getContextPath()+'/supplier/selectIdAndName',
	        dataType: 'json',
	        data: {
	        },
	        success: function (json) {
	        	$("#yifang").html('');
	        	$("#xgyifang").html('');
	        	 for(var i=0;i<json.length;i++){
	        		$("#yifang").append( "<option value='" + json[i].spId + "'>"
		                    + json[i].spName + "</option>")
		            $("#xgyifang").append( "<option value='" + json[i].spId + "'>"
		                    + json[i].spName + "</option>")
	        	}
	        	 $.fn.modal.Constructor.prototype.enforceFocus = function () { }
	        	 $("#yifang").select2({
	                 tags: true,
	                 placeholder: '请搜索或选择语言',
	                 allowClear: true
	             });
	             $("#xgyifang").select2({
	                 tags: true,
	                 placeholder: '请搜索或选择语言',
	                 allowClear: true
	             });
	        }
	    });
	}
	
	function clearP(){
		$("#myModal input").val("");
		$("#hetonggaishu").val("");
	}
	
	//填报保存
	function saveCg(){
		var cghetongming=$("#cghetongming").val();
		var task_no=$("#task_no").val();
		var prjName=$("#prjName").val();
		var cghetongType=$("#cghetongType").val();
		var cghetongMoney=$("#cghetongMoney").val();
		var hetongjiafang=$("#hetongjiafang").val();
		var yifang=$("#yifang").val();
		var fukuangfangshi=$("#fukuangfangshi").val();
		var year=$("#year").val();
		var hetonggaishu=$("#hetonggaishu").val();
		var gaikuang=$("#gaikuang").val();
		var cg_bumen=$("#cg_bumen").val();
		var yunfei=$("#yunfei").val();;
		var shuilv=$("#shuilv").val();
		var shuijin=$("#shuijin").val();

		if(cghetongming==''){
			toastr.error("采购合同名称不能为空");
			return;
		}
		var cgOtherContract={
				 cgoId:undefined,   //编号                   
				 contractName:undefined,   // 采购合同名称      
				 cgoNo:undefined,   //采购合同编号               
				 workNo:undefined,   // 任务单号              
				 prjName:undefined,   //项目名称              
				 cgocType:undefined,   // 采购合同类型              
				 cgoContractMoney:0,   // 采购合同金额    
				 contractNameJia:undefined,   // 合同甲方名称   
				 contractNameYi:undefined,   // 乙方        
				 payMode:undefined,   // 付款方式             
				 contractSignTime:undefined,   // 采购合同签订时间
				 contractSummary:undefined,   // 采购合同概述   
				 workContent:undefined,   // 主要概况及工作内容    
				 makeTime:undefined,    //当前时间            
				 history:undefined,   //历史状态              
				 cgoDepartment:undefined,
				 freight:0,
				 shuilv:0,
				 shuijin:0,
		}
		cgOtherContract.contractName=cghetongming;
		cgOtherContract.workNo=task_no;
		cgOtherContract.prjName=prjName;
		cgOtherContract.cgocType=cghetongType;
		cgOtherContract.cgoContractMoney=cghetongMoney;
		cgOtherContract.contractNameJia=hetongjiafang;
		cgOtherContract.contractNameYi=yifang;
		cgOtherContract.payMode=fukuangfangshi;
		cgOtherContract.contractSignTime=year;
		cgOtherContract.contractSummary=hetonggaishu;
		cgOtherContract.workContent=gaikuang;
		cgOtherContract.cgoDepartment=cg_bumen;
		cgOtherContract.freight=yunfei;
		cgOtherContract.shuilv=shuilv;
		cgOtherContract.shuijin=shuijin;
		//console.log(cgOtherContract)
		var formData = new FormData();
  		formData.append("cgOtherContract", JSON.stringify(cgOtherContract));
  		
  		$("#new_accessory tbody").find("tr").each(function(){
  			formData.append("file", $(this).find("input")[0].files[0]);
  		})
  		
  		$("#new_accessory1 tbody").find("tr").each(function(){
  			formData.append("file1", $(this).find("input")[0].files[0]);
  		})
  		
  		showMask();
  		$.ajax({
	  			type: 'POST',
	            url: getContextPath()+'/cgOtherContract/addCgoContractSave',
	            data: formData,  
	            processData: false,
	            contentType: false,
	            error:function(json){
	            	toastr.error("保存失败");
	            	location.reload();
	            },
	            success: function (json) {
	            	if(json>0){
	            		clearP();
	            		$("#myModal").modal("hide");
	            		toastr.success("保存成功");
	            		//location.reload([true]);
	            	}else{
	            		toastr.error("保存失败");
	            	}
	            	hidMask();
	            }
	  		}) 
	}
	
	//填报提交
	function submitCg(){
		var cghetongming=$("#cghetongming").val();
		var task_no=$("#task_no").val();
		var prjName=$("#prjName").val();
		var cghetongType=$("#cghetongType").val();
		var cghetongMoney=$("#cghetongMoney").val();
		var hetongjiafang=$("#hetongjiafang").val();
		var yifang=$("#yifang").val();
		var fukuangfangshi=$("#fukuangfangshi").val();
		var year=$("#year").val();
		var hetonggaishu=$("#hetonggaishu").val();
		var gaikuang=$("#gaikuang").val();
		var cg_bumen=$("#cg_bumen").val();
		var yunfei=$("#yunfei").val();
		var shuilv=$("#shuilv").val();
		var shuijin=$("#shuijin").val();

		if(cghetongming==''){
			toastr.error("采购合同名称不能为空");
			return;
		}
		if(cghetongType==''){
			toastr.error("采购合同类型不能为空");
			return;
		}
		if(prjName==''){
			toastr.error("项目名称不能为空");
			return;
		} 
		/* if(task_no==''){
			toastr.error("任务单号不能为空");
			return;
		} */
		if(hetongjiafang==''){
			toastr.error("合同甲方名称不能为空");
			return;
		}
		if(yifang==''){
			toastr.error("乙方不能为空");
			return;
		}
		if(cghetongMoney==0){
			toastr.error("采购合同金额不能为0");
			return;
		}
		if($("#new_accessory").find('tbody tr').length<1 || $("#file").val()==''){
			toastr.error("采购合同文本附件为空")
			return;
		} 
		/* if($("#new_accessory1").find('tbody tr').length<1 || $("#file1").val()==''){
			toastr.error("法律顾问签字附件为空")
			return;
		} */
		var reg=/^\d+(\.\d{0,2})?$/;//只能输入数字或含两位小数的正则
		if(yunfei==""||!reg.test(yunfei)){
			toastr.error("运费只能输入数字且只能有两位小数");
			return;
		} 
		var reg=/^[0-1]{1}([.]([0-9]){1,2})?$/;
		if(shuilv==''||!reg.test(shuilv)){
			toastr.error("税率不能为空且税率只能填0-1之间的小数且只能有两位小数")
			return;
		}
		if(shuijin==''){
			toastr.error("税金不能为空")
			return;
		}
		
		var cgOtherContract={
				 cgoId:undefined,   //编号                   
				 contractName:undefined,   // 采购合同名称      
				 cgoNo:undefined,   //采购合同编号               
				 workNo:undefined,   // 任务单号              
				 prjName:undefined,   //项目名称              
				 cgocType:undefined,   // 采购合同类型           
				 cgoContractMoney:0,   // 采购合同金额    
				 contractNameJia:undefined,   // 合同甲方名称   
				 contractNameYi:undefined,   // 乙方        
				 payMode:undefined,   // 付款方式             
				 contractSignTime:undefined,   // 采购合同签订时间
				 contractSummary:undefined,   // 采购合同概述   
				 workContent:undefined,   // 主要概况及工作内容    
				 makeTime:undefined,    //当前时间            
				 history:undefined,   //历史状态              
				 cgoDepartment:undefined,
				 freight:0,
				 shuilv:0,
				 shuijin:0,
		}
		cgOtherContract.contractName=cghetongming;
		cgOtherContract.workNo=task_no;
		cgOtherContract.prjName=prjName;
		cgOtherContract.cgocType=cghetongType;
		cgOtherContract.cgoContractMoney=cghetongMoney;
		cgOtherContract.contractNameJia=hetongjiafang;
		cgOtherContract.contractNameYi=yifang;
		cgOtherContract.payMode=fukuangfangshi;
		cgOtherContract.contractSignTime=year;
		cgOtherContract.contractSummary=hetonggaishu;
		cgOtherContract.workContent=gaikuang;
		cgOtherContract.cgoDepartment=cg_bumen;
		cgOtherContract.freight=yunfei;
		cgOtherContract.shuilv=shuilv;
		cgOtherContract.shuijin=shuijin;
		
		var formData = new FormData();
  		formData.append("cgOtherContract", JSON.stringify(cgOtherContract));
  		
  		$("#new_accessory tbody").find("tr").each(function(){
  			formData.append("file", $(this).find("input")[0].files[0]);
  		})
  		
  		$("#new_accessory1 tbody").find("tr").each(function(){
  			formData.append("file1", $(this).find("input")[0].files[0]);
  		})
  		$.ajax({
	  			type: 'POST',
	            url: getContextPath()+'/cgOtherContract/addCgoContractSubmit',
	            data: formData,  
	            processData: false,
	            contentType: false,
	            dataType: 'json',
	            success: function (json) {
	            	if(json=='-1'){
	            		toastr.error("请刷新页面后重新登录");
	            	}else if(json=='0'){
		        		toastr.error("保存失败");
		        	}else{
		        		clearP();
		        		$("#myModal").modal("hide")
		        		lianjie=json.url;
		            	if(json.receiver!=null&&json.receiver.length>=1){
			        		  $("#tijiaogei").modal('show');
			        		  $("#tijiaoren tbody").empty("");
			        		  for(var i=0;i<json.receiver.length;i++){
			        			  $("#tijiaoren tbody").append('<tr><td>'
			        					  +'<input type="radio" name="tijiaorenming" data-id="'+json.receiver[i].userId+'" data-id2="'+json.receiver[i].omId+'" data-id3="'+json.receiver[i].dutyId+'">'
			        					  +'</td><td>'
			        					  +json.receiver[i].omName
			        					  +'</td><td>'
			        					  +json.receiver[i].dutyName
			        					  +'</td><td>'
			        					  +json.receiver[i].uName
			        					  +'</td></tr>');
			        		  }
			        	  }else if(json.receiver.length==1){
			        		  $.ajax({
			        	          type: 'POST',
			        	          url: getContextPath()+'/task/addTask4',
			        	          dataType: 'json',
			        	          data:{
			        	        	  url:json.url,
			        	        	  userId:json.receiver.userId,
			        	        	  uName:json.receiver.uName,
			        	        	  omName:json.receiver.omName,
			        	        	  dutyName:json.receiver.dutyName,
			        	        	  omId:json.receiver.omId,
			        	        	  dutyId:json.receiver.dutyId
			        	          },
			        	          success: function (json) {
			        	        	  toastr.success('提交成功');
			        	          }
			        	      }); 
			        	  }
		        	}
	            	/* if(json>0){
	            		$("#myModal").modal("hide")
	            		toastr.success("保存成功")
	            		//location.reload([true]);
	            	}else{
	            		toastr.error("保存失败")
	            	} */
	            }
	  		})
	}
	
	
	var modal2Tr;
  	function openModal2(obj){
  		modal2Tr=$(obj).parents("tr");
  		$("#myModal2").modal("show");
  	}
	
	function submitCgCancel(){
		var stopReason=$("#cancel_reason").val();
  		var data=$("#mainContent").DataTable().row(modal2Tr).data();
  		var cgName=data.contractName;
  		var cgoDepartment=data.cgoDepartment;
  		var id=data.cgoId;
  		$.ajax({
				type: 'POST',
		        url: getContextPath()+'/cgOtherContract/submitCgoCancel',
	            dataType: 'json',
		     	data: {
		     		stopReason:stopReason,
		     		id:id,
		     		cgName:cgName,
		     		cgoDepartment:cgoDepartment,
		     	},  
		        success: function (json) {
		        	if(json=='0'){
		        		toastr.error("保存失败");
		        	}else{
		        		$("#myModal2").modal("hide");
		        		lianjie=json.url;
		            	if(json.receiver!=null&&json.receiver.length>=1){
			        		  $("#tijiaogei").modal('show');
			        		  $("#tijiaoren tbody").empty("");
			        		  for(var i=0;i<json.receiver.length;i++){
			        			  $("#tijiaoren tbody").append('<tr><td>'
			        					  +'<input type="radio" style="width:20px;height:20px;" name="tijiaorenming" data-id="'+json.receiver[i].userId+'" data-id2="'+json.receiver[i].omId+'" data-id3="'+json.receiver[i].dutyId+'">'
			        					  +'</td><td>'
			        					  +json.receiver[i].omName
			        					  +'</td><td>'
			        					  +json.receiver[i].dutyName
			        					  +'</td><td>'
			        					  +json.receiver[i].uName
			        					  +'</td></tr>');
			        		  }
			        	  }else if(json.receiver.length==1){
			        		  $.ajax({
			        	          type: 'POST',
			        	          url: getContextPath()+'/task/addTask4',
			        	          dataType: 'json',
			        	          data:{
			        	        	  url:json.url,
			        	        	  userId:json.receiver.userId,
			        	        	  uName:json.receiver.uName,
			        	        	  omName:json.receiver.omName,
			        	        	  dutyName:json.receiver.dutyName,
			        	        	  omId:json.receiver.omId,
			        	        	  dutyId:json.receiver.dutyId
			        	          },
			        	          success: function (json) {
			        	        	  toastr.success('提交成功');
			        	          }
			        	      }); 
			        	  }
		        	}
		        }
		})
	}
	
	var modal3Tr;
  	function openModal3(obj){
  		modal3Tr=$(obj).parents("tr");
  		var data=$("#mainContent").DataTable().row(modal3Tr).data();
  		$.ajax({
			type: 'POST',
	        url: getContextPath()+'/ContractReason/selectContractReasonById',
            dataType: 'json',
	     	data: {
	     		id:data.cgoId
	     	},  
	        success: function (json) {
	        	$("#look_cancel_reason").val(json.stopReason);
	        	$("#myModal3").modal("show");
	        }
  		});
  		
  	}
  	
  	
  	function submitCgRestart(){
  		var stopReason=$("#cancel_reason").val();
  		var data=$("#mainContent").DataTable().row(modal2Tr).data();
  		var cgName=data.contractName;
  		var cgoDepartment=data.cgoDepartment;
  		var id=data.cgoId;
  		$.ajax({
				type: 'POST',
		        url: getContextPath()+'/cgOtherContract/submitCgoRestart',
	            dataType: 'json',
		     	data: {
		     		stopReason:stopReason,
		     		id:id,
		     		cgName:cgName,
		     		cgoDepartment:cgoDepartment,
		     	},  
		        success: function (json) {
		        	if(json=='0'){
		        		toastr.error("保存失败");
		        	}else{
		        		$("#myModal3").modal("hide");
		        		lianjie=json.url;
		            	if(json.receiver!=null&&json.receiver.length>=1){
			        		  $("#tijiaogei").modal('show');
			        		  $("#tijiaoren tbody").empty("");
			        		  for(var i=0;i<json.receiver.length;i++){
			        			  $("#tijiaoren tbody").append('<tr><td>'
			        					  +'<input type="radio" style="width:20px;height:20px;" name="tijiaorenming" data-id="'+json.receiver[i].userId+'" data-id2="'+json.receiver[i].omId+'" data-id3="'+json.receiver[i].dutyId+'">'
			        					  +'</td><td>'
			        					  +json.receiver[i].omName
			        					  +'</td><td>'
			        					  +json.receiver[i].dutyName
			        					  +'</td><td>'
			        					  +json.receiver[i].uName
			        					  +'</td></tr>');
			        		  }
			        	  }else if(json.receiver.length==1){
			        		  $.ajax({
			        	          type: 'POST',
			        	          url: getContextPath()+'/task/addTask4',
			        	          dataType: 'json',
			        	          data:{
			        	        	  url:json.url,
			        	        	  userId:json.receiver.userId,
			        	        	  uName:json.receiver.uName,
			        	        	  omName:json.receiver.omName,
			        	        	  dutyName:json.receiver.dutyName,
			        	        	  omId:json.receiver.omId,
			        	        	  dutyId:json.receiver.dutyId
			        	          },
			        	          success: function (json) {
			        	        	  toastr.success('提交成功');
			        	          }
			        	      }); 
			        	  }
		        	}
		        }
		})
  	}
	
	function submitPerson(){
  		var uid=$("input[name='tijiaorenming']:checked").attr("data-id");
  	  var omid=$("input[name='tijiaorenming']:checked").attr("data-id2");
  	  var dutyid=$("input[name='tijiaorenming']:checked").attr("data-id3");
  	  var bmmc=$("input[name='tijiaorenming']:checked").parent().next().text();
  	  var zw=$("input[name='tijiaorenming']:checked").parent().next().next().text();
  	  var uname=$("input[name='tijiaorenming']:checked").parent().next().next().next().text();
  	  //var uname=$("input[name='tijiaorenming']:checked").val();
  	  $.ajax({
            type: 'POST',
            url: getContextPath()+'/task/addTask4',
            dataType: 'json',
            data:{
          	  url:lianjie,
          	  userId:uid,
          	  uName:uname,
          	  omName:bmmc,
          	  dutyName:zw,
          	  omId:omid,
          	  dutyId:dutyid
            },
            success: function (json) {
          	  toastr.success('提交成功');
            }
        });  
  	}
	
	//修改回显
	var editId;
	var xm;
	var gs;
	function checkCgC(obj){
		var dom=$(obj).parents('tr');
		var data=$('#mainContent').DataTable().row(dom).data();
		//console.log(data)
		editId=data.cgoId;
		$.ajax({
			type:"post",
			url:getContextPath()+"/cgOtherContract/selectCgoContractById",
			dataType:"json",
			async:false,
			data:{
				id:editId,
			},
			success:function(json){
				//console.log(json)
				$("#xgcghetongming").val(json.contractName);
				$("#xgcgoNo").val(json.cgoNo)
				$("#xgtask_no").val(json.workNo);
				$("#xgprjName").val(json.prjName);    		
				$("#xgcghetongType").val(json.cgocType);
				$("#xgcghetongMoney").val(json.cgoContractMoney);
				$("#xghetongjiafang").val(json.contractNameJia);
				$("#xgyifang").val(json.contractNameYi).select2();
				$("#xgfukuangfangshi").val(json.payMode);
				$("#xgyear").val(json.contractSignTime);
				$("#xghetonggaishu").val(json.contractSummary);
				$("#xggaikuang").val(json.workContent);
				$("#xgcg_bumen").val(json.cgoDepartment);
				$("#xgyunfei").val(json.freight)
				$("#xgshuilv").val(json.shuilv);
				$("#xgshuijin").val(json.shuijin);
			}
		}) 
	}
	
	
	
	function huixianPrjNameAndNo(obj1,obj2,obj3){
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/PrjMaterialBuy/selectBuyByIds',
            dataType: 'json',
            data: {
            	ids:obj1
            },
            success: function (json) {
            	$("#xgprjName").empty()
            	$("#xgtask_no").empty()
            	for(var i=0;i<json.length;i++){
            		$("#xgprjName").append("<option value="+json[i].applyPrj+">"+json[i].applyPrj+"</option>")
            		$("#xgtask_no").append("<option value="+json[i].applyCode+">"+json[i].applyCode+"</option>")
            	}
            	$("#xgprjName").val(obj2)
            	$("#xgtask_no").val(obj3)
            }
		});
		
	}
	
	
	//删除附件
	function deletefile(obj){
		var id=$(obj).attr("data1");
		var name=$(obj).parents("tr").find("td").eq(1).find("input").val();
		var url=$(obj).attr("data2");
		$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/cgOtherContract/deleteAccessory',
	        dataType: 'json',
	        data: {
	        	aId:id,
	        	acName:name,
	        	acUrl:url
	        },
	        success: function (json) {
	        	if(json==0){
	        		toastr.error("删除失败");
	        	}else{
	        		toastr.success("删除成功");
	        		$(obj).parent().parent().remove();
	        		//$('#change').modal('hide');
	        	}
	        }
		});
	}
	
	
	//修改保存
	function checksaveCgC(){
		
		var xgcghetongming=$("#xgcghetongming").val();
		var xgcgoNo=$("#xgcgoNo").val();
		var xgtask_no=$("#xgtask_no").val();
		var xgprjName=$("#xgprjName").val();
		var xgcghetongType=$("#xgcghetongType").val();
		var xgcghetongMoney=$("#xgcghetongMoney").val();
		var xghetongjiafang=$("#xghetongjiafang").val();
		var xgyifang=$("#xgyifang").val();
		var xgfukuangfangshi=$("#xgfukuangfangshi").val();
		var xgyear=$("#xgyear").val();
		var xghetonggaishu=$("#xghetonggaishu").val();
		var xggaikuang=$("#xggaikuang").val();
		var xgcg_bumen=$("#xgcg_bumen").val()
		var xgyunfei=$("#xgyunfei").val();
		var xgshuilv=$("#xgshuilv").val();
		var xgshuijin=$("#xgshuijin").val();
		
		if(xgcghetongming==''){
			toastr.error("采购合同名称为空");
			return;
		}
		
		var cgOtherContract={
				 cgoId:undefined,   //编号                   
				 contractName:undefined,   // 采购合同名称      
				 cgoNo:undefined,   //采购合同编号                  
				 workNo:undefined,   // 任务单号              
				 prjName:undefined,   //项目名称                       
				 cgocType:undefined,   // 采购合同类型           
				 cgoContractMoney:0,   // 采购合同金额    
				 contractNameJia:undefined,   // 合同甲方名称   
				 contractNameYi:undefined,   // 乙方        
				 payMode:undefined,   // 付款方式             
				 contractSignTime:undefined,   // 采购合同签订时间
				 contractSummary:undefined,   // 采购合同概述   
				 workContent:undefined,   // 主要概况及工作内容    
				 makeTime:undefined,    //当前时间            
				 history:undefined,   //历史状态              
				 cgoDepartment:undefined,
				 freight:0,
				 shuilv:0,
				 shuijin:0,
		}
		cgOtherContract.contractName=xgcghetongming;
		cgOtherContract.cgoNo=xgcgoNo;
		cgOtherContract.workNo=xgtask_no;
		cgOtherContract.prjName=xgprjName;
		cgOtherContract.cgocType=xgcghetongType;
		cgOtherContract.cgoContractMoney=xgcghetongMoney;
		cgOtherContract.contractNameJia=xghetongjiafang;
		cgOtherContract.contractNameYi=xgyifang;
		cgOtherContract.payMode=xgfukuangfangshi;
		cgOtherContract.contractSignTime=xgyear;
		cgOtherContract.contractSummary=xghetonggaishu;
		cgOtherContract.workContent=xggaikuang;
		cgOtherContract.cgoDepartment=xgcg_bumen;
		cgOtherContract.freight=xgyunfei;
		cgOtherContract.shuilv=xgshuilv;
		cgOtherContract.shuijin=xgshuijin;
		
		var formData = new FormData();
 		formData.append("cgOtherContract", JSON.stringify(cgOtherContract));
 		
 		$("#edit_accessory tbody").find("tr").each(function(){
 			formData.append("file", $(this).find("input")[0].files[0]);
 		})
 		
 		$("#edit_accessory1 tbody").find("tr").each(function(){
 			formData.append("file1", $(this).find("input")[0].files[0]);
 		})
		showMask();
		 $.ajax({
	            type: 'POST',
	            url: getContextPath()+'/cgOtherContract/updateCgoContractSave',
	            data: formData,  
	            processData: false,
	            contentType: false,
	            dataType: 'json',
	            success: function (json) {
	            	if(json==0){
						toastr.error("修改失败")
					}else if(json>0){
						//location.reload([true]);
						toastr.success("修改成功")
						$("#change").modal("hide")
					}
	            	hidMask();
	            }
	        });  
			
	}
	
	
	//修改提交
	function checksubmitCgC(){

		var xgcghetongming=$("#xgcghetongming").val();
		var xgcgoNo=$("#xgcgoNo").val();
		var xgtask_no=$("#xgtask_no").val();
		var xgprjName=$("#xgprjName").val();
		var xgcghetongType=$("#xgcghetongType").val();
		var xgcghetongMoney=$("#xgcghetongMoney").val();
		var xghetongjiafang=$("#xghetongjiafang").val();
		var xgyifang=$("#xgyifang").val();
		var xgfukuangfangshi=$("#xgfukuangfangshi").val();
		var xgyear=$("#xgyear").val();
		var xghetonggaishu=$("#xghetonggaishu").val();
		var xggaikuang=$("#xggaikuang").val();
		var xgcg_bumen=$("#xgcg_bumen").val()
		var xgyunfei=$("#xgyunfei").val();
		var xgshuilv=$("#xgshuilv").val();
		var xgshuijin=$("#xgshuijin").val();
		
		if(xgcghetongming==''){
			toastr.error("采购合同名称为空");
			return;
		}
		if(xgcghetongType==''){
			toastr.error("采购合同类型不能为空");
			return;
		}
		if(xgprjName==''){
			toastr.error("项目名称不能为空");
			return;
		} 
		/* if(xgtask_no==''){
			toastr.error("任务单号不能为空");
			return;
		} */
		if(xghetongjiafang==''){
			toastr.error("合同甲方名称不能为空");
			return;
		}
		if(xgyifang==''){
			toastr.error("乙方不能为空");
			return;
		}
		/* if(xgcghetongMoney==''){
			toastr.error("采购合同金额为空");
			return;
		} */
		if(xgcghetongMoney==0){
			toastr.error("采购合同金额不能为0");
			return;
		}
		if($("#edit_accessory").find('tbody tr').length<1 || $("#xgfile").val()==''){
			toastr.error("采购合同文本附件为空")
			return;
		}
		/* if($("#edit_accessory1").find('tbody tr').length<1 || $("#xgfile1").val()==''){
			toastr.error("法律顾问签字附件为空")
			return;
		} */
		var reg=/^\d+(\.\d{0,2})?$/;//只能输入数字或含两位小数的正则
		if(xgyunfei==""||!reg.test(xgyunfei)){
			toastr.error("运费只能输入数字且只能有两位小数");
			return;
		} 
		var reg=/^[0-1]{1}([.]([0-9]){1,2})?$/;
		if(xgshuilv==''||!reg.test(xgshuilv)){
			toastr.error("税率不能为空且税率只能填0-1之间的小数且只能有两位小数")
			return;
		}
		if(xgshuijin==''){
			toastr.error("税金不能为空")
			return;
		}
		
		var cgOtherContract={
				 cgoId:undefined,   //编号                   
				 contractName:undefined,   // 采购合同名称      
				 cgoNo:undefined,   //采购合同编号               
				 workNo:undefined,   // 任务单号              
				 prjName:undefined,   //项目名称                      
				 cgocType:undefined,   // 采购合同类型            
				 cgoContractMoney:0,   // 采购合同金额    
				 contractNameJia:undefined,   // 合同甲方名称   
				 contractNameYi:undefined,   // 乙方        
				 payMode:undefined,   // 付款方式             
				 contractSignTime:undefined,   // 采购合同签订时间
				 contractSummary:undefined,   // 采购合同概述   
				 workContent:undefined,   // 主要概况及工作内容    
				 makeTime:undefined,    //当前时间            
				 history:undefined,   //历史状态                  
				 cgoDepartment:undefined,
				 freight:0,
				 shuilv:0,
				 shuijin:0,
		}
		cgOtherContract.contractName=xgcghetongming;
		cgOtherContract.cgoNo=xgcgoNo;
		cgOtherContract.workNo=xgtask_no;
		cgOtherContract.prjName=xgprjName;
		cgOtherContract.cgocType=xgcghetongType;
		cgOtherContract.cgoContractMoney=xgcghetongMoney;
		cgOtherContract.contractNameJia=xghetongjiafang;
		cgOtherContract.contractNameYi=xgyifang;
		cgOtherContract.payMode=xgfukuangfangshi;
		cgOtherContract.contractSignTime=xgyear;
		cgOtherContract.contractSummary=xghetonggaishu;
		cgOtherContract.workContent=xggaikuang;
		cgOtherContract.cgoDepartment=xgcg_bumen;
		cgOtherContract.freight=xgyunfei;
		cgOtherContract.shuilv=xgshuilv;
		cgOtherContract.shuijin=xgshuijin;
		
		var formData = new FormData();
 		formData.append("cgOtherContract", JSON.stringify(cgOtherContract));
 		
 		$("#edit_accessory tbody").find("tr").each(function(){
 			formData.append("file", $(this).find("input")[0].files[0]);
 		})
 		
 		$("#edit_accessory1 tbody").find("tr").each(function(){
 			formData.append("file1", $(this).find("input")[0].files[0]);
 		})
		
		$.ajax({
	            type: 'POST',
	            url: getContextPath()+'/cgOtherContract/updateCgoContractSubmit',
	            data: formData,  
	            processData: false,
	            contentType: false,
	            dataType: 'json',
	            success: function (json) {
	            	if(json=='0'){
		        		toastr.error("保存失败");
		        	}else{
		        		$("#change").modal("hide");
		        		lianjie=json.url;
		            	if(json.receiver!=null&&json.receiver.length>=1){
			        		  $("#tijiaogei").modal('show');
			        		  $("#tijiaoren tbody").empty("");
			        		  for(var i=0;i<json.receiver.length;i++){
			        			  $("#tijiaoren tbody").append('<tr><td>'
			        					  +'<input type="radio" style="width:20px;height:20px;" name="tijiaorenming" data-id="'+json.receiver[i].userId+'" data-id2="'+json.receiver[i].omId+'" data-id3="'+json.receiver[i].dutyId+'">'
			        					  +'</td><td>'
			        					  +json.receiver[i].omName
			        					  +'</td><td>'
			        					  +json.receiver[i].dutyName
			        					  +'</td><td>'
			        					  +json.receiver[i].uName
			        					  +'</td></tr>');
			        		  }
			        	  }else if(json.receiver.length==1){
			        		  $.ajax({
			        	          type: 'POST',
			        	          url: getContextPath()+'/task/addTask4',
			        	          dataType: 'json',
			        	          data:{
			        	        	  url:json.url,
			        	        	  userId:json.receiver.userId,
			        	        	  uName:json.receiver.uName,
			        	        	  omName:json.receiver.omName,
			        	        	  dutyName:json.receiver.dutyName,
			        	        	  omId:json.receiver.omId,
			        	        	  dutyId:json.receiver.dutyId
			        	          },
			        	          success: function (json) {
			        	        	  toastr.success('提交成功');
			        	          }
			        	      }); 
			        	  }
		        	}
	            }
	        }); 
	}
	
	
	
	//查看详细信息
	var cgoNo;
	var LookcgoId;
	function lookCgC(obj){
		var dom=$(obj).parents('tr');
		var data=$('#mainContent').DataTable().row(dom).data();
		cgoNo=data.cgoNo;
		LookcgoId=data.cgoId;
		initTableHistory();
		
		$.ajax({
			type:"post",
			url:getContextPath()+"/cgOtherContract/selectCgoContractById",
			dataType:"json",
			data:{
				id:data.cgoId,
			},
			success:function(json){
				$("#lookcghetongming").text(json.contractName);
				$("#lookcgoNo").text(json.cgoNo);
				$("#lookcgbianhao").text(json.cgoId)
				
				$("#looktask_no").html("");
				if(json.workNo==""||json.workNo==null){
					$("#looktask_no").text(json.workNo);
				}else{
					var taskprjNoClick = '<a href="../chankanxiangqing/taskDetails.html?prjNo='
						+json.workNo
						+'" target="_blank" style="color:blue;">'+json.workNo+'</a>';		
					$("#looktask_no").append(taskprjNoClick);
				}
				
				//$("#looktask_no").text(json.workNo);
				$("#lookprjName").html("")
				if(json.workNo==""||json.workNo==null){
					$("#lookprjName").text(json.prjName);
				}else{
					var taskprjNoClick = '<a href="../chankanxiangqing/taskDetails.html?prjNo='
		    			+json.workNo
		    			+'" target="_blank" style="color:blue;">'+json.prjName+'</a>';		
					$("#lookprjName").append(taskprjNoClick);
				}
				//$("#lookprjName").text(json.prjName)
				$("#lookcgType").text(json.cgocType);
				$("#lookcghetongMoney").text(json.cgoContractMoney==null?"":json.cgoContractMoney);
				$("#lookjiafang").text(json.contractNameJia==null?"":json.contractNameJia);
				$("#lookyifang").text(json.spName==null?"":json.spName);
				$("#lookfukuanfangshi").text(json.payMode==null?"":json.payMode);
				$("#lookyear").text(json.contractSignTime==null?"":json.contractSignTime);
				$("#lookcghetonggaishu").text(json.contractSummary==null?"":json.contractSummary);
				$("#lookgaikuang").text(json.workContent==null?"":json.workContent);
				$("#lookcg_bumen").text(json.cgoDepartment);
				$("#lookyunfei").text(json.freight==null?"":json.freight);
				$("#look_shuilv").text(json.shuilv==null?"":json.shuilv);
				$("#look_shuijin").text(json.shuijin==null?"":json.shuijin);
			
			}
		})
		
		$.ajax({
			type:"post",
			url:getContextPath()+"/cgOtherContract/selectAccessoryById",
			dataType:"json",
			async:false,
			data:{
				id:data.cgoId,
			},
			success:function(json){
				$("#look_all_table").empty();
	            for(var i=0;i<json.length;i++){
	            	   if(json[i].aType=="采购合同文本"){
		            	   $("#look_all_table").append("<tr>"+
	      	   										"<td style='width:20%;'>采购合同文本</td>"+
	      	   										"<td colspan='3'><a href='"+getLocalPath()+"/oa_file/"+json[i].acUrl+"' target='view_window' style='color:blue'>"+json[i].acName+"</a></td>"+  	    
							            	    "</tr>");
	            	   }
	            	   if(json[i].aType=="合同扫描件"){
		            	   $("#look_all_table").append("<tr>"+
	      	   										"<td style='width:20%;'>合同扫描件</td>"+
	      	   										"<td colspan='3'><a href='"+getLocalPath()+"/oa_file/"+json[i].acUrl+"' target='view_window' style='color:blue'>"+json[i].acName+"</a></td>"+							            	    	
							            	    "</tr>");
		            	   }

	               }
			}
		})
		
		$.ajax({
        	type: 'POST',
            url: getContextPath()+'/flowHistory/getHistoryNowAndLastByModeId',
            data:{
            	id:data.cgoId
            },
            success: function (json) {
            	$("#d_table tbody").html('');
            	for(var i=0;i<json.length;i++){
            		var operatorType = json[i].operateType;
            		operatorType = getCnByOt(operatorType);
            		var date = json[i].doDate;
            		var title = json[i].title;
            		var name = json[i].actorname;
            		if(date == null){
            			date="";
            			if(json[i].operateType==8){
            				title="<lable style='color:red'>"+json[i].title+"</lable>";
            				name="<lable style='color:red'>"+json[i].actorname+"</lable>";
            				operatorType="<lable style='color:red'>"+operatorType+"</lable>";
            			}else{
            				title = json[i].title;
            				name = json[i].actorname;
            			}
            		}
                	$("#d_table tbody").append("<tr><td>"+title+"</td><td>"+name+"</td><td></td><td>"+operatorType+"</td><td>"+date+"</td></tr>");
            	}
            }
        });
		
	}
	
	function getCnByOt(s){
		  if(s==1){
			  return "提交";
		  }else if(s==2){
			  return "退回";
		  }else if(s==3){
			  return "撤销";
		  }else if(s==0){
			  return "驳回";
		  }else if(s==8){
			  return "待审批";
		  }
	  }
	
	function getLocalPath(){
		var pathArray = window.location.pathname.split('/');
		var secondLevelLocation = pathArray[1];
		var loginUrl = window.location.protocol + "//"  + window.location.host ;
		return loginUrl;
	}
	
	//下载附件
	function download_all(obj){
		var url=$(obj).attr("data1");
		var name=$(obj).parents("tr").find("td").eq(1).find("input").val();
		
		window.location.href=encodeURI(getContextPath()+"/FileDownLoad?fileName="+name+"&filePath="+url);
	}
	
	//初始化历史列表
	function initTableHistory(){
        $.ajax({
            type: 'POST',
            url: getContextPath()+'/cgOtherContract/selectHistoryByNo',
            dataType: 'json',
            data: {
            	cgoNo:cgoNo,
            },
            error: function (msg) {
                errMessage("请求失败");
            },
            success: function (json) {
                $('#lookHistory').dataTable().fnClearTable();
                $('#lookHistory').DataTable().rows.add(json).draw(false);
            }
        });
    }
	
	//超级链接
	 function GetQueryString(name){
        var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if(r!=null)return  unescape(r[2]); return null;
   }
	// 调用方法
   	id=GetQueryString("prjId");
   	no=GetQueryString("prjNo");
   	//var title = decodeURI(id)
   	if(id!=null&&no!=null){
   		$("#allMsg1").modal("show");
   		var cgoNo;
   		$.ajax({
			type:"POST",
			url:getContextPath()+"/cgOtherContract/selectByCgoNo",
			dataType:"json",
			async:false,
			data:{
				no:no
				},
			success:function(json){
				var data=json;
				cgoNo=data.cgoNo;
				initTableHistory();
				
				$("#lookcghetongming").text(data.contractName);
				$("#lookcgoNo").text(data.cgoNo);
				$("#lookcgbianhao").text(data.cgoId)
				$("#looktask_no").text(data.workNo);
				$("#lookprjName").text(data.prjName)
				$("#lookcgType").text(data.cgocType);
				$("#lookcghetongMoney").text(data.cgoContractMoney);
				$("#lookjiafang").text(data.contractNameJia);
				$("#lookyifang").text(data.spName);
				$("#lookfukuanfangshi").text(data.payMode);
				$("#lookyear").text(data.contractSignTime);
				$("#lookcghetonggaishu").text(data.contractSummary);
				$("#lookgaikuang").text(data.workContent);
				
				if(list!=null){
					$("#lookcghetongMoney").val("");
					for(var i=0;i<list.length;i++){
						//console.log(list[i])
				  		$.ajax({
				            type: 'POST',
				            url: getContextPath()+'/PrjMaterialBuy/selectBuyByIds',
				            dataType: 'json',
				            data: {
				            	ids:list.toString()
				            },
				            success: function (json) {
				            	//console.log(json)
				            	for(var i=0;i<json.length;i++){
				            		var omName=json[i].omName
				            		var sumPrice=json[i].sumPrice;
				            		var pmbId=json[i].pmbId;
				            		$("#lookcgbumen"+i+"").text(json[i].omName)
				            		$("#lookcgbumen"+i+"").attr("dataId",pmbId)
				            		$("#lookbumencgMoney"+i+"").text(json[i].sumPrice)
				            		
				            		$.ajax({
				                        type: 'POST',
				                        url: getContextPath()+'/cgOtherContract/getMdById',
				                        dataType: 'json',
				                        async:false,
				                        data: {
				                        	id:pmbId
				                        },
				                        success: function (json) {
				                        	//console.log(json)
				                        	for(var k=0;k<json.length;k++){
				                        		$("#lookcailiaobiao"+i+" tbody").append("<tr dataId="+json[k].mdlId+"><td>"
				                		  				+""+json[k].materialName+""
				                		  				+"</td><td>"
				                		  				+""+json[k].materialType+""
				                		  				+"</td><td>"
				                		  				+""+json[k].modeType+""
				                		  				+"</td><td>"
				                		  				+""+json[k].buyCompany+""
				                		  				+"</td><td>"
				                		  				+""+json[k].num+""
				                		  				+"</td><td>"
				                		  				+""+json[k].price+""
				                		  				+"</td><td>"
				                		  				+""+json[k].price+""
				                		  				+"</td><td>"
				                		  				+""+json[k].infos+""
				                		  				+"</td></tr>")
				                        	} 
				                        }
				              		});
				            		
				            	}
				            }
				  		});
				  		
			  		}
				}
				
				$.ajax({
					type:"post",
					url:getContextPath()+"/cgOtherContract/selectAccessoryById",
					dataType:"json",
					async:false,
					data:{
						id:data.cgoId,
					},
					success:function(json){
						$("#look_all_table").empty();
						//$("#look_all_table1").empty();
			            for(var i=0;i<json.length;i++){
			            	   if(json[i].aType=="采购合同文本"){
				            	   $("#look_all_table").append("<tr>"+
			      	   										"<td style='width:20%;'>采购合同文本</td>"+
			      	   										"<td colspan='3'><a href='"+getLocalPath()+"/oa_file/"+json[i].acUrl+"' target='view_window' style='color:blue'>"+json[i].acName+"</a></td>"+
									            	    	/* "<td colspan='2'><input type='text' class='form-control' style='width:100%;' value='"+json[i].acName+"' disabled></td>"+
									            	    	"<td><button type='button' class='btn btn-primary' data1='"+json[i].acUrl+"' onclick='download_all(this)'>下载附件</button></td>"+ */
									            	    "</tr>");
			            	   }
			            	   /* if(json[i].aType=="法律顾问签字"){
				            	   $("#look_all_table1").append("<tr>"+
			      	   										"<td>法律顾问签字</td>"+
									            	    	"<td colspan='2'><input type='text' class='form-control' style='width:100%;' value='"+json[i].acName+"' disabled></td>"+
									            	    	"<td><button type='button' class='btn btn-primary' data1='"+json[i].acUrl+"' onclick='download_all(this)'>下载附件</button></td>"+
									            	    "</tr>");
			            	   } */
			               }
					}
				})
			}
		}) 
   	}
	//查看历史信息的详细信息
	function lookHistoryDetails(obj){
		var dom=$(obj).parents('tr');
		var data=$('#lookHistory').DataTable().row(dom).data();
		$('#History').on('hidden.bs.modal', function () {//解决模态框页面滚动问题
            if ($('.modal.in').size() >= 1) {
                $('body').addClass('modal-open')
            }
        })
		
        $.ajax({
			type:"post",
			url:getContextPath()+"/cgOtherContract/selectCgoContractById",
			dataType:"json",
			data:{
				id:data.cgoId,
			},
			success:function(json){
				$("#Historycghetongming").text(json.contractName);
				$("#HistorycgoNo").text(json.cgoNo==null?"":json.cgoNo);
				$("#Historycgbianhao").text(json.cgoId==null?"":json.cgoId)
				$("#Historytask_no").text(json.workNo==null?"":json.workNo);
				$("#HistoryprjName").text(json.prjName==null?"":json.prjName)
				$("#HistorycgType").text(json.cgocType==null?"":json.cgocType);
				$("#HistorycghetongMoney").text(json.cgoContractMoney==null?"":json.cgoContractMoney);
				$("#Historyjiafang").text(json.contractNameJia==null?"":json.contractNameJia);
				$("#Historyyifang").text(json.spName==null?"":json.spName);
				$("#Historyfukuanfangshi").text(json.payMode==null?"":json.payMode);
				$("#Historyyear").text(json.contractSignTime==null?"":json.contractSignTime);
				$("#Historycghetonggaishu").text(json.contractSummary==null?"":json.contractSummary);
				$("#Historygaikuang").text(json.workContent==null?"":json.workContent);
				$("#Historycg_bumen").text(json.cgoDepartment==null?"":json.cgoDepartment);
				$("#Historyyunfei").text(json.freight);
						
			}
		})    
		
		$.ajax({
			type:"post",
			url:getContextPath()+"/cgOtherContract/selectAccessoryById",
			dataType:"json",
			async:false,
			data:{
				id:data.cgoId,
			},
			success:function(json){
				$("#History_all_table").empty();
				//$("#History_all_table1").empty();
	               for(var i=0;i<json.length;i++){
	            	   if(json[i].aType=="采购合同文本"){
		            	   $("#History_all_table").append("<tr>"+
	      	   										"<td style='width:20%;'>采购合同文本</td>"+
	      	   										"<td colspan='3'><a href='"+getLocalPath()+"/oa_file/"+json[i].acUrl+"' target='view_window' style='color:blue'>"+json[i].acName+"</a></td>"+
							            	    	/* "<td colspan='2'><input type='text' class='form-control' style='width:100%;' value='"+json[i].acName+"' disabled></td>"+
							            	    	"<td><button type='button' class='btn btn-primary' data1='"+json[i].acUrl+"' onclick='download_all(this)'>下载附件</button></td>"+ */
							            	    "</tr>");
	            	   }
	            	   if(json[i].aType=="合同扫描件"){
		            	   $("#look_all_table").append("<tr>"+
	      	   										"<td style='width:20%;'>合同扫描件</td>"+
	      	   										"<td colspan='3'><a href='"+getLocalPath()+"/oa_file/"+json[i].acUrl+"' target='view_window' style='color:blue'>"+json[i].acName+"</a></td>"+
							            	    	/* "<td colspan='2'><input type='text' class='form-control' style='width:100%;' value='"+json[i].acName+"' disabled></td>"+
							            	    	"<td><button type='button' class='btn btn-primary' data1='"+json[i].acUrl+"' onclick='download_all(this)'>下载附件</button></td>"+ */
							            	    "</tr>");
		            	   }
	            	   /* if(json[i].aType=="法律顾问签字"){
		            	   $("#History_all_table1").append("<tr>"+
	      	   										"<td>法律顾问签字</td>"+
							            	    	"<td colspan='2'><input type='text' class='form-control' style='width:100%;' value='"+json[i].acName+"' disabled></td>"+
							            	    	"<td><button type='button' class='btn btn-primary' data1='"+json[i].acUrl+"' onclick='download_all(this)'>下载附件</button></td>"+
							            	    "</tr>");
	            	   } */
	               }
			}
		})
		
	}
	
	
	
	
	//点击填报采购合同时默认添加的一个附件
	/*function newFile(){
		$("#new_accessory tbody").html('');
		$("#new_accessory tbody").append("<tr><td>新附件</td><td><input type='file' name='file' id='file'><td style='width:150px;'></td></tr>")
		 
	} */
	
	function addFile(){
		$("#new_accessory tbody").append("<tr><td>新附件</td><td><input type='file' name='file' id='file' style='width:70%;' class='form-control'></td><td style='width:150px;'><button type='button' class='btn btn-danger' onclick='removeFile(this)'>移除附件</button></td></tr>");
	}
	function addFile1(){
		$("#new_accessory1 tbody").append("<tr><td>新附件</td><td><input type='file' name='file1' id='file1' style='width:70%;' class='form-control'></td><td style='width:150px;'><button type='button' class='btn btn-danger' onclick='removeFile(this)'>移除附件</button></td></tr>");
	}
	
	function addFile2(){
		$("#edit_accessory tbody").append("<tr><td>新附件</td><td><input type='file' name='file' id='xgfile' style='width:70%;' class='form-control'></td><td style='width:150px;'><button type='button' class='btn btn-danger' onclick='removeFile(this)'>移除附件</button></td></tr>");
	}
	function addFile3(){
		$("#edit_accessory1 tbody").append("<tr><td>新附件</td><td><input type='file' name='file1' id='xgfile1' style='width:70%;' class='form-control'></td><td style='width:150px;'><button type='button' class='btn btn-danger' onclick='removeFile(this)'>移除附件</button></td></tr>");
	}
	
	function removeFile(obj){
  		var tr=$(obj).parents("tr");
  		$(tr).remove();
  	}
	
	 function showMask() {
	    	myTool.mask.show('保存中...');
	 }
	 function hidMask() {
	 	myTool.mask.hide();
	 }
	
	
    function getCreat(bb){
        var EnterpriseRating= $(bb).parent().prev().text();
        var Remarks= $(bb).parent().prev().prev().text();
        var ContactPhone1= $(bb).parent().prev().prev().prev().text();
        var Contacts= $(bb).parent().prev().prev().prev().prev().text();
        var address= $(bb).parent().prev().prev().prev().prev().prev().text();
        var ProprietorUnit= $(bb).parent().prev().prev().prev().prev().prev().prev().text();
        var Code= $(bb).parent().prev().prev().prev().prev().prev().prev().prev().text();
        $("#CEnterprise-rating").val(EnterpriseRating);
        $("#CRemarks").val(Remarks);
        $("#CContact-phone1").val(ContactPhone1);
        $("#CContacts").val(Contacts);
        $("#Caddress").val(address);
        $("#CProprietor-unit").val(ProprietorUnit);
        $("#CCode").val(Code);
        rowIndex = bb.parentNode.parentNode.rowIndex; 
    }

    // $("#mainContent tbody tr").click(function (){
    //     $(this).addClass('selected')
    //     .siblings().removeClass('selected')
    //     .end();
    // })
//数组去重
Array.prototype.unique3 = function(){
 var res = [];
 var json = {};
 for(var i = 0; i < this.length; i++){
  if(!json[this[i]]){
   res.push(this[i]);
   json[this[i]] = 1;
  }
 }
 return res;
}

    var arr=[];
    // $('#renwuDanhao')[0].selectedIndex = -1;
    $("#renwuDanhao").change(function(){
        arr.push($("#renwuDanhao").val())
        $("#rwdh").text(arr.unique3())
    })
    var arr2=[];
    // $('#renwuDanhao2')[0].selectedIndex = -1;
    $("#renwuDanhao2").change(function(){
        arr2.push($("#renwuDanhao2").val())
        $("#rwdh2").text(arr2.unique3())
    })

    $(".zhuangtai").change(function(){
        var zt=$(".zhuangtai").val();
        if(zt=="合同终止"){
            $(".quxiao").hide();
            $(".chongqi").show()
        }else{
            $(".quxiao").show();
            $(".chongqi").hide();
        }
    })
    
    
    //打印预览
    function dayinyulan(){
    	window.open("../contractyulan/ProcurementOtherContract.html?id="+LookcgoId+"");
    }
    
    //扫描合同件
    var smht_cgoId;
	function addsaomiaohetongjian(obj){
		tr_smht=$(obj).parents("tr");
		data_smht=$("#mainContent").DataTable().row(tr_smht).data();
		//console.log(data_bl)
		smht_cgoId=data_smht.cgoId;
    	$("#addSaoMiaohtModel").modal("show");
	}
    
	 function savesaomiaohetongjian(){
		 var saomiaoUrl=$("#saomiaofileUrl").val();	 
		 if(saomiaoUrl==''){
				toastr.error("请选择上传文件");
				return;
			 }
		 var formData = new FormData();
		 formData.append("cgoId", smht_cgoId);
		 formData.append("file",$("#saomiaofileUrl")[0].files[0]);
		 $.ajax({
		        type: 'POST',
		        url: getContextPath()+'/cgOtherContract/addSaoMiaoHeTong',
	            data: formData,  
	            cache: false,
	            processData: false,
	            contentType: false,
	            async: false,
		        success: function (json) {
	        		var result=json.result;
	        		if(result>0){
	        			toastr.success('保存成功');
	        			//$('#mainContent').DataTable().row.add(OtherFile).draw(false);
	        			$("#addSaoMiaohtModel").modal("hide");
	        			$("#saomiaofileUrl").val("");
	        		}else if(result==-2){
	        			toastr.error('请先刷新页面后登陆');
	        		}else{
	        			toastr.error('保存失败');
	        		}
		        }
		    });		
	 }
    
	 $("#searchData").on("input", function(e){
			var d = $("#searchData").val();
			$("#mainContent").DataTable().search(d).draw(true);
		});

</script>
</html>