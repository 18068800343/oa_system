<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="../../font2/iconfont.css">
    <link rel="stylesheet" href="../../font3/iconfont.css">
	<link href="../../style/bootstrap.min.css" rel="stylesheet">
    <link href="../../style/style.css" rel="stylesheet">
    <link href="../../toastr/toastr.css" rel="stylesheet">
    <link rel="stylesheet" href="../../style/jquery.dataTables.min.css">
    <!-- <link rel="stylesheet" href="../../style/jquery-editable-select.css"> -->
    <link href="../../select/css/select2.min.css" rel="stylesheet">
    <style lang="">
        body{
            background: #fff;
        }
        .UpperPart{
            display: flex;
            justify-content:space-between;
            border-bottom: 1px solid #ccc;
            padding-bottom: 12px;
        }
        .selected{
            background: rgba(247, 161, 3,0.2);
        }
        #mainContent th{
            cursor: pointer;
            font-size: 14px;
        }
       /*  #tijiaoren{
                display: flex;
                flex-wrap:wrap;
        } */
        .tab-content>div{
            margin-top:18px;
        }
    </style>
</head>
<body>
   
    <!-- 面包屑 -->
    <div class="mianbao">
    	<ul class="breadcrumb">
    		<li><i class="iconfont icon-knowledgebase"></i></li>
			<li>生产管理</li>
			<li class="active">任务单管理</li>
		</ul>
    </div>

    <div class="zhuti-content">
        <div>
            <ul class="nav nav-tabs" role="tablist">
                <li role="presentation" class="active" id="diyi"><a href="#home" aria-controls="home" role="tab" data-toggle="tab">主页</a></li>
                <li role="presentation" id="dier"><a href="#profile" aria-controls="profile" role="tab" data-toggle="tab">新建</a></li>
                <li role="presentation" id="disan"><a href="#messages" aria-controls="messages" role="tab" data-toggle="tab">修改</a></li>
                <li role="presentation" id="disi"><a href="#settings" aria-controls="settings" role="tab" data-toggle="tab">查看详细信息</a></li>
                <li role="presentation" id="diwu"><a href="#jinetj" aria-controls="jinetj" role="tab" data-toggle="tab">部门统计</a></li>
            </ul>
            <!-- Tab panes -->
            <div class="tab-content">
                <div role="tabpanel" class="tab-pane active" id="home">
                    <div class="UpperPart">
                        <div class="UpperPartL" style="font-size:18px;">
                            <form class="form-inline">
                                <label>状态筛选:</label>
                                <select id="zhuangtai" class="zhuangtai form-control">
                                    
                                    <option>审批结束</option><!-- 正常进行 -->
                                    <option>审批中</option>
                                    <option>终止</option><!-- 项目中止 -->
                                </select>
                            </form>
                        </div>
                        <div class="UpperPartR">
                            <form class="yihang">
                            	<button type="button" class="btn btn-primary Peaf" id="jinetongji" >部门统计</button>&nbsp;&nbsp;&nbsp;
                            	 <button type="button" class="btn btn-primary Peaa" id="zenjia" >填报任务单</button>
                            	 <div id="tabBtn" style="margin-left: 10px;"></div>
                            </form>
                        </div>
                    </div>
                    <div class="LowerPart" style="margin-top:3px;">
                    	<div class="chaojisousuo" style="margin-bottom:12px;">
                    		<div class="sousuoClick" style="display:flex;justify-content: space-between;margin-bottom:12px;">
                    				<div></div>
                    				<div>
                   						<button type="button" class="btn btn-info" onclick="seachAll()"><span class="glyphicon glyphicon-search" aria-hidden="true"></span>搜索</button>
                    					<button type="button" class="btn btn-primary" style="width:100px;" id="zhedieBtn"><span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span></button>
                    				</div>
                    		</div>
                    		<div class="sousuoInput" id="sousuodiv">
                    			<div id="sousuoTable"  style="border:1px solid #eee;padding:5px;">
                    			
                    				<div class="yihang2">
                    					<div style="width:25%;">
                    							<form class="form-inline">
														  <div class="form-group" style="display:flex;align-items:center;">
														    	<label for="exampleInput">项目开始时间:&nbsp;</label>
														    	<input type="text" class="form-control" id="seach_start_time_min"  style="width:30%;">
														    	<label>-</label>
														    	<input type="text" class="form-control" id="seach_start_time_max"  style="width:30%;">
														  </div>
													</form>
                    					</div>
                    					<div style="width:25%;">
                    							<form class="form-inline">
														  <div class="form-group" style="display:flex;align-items:center;">
														        <label for="exampleInput">项目结束时间:&nbsp;</label>
														    	<input type="text" class="form-control" id="seach_end_time_min"  style="width:30%;">
														    	<label>-</label>
														    	<input type="text" class="form-control" id="seach_end_time_max"  style="width:30%;">
														  </div>
													</form>
                    					</div>
                    					<div style="width:25%;">
                    							<form class="form-inline">
														  <div class="form-group" style="display:flex;align-items:center;">
														    	<label for="exampleInput">主办部门:&nbsp;</label>
														    	<select class="form-control" id="seach_main_department"  style="width:64%;"></select>
														  </div>
													</form>
                    					</div>
                    					<div style="width:25%;">
                   									<form class="form-inline">
														  <div class="form-group" style="display:flex;align-items:center;">
														    	<label for="exampleInput">协办部门:&nbsp;</label>
														    	<select class="form-control" id="seach_xb_department"  style="width:64%;"></select>
														  </div>
													</form>
                   							</div>
                   					</div>
                   					<hr/>
                   					<div class="yihang2" >
                   							<div style="width:25%;">
                   									<form class="form-inline">
														  <div class="form-group" style="display:flex;align-items:center;">
														    <label for="exampleInput">项&nbsp;目&nbsp;金&nbsp;额&nbsp;：&nbsp;</label>
														    	<input type="text" class="form-control" id="seach_prj_money_min"  style="width:30%;">
														    	<label>-</label>
														    	<input type="text" class="form-control" id="seach_prj_money_max"  style="width:30%;">
														  	</div>
													</form>
                   							</div>
                   							<div style="width:25%;">
                   									<form class="form-inline">
														  <div class="form-group" style="display:flex;align-items:center;">
														    <label for="exampleInput">合&nbsp;同&nbsp;金&nbsp;额&nbsp;：&nbsp;</label>
														    	<input type="text" class="form-control" id="seach_contract_money_min" style="width:30%;">
														    	<label>-</label>
														    	<input type="text" class="form-control" id="seach_contract_money_max"  style="width:30%;">
														  </div>
													</form>
                   							</div>
                   							<div style="width:25%;">
                   									<!-- <form class="form-inline">
														  <div class="form-group" style="display:flex;align-items:center;">
														    <label for="exampleInput">暂&nbsp;定&nbsp;金：</label>
														    	<input type="text" class="form-control" id="seach_zd_money_min" style="width:31%;">
														    	<label>-</label>
														    	<input type="text" class="form-control" id="seach_zd_money_max"  style="width:31%;">
														  </div>
													</form> -->
                   							</div>
                   							<div  style="width:25%;"></div>
                   					</div>
                    			</div>
                    		</div>
                    	</div>
                        <table class="table table-bordered table-condensed" id="mainContent" style="width:100%;">
                            <thead>
                                
                                <tr>
                                    <th>任务单号</th>
                                    <th style="width:12%;">项目名称</th>
                                    <th>项目来源</th>
                                    <th>合同所属公司</th>
                                    <th>项目类型</th>
                                    <th style="width:12%;">甲方单位</th>
                                    <th>任务金额(元)</th>
                                    <th>合同金额(元)</th>
                                    <th>合同信息</th>
                                    <th>项目开始时间</th>
                                    <th>主办部门</th>
                                    <th style="width:100px;">操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                
                            </tbody>   
                        </table>
                    </div>
                </div>

                <div role="tabpanel" class="tab-pane" id="profile">
                    <table class="table table-bordered table-condensed">
                    	<thead>
                    		<tr>
                    			<th colspan="10">项目基本信息</th>
                    		</tr>
                    	</thead>
                    	<tbody>
                    		<tr>
                                <td  style="width:20%;">项目名称 <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td  style="width:30%;">
                                	<input type="text" class="form-control"  id="taskName">
                                </td>
                                <td  style="width:20%;">所属区域  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td  style="width:30%;">
                                            <div class="docs-methods" style="width:100%;">
                                                <form class="form-inline">
                                                    <div id="distpicker">
                                                        <div class="form-group">
                                                            <div style="position: relative;">
                                                                <input id="city-picker3" class="form-control" readonly type="text" value="" data-toggle="city-picker">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div> 
                                </td>
                            </tr>
                            <tr>
	                            	<td>项目经营模式  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
	                                <td>
	                                	<select class="form-control" style="width:100%;" id="moshi">
	                                        <option>自营</option>
	                                        <option>联营</option>
	                                    </select>
	                                </td>
	                                <td>合同所属公司  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
	                                <td>
	                                    <select class="form-control" style="width:100%;" id="gongsi">
	                                        <option value="华通">华通</option>
	                                        <option value="华汇">华汇</option>
	                                        <option value="宿迁分公司">宿迁分公司</option>
	                                    </select>
	                                </td>
                            </tr>
                            <tr>
                            	<td>项目类型  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td colspan="6">
	                                    <form class="form-inline">
	                                    	  <div class="form-group">
												    <select class="form-control" style="width:100%;" id="erjileixing"></select>
											  </div>&nbsp;&nbsp;
											  
											  <div class="form-group yugongke">
												    <label for="yugongke ">预工可(百分比):</label>
												    <input type="text" class="form-control" id="yugongke" >
												    <label>%</label>
											  </div>&nbsp;&nbsp;
											  <div class="form-group chushe">
												    <label for="chushe">初设(百分比):</label>
												    <input type="text" class="form-control" id="chushe" >
												    <label>%</label>
											  </div>&nbsp;&nbsp;
											  <div class="form-group shishe">
												    <label for="shishe">施设(百分比):</label>
												    <input type="text" class="form-control" id="shishe" >
												    <label>%</label>
											  </div>
											  
										</form>
                                </td>
                            </tr>
                            <tr>
                            	<td class="jinqianyanse">任务金额  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td><input type="text" class="form-control" style="width:100%;" id="jine"></td>
                                <td class="jinqianyanse">合同金额  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td><input type="text" placeholder="不含暂定金" class="form-control" style="width:100%;" id="hetonge"></td>
                            </tr>
                            <tr>
                            	<td class="jinqianyanse">暂定金  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td><input type="text" class="form-control" style="width:100%;" id="zandingjin"></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>项目起止时间</td>
                                <td>
                                	<div   class="yihang">
	                                	<input type="text" class="form-control" id="year" style="width:45%;">
	                                	&nbsp;&nbsp;-&nbsp;&nbsp;
	                                	<input type="text" class="form-control" id="year2" style="width:45%;">
                                	</div>
                                </td>
                                <td>项目来源  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                	<select class="form-control" style="width:100%;" id="prj_source">
                                        <option value="招标">招标</option>
                                        <option value="竞争性谈判">竞争性谈判</option>
                                        <option value="委托">委托</option>
                                        <option value="其他">其他</option>
                                    </select>  
                                </td>
                            </tr>
                            <!-- <tr>
                            	<td>主任务单号</td>
                            	<td>
                            		<input type="text" class="form-control"  style="width:100%;" id="main_task_no" disabled>
                            	</td>
                            	<td>
                            		<button type="button" style="margin-left: 5px;" class="btn btn-primary" onclick="chooseMainTask(0)">选择任务单</button>
                            	</td>
                            	<td></td>
                            	<td></td>
                            </tr> -->
                            <tr>
                            	<td>项目概况及工作内容</td>
                                <td colspan="9"><textarea class="form-control" rows="3" style="width:90%;" id="gaikuang"></textarea></td>
                            </tr>
                    	</tbody>
                    </table>
                    
                    <table class="table table-bordered table-condensed">
                    	<thead>
                    		<tr>
                    			<th colspan="8">项目业主信息</th>
                    		</tr>
                    	</thead>
                    	<tbody>
                    		<tr>
                                <td  style="width:20%;">甲方单位  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                <form class="form-inline">
                                	<select class="form-control" style="width:100%;" id="yezhudanwei">
                                        
                                    </select>
                                    
                                </form>
                                </td>
                                
                            </tr>
                    	</tbody>
                    </table>
                    <table class="table table-bordered table-condensed">
                            <tr>
                                <td style="width:20%;">联系人  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td style="width:20%;">
                                    <select class="form-control" style="width:200px;" id="lianxiren">
                                    </select>
                                </td>
                                <td  style="width:20%;">联系方式  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td style="width:20%;">
                                    <select class="form-control" style="width:200px;" id="lianxifangshi">
                                    </select>
                                </td>
                                <td  style="width:20%;">
	                                <button type="button" style="margin-left: 5px;" class="btn btn-primary"  id="xuanzelianxiren" data-toggle="modal" data-target="#addGuanliren">新建联系人</button>
	                                <button type="button" class="btn btn-info" onclick="addLianxiren(this)">添加</button>
                                </td>
                            </tr>
                        </table>
                        <table class="table table-bordered table-condensed" id="lianxibiaoge">
                            <thead>
                                <tr>
                                    <th colspan="3">添加的联系人,联系方式</th>
                                </tr>
                                <tr>
                                    <th  style="width:20%;">联系人</th>
                                    <th>联系方式</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                
                            </tbody>
                        </table>
                        <table class="table table-bordered table-condensed" id="xieban">
                            <thead>
                                <tr>
                                    <th colspan="3" style="text-align:right;"><button type="button" class="btn btn-primary" onclick="addBumen()">添加协办部门</button></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="width:20%;">主办部门  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                    <td>
                                        <form class="form-inline">
                                            <select class="form-control" style="width:180px;" id="zhuban">
                                                
                                            </select>
                                            <input type="text" class="form-control" style="width:180px;margin-left: 10px;" placeholder="金额" id="zhubanjine">
                                        	<input type="text" id="chenbenfentanbili" class="form-control" style="width:180px;margin-left:10px;" placeholder="成本分摊比例" onchange="appendBfh(this)">
                                        </form>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        
                    <div class="modal-footer" >
                        <button type="button" class="btn btn-default"  onclick="quxiao()">取消</button>
                        <button type="button" class="btn btn-default"  onclick="addrenwudan()">保存</button>
                        <button type="button" class="btn btn-success"   onclick="tijiaorenwudan()">提交</button> 
                    </div>
                </div>
			<!-- 修改 -->
                <div role="tabpanel" class="tab-pane" id="messages">
                    <table class="table table-bordered table-condensed">
                    	<thead>
                    		<tr>
                    			<th colspan="8">修改项目基本信息</th>
                    		</tr>
                    	</thead>
                    	<tbody>
                    		<tr>
                                <td  style="width:20%;">项目名称  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td  style="width:30%;">
                                   <input type="text" class="form-control" style="width:100%;" id="xgtaskName">
                                </td>
                                <td  style="width:20%;">所属区域  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td  style="width:30%;">
                                		<div class="docs-methods" style="width:100%;">
                                                <form class="form-inline">
                                                    <div id="distpicker">
                                                        <div class="form-group">
                                                            <div style="position: relative;">
                                                                <input id="edit_city" class="form-control" readonly type="text" value="" data-toggle="city-picker">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div> 
                                		<!-- <div class="yihang">
		                                		<input type="text" id="xgprjArea" style="width:62%;" class="form-control" disabled>
		                            			<button type="button" class="btn btn-default" data-toggle="modal" data-target="#chooseCity">选择城市</button>
                                		</div> -->
                                </td>
                            </tr>
                            <tr>
                            	<td>任务单号  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td><input type="text" class="form-control" style="width:100%;" id="xgtaskbianhao" disabled></td>
                                <td>项目经营模式  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                    <select class="form-control" style="width:100%;" id="xgmoshi">
                                        <option>自营</option>
                                        <option>联营</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                            	<td>合同所属公司  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                    <select class="form-control" style="width:100%;" id="xggongsi">
                                        <option value="华通">华通</option>
                                        <option value="华汇">华汇</option>
                                        <option value="宿迁分公司">宿迁分公司</option>
                                    </select>
                                </td>
                                <!-- <td>重要程度</td>
                                <td>
                                	<select id="edit_importance" class="form-control" style="width:100%;">
                                		<option value="重要">重要</option>
                                		<option value="一般">一般</option>
                                	</select>
                                </td> -->
                                <td class="jinqianyanse">任务金额  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td><input type="text" class="form-control" style="width:100%;" id="xgjine"></td>
                            </tr>
                            <tr>
	                            <td>项目类型  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td colspan="7">
                                		<form class="form-inline">
	                                    	  <div class="form-group">
												    <select class="form-control" style="width:100%;" id="xgerjileixing"></select>
											  </div>&nbsp;&nbsp;
											  <div class="form-group xgyugongke">
												    <label for="xgyugongke ">预工可(百分比):</label>
												    <input type="text" class="form-control" id="xgyugongke" >
												    <label>%</label>
											  </div>&nbsp;&nbsp;
											  <div class="form-group xgchushe">
												    <label for="xgchushe">初设(百分比):</label>
												    <input type="text" class="form-control" id="xgchushe" >
												    <label>%</label>
											  </div>&nbsp;&nbsp;
											  <div class="form-group xgshishe">
												    <label for="xgshishe">施设(百分比):</label>
												    <input type="text" class="form-control" id="xgshishe" >
												    <label>%</label>
											  </div>
											  
										</form>
                                </td>
	                      	</tr>
	                      	<tr>
	                      	 	<td class="jinqianyanse">合同金额  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td><input type="text" class="form-control" placeholder="不含暂定金" style="width:100%;" id="xghetonge"></td>
                                <td class="jinqianyanse">暂定金  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td><input type="text" class="form-control"  id="xgzandingjin" ></td>
	                      	</tr>
	                      	<tr>
                                <td>项目起止时间</td>
                                <td>
                                	<div   class="yihang">
	                                	<input type="text" class="form-control" id="xgstartTime" style="width:45%;">
	                                	&nbsp;&nbsp;-&nbsp;&nbsp;
	                                	<input type="text" class="form-control" id="xgendTime" style="width:45%;">
                                	</div>
                                </td>
                                <td>项目来源  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                	<select class="form-control" style="width:100%;" id="xg_prj_source">
                                        <option value="招标">招标</option>
                                        <option value="竞争性谈判">竞争性谈判</option>
                                        <option value="委托">委托</option>
                                        <option value="其他">其他</option>
                                    </select>  
                                </td>
                            </tr>
                            <!-- <tr>
                            	<td>主任务单号</td>
                                <td>
                                	<input type="text" class="form-control" style="width:100%;" id="xg_main_task_no">
                                </td>
                                <td>
                                	<button type="button" style="margin-left: 5px;" class="btn btn-primary" onclick="chooseMainTask(1)">选择任务单</button>
                                </td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr> -->
                            <tr>
	                            <td>项目概况及工作内容</td>
                                <td colspan="7"><textarea class="form-control" rows="3" style="width:90%;" id="xggaikuang"></textarea></td>
	                      	</tr>
                    	</tbody>
                 </table>
                 
                 <table class="table table-bordered table-condensed">
                    	<thead>
                    		<tr>
                    			<th colspan="8">修改业主信息</th>
                    		</tr>
                    	</thead>
                    	<tbody>
                    		<tr>
                                <td style="width:20%;">甲方单位  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                	<div class="yihang">
	                                	<select class="form-control" style="width:80%;" id="xgyezhudanwei">
	                                        
	                                    </select>
                                	</div>
                                </td>
                            </tr>
                            
                    	</tbody>
                 </table>
                <table class="table table-bordered table-condensed">
                            <tr>
                                <td style="width:20%;">联系人  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td style="width:20%;">
                                    <select class="form-control" style="width:80%;" id="xglianxiren">
                                    </select>
                                </td>
                                <td style="width:20%;">联系方式  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td style="width:20%;">
                                    <select class="form-control" style="width:80%;" id="xglianxifangshi">
                                    </select>
                                </td>
                                <td style="width:20%;">
                                	<div class="yihang">
                                		<button type="button" style="margin-left: 10px;" class="btn btn-primary"  id="xgxuanzelianxiren" data-toggle="modal" data-target="#xgaddGuanliren">新建联系人</button>
                                		<button type="button" class="btn btn-info" style="margin-left: 10px;" onclick="xgaddLianxiren()">添加</button>
                                	</div>
                                </td>
                            </tr>
                        </table>
                        <table class="table table-bordered table-condensed" id="xglianxibiaoge">
                            <thead>
                                <tr>
                                    <th colspan="3">修改的联系人,联系方式</th>
                                </tr>
                                <tr>
                                    <th style="width:20%;">联系人</th>
                                    <th>联系方式</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                
                            </tbody>
                        </table>
                 
                 <table class="table table-bordered table-condensed" id="xgxieban">
                            <thead>
                                <tr>
                                    <th colspan="3" style="text-align:right;"><button type="button" class="btn btn-primary" onclick="xgaddBumen()">添加协办部门</button></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="width:20%;">主办部门  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                    <td>
                                        <form class="form-inline">
                                            <select class="form-control" style="width:150px;" id="xgzhuban">
                                                
                                            </select>
                                            <input type="text" class="form-control" style="width:150px;margin-left:9px;" placeholder="金额" id="xgzhubanjine">
                                            <input type="text" id="xgchenbenfentanbili" class="form-control" style="width:150px;margin-left:9px;" placeholder="成本分摊比例"  onchange="appendBfh(this)">
                                        </form>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default"  onclick="quxiao2()">取消</button>
                        <button type="button" class="btn btn-default" onclick="xgsaverenwudan()">保存</button>
                        <button type="button" class="btn btn-success" onclick="xgaddrenwudan()">提交</button>
                    </div>
                </div>

                <div role="tabpanel" class="tab-pane" id="settings">
                	<table class="table table-bordered table-condensed">
                    	<thead>
                    		<tr>
                    			<th colspan="8">查看项目基本信息</th>
                    		</tr>
                    	</thead>
                    	<tbody>
                    		<tr>
	                            <td style="width:20%;">项目名称</td>
	                            <td id="looktaskName" style="width:30%;"></td>
	                            <td style="width:20%;">所属区域</td>
	                            <td id="look_prj_area" style="width:30%;"></td>
	                        </tr>
	                        <tr>
	                        	<td>任务单号</td>
	                            <td id="looktaskbianhao"></td>
	                            <td>项目经营模式</td>
	                            <td id="lookmoshi" ></td>
	                        </tr>
	                        <tr>
	                        	<td>合同所属公司</td>
	                            <td id="lookgongsi"></td>
	                            <td>项目类型</td>
	                            <td id="lookleixing"></td>
	                        </tr>
	                        <tr>
	                        	<td>重要程度</td>
	                            <td id="look_importance"></td>
	                            <td>主任务单</td>
	                            <td id="look_main_task_no"></td>
	                        </tr>
	                        <tr>
	                        	<td class="jinqianyanse">任务金额</td>
	                            <td id="lookjine" ></td>
	                            <td class="jinqianyanse">合同金额</td>
	                            <td id="lookhetonge" ></td>
	                         </tr>
	                         <tr>
	                         	<td class="jinqianyanse">暂定金</td>
	                            <td id="lookzandingjin"></td>
	                            <td>项目开始时间</td>
	                            <td>
	                            	<span  id="lookstartTime"></span><span>&nbsp;&nbsp;-&nbsp;&nbsp;</span><span  id="lookendTime"></span>
	                            </td>
	                         </tr>
	                         <tr>
	                            <td>项目来源</td>
	                            <td id="look_prj_source"></td>
	                            <td></td>
	                            <td></td>
	                        </tr>
	                         <tr>
		                            <td>项目概况及工作内容</td>
		                            <td colspan="8"  id="lookgaikuang"></td>
		                      </tr>
                    	</tbody>
                    </table>
                    
                    <table class="table table-bordered table-condensed">
                    	<thead>
                    		<tr>
                    			<th colspan="8">查看业主信息</th>
                    		</tr>
                    	</thead>
                    	<tbody>
                    		<tr>
	                            <td style="width:20%;">甲方单位</td>
	                            <td id="lookyezhudanwei" ></td>
	                        </tr>
	                        
                    	</tbody>
                    </table>
                    <table class="table table-bordered table-condensed"  id="looklianxibiaoge">
                        <thead>
                            <tr>
                                <th colspan="2">添加的联系人,联系方式</th>
                            </tr>
                            <tr>
                                <th style="width:20%;">联系人</th>
                                <th>联系方式</th>
                            </tr>
                        </thead>
                        <tbody>
                            
                        </tbody>
                    </table>
                    
                    <table class="table table-bordered table-condensed" id="look_xieban_table">
                    	<thead>
                    		<tr>
                    			<th colspan="6">查看承接部门信息</th>
                    		</tr>
                    	</thead>
                    	<tbody>
                    	</tbody>
                    </table>
						
					<br/>
					<h2 style="color:red;">历史信息</h2>
					<table class="table table-bordered table-condensed" id="history_table" style="width:100%;">
						  <thead>
	                        	<tr>
	                        		<th>任务单号</th>
	                        		<th>项目名称</th>
	                        		<th>所属公司</th>
	                        		<th>甲方单位</th>
	                        		<th>修改时间</th>
	                        		<th style="width:80px;;">操作</th>
	                        	</tr>
	                        </thead>
	                        <tbody></tbody>
					</table>
					
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" onclick="quxiao3()">取消</button>
                    </div>
                </div>
                
                <!-- 金额统计 -->
                <div role="tabpanel" class="tab-pane" id="jinetj">
                	<div class="UpperPart">
                        <div class="UpperPartL" style="font-size:18px;">
                            <form class="form-inline">
                                <label>部门筛选:</label>
                                <select id="bumenshaixuan" class="form-control" style="width:180px;">
                                    		
                                </select>
                            </form>
                        </div>
                        <div class="UpperPartR">
                            <div id="tabBtntj" style="margin-left: 10px;"></div>
                        </div>
                    </div>
                    <div class="LowerPart" style="margin-top:3px;">
                    	
                        <table class="table table-bordered table-condensed" id="mainContenttjje" style="width:100%;">
                            <thead>
                                
                                <tr>
                                    <th>任务单号</th>
                                    <th style="width:12%;">项目名称</th>
                                    <th>项目来源</th>
                                    <th>合同所属公司</th>
                                    <th>项目类型</th>
                                    <th style="width:12%;">甲方单位</th>
                                    <th>任务金额(元)</th>
                                    <th>所选部门金额</th>
                                    <th>项目开始时间</th>
                                </tr>
                            </thead>
                            <tbody>
                                
                            </tbody>   
                        </table>
                    </div>
                    
                    <div class="modal-footer" >
                        <button type="button" class="btn btn-default"  onclick="quxiaojinetongji()">取消</button>
                    </div>
                    
                </div>
            </div>

                
        </div>
    </div>
<!--选人 modal -->
<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="addGuanliren">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="gridSystemModalLabel">新建联系人,联系方式</h4>
            </div>
            <div class="modal-body">
            
                <div>
                	
                	<table class="table table-bordered table-condensed" >
                		<tr>
                			<td>联系人</td>
                			<td><input type="text" class="form-control" style="width:180px;" id="xinjianlianxiren"></td>
                			<td>联系方式</td>
                			<td><input type="text" class="form-control" style="width:180px;" id="xinjianlianxifangshi"></td>
                		</tr>
                	</table>
                     <!-- <table class="table table-bordered table-condensed"  id="bmmingzibiao" >
                     	<thead>
		   					<tr>
		   						<th></th>
		   						<th>联系人</th>
		   						<th>联系方式</th>
		   					</tr>
		   				</thead>
		   				<tbody></tbody>
                     </table> -->
              </div>
              
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="saveGuanliren()" data-dismiss="modal">确定</button>
            </div>
        </div>
    </div>
</div>
<!-- 选人 modal结束 --> 
<!--选人 modal -->
<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="xgaddGuanliren">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="gridSystemModalLabel">选择联系人,联系方式</h4>
            </div>
            <div class="modal-body">
            
                <div>
                	<table class="table table-bordered table-condensed" >
                		<tr>
                			<td>联系人</td>
                			<td><input type="text" class="form-control" style="width:180px;" id="xinjianlianxiren"></td>
                			<td>联系方式</td>
                			<td><input type="text" class="form-control" style="width:180px;" id="xinjianlianxifangshi"></td>
                		</tr>
                	</table>
                     <!-- <table class="table table-bordered table-condensed"  id="xgbmmingzibiao" >
                     	<thead>
		   					<tr>
		   						<th></th>
		   						<th>联系人</th>
		   						<th>联系方式</th>
		   					</tr>
		   				</thead>
		   				<tbody></tbody>
                     </table> -->
              </div>
              
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="xgsaveGuanliren()" data-dismiss="modal">确定</button>
            </div>
        </div>
    </div>
</div>
<!-- 选人 modal结束 --> 
<!--修改选择城市 modal -->
<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="chooseCity">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="gridSystemModalLabel">选择城市</h4>
            </div>
            <div class="modal-body">
                    <div class="docs-methods">
                         <form class="form-inline">
                             <div id="distpicker">
                                 <div class="form-group">
                                     <div style="position: relative;">
                                         <input id="edit_city_picker3" class="form-control" readonly type="text" value="" data-toggle="city-picker">
                                     </div>
                                 </div>
                             </div>
                         </form>
                     </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="savechooseCity()" data-dismiss="modal">确定</button>
            </div>
        </div>
    </div>
</div>
<!-- 修改选择城市结束 -->
<!-- 提交 modal -->
<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="tijiaogei">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="gridSystemModalLabel">提交给</h4>
            </div>
            <div class="modal-body">
                
                    <!-- <div id="tijiaoren"></div> -->
                        <table class="table table-bordered table-condensed" id="tijiaoren">
                        	<thead>
                        			<tr>
		                            	<th></th>
		                                <th>部门</th>
		                                <th>职务</th>
		                                <th>审批人</th>
		                            </tr>
                        	</thead>
                            <tbody>
                            	
                            </tbody>
                        </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-success" data-dismiss="modal"  onclick="tijiaorenwudan2()">提交</button>
            </div>
        </div>
    </div>
</div>
<!-- 提交 modal结束 -->

<!-- Modal项目 -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="xiangmumd">
    <div class="modal-dialog modal-lg" role="document" style="width:70%;">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>选择项目</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline">
                        <table class="table table-bordered table-condensed" id="xiangmubiao" style="width:100%;">
                            <thead>
                            	<tr>
                            		<th style="width:8%;"></th>
                            		<th style="width:12%;">编号</th>
                                    <th style="width:30%;">项目名称</th>
                                    <th style="width:15%;">项目所属公司</th>
                                    <th style="width:15%;">项目类型</th>
                                    <th style="width:20%;">甲方单位</th>
                            	</tr>
                            </thead>
                            <tbody>
                                
                            </tbody>
                        </table> 
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-success" onclick="saveTask()">保存</button>
        </div>
        </div>
    </div>
</div>
<!-- model项目结束 -->

	<!-- 查看Modal -->
				<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="look_history_info">
				    <div class="modal-dialog modal-lg" role="document">
				        <div class="modal-content">
				        <div class="modal-header">
				            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				            <h4 class="modal-title" id="myModalLabel"><b>查看详细信息</b></h4>
				        </div>
				        <div class="modal-body">
				                <div>     
				                    <table class="table table-bordered table-condensed">
				                    	<thead>
				                    		<tr>
				                    			<th colspan="8">查看项目基本信息</th>
				                    		</tr>
				                    	</thead>
				                    	<tbody>
				                    		<tr>
				                            <td>项目名称</td>
				                            <td id="historyName"></td>
				                            <td style="width:100px;">任务单号</td>
				                            <td id="historybianhao"></td>
				                            <td>所属区域</td>
				                            <td id=""></td>
				                            <td>项目经营模式</td>
				                            <td id="historymoshi"></td>
				                            
				                        </tr>
				                        <tr>
				                        	<td>合同所属公司</td>
				                            <td id="historygongsi"></td>
				                            <td style="width:100px;">项目类型</td>
				                            <td id="historyleixing"></td>
				                            <td></td>
				                            <td></td>
				                            <td></td>
				                            <td></td>
				                        </tr>
				                         <tr>
					                            <td>项目概况及工作内容</td>
					                            <td colspan="8"  id="historygaikuang"></td>
					                      </tr>
				                    	</tbody>
				                    </table>
				                    
				                    <table class="table table-bordered table-condensed">
				                    	<thead>
				                    		<tr>
				                    			<th colspan="8">查看业主信息</th>
				                    		</tr>
				                    	</thead>
				                    	<tbody>
				                    		<tr>
					                            <td>甲方单位</td>
					                            <td id="historyyezhudanwei"></td>
					                            <td class="jinqianyanse">任务金额</td>
					                            <td id="historyjine"></td>
					                            <td class="jinqianyanse">合同金额</td>
					                            <td id="historyhetonge"></td>
					                            <td class="jinqianyanse">暂定金</td>
					                            <td id="historyzandingjin"></td>
					                        </tr>
					                        <tr>
					                            <td>项目开始时间</td>
					                            <td id="historystartTime"></td>
					                            <td>项目结束时间</td>
					                            <td id="historyendTime"></td>
					                            <td>预估合同金额</td>
					                            <td></td>
					                            <td></td>
					                            <td></td>
					                        </tr>
				                    	</tbody>
				                    </table>
				                    <table class="table table-bordered table-condensed"  id="historylianxibiaoge">
				                        <thead>
				                            <tr>
				                                <th colspan="2">添加的联系人,联系方式</th>
				                            </tr>
				                            <tr>
				                                <th>联系人</th>
				                                <th>联系方式</th>
				                            </tr>
				                        </thead>
				                        <tbody>
				                            
				                        </tbody>
				                    </table>
				                    
				                    <table class="table table-bordered table-condensed" id="history_xieban_table">
				                    	<thead>
				                    		<tr>
				                    			<th colspan="8">查看承接信息</th>
				                    		</tr>
				                    	</thead>
				                    	<tbody>
				                    	</tbody>
				                    </table>
				                </div>
				        </div>
				        <div class="modal-footer">
				            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
				        </div>
				        </div>
				    </div>
				</div>
				<!-- 查看model结束 -->


<!-- Modal3 -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="myModal3">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>任务单重新启用申请表</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline">
                        <table class="table table-bordered table-condensed">
                            <tr>
                                <td>任务单重新启用原因</td>
                                <td colspan="3"><textarea name="" id="" cols="50" rows="5"></textarea></td>
                            </tr>
                        </table>
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-success">保存</button>
            <!-- <button type="button" class="btn btn-success">提交</button> -->
        </div>
        </div>
    </div>
</div>
<!-- model3结束 -->
<!-- Modal4 -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="myModal4">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>任务单终止申请表</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline">
                        <table class="table table-bordered table-condensed">
                            <tr>
                                <td>任务单终止原因</td>
                                <td colspan="3"><textarea name="" id="" cols="50" rows="5"></textarea></td>
                            </tr>
                        </table>
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <!-- <button type="button" class="btn btn-default">保存</button> -->
            <button type="button" class="btn btn-success" id="stopTask">提交</button>
        </div>
        </div>
    </div>
</div>
<!-- model4结束 -->
<!-- Modal5-->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="myModal5">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>任务单履约完结申请表</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline">
                        <table class="table table-bordered table-condensed">
                            <tr>
                                <td>任务单履约完结原因</td>
                                <td colspan="3"><textarea name="" id="" cols="50" rows="5"></textarea></td>
                            </tr>
                        </table>
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <!-- <button type="button" class="btn btn-default">保存</button> -->
            <button type="button" class="btn btn-success" id="finishTask">提交</button>
        </div>
        </div>
    </div>
</div>
<!-- model5结束 -->
</body>
<script src="../../js/jquery.js"></script>
<script src="../../js/common-scripts.js"></script>
<script src="../../js/bootstrap.min.js"></script>
<script src="../../js/laydate/laydate.js"></script>
<!-- <script src="../../js/jquery-editable-select.js"></script> -->
<script src="../../toastr/toastr.js"></script>
<script src="../../js/city-picker.data.js"></script>
<script src="../../js/city-picker.js"></script>
<script src="../../js/quanxian.js"></script>


<script src="../../js/datatables/jquery.dataTables.min.js"></script>
<script src="../../js/datatables/dataTables.colVis.min.js"></script>
<script src="../../js/datatables/dataTables.tableTools.min.js"></script>
<!-- <script src="../../js/datatables/dataTables.bootstrap.min.js"></script> -->
<script src="../../js/datatables/datatables.responsive.min.js"></script>
<script src="../../js/datatables/dataTables.buttons.min.js" ></script>
<script src="../../js/datatables/buttons.html5.min.js" ></script>
<script src="../../js/datatables/buttons.flash.min.js" ></script>
<script src="../../js/datatables/jszip.min.js"></script>
<script src="../../js/jquery.cookie.js"></script>

<script src="../../select/js/select2.min.js"></script>
<script>  
    $(document).ready( function () {
    	$("#zhuangtai").trigger("change");
    	laydate.render({
            elem: '#year' //指定元素
        });
        laydate.render({
            elem: '#year2' //指定元素
        });
        laydate.render({
            elem: '#xgstartTime' //指定元素
        });
        laydate.render({
            elem: '#xgendTime' //指定元素
        });
        laydate.render({
            elem: '#seach_start_time_min' //指定元素
        });
        laydate.render({
            elem: '#seach_start_time_max' //指定元素
        });
        laydate.render({
            elem: '#seach_end_time_min' //指定元素
        });
        laydate.render({
            elem: '#seach_end_time_max' //指定元素
        });
        initSelect2WithSearch();
        
        initType();
        leixingSelect2();
        
        initbzhiwu();
        initbushei();
        initbumen();
        $("#sousuodiv").hide();//超级搜索折叠div
        initTabletjje();
	});
        $("#diyi a").hide();
        $("#dier a").hide();
        $("#disan a").hide();
        $("#disi a").hide();
        $("#diwu a").hide();
     $("#jinetongji").click(function(){
         $("#diyi").removeClass("active");
         $("#diwu").addClass("active");
         $("#diyi a").show();
         $("#diwu a").show();
         $("#home").removeClass("active");
         $("#jinetj").addClass("active");
         $("#bumenshaixuan").trigger("change");
     })
    $("#zenjia").click(function(){
        $("#diyi").removeClass("active");
        $("#dier").addClass("active");
        $("#diyi a").show();
        $("#dier a").show();
        $("#home").removeClass("active");
        $("#profile").addClass("active");
    })
    function quxiao(){
    	 $("#diyi").addClass("active");
         $("#dier").removeClass("active");
         $("#diyi a").hide();
         $("#dier a").hide();
         $("#home").addClass("active");
         $("#profile").removeClass("active");
    }
    function quxiao2(){
    	$("#diyi").addClass("active");
        $("#disan").removeClass("active");
        $("#diyi a").hide();
        $("#disan a").hide();
        $("#home").addClass("active");
        $("#messages").removeClass("active");
   }
    function quxiao3(){
    	$("#diyi").addClass("active");
        $("#disi").removeClass("active");
        $("#diyi a").hide();
        $("#disi a").hide();
        $("#home").addClass("active");
        $("#settings").removeClass("active");
   }
    function quxiaojinetongji(){
    	$("#diyi").addClass("active");
        $("#diwu").removeClass("active");
        $("#diyi a").hide();
        $("#diwu a").hide();
        $("#home").addClass("active");
        $("#jinetj").removeClass("active");
    }

    
    var table=$('#mainContent').DataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 10,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
		            { "data": "prjNo"}, 
		            { "data": "prjName"},
		            { "data": "prjSource"},
		            { "data": "prjCompany"}, 
		            { "data": "prjType2"}, 
		            { "data": "ccName"}, 
		            { "data": "prjEstimateMoney"}, 
		            { "data": "contractMoney"}, 
		            { "data": "cjId"}, 
		            { "data": "prjStartTime"}, 
		            { "data": "omName"}, 
		            { "data": null},
		        ],
		        "columnDefs": [
								{	
										 "class": "tcenter",
									     "targets": 8,
									     "searchable": true,
									     "render": function(data, type, full) {
									    	 if(data==""||data==null||data==undefined||data=="null"){
									    		 return '<button type="button" class="btn btn-danger">无</button>';
									    	 }else{
									    		 return '<button type="button" class="btn btn-success" onclick="lookContract(this)">有</button>';
									    	 }
							  	  		 	/* return '<i class="iconfont icon-icon-test" style="font-size:20px;cursor:pointer;margin-left:5px;" title="查看详细信息"   id="lookContract" onclick="lookContract(this)"></i>' */
							            }
						        },
						        {	
									     "class": "tcenter",
									     "targets": 11,
									     "searchable": true,
									     "render": function(data, type, full) {
									    	 var cj = full.cjId;
									    	 var json =  JSON.stringify(full);
									    	 var codeJson = encodeURIComponent(json);
									    	 var zt =  $("#zhuangtai").val();
									    	 var mainPrj = full.mainPrjNo;
									    	 if(cj==null&&zt=="审批结束"&&(mainPrj==""||mainPrj==null)){
						  	  		         return '<i class="iconfont icon-icon-test Peab" style="font-size:20px;cursor:pointer;margin-left:5px;display:none;" title="查看详细信息"   id="lookDetall"></i><span class="glyphicon glyphicon-resize-full Peag" style="font-size:15px;cursor:pointer;margin-left:5px;display:none;" title="拆分子任务单"   id="chaiFenTask"></span><i class="iconfont icon-xiugai Peac" style="font-size:18px;cursor:pointer;margin-left:5px;display:none;" title="修改"  id="Changedanwei"></i><i class="iconfont icon-arrow chongqi Peae" style="font-size:18px;cursor:pointer;display:none;margin-left:5px;" title="重启" data-toggle="modal" data-target="#myModal3"></i><i class="iconfont icon-tuichu Pead" style="font-size:18px;cursor:pointer;margin-left:5px;display:none;" title="项目终止"  data-toggle="modal" data-target="#myModal4"></i></i>'
									    	 }else{
							    		     return '<i class="iconfont icon-icon-test Peab" style="font-size:20px;cursor:pointer;margin-left:5px;display:none;" title="查看详细信息"   id="lookDetall"></i><i class="iconfont icon-xiugai Peac" style="font-size:18px;cursor:pointer;margin-left:5px;display:none;" title="修改"  id="Changedanwei"></i><i class="iconfont icon-arrow chongqi Peae" style="font-size:18px;cursor:pointer;display:none;margin-left:5px;" title="重启" data-toggle="modal" data-target="#myModal3"></i><i class="iconfont icon-tuichu Pead" style="font-size:18px;cursor:pointer;margin-left:5px;display:none;" title="项目终止"  data-toggle="modal" data-target="#myModal4"></i></i>'	 
									    	 }
		                                }
						        }
								],
								"fnDrawCallback" : function() {
									var zt=$("#zhuangtai").val();
									if(zt=="审批结束"){
										$.ajax({
					                		type:"post",
					                		url:getContextPath()+"/login/getUser",
					                		async:false,
					                		data:{
					                		},
					                		success:function(json){
					                			
					                			if(json!=null &&json!=""){
					                				var arr = json.uPermissions.split(',');
					                				
					                				for(var i=0;i<arr.length;i++){
					                					var arr2 = arr[i].replace("+","");
					                					if(arr[i].indexOf("Peab") >= 0 ){
					                						$(".Peab").show();
					                					}
					                					if(arr[i].indexOf("Peac") >= 0 ){
					                						$(".Peac").show();
					                					}
					                					if(arr[i].indexOf("Pead") >= 0 ){
					                						$(".Pead").show();
					                					}
					                					if(arr[i].indexOf("Peag") >= 0 ){
					                						$(".Peag").show();
					                					}
					                				}
					                				
					                			}
					                			
					                		}
					                	});
									}else if(zt=="终止"){
										$.ajax({
					                		type:"post",
					                		url:getContextPath()+"/login/getUser",
					                		async:false,
					                		data:{
					                		},
					                		success:function(json){
					                			
					                			if(json!=null &&json!=""){
					                				var arr = json.uPermissions.split(',');
					                				
					                				for(var i=0;i<arr.length;i++){
					                					var arr2 = arr[i].replace("+","");
					                					if(arr[i].indexOf("Peab") >= 0 ){
					                						$(".Peab").show();
					                					}
					                					if(arr[i].indexOf("Peac") >= 0 ){
					                						$(".Peac").show();
					                					}
					                					if(arr[i].indexOf("Peae") >= 0 ){
					                						$(".Peae").show();
					                					}
					                				}
					                				
					                			}
					                			
					                		}
					                	});
									}else if(zt=="审批中"){
										$.ajax({
					                		type:"post",
					                		url:getContextPath()+"/login/getUser",
					                		async:false,
					                		data:{
					                		},
					                		success:function(json){
					                			
					                			if(json!=null &&json!=""){
					                				var arr = json.uPermissions.split(',');
					                				
					                				for(var i=0;i<arr.length;i++){
					                					var arr2 = arr[i].replace("+","");
					                					if(arr[i].indexOf("Peab") >= 0 ){
					                						$(".Peab").show();
					                					}
					                					if(arr[i].indexOf("Peac") >= 0 ){
					                						$(".Peac").show();
					                					}
					                					if(arr[i].indexOf("Pead") >= 0 ){
					                						$(".Pead").show();
					                					}
					                				}
					                				
					                			}
					                			
					                		}
					                	});
									}
									
									
								},
         "order": false, 
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
        "buttons": [
		        	{
		                extend: "csv",
		                text: "导出csv",
		                bom: true,
		                filename: '任务单',
		                fieldSeparator: ',',
		                exportOptions: {
		                	format: {
		                        header: function ( data) {
		                            return data;
		                        },
		                        body: function ( data, columnIdx, rowIdx, code ) {
					                return data;
					            }
		                    },
		                    columns:[0,1,2,3,4,5,6,7,9,10]
		                }
		            }
		        ]
	});
    
    var tableje=$('#mainContenttjje').DataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 10,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
		            { "data": "prjNo"}, 
		            { "data": "prjName"},
		            { "data": "prjSource"},
		            { "data": "prjCompany"}, 
		            { "data": "prjType2"}, 
		            { "data": "ccName"}, 
		            { "data": "prjEstimateMoney"}, 
		            { "data": "tongjiMoney"}, 
		            { "data": "prjStartTime"}, 
		        ],
		        "columnDefs": [
								{	
										 "class": "tcenter",
									     "targets": 7,
									     "searchable": true,
									     "render": function(data, type, full) {
									    	 return "<b>"+data+"</b>";
							            }
						        }],
        "order": [[1, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
        "buttons": [
        	{
                extend: "csv",
                text: "导出csv",
                bom: true,
                filename: '部门金额统计表',
                fieldSeparator: ',',
                exportOptions: {
                	format: {
                        header: function ( data) {
                            return data;
                        },
                        body: function ( data, columnIdx, rowIdx, code ) {
                        	
			                return data;
			            }
                    },
                    columns:[0,1,2,3,4,5,6,7,8]
                }
            }
        ]
	});
    
    $(".hasinput").on( 'change', function () {
        table
            .column( $(this).parent().index()+':visible' )
            .search( this.value )
            .draw(false);
    } );
 
 
   table.buttons().container().appendTo( $('#tabBtn') );
   tableje.buttons().container().appendTo( $('#tabBtntj') );
   $('.buttons-csv').addClass('btn btn-primary');
   var table11=$('#xiangmubiao').dataTable({
       "deferRender": true,
       "processing": true,
       "bDestroy": true,
       "iDisplayLength": 5,
       "searching": true,
       "lengthChange": false,
       "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
					{ "data": null},
		            { "data": "prjNo"},
		            { "data": "prjName"},
		            { "data": "prjCompany"},
		            { "data": "prjType2"},
		            { "data": "ccName"},
		            
		        ],
		        "columnDefs": [
								{
										 "class": "tcenter",
										    "targets": 0,
										    "searchable": true,
										    "render": function(data, type, full) {
										  	  		return '<input type="radio" name="xiangmuName" style="width:16px;height:16px;">'
										        }
										  }
								],
       "order": [[1, 'asc']],
       "oLanguage": { //国际化配置
       "sProcessing": "正在获取数据，请稍后...",
       "sLengthMenu": "显示 _MENU_ 条",
       "sZeroRecords": "查询不到相关数据",
       "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
       "sInfoEmpty": "记录数为0",
       "sInfoFiltered": "(全部记录数 _MAX_ 条)",
       "sInfoPostFix": "",
       "sSearch": "搜索",
       "sUrl": "",
       "oPaginate": {
           "sFirst": "第一页",
           "sPrevious": "上一页",
           "sNext": "下一页",
           "sLast": "最后一页"
       }},
       
	});
    
    var table2=$('#history_table').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 10,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
		            { "data": "prjNo"}, 
		            { "data": "prjName"},
		            { "data": "prjCompany"}, 
		            { "data": "ccName"}, 
		            { "data": "makeTime"}, 
		            { "data": null},
		        ],
		        "columnDefs": [
								{	
										 "class": "tcenter",
										    "targets": 5,
										    "searchable": true,
										    "render": function(data, type, full) {
										  	  		return '<i class="iconfont icon-icon-test" style="font-size:20px;cursor:pointer;;margin-left:5px;" title="查看历史详细信息" onclick="lookHistory(this)"></i>'
										        }
										  }
								],
        "order": [[1, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
        
	});

    
	function initTabletjje(){
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/task/selectTaskTongjiByStatusAndDepart',
            dataType: 'json',
            data: {
            	departMentId:$("#bumenshaixuan").val(),
            	status:2
            },
            success: function (json) {
                $('#mainContenttjje').dataTable().fnClearTable();
                $('#mainContenttjje').DataTable().rows.add(json).draw(false);
            }
        });
    }
	$("#bumenshaixuan").on("change",function(){
		initTabletjje();
	})
  //初始化提交部门
	function initbumen(){
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/organizationManagement/selectProductionDepartment',
            dataType: 'json',
            data: {

            },
            error: function (msg) {
            	toastr.error("请求失败");
            },
            success: function (json) {
            	$("#seach_main_department").append("<option value='%'>全部</option>");
            	$("#seach_xb_department").append("<option value='%'>全部</option>");
                for(var i=0;i<json.length;i++){
                	$("#tijiaobumen").append("<option value="+json[i].omId+">"+json[i].omName+"</option>");
                	$("#zhuban").append("<option value="+json[i].omId+">"+json[i].omName+"</option>");
                	$("#xgzhuban").append("<option value="+json[i].omId+">"+json[i].omName+"</option>");
                	$("#seach_main_department").append("<option value="+json[i].omId+">"+json[i].omName+"</option>");
                	$("#seach_xb_department").append("<option value="+json[i].omId+">"+json[i].omName+"</option>");
                	$("#bumenshaixuan").append("<option value="+json[i].omId+">"+json[i].omName+"</option>");
                	$("#zhuban").trigger('change');
                	$("#xgzhuban").trigger('change');
                }
            }
		});
	}
    
	function initType(){
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/projectType/selectAllSecond',
            dataType: 'json',
            data: {
            },
            success: function (json) {
                $("#erjileixing").html("");
                $("#xgerjileixing").html("");
                
                for(var i=0;i<json.length;i++){
                	if(json[i]!=null){
                	$("#erjileixing").append("<option value='"+json[i].nameSecond+"'>"+json[i].nameSecond+"</option>")
                	$("#xgerjileixing").append("<option value='"+json[i].nameSecond+"'>"+json[i].nameSecond+"</option>")
                	}
                }
            }
        });
	}

    //初始化
    $("#zhuangtai").change(function(){
        var zt=$("#zhuangtai").val();
        var startMin=$("#seach_start_time_min").val();
        var startMax=$("#seach_start_time_max").val();
        var endMin=$("#seach_end_time_min").val();
        var endMax=$("#seach_end_time_max").val();
        var mainDp=$("#seach_main_department").val();
        var xbDp=$("#seach_xb_department").val();
        var prjMoneyMin=$("#seach_prj_money_min").val();
        var prjMoneyMax=$("#seach_prj_money_max").val();
        var contractMoneyMin=$("#seach_contract_money_min").val();
        var contractMoneyMax=$("#seach_contract_money_max").val();
        var zdMoneyMin=$("#seach_zd_money_min").val();
        var zdMoneyMax=$("#seach_zd_money_max").val();
        if(zt=="审批结束"){
        	$.ajax({
                type: 'POST',
                url: getContextPath()+'/task/selectTaskByStatus',
                dataType: 'json',
                data: {
                	status:2,
                	startMin:startMin,
                	startMax:startMax,
                	endMin:endMin,
                	endMax:endMax,
                	mainDp:mainDp,
                	xbDp:xbDp,
                	prjMoneyMin:prjMoneyMin,
                	prjMoneyMax:prjMoneyMax,
                	contractMoneyMin:contractMoneyMin,
                	contractMoneyMax:contractMoneyMax,
                	zdMoneyMin:zdMoneyMin,
                	zdMoneyMax:zdMoneyMax
                },
                success: function (json) {
                    $('#mainContent').dataTable().fnClearTable();
                    $('#mainContent').DataTable().rows.add(json).draw(false);
                    
                    $.ajax({
                		type:"post",
                		url:getContextPath()+"/login/getUser",
                		data:{
                		},
                		success:function(json){
                			
                			if(json!=null &&json!=""){
                				var arr = json.uPermissions.split(',');
                				
                				for(var i=0;i<arr.length;i++){
                					var arr2 = arr[i].replace("+","");
                					if(arr[i].indexOf("Peab") >= 0 ){
                						$(".Peab").show();
                					}
                					if(arr[i].indexOf("Peac") >= 0 ){
                						$(".Peac").show();
                					}
                					
                					if(arr[i].indexOf("Pead") >= 0 ){
                						$(".Pead").show();
                					}
                					if(arr[i].indexOf("Peag") >= 0 ){
                						$(".Peag").show();
                					}
                				}
                				
                			}
                			
                		}
                	});
                    
                    $(".chongqi").hide();
                    $(".Peac").show();//修改
                    $(".Pead").show();//中止
                    $(".iconlywj").show();
                }
            });
            
        }else if(zt=="终止"){
        	$.ajax({
                type: 'POST',
                url: getContextPath()+'/task/selectTaskByStatus',
                dataType: 'json',
                data: {
                	status:3,
                	startMin:startMin,
                	startMax:startMax,
                	endMin:endMin,
                	endMax:endMax,
                	mainDp:mainDp,
                	xbDp:xbDp,
                	prjMoneyMin:prjMoneyMin,
                	prjMoneyMax:prjMoneyMax,
                	contractMoneyMin:contractMoneyMin,
                	contractMoneyMax:contractMoneyMax,
                	zdMoneyMin:zdMoneyMin,
                	zdMoneyMax:zdMoneyMax
                },
                success: function (json) {
                    $('#mainContent').dataTable().fnClearTable();
                    $('#mainContent').DataTable().rows.add(json).draw(false);
                    
                    $.ajax({
                		type:"post",
                		url:getContextPath()+"/login/getUser",
                		data:{
                		},
                		success:function(json){
                			
                			if(json!=null &&json!=""){
                				var arr = json.uPermissions.split(',');
                				
                				for(var i=0;i<arr.length;i++){
                					var arr2 = arr[i].replace("+","");
                					if(arr[i].indexOf("Peab") >= 0 ){
                						$(".Peab").show();
                					}
                					
                					if(arr[i].indexOf("Peae") >= 0 ){
                						$(".Peae").show();
                					}
                					
                				}
                				
                			}
                			
                		}
                	});
                    
                    //$(".chongqi").show();
                    $(".Peac").hide();
                    $(".Pead").hide();
                    $(".iconlywj").hide();
                    
                   
                }
            });
            
        }else if(zt=="审批中"){
        	$.ajax({
                type: 'POST',
                url: getContextPath()+'/task/selectTaskByStatus',
                dataType: 'json',
                data: {
                	status:1,
                	startMin:startMin,
                	startMax:startMax,
                	endMin:endMin,
                	endMax:endMax,
                	mainDp:mainDp,
                	xbDp:xbDp,
                	prjMoneyMin:prjMoneyMin,
                	prjMoneyMax:prjMoneyMax,
                	contractMoneyMin:contractMoneyMin,
                	contractMoneyMax:contractMoneyMax,
                	zdMoneyMin:zdMoneyMin,
                	zdMoneyMax:zdMoneyMax
                },
                success: function (json) {
                    $('#mainContent').dataTable().fnClearTable();
                    $('#mainContent').DataTable().rows.add(json).draw(false);
                    
                    $.ajax({
                		type:"post",
                		url:getContextPath()+"/login/getUser",
                		data:{
                		},
                		success:function(json){
                			
                			if(json!=null &&json!=""){
                				var arr = json.uPermissions.split(',');
                				
                				for(var i=0;i<arr.length;i++){
                					var arr2 = arr[i].replace("+","");
                					if(arr[i].indexOf("Peab") >= 0 ){
                						$(".Peab").show();
                					}
                					
                				}
                				
                			}
                			
                		}
                	});
                    
                    $(".chongqi").hide();
                    $(".Peac").hide();
                    $(".Pead").hide();
                    $(".iconlywj").show();
                }
            });
            
        }
    })
    
    function seachAll(){
    	 $("#zhuangtai").trigger("change");
    }
    
	//超级搜索折叠div
    var zhediepanduan=true;
    $("#zhedieBtn").click(function(){
    	if(zhediepanduan==true){
    		$("#sousuodiv").show(300);
    		zhediepanduan=false;
    	}else{
    		$("#sousuodiv").hide(300);
    		zhediepanduan=true;
    	}
    })
    
     //增加部门
    function addBumen(){
    	if(($("#xieban tr").length)<=4){
	    	$("#xieban").append("<tr><td>"+"协办部门"+($("#xieban tr").length-1)+"</td><td>"
	                +'<form class="form-inline">'
	                    +'<select class="form-control" id="xieban'+($("#xieban tr").length-1)+'" style="width:180px;">'
	                    +'</select>'
	                    +'  <input type="text" id="xiebanMoney'+($("#xieban tr").length-1)+'" class="form-control" style="width:180px;margin-left:10px;" placeholder="金额">'
	                    +'  <input type="text" id="chenbenfentanbili'+($("#xieban tr").length-1)+'" class="form-control" style="width:180px;margin-left:10px;" placeholder="成本分摊比例" onchange="appendBfh(this)">'
	                    +'<button type="button" style="text-align:right;margin-left:10px;" class="btn btn-primary" onclick="deleteXieBan(this)">移除协办单位</button>'
	                +'</form>'
	                +"</td></tr>")
	                $.ajax({
	                    type: 'POST',
	                    url: getContextPath()+'/organizationManagement/selectProductionDepartment',
	                    dataType: 'json',
	                    data: {
	
	                    },
	                    error: function (msg) {
	                    	toastr.error("请求失败");
	                    },
	                    success: function (json) {
	                    	$("#xieban1").empty();
	                    	$("#xieban2").empty();
	                    	$("#xieban3").empty();
	                        for(var i=0;i<json.length;i++){
	                        	$("#xieban1").append("<option value="+json[i].omId+">"+json[i].omName+"</option>");
	                        	$("#xieban2").append("<option value="+json[i].omId+">"+json[i].omName+"</option>");
	                        	$("#xieban3").append("<option value="+json[i].omId+">"+json[i].omName+"</option>");
	                        }
	                    }
	        		});
    	}else{
    		toastr.error("协办部门已达上限")
    	}
    }
    function xgaddBumen(){
    	if(($("#xgxieban tr").length)<=4){
	    	$("#xgxieban").append("<tr><td>"+"协办部门"+($("#xgxieban tr").length-1)+"</td><td>"
	                +'<form class="form-inline">'
	                    +'<select class="form-control" id="xgxieban'+($("#xgxieban tr").length-1)+'" style="width:180px;">'
	                    +'</select>'
	                    +'  <input type="text" id="xgxiebanMoney'+($("#xgxieban tr").length-1)+'" class="form-control" style="width:180px;margin-left:10px;" placeholder="金额">'
	                    +'  <input type="text" id="xgchenbenfentanbili'+($("#xieban tr").length-1)+'" class="form-control" style="width:180px;margin-left:10px;" placeholder="成本分摊比例" onchange="appendBfh(this)">'
	                    +'<button type="button" style="text-align:right;margin-left:10px;" class="btn btn-primary" onclick="deleteXieBan(this)">移除协办单位</button>'
	                 +'</form>'
	                +"</td></tr>");
	                $.ajax({
	                    type: 'POST',
	                    url: getContextPath()+'/organizationManagement/selectProductionDepartment',
	                    dataType: 'json',
	                    data: {
	
	                    },
	                    error: function (msg) {
	                    	toastr.error("请求失败");
	                    },
	                    success: function (json) {
	                    	$("#xgxieban1").empty();
	                    	$("#xgxieban2").empty();
	                    	$("#xgxieban3").empty();
	                        for(var i=0;i<json.length;i++){
	                        	$("#xgxieban1").append("<option value="+json[i].omId+">"+json[i].omName+"</option>");
	                        	$("#xgxieban2").append("<option value="+json[i].omId+">"+json[i].omName+"</option>");
	                        	$("#xgxieban3").append("<option value="+json[i].omId+">"+json[i].omName+"</option>");
	                        }
	                    }
	        		});
    	}else{
    		toastr.error("协办部门已达上限")
    	}
    }
    
    //回显协办部门
    function xiebanhuixian(obj1,obj2,obj3){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/organizationManagement/selectProductionDepartment',
            dataType: 'json',
            async:false,
            data: {

            },
            error: function (msg) {
            	toastr.error("请求失败");
            },
            success: function (json) {
            	$("#xgxieban1").empty();
            	$("#xgxieban2").empty();
            	$("#xgxieban3").empty();
                for(var i=0;i<json.length;i++){
                	$("#xgxieban1").append("<option value="+json[i].omId+">"+json[i].omName+"</option>");
                	$("#xgxieban2").append("<option value="+json[i].omId+">"+json[i].omName+"</option>");
                	$("#xgxieban3").append("<option value="+json[i].omId+">"+json[i].omName+"</option>");
                }
                $("#xgxieban1").val(obj1);
                $("#xgxieban2").val(obj2);
                $("#xgxieban3").val(obj3);
            }
		});
    }
    
	$("#zhuban").change(function(){
		var bumen=$("#zhuban").val();
		$.ajax({
			type:"POST",
			url:getContextPath()+"/user/selectUserByomId",
			dataTyepe:"json",
			async:false,
			data:{ 
				omId:bumen 
				},
			success:function(json){
				$("#xmfzr").empty();
				$("#zrgcs").empty();
				$("#qtzyglry").empty();
				for(var i=0;i<json.length;i++){
					$("#xmfzr").append("<option value='" + json[i].userId + "'>"
		                    + json[i].uName + "</option>");
					$("#zrgcs").append("<option value='" + json[i].userId + "'>"
		                    + json[i].uName + "</option>");
					$("#qtzyglry").append("<option value='" + json[i].userId + "'>"
		                    + json[i].uName + "</option>");
				}
			}
		})
	})
	$("#xgzhuban").change(function(){
		var bumen=$("#xgzhuban").val();
		$.ajax({
			type:"POST",
			url:getContextPath()+"/user/selectUserByomId",
			dataTyepe:"json",
			async:false,
			data:{ 
				omId:bumen 
				},
			success:function(json){
				$("#xgxmfzr").empty();
				$("#xgzrgcs").empty();
				$("#xgqtzyglry").empty();
				for(var i=0;i<json.length;i++){
					$("#xgxmfzr").append("<option value='" + json[i].userId + "'>"
		                    + json[i].uName + "</option>");
					$("#xgzrgcs").append("<option value='" + json[i].userId + "'>"
		                    + json[i].uName + "</option>");
					$("#xgqtzyglry").append("<option value='" + json[i].userId + "'>"
		                    + json[i].uName + "</option>");
				}
			}
		})
	})
    //初始化提交人员
	function initbushei(){
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/user/selectAllUser',
            dataType: 'json',
            data: {

            },
            error: function (msg) {
            	toastr.error("请求失败");
            },
            success: function (json) {
                for(var i=0;i<json.length;i++){
                	$("#tijiaoshei").append("<option value="+json[i].uName+">"+json[i].uName+"</option>");
                }
            }
		});
	}
	//初始化职务
	function initbzhiwu(){
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/jobc/selectJobByType',
            dataType: 'json',
            data: {

            },
            error: function (msg) {
            	toastr.error("请求失败");
            },
            success: function (json) {
                for(var i=0;i<json.length;i++){
                	$("#tijiaozhiwu").append("<option value="+json[i].dutyDesc+">"+json[i].dutyDesc+"</option>");
                }
            }
		});
	}
    //甲方单位
    function leixingSelect2(){
	    $.ajax({
	        type: 'POST',
	        url: getContextPath()+'/cooperator/selectCooperatorIdAndNameByCcType',
	        dataType: 'json',
	        async:false,
	        data: {
	           ccType:'业主单位'
	        },
	        success: function (json) {
	        	$("#yezhudanwei").html('');
	        	$("#xgyezhudanwei").html('');
	        	 for(var i=0;i<json.length;i++){
	        		$("#yezhudanwei").append( "<option value='" + json[i].ccId + "'>"
		                    + json[i].ccName + "</option>")
		                    $("#xgyezhudanwei").append( "<option value='" + json[i].ccId + "'>"
                    + json[i].ccName + "</option>")
	        	}
	        	
	        	 $("#yezhudanwei").trigger("change");
	        	 $("#xgyezhudanwei").trigger("change");
	        }
	    });
	}
    function initSelect2WithSearch(){
        $("#yezhudanwei").select2({
            tags: true,
            placeholder: '请搜索或选择语言',
            allowClear: true
        });
        $("#xgyezhudanwei").select2({
            tags: true,
            placeholder: '请搜索或选择语言',
            allowClear: true
        });
    }
    

    var lianxiid;
    $("#yezhudanwei").on("change",function(){
    	var yezhudanwei=$("#yezhudanwei").val();
    	$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/task/getEnterpriseById',
	        dataType: 'json',
	        data: {
	           id:yezhudanwei
	        },
	        success: function (json) {
	        	$("#lianxiren").html('');
	        	
	        	for(var i=0;i<json.length;i++){
	        		lianxiid=json[0].eId
	        		$("#lianxiren").append("<option data-id="+json[i].eId+" value="+json[i].eMan+">"+json[i].eMan+"</option>");
	        	}
	        	
	        	$("#lianxiren").trigger("change");
	        }
    	});
    })
    
    var xglianxiid;
    $("#xgyezhudanwei").on("change",function(){
    	var yezhudanwei=$("#xgyezhudanwei").val();
    	$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/task/getEnterpriseById',
	        dataType: 'json',
	        data: {
	           id:yezhudanwei
	        },
	        success: function (json) {
	        	$("#xglianxiren").html('');
	        	
	        	for(var i=0;i<json.length;i++){
	        		xglianxiid=json[0].eId
	        		$("#xglianxiren").append("<option value="+json[i].eMan+">"+json[i].eMan+"</option>");
	        	}
	        	$("#xglianxiren").trigger("change");
	        }
    	});
    })
    
    $("#lianxiren").on("change",function(){
    	var yezhudanwei=$("#yezhudanwei").val();
    	var name=$("#lianxiren").val();
    	$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/task/getEnterpriseByIdAndName',
	        dataType: 'json',
	        data: {
	           id:yezhudanwei,
	           name:name
	        },
	        success: function (json) {
	        	$("#lianxifangshi").html('');
	        	for(var i=0;i<json.length;i++){
	        		$("#lianxifangshi").append("<option value="+json[i].eTel+">"+json[i].eTel+"</option>");
	        	}
	        }
    	});
    })
    
     $("#xglianxiren").on("change",function(){
    	var yezhudanwei=$("#xgyezhudanwei").val();
    	var name=$("#xglianxiren").val();
    	$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/task/getEnterpriseByIdAndName',
	        dataType: 'json',
	        data: {
	           id:yezhudanwei,
	           name:name
	        },
	        success: function (json) {
	        	$("#xglianxifangshi").html('');
	        	for(var i=0;i<json.length;i++){
	        		$("#xglianxifangshi").append("<option value="+json[i].eTel+">"+json[i].eTel+"</option>");
	        	}
	        }
    	});
    })

    function saveGuanliren(){
    	
		 $.ajax({
	        type: 'POST',
	        url: getContextPath()+'/cooperator/countOfEnterprise',
	        dataType: 'json',
	        data:{
	        	eId:lianxiid,
	        	eMan:$("#xinjianlianxiren").val(),
	        	eTel:$("#xinjianlianxifangshi").val()
	        },
	        success: function (json) {
	        	
	        	$("#lianxibiaoge tbody").append("<tr><td>"
	        			+'<input type="text" class="form-control" value='+$("#xinjianlianxiren").val()+' disabled>'
	        			+"</td><td>"
	        			+'<input type="text" class="form-control" value='+$("#xinjianlianxifangshi").val()+' disabled>'
	        			+"</td><td><button type='button' style='text-align:right;' class='btn btn-primary' onclick='deleteLianxiren(this)'>移除联系人</button></td></tr>")
	        }
	    });
		
    }

    function xgsaveGuanliren(){
    	
		 $.ajax({
	        type: 'POST',
	        url: getContextPath()+'/cooperator/countOfEnterprise',
	        dataType: 'json',
	        data:{
	        	eId:xglianxiid,
	        	eMan:$("#xinjianlianxiren").val(),
	        	eTel:$("#xinjianlianxifangshi").val()
	        },
	        success: function (json) {
	        	
	        	$("#xglianxibiaoge tbody").append("<tr><td>"
	        			+'<input type="text" class="form-control" value='+$("#xinjianlianxiren").val()+' disabled>'
	        			+"</td><td>"
	        			+'<input type="text" class="form-control" value='+$("#xinjianlianxifangshi").val()+' disabled>'
	        			+"</td><td><button type='button' style='text-align:right;' class='btn btn-primary' onclick='deleteLianxiren(this)'>移除联系人</button></td></tr>")
	        }
	    });
		
    }
  //增加联系人联系电话
    function addLianxiren(aa){
    	var eid=$(aa).parent().prev().prev().prev().find("select").find("option:selected").attr("data-id");
	    var dianhua=$(aa).parent().prev().find("select").val();
	    var ren=$(aa).parent().prev().prev().prev().find("select").val();
    	$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/cooperator/countOfEnterprise',
	        dataType: 'json',
	        data:{
	        	eId:eid,
	        	eMan:dianhua,
	        	eTel:ren
	        },
	        success: function (json) {
	        	var lianxiren=$("#lianxiren").val();
	        	var lianxifangshi=$("#lianxifangshi").val();
	        	if(lianxiren==null||lianxifangshi==null||lianxiren==''||lianxifangshi==''){
	        		toastr.error("联系人或联系方式为空");
	        		return;
	        	}
	        	$("#lianxibiaoge tbody").append("<tr><td>"
	        			+'<input type="text" class="form-control" value='+lianxiren+' disabled>'
	        			+"</td><td>"
	        			+'<input type="text" class="form-control" value='+lianxifangshi+' disabled>'
	        			+"</td><td><button type='button' style='text-align:right;' class='btn btn-primary' onclick='deleteLianxiren(this)'>移除联系人</button></td></tr>")
	        }
	    }); 
    }
    
    function xgaddLianxiren(){
    	var xglianxiren=$("#xglianxiren").val();
    	var xglianxifangshi=$("#xglianxifangshi").val();
    	if(xglianxiren==null||xglianxifangshi==null||xglianxiren==''||xglianxifangshi==''){
    		toastr.error("联系人或联系方式为空");
    		return;
    	}
    	$("#xglianxibiaoge tbody").append("<tr><td>"
    			+'<input type="text" class="form-control" value='+xglianxiren+' disabled>'
    			+"</td><td>"
    			+'<input type="text" class="form-control" value='+xglianxifangshi+' disabled>'
    			+"</td><td><button type='button' style='text-align:right;' class='btn btn-primary' onclick='deleteLianxiren(this)'>移除联系人</button></td></tr>")
    }
   
    //B项目类型
    $(".shishe").hide();
    $(".chushe").hide();
    $(".yugongke").hide();
    $("#erjileixing").click(function(){
    	var zhi=$("#erjileixing option:selected").text()
    	if(zhi.indexOf("B1") >= 0 ){
    		$(".shishe").show();
    		$(".chushe").hide();
    	    $(".yugongke").hide();
    	}else if(zhi.indexOf("B2") >= 0 ){
    		$(".shishe").show();
    		$(".chushe").show();
    		$(".yugongke").hide();
    	}else if(zhi.indexOf("B3") >= 0 ){
    		$(".shishe").show();
    		$(".chushe").show();
    		$(".yugongke").show();
    	}else if(zhi.indexOf("B4") >= 0 ){
    		$(".shishe").show();
    		$(".chushe").hide();
    		$(".yugongke").show();
    	}else{
    		$(".shishe").hide();
    	    $(".chushe").hide();
    	    $(".yugongke").hide();
    	}
    })
    //xiugai B项目类型
    $(".xgshishe").hide();
    $(".xgchushe").hide();
    $(".xgyugongke").hide();
    $("#xgerjileixing").click(function(){
    	var zhi=$("#xgerjileixing option:selected").text()
    	if(zhi.indexOf("B1") >= 0 ){
    		$(".xgshishe").show();
    		$(".xgchushe").hide();
    	    $(".xgyugongke").hide();
    	}else if(zhi.indexOf("B2") >= 0 ){
    		$(".xgshishe").show();
    		$(".xgchushe").show();
    		$(".xgyugongke").hide();
    	}else if(zhi.indexOf("B3") >= 0 ){
    		$(".xgshishe").show();
    		$(".xgchushe").show();
    		$(".xgyugongke").show();
    	}else if(zhi.indexOf("B4") >= 0 ){
    		$(".xgshishe").show();
    		$(".xgchushe").hide();
    		$(".xgyugongke").show();
    	}else{
    		$(".xgshishe").hide();
    	    $(".xgchushe").hide();
    	    $(".xgyugongke").hide();
    	}
    })
    
    //添加任务单
    function addrenwudan(){
    	var danwei= new Array();
    	var lianxibiao= new Array();
    	$("#lianxibiaoge tbody").find("tr").each(function(){
    		var name = $(this).find("input").eq(0).val();
    	    var way = $(this).find("input").eq(1).val();
    	    
    	    var xinlianxibiao={
    	    		eId:undefined,
    				eMan:undefined,
    				eTel:undefined
    	    }
    	    xinlianxibiao.eId=null;
    	    xinlianxibiao.eMan=name;
    	    xinlianxibiao.eTel=way;
    	    lianxibiao.push(xinlianxibiao);
    	})
    	
    	var a=1;
    	$("#profile").find("input").each(function(){
    		var aa=$(this).val();
    		if(aa==null||aa==''){
    			a=0;
    		}
    	})
    	//if(a==0){
    		//toastr.error("请填写完整");
			//return;
    	//}
    	
    	    /* var yiji=$("#yijileixing").find("option:selected").val(); */
	    	var erji=$("#erjileixing").find("option:selected").val();
    		var taskName=$("#taskName").val();
        	var taskbianhao=$("#taskbianhao").val();
        	var mainPrjNo=$("#main_prj_no").val();
        	var moshi=$("#moshi").find("option:selected").val();
        	var gongsi=$("#gongsi").find("option:selected").val();
        	var yezhudanwei=$("#yezhudanwei").val();
        	var city=$("#city-picker3").val();
        	var importance=$("#importance").val();
        	var prjSource=$("#prj_source").val();
        	var jine=$("#jine").val();
        	var hetonge=$("#hetonge").val();
        	var zandingjin=$("#zandingjin").val();
        	var startTime=$("#year").val();
        	var endTime=$("#year2").val();
        	var zhuban=$("#zhuban").val();
        	var zhubanjine=$("#zhubanjine").val();
        	var chenbenfentanbili=$("#chenbenfentanbili").val();
        	var xieban1=$("#xieban1").find("option:selected").val();
        	var xieban1jine=$("#xiebanMoney1").val();
        	var chenbenfentanbili1=$("#chenbenfentanbili1").val();
        	var xieban2=$("#xieban2").find("option:selected").val();
        	var xieban2jine=$("#xiebanMoney2").val();
        	var chenbenfentanbili2=$("#chenbenfentanbili2").val();
        	var xieban3=$("#xieban3").find("option:selected").val();
        	var xieban3jine=$("#xiebanMoney3").val();
        	var chenbenfentanbili3=$("#chenbenfentanbili3").val();
        	var gaikuang=$("#gaikuang").val();
        	
        	if(taskName==''){
	    		toastr.error("项目名称不能为空");
	    		return;
	    	}
			
			var yugongke = $("#yugongke").val().replace("%","");
    	    var chushe = $("#chushe").val().replace("%","");
    	    var shishe = $("#shishe").val().replace("%","");
    	    var allLei=0;
    	    if(yugongke!=""&&yugongke!=null){
    	    	yugongke = parseInt(yugongke);
    	    	allLei+=yugongke;
    	    }
    	    if(chushe!=""&&chushe!=null){
    	    	chushe = parseInt(chushe);
    	    	allLei+=chushe
    	    }
    	    if(shishe!=""&&shishe!=null){
    	    	shishe = parseInt(shishe);
    	    	allLei+=shishe
    	    }
    	    
    	    var xindanwei={
    	    		prjType2:undefined,
    	    		prjNo:undefined,
    	    		prjName:undefined,
    	    		prjArea:undefined,
    	    		mainPrjNo:undefined,
    	    		importance:undefined,
	            	prjManagementModel:undefined,
	            	prjCompany:undefined,
	            	prjSource:undefined,
	            	prjOwnerUnit:undefined,
	            	workContent:undefined,
	            	prjEstimateMoney:undefined,
	            	contractMoney:undefined,
	            	provisionalSum:undefined,
	            	prjStartTime:undefined,
	            	prjEndTime:undefined,
	            	mainDepartment:undefined,
	            	mainDepartmentMoney:undefined,
	            	mainDepartmentCost:undefined,
	            	assistDepartment1:undefined,
	            	assistDepartment1Money:undefined,
	            	assistDepartment1Cost:undefined,
	            	assistDepartment2:undefined,
	            	assistDepartment2Money:undefined,
	            	assistDepartment2Cost:undefined,
	            	assistDepartment3:undefined,
	            	assistDepartment3Money:undefined,
	            	assistDepartment3Cost:undefined,
	            	enterprise:undefined,
   			}

    	    xindanwei.prjArea=city;
    	    xindanwei.importance=importance;
    	    xindanwei.prjType2=erji,
    	    xindanwei.prjNo=taskbianhao,
    	    xindanwei.mainPrjNo=mainPrjNo;
    	    xindanwei.prjName=taskName,
    	    xindanwei.prjManagementModel=moshi,
    	    xindanwei.prjCompany=gongsi,
    	    xindanwei.prjSource=prjSource,
    	    xindanwei.prjOwnerUnit=yezhudanwei,
    	    xindanwei.workContent=gaikuang,
    	    xindanwei.prjEstimateMoney=jine,
    	    xindanwei.contractMoney=hetonge,
    	    xindanwei.provisionalSum=zandingjin,
    	    xindanwei.prjStartTime=startTime,
    	    xindanwei.prjEndTime=endTime,
    	    xindanwei.mainDepartment=zhuban,
    	    xindanwei.mainDepartmentMoney=zhubanjine,
    	    xindanwei.mainDepartmentCost=chenbenfentanbili,
    	    xindanwei.assistDepartment1=xieban1,
    	    xindanwei.assistDepartment1Money=xieban1jine,
    	    xindanwei.assistDepartment1Cost=chenbenfentanbili1,
    	    xindanwei.assistDepartment2=xieban2,
    	    xindanwei.assistDepartment2Money=xieban2jine,
    	    xindanwei.assistDepartment2Cost=chenbenfentanbili2,
    	    xindanwei.assistDepartment3=xieban3,
    	    xindanwei.assistDepartment3Money=xieban3jine,
    	    xindanwei.assistDepartment3Cost=chenbenfentanbili3,
    	    xindanwei.enterprise=lianxibiao,
    	    xindanwei.yugongkebili = yugongke;
    	    xindanwei.chushebili = chushe;
    	    xindanwei.shishebili = shishe;
    	    danwei.push(xindanwei);
    		//console.log(danwei)
    	    $.ajax({
	            type: 'POST',
	            url: getContextPath()+'/task/addTask',
	            dataType: 'json',
	            contentType: "application/json", 
	            data:JSON.stringify(danwei),
	            success: function (json) {
	            	if(json==0){
	            		toastr.error("保存失败")
	            	}else{
	            		toastr.success("保存成功")
	            		quxiao();
	            	}
	            }
	        });
    }
 
  //提交任务单
  var lianjie;
    function tijiaorenwudan(){
    	var danwei= new Array();
    	var lianxibiao= new Array();
    	$("#lianxibiaoge tbody").find("tr").each(function(){
    		var name = $(this).find("input").eq(0).val();
    	    var way = $(this).find("input").eq(1).val();
    	    
    	    var xinlianxibiao={
    	    		eId:undefined,
    				eMan:undefined,
    				eTel:undefined
    	    }
    	    xinlianxibiao.eId=null;
    	    xinlianxibiao.eMan=name;
    	    xinlianxibiao.eTel=way;
    	    lianxibiao.push(xinlianxibiao);
    	})
    	var a=1;
    	$("#profile").find("input").each(function(){
    		var aa=$(this).val();
    		if(aa==null||aa==''){
    			a=0;
    		}
    	})
    	//if(a==0){
    		//toastr.error("请填写完整");
			//return;
    	//}
    	
   		if(lianxibiao.length!=0){
   			var erji=$("#erjileixing").find("option:selected").val();
    		var taskName=$("#taskName").val();
        	var taskbianhao=$("#taskbianhao").val();
        	var mainPrjNo=$("#main_prj_no").val();
        	var moshi=$("#moshi").find("option:selected").val();
        	var gongsi=$("#gongsi").find("option:selected").val();
        	var yezhudanwei=$("#yezhudanwei").val();
        	var city=$("#city-picker3").val();
        	var importance=$("#importance").val();
        	var prjSource=$("#prj_source").val();
        	var jine=$("#jine").val();
        	var hetonge=$("#hetonge").val();
        	var zandingjin=$("#zandingjin").val();
        	var startTime=$("#year").val();
        	var endTime=$("#year2").val();
        	var zhuban=$("#zhuban").val();
        	var zhubanjine=$("#zhubanjine").val();
        	var chenbenfentanbili=$("#chenbenfentanbili").val();
        	var xieban1=$("#xieban1").find("option:selected").val();
        	var xieban1jine=$("#xiebanMoney1").val();
        	var chenbenfentanbili1=$("#chenbenfentanbili1").val();
        	var xieban2=$("#xieban2").find("option:selected").val();
        	var xieban2jine=$("#xiebanMoney2").val();
        	var chenbenfentanbili2=$("#chenbenfentanbili2").val();
        	var xieban3=$("#xieban3").find("option:selected").val();
        	var xieban3jine=$("#xiebanMoney3").val();
        	var chenbenfentanbili3=$("#chenbenfentanbili3").val();
        	var gaikuang=$("#gaikuang").val();
        	
        	if(taskName==''){
	    		toastr.error("项目名称不能为空");
	    		return;
	    	}
        	if(city==''){
	    		toastr.error("所属区域不能为空");
	    		return;
	    	}
        	if(moshi==''){
	    		toastr.error("项目经营模式不能为空");
	    		return;
	    	}
        	if(erji==''){
	    		toastr.error("项目类型不能为空");
	    		return;
	    	}
        	if(gongsi==''){
	    		toastr.error("合同所属公司不能为空");
	    		return;
	    	}
        	if(yezhudanwei==''){
	    		toastr.error("甲方单位不能为空");
	    		return;
	    	}
        	if(jine==''){
	    		toastr.error("任务金额不能为空");
	    		return;
	    	}
        	if(hetonge==''){
	    		toastr.error("合同金额不能为空");
	    		return;
	    	}
        	if(prjSource==''){
	    		toastr.error("项目来源不能为空");
	    		return;
	    	}
        	if(zhuban==''){
	    		toastr.error("主办部门不能为空");
	    		return;
	    	}
        	if(zandingjin==''){
	    		toastr.error("暂定金不能为空");
	    		return;
	    	}
        	
        	var all_bili=0;
        	var allMoney=0;
        	if(zhuban!=''&&zhuban!=undefined){
        		if(chenbenfentanbili==''){
        			toastr.error("成本分摊比例不能为空");
    	    		return;
        		}else{
        			var bili=chenbenfentanbili.replace("%","");
        			all_bili=all_bili+parseInt(bili);
        		}
        		allMoney=allMoney+parseInt(zhubanjine);
        	}
        	if(xieban1!=''&&xieban1!=undefined){
        		if(chenbenfentanbili1==''){
        			toastr.error("成本分摊比例不能为空");
    	    		return;
        		}else{
        			var bili1=chenbenfentanbili1.replace("%","");
        			all_bili=all_bili+parseInt(bili1);
        		}
        		allMoney=allMoney+parseInt(xieban1jine);
        	}
			if(xieban2!=''&&xieban2!=undefined){
				if(chenbenfentanbili2==''){
        			toastr.error("成本分摊比例不能为空");
    	    		return;
        		}else{
        			var bili2=chenbenfentanbili2.replace("%","");
        			all_bili=all_bili+parseInt(bili2);
        		}
				allMoney=allMoney+parseInt(xieban2jine);
        	}
			if(xieban3!=''&&xieban3!=undefined){
				if(chenbenfentanbili3==''){
        			toastr.error("成本分摊比例不能为空");
    	    		return;
        		}else{
        			var bili3=chenbenfentanbili3.replace("%","");
        			all_bili=all_bili+parseInt(bili3);
        		}
				allMoney=allMoney+parseInt(xieban3jine);
        	}
			if(allMoney!=jine){
				toastr.error("主协办金额分配错误");
	    		return;
			}
			if(all_bili!=100){
				toastr.error("成本分摊比例总和不等于100%");
	    		return;
			}
			var yugongke = $("#yugongke").val().replace("%","");
    	    var chushe = $("#chushe").val().replace("%","");
    	    var shishe = $("#shishe").val().replace("%","");
    	    var allLei=0;
    	    if(yugongke!=""&&yugongke!=null){
    	    	yugongke = parseInt(yugongke);
    	    	allLei+=yugongke;
    	    }
    	    if(chushe!=""&&chushe!=null){
    	    	chushe = parseInt(chushe);
    	    	allLei+=chushe
    	    }
    	    if(shishe!=""&&shishe!=null){
    	    	shishe = parseInt(shishe);
    	    	allLei+=shishe
    	    }
    	    
    	    if(erji.indexOf("B")>=0){
   	    	 if(allLei!=100){
 					toastr.error("项目B类百分比分配有误");
 		    		return;
  				}
  			}
    	   
    	    var xindanwei={
    	    		prjType2:undefined,
    	    		prjNo:undefined,
    	    		prjName:undefined,
    	    		prjArea:undefined,
    	    		mainPrjNo:undefined,
    	    		importance:undefined,
	            	prjManagementModel:undefined,
	            	prjCompany:undefined,
	            	prjSource:undefined,
	            	prjOwnerUnit:undefined,
	            	workContent:undefined,
	            	prjEstimateMoney:undefined,
	            	contractMoney:undefined,
	            	provisionalSum:undefined,
	            	prjStartTime:undefined,
	            	prjEndTime:undefined,
	            	mainDepartment:undefined,
	            	mainDepartmentMoney:undefined,
	            	mainDepartmentCost:undefined,
	            	assistDepartment1:undefined,
	            	assistDepartment1Money:undefined,
	            	assistDepartment1Cost:undefined,
	            	assistDepartment2:undefined,
	            	assistDepartment2Money:undefined,
	            	assistDepartment2Cost:undefined,
	            	assistDepartment3:undefined,
	            	assistDepartment3Money:undefined,
	            	assistDepartment3Cost:undefined,
	            	enterprise:undefined,
   			}

    	    xindanwei.prjArea=city;
    	    xindanwei.importance=importance;
    	    xindanwei.prjType2=erji,
    	    xindanwei.prjNo=taskbianhao,
    	    xindanwei.mainPrjNo=mainPrjNo;
    	    xindanwei.prjName=taskName,
    	    xindanwei.prjManagementModel=moshi,
    	    xindanwei.prjCompany=gongsi,
    	    xindanwei.prjSource=prjSource,
    	    xindanwei.prjOwnerUnit=yezhudanwei,
    	    xindanwei.workContent=gaikuang,
    	    xindanwei.prjEstimateMoney=jine,
    	    xindanwei.contractMoney=hetonge,
    	    xindanwei.provisionalSum=zandingjin,
    	    xindanwei.prjStartTime=startTime,
    	    xindanwei.prjEndTime=endTime,
    	    xindanwei.mainDepartment=zhuban,
    	    xindanwei.mainDepartmentMoney=zhubanjine,
    	    xindanwei.mainDepartmentCost=chenbenfentanbili,
    	    xindanwei.assistDepartment1=xieban1,
    	    xindanwei.assistDepartment1Money=xieban1jine,
    	    xindanwei.assistDepartment1Cost=chenbenfentanbili1,
    	    xindanwei.assistDepartment2=xieban2,
    	    xindanwei.assistDepartment2Money=xieban2jine,
    	    xindanwei.assistDepartment2Cost=chenbenfentanbili2,
    	    xindanwei.assistDepartment3=xieban3,
    	    xindanwei.assistDepartment3Money=xieban3jine,
    	    xindanwei.assistDepartment3Cost=chenbenfentanbili3,
    	    xindanwei.enterprise=lianxibiao,
    	    xindanwei.yugongkebili = yugongke;
    	    xindanwei.chushebili = chushe;
    	    xindanwei.shishebili = shishe;
    	    danwei.push(xindanwei);
    		
    	     $.ajax({
	            type: 'POST',
	            url: getContextPath()+'/task/addTask2',
	            dataType: 'json',
	            contentType: "application/json", 
	            data:JSON.stringify(danwei),
	            success: function (json) {
	            	lianjie=json.url;
	            	if(json.receiver!=null&&json.receiver.length>=1){
		            	  $("#tijiaogei").modal('show');
		        		  $("#tijiaoren tbody").empty("");
		        		  for(var i=0;i<json.receiver.length;i++){
		        			  $("#tijiaoren tbody").append('<tr><td>'
		        					  +'<input type="radio" name="tijiaorenming" data-id="'+json.receiver[i].userId+'" data-id2="'+json.receiver[i].omId+'" data-id3="'+json.receiver[i].dutyId+'">'
		        					  +'</td><td>'
		        					  +json.receiver[i].omName
		        					  +'</td><td>'
		        					  +json.receiver[i].dutyName
		        					  +'</td><td>'
		        					  +json.receiver[i].uName
		        					  +'</td></tr>');
		        		  }
		        	  }else if(json.receiver.length==1){
		        		  $.ajax({
		        	          type: 'POST',
		        	          url: getContextPath()+'/task/addTask4',
		        	          dataType: 'json',
		        	          data:{
		        	        	  url:json.url,
		        	        	  userId:json.receiver.userId,
		        	        	  uName:json.receiver.uName,
		        	        	  omName:json.receiver.omName,
		        	        	  dutyName:json.receiver.dutyName,
		        	        	  omId:json.receiver.omId,
		        	        	  dutyId:json.receiver.dutyId
		        	          },
		        	          success: function (json) {
		        	        	  toastr.success('提交成功');
		        	          }
		        	      }); 
		        	  }
	            	
	            }
	        });
    	//$('#myModal').modal('hide');
   		}else{
   			toastr.error("请至少输入一条联系人联系方式")
   			return;
   		}
    	quxiao();
    }
    
  function tijiaorenwudan2(){
	  var uid=$("input[name='tijiaorenming']:checked").attr("data-id");
	  var omid=$("input[name='tijiaorenming']:checked").attr("data-id2");
	  var dutyid=$("input[name='tijiaorenming']:checked").attr("data-id3");
	  var bmmc=$("input[name='tijiaorenming']:checked").parent().next().text();
	  var zw=$("input[name='tijiaorenming']:checked").parent().next().next().text();
	  var uname=$("input[name='tijiaorenming']:checked").parent().next().next().next().text();
	  //var uname=$("input[name='tijiaorenming']:checked").val();
	$.ajax({
          type: 'POST',
          url: getContextPath()+'/task/addTask4',
          dataType: 'json',
          data:{
        	  url:lianjie,
        	  userId:uid,
        	  uName:uname,
        	  omName:bmmc,
        	  dutyName:zw,
        	  omId:omid,
        	  dutyId:dutyid
          },
          success: function (json) {
        	  toastr.success('提交成功');
          }
      });  
	
  }
    //修改任务单
    var xiugaiid;
    $('#mainContent').delegate('#Changedanwei','click', function () {

  		var dom = $(this).parents('tr');
		var data=$('#mainContent').DataTable().row(dom).data();
		var length = data.cjId;
		if(length!=null&&length!=undefined&&length!=""){
			$("#xgjine").attr("disabled","true");
			$("#xghetonge").attr("disabled","true");
			$("#xgzandingjin").attr("disabled","true");
		}else{
			$("#xgjine").removeAttr("disabled");
			$("#xghetonge").removeAttr("disabled");
			$("#xgzandingjin").removeAttr("disabled");
		}
		xiugaiid=data.prjId;
	  		$.ajax({
	            type: 'POST',
	            url: getContextPath()+'/task/selectTaskById',
	            dataType: 'json',
	            data: {
	            	id:data.prjId
	            },
	            success: function (json) {
	            	/* $("#xgyijileixing").val(json.prjType1); */
	            	/* $("#xgyijileixing").trigger("change"); */
	            	$("#xgerjileixing").val(json.prjType2);
	            	$("#xgshishe").val(json.shishebili);
	            	$("#xgchushe").val(json.chushebili);
	            	$("#xgyugongke").val(json.yugongkebili);
	            	$("#xgerjileixing").trigger("click");
	            	
	        		$("#xgtaskName").val(json.prjName);
	            	$("#xgtaskbianhao").val(json.prjNo);
	            	$("#xgmoshi").val(json.prjManagementModel);
	            	$("#xggongsi").val(json.prjCompany1);
	            	/* 回显城市 */
	            	var area=json.prjArea;
	            	if(area!=''&&area!=null){
	            		var province=area.split("/")[0];
		            	var city=area.split("/")[1];
		            	var district=area.split("/")[2];
		            	$("#edit_city").citypicker("reset");
		          		$("#edit_city").citypicker("destroy");
		          		$("#edit_city").citypicker({
		          			province:province,
		          			city:city,
		          			district:district
		          		});
	            	}
	            	
	            	$("#edit_importance").val(json.importance);
	            	$("#xg_prj_source").val(json.prjSource);
	            	$("#xgyezhudanwei").val(json.prjOwnerUnit).select2();
	            	$("#xgyezhudanwei").trigger("change");
	            	$("#xgjine").val(json.prjEstimateMoney);
	            	$("#xghetonge").val(json.contractMoney);
	            	$("#xgzandingjin").val(json.provisionalSum);
	            	$("#xgstartTime").val(json.prjStartTime);
	            	$("#xgendTime").val(json.prjEndTime);
	            	$("#xgzhuban").val(json.mainDepartment);
	            	$("#xgzhubanjine").val(json.mainDepartmentMoney);
	            	$("#xgchenbenfentanbili").val(json.mainDepartmentCost);
	            	$("#xggaikuang").val(json.workContent);
	            	/* var xieban1=$("#xgxieban1").val(json.assistDepartment1);
	            	var xieban1jine=$("#xgxiebanMoney1").val(json.assistDepartment1Money);
	            	var xieban2=$("#xgxieban2").val(json.assistDepartment2);
	            	var xieban2jine=$("#xgxiebanMoney2").val(json.assistDepartment2Money);
	            	var xieban3=$("#xgxieban3").val(json.assistDepartment3);
	            	var xieban3jine=$("#xgxiebanMoney3").val(json.assistDepartment3Money); */
	            	
	            	$("#xglianxibiaoge tbody").empty();
	            	$("#xgxieban .xieban").empty();
	            	for(var i=0;i<json.enterprise.length;i++){
	            		$("#xglianxibiaoge tbody").append("<tr><td>"
												    			+'<input type="text" class="form-control" value="'+json.enterprise[i].eMan+'" disabled>'
												    			+"</td><td>"
												    			+'<input type="text" class="form-control" value='+json.enterprise[i].eTel+' disabled>'
												    			+"</td><td><button type='button' style='text-align:right;' class='btn btn-primary' onclick='deleteLianxiren(this)'>移除联系人</button></td></tr>")
	            	}
	            	if(json.assistDepartment1!=null&&json.assistDepartment1!=""){
	            		$("#xgxieban tbody").append("<tr class='xieban'><td>"+"协办部门1"+"</td><td>"
	        	                +'<form class="form-inline">'
	        	                    +'<select class="form-control" id="xgxieban1" style="width:150px;">'
	        	                    +'</select>'
	        	                    +'<input type="text" id="xgxiebanMoney1" class="form-control" style="width:150px;margin-left:10px;" placeholder="金额">'
	        	                    +'<input type="text" id="xgchenbenfentanbili1" class="form-control" style="width:150px;margin-left:10px;">'
	        	                    +"<button type='button' style='text-align:right;margin-left:30px;' class='btn btn-primary' onclick='deleteXieBan(this)'>移除协办单位</button>"
	        	                +'</form>'
	        	                +"</td></tr>");
	            		xiebanhuixian(json.assistDepartment1,json.assistDepartment2,json.assistDepartment3);
	            		$("#xgxiebanMoney1").val(json.assistDepartment1Money);
	            		$("#xgchenbenfentanbili1").val(json.assistDepartment1Cost)
	            	}
	            	if(json.assistDepartment2!=null&&json.assistDepartment2!=""){
	            		$("#xgxieban tbody").append("<tr class='xieban'><td>"+"协办部门2"+"</td><td>"
	        	                +'<form class="form-inline">'
	        	                    +'<select class="form-control" id="xgxieban2" style="width:150px;">'
	        	                    +'</select>'
	        	                    +'<input type="text" id="xgxiebanMoney2" class="form-control" style="width:150px;margin-left:10px;" placeholder="金额">'
	        	                    +'<input type="text" id="xgchenbenfentanbili2" class="form-control" style="width:150px;margin-left:10px;">'
	        	                    +"<button type='button' style='text-align:right;margin-left:30px;' class='btn btn-primary' onclick='deleteXieBan(this)'>移除协办单位</button>"
	        	                +'</form>'
	        	                +"</td></tr>");
	            		xiebanhuixian(json.assistDepartment1,json.assistDepartment2,json.assistDepartment3);
	            		$("#xgxiebanMoney2").val(json.assistDepartment2Money);
	            		$("#xgchenbenfentanbili2").val(json.assistDepartment2Cost)
	            	}
	            	if(json.assistDepartment3!=null&&json.assistDepartment3!=""){
	            		$("#xgxieban tbody").append("<tr class='xieban'><td>协办部门3</td><td>"
	        	                +'<form class="form-inline">'
	        	                    +'<select class="form-control" id="xgxieban3" style="width:150px;">'
	        	                    +'</select>'
	        	                    +'<input type="text" id="xgxiebanMoney3" class="form-control" style="width:150px;margin-left:10px;" placeholder="金额">'
	        	                    +'<input type="text" id="xgchenbenfentanbili3" class="form-control" style="width:150px;margin-left:10px;">'
	        	                    +"<button type='button' style='text-align:right;margin-left:30px;' class='btn btn-primary' onclick='deleteXieBan(this)'>移除协办单位</button>"
	        	                +'</form>'
	        	                +"</td></tr>");
	            		xiebanhuixian(json.assistDepartment1,json.assistDepartment2,json.assistDepartment3);
	            		$("#xgxiebanMoney3").val(json.assistDepartment3Money);
	            		$("#xgchenbenfentanbili3").val(json.assistDepartment3Cost);
	            	}
	            	
	            	 $("#diyi").removeClass("active");
		   	         $("#disan").addClass("active");
		   	         $("#diyi a").show();
		   	         $("#disan a").show();
		   	         $("#home").removeClass("active");
		   	         $("#messages").addClass("active");
	            }
	        });	
    	});
    
    function deleteXieBan(obj){
    	var tr=$(obj).parent().parent().parent();
    	$(tr).remove();
    }
    
    function xgaddrenwudan(){
    	var danwei= new Array();
    	var lianxibiao= new Array();
    	$("#xglianxibiaoge tbody").find("tr").each(function(){
    		var name = $(this).find("input").eq(0).val();
    	    var way = $(this).find("input").eq(1).val();
    	   
    	    var xinlianxibiao={
    	    		eId:undefined,
    				eMan:undefined,
    				eTel:undefined
    	    }
    	    xinlianxibiao.eId=null;
    	    xinlianxibiao.eMan=name;
    	    xinlianxibiao.eTel=way;
    	    lianxibiao.push(xinlianxibiao);
    	})
    	
    	var a=1;
    	$("#messages").find("input").each(function(){
    		var name=$(this).val();
    		if(name==''||name==null){
    			a=0;
    		}
    	});
    	
    	//if(a==0){
    		//toastr.error('存在数据未填写');
    		//return;
    	//}
           	var erji=$("#xgerjileixing").find("option:selected").val();
    		var taskName=$("#xgtaskName").val();
        	var taskbianhao=$("#xgtaskbianhao").val();
        	var mainPrjNo=$("#xg_main_task_no").val();
        	var city=$("#edit_city").val();
        	var importance=$("#edit_importance").val();
        	var moshi=$("#xgmoshi").find("option:selected").val();
        	var gongsi=$("#xggongsi").find("option:selected").val();
        	var yezhudanwei=$("#xgyezhudanwei").val();
        	var prjSource=$("#xg_prj_source").val();
        	var jine=$("#xgjine").val();
        	var hetonge=$("#xghetonge").val();
        	var zandingjin=$("#xgzandingjin").val();
        	var startTime=$("#xgstartTime").val();
        	var endTime=$("#xgendTime").val();
        	var zhuban=$("#xgzhuban").val();
        	var zhubanjine=$("#xgzhubanjine").val();
        	var chenbenfentanbili=$("#xgchenbenfentanbili").val();
        	var xieban1=$("#xgxieban1").find("option:selected").val();
        	var xieban1jine=$("#xgxiebanMoney1").val();
        	var chenbenfentanbili1=$("#xgchenbenfentanbili1").val();
        	var xieban2=$("#xgxieban2").find("option:selected").val();
        	var xieban2jine=$("#xgxiebanMoney2").val();
        	var chenbenfentanbili2=$("#xgchenbenfentanbili2").val();
        	var xieban3=$("#xgxieban3").find("option:selected").val();
        	var xieban3jine=$("#xgxiebanMoney3").val();
        	var chenbenfentanbili3=$("#xgchenbenfentanbili3").val();
        	var gaikuang=$("#xggaikuang").val();
        	
        	if(taskName==''){
	    		toastr.error("项目名称不能为空");
	    		return;
	    	}
        	if(city==''){
	    		toastr.error("所属区域不能为空");
	    		return;
	    	}
        	if(moshi==''){
	    		toastr.error("项目经营模式不能为空");
	    		return;
	    	}
        	if(erji==''){
	    		toastr.error("项目类型不能为空");
	    		return;
	    	}
        	if(gongsi==''){
	    		toastr.error("合同所属公司不能为空");
	    		return;
	    	}
        	if(yezhudanwei==''){
	    		toastr.error("甲方单位不能为空");
	    		return;
	    	}
        	if(jine==''){
	    		toastr.error("任务金额不能为空");
	    		return;
	    	}
        	if(hetonge==''){
	    		toastr.error("合同金额不能为空");
	    		return;
	    	}
        	if(prjSource==''){
	    		toastr.error("项目来源不能为空");
	    		return;
	    	}
        	if(zhuban==''){
	    		toastr.error("主办部门不能为空");
	    		return;
	    	}
        	if(zandingjin==''){
	    		toastr.error("暂定金不能为空");
	    		return;
	    	}
        	var all_bili=0;
        	if(zhuban!=''&&zhuban!=undefined){
        		if(chenbenfentanbili==''){
        			toastr.error("成本分摊比例不能为空");
    	    		return;
        		}else{
        			var bili=chenbenfentanbili.replace("%","");
        			all_bili=all_bili+parseInt(bili);
        		}
        	}
        	if(xieban1!=''&&xieban1!=undefined){
        		if(chenbenfentanbili1==''){
        			toastr.error("成本分摊比例不能为空");
    	    		return;
        		}else{
        			var bili1=chenbenfentanbili1.replace("%","");
        			all_bili=all_bili+parseInt(bili1);
        		}
        	}
			if(xieban2!=''&&xieban2!=undefined){
				if(chenbenfentanbili2==''){
        			toastr.error("成本分摊比例不能为空");
    	    		return;
        		}else{
        			var bili2=chenbenfentanbili2.replace("%","");
        			all_bili=all_bili+parseInt(bili2);
        		}
        	}
			if(xieban3!=''&&xieban3!=undefined){
				if(chenbenfentanbili3==''){
        			toastr.error("成本分摊比例不能为空");
    	    		return;
        		}else{
        			var bili3=chenbenfentanbili3.replace("%","");
        			all_bili=all_bili+parseInt(bili3);
        		}
        	}
			if(all_bili!=100){
				toastr.error("成本分摊比例总和不等于100%");
	    		return;
			}
			var yugongke = $("#xgyugongke").val().replace("%","");
    	    var chushe = $("#xgchushe").val().replace("%","");
    	    var shishe = $("#xgshishe").val().replace("%","");
    	    var allLei=0;
    	    if(yugongke!=""&&yugongke!=null){
    	    	yugongke = parseInt(yugongke);
    	    	allLei+=yugongke;
    	    }
    	    if(chushe!=""&&chushe!=null){
    	    	chushe = parseInt(chushe);
    	    	allLei+=chushe
    	    }
    	    if(shishe!=""&&shishe!=null){
    	    	shishe = parseInt(shishe);
    	    	allLei+=shishe
    	    }
    	    if(erji.indexOf("B")>=0){
    	    	 if(allLei!=100){
  					toastr.error("项目B类百分比分配有误");
  		    		return;
   				}
   			}
    	    var xindanwei={
    	    		prjType2:undefined,
    	    		prjNo:undefined,
    	    		prjName:undefined,
    	    		prjArea:undefined,
    	    		mainPrjNo:undefined,
    	    		importance:undefined,
	            	prjManagementModel:undefined,
	            	prjCompany:undefined,
	            	prjSource:undefined,
	            	prjOwnerUnit:undefined,
	            	workContent:undefined,
	            	prjEstimateMoney:undefined,
	            	contractMoney:undefined,
	            	provisionalSum:undefined,
	            	prjStartTime:undefined,
	            	prjEndTime:undefined,
	            	mainDepartment:undefined,
	            	mainDepartmentMoney:undefined,
	            	mainDepartmentCost:undefined,
	            	assistDepartment1:undefined,
	            	assistDepartment1Money:undefined,
	            	assistDepartment1Cost:undefined,
	            	assistDepartment2:undefined,
	            	assistDepartment2Money:undefined,
	            	assistDepartment2Cost:undefined,
	            	assistDepartment3:undefined,
	            	assistDepartment3Money:undefined,
	            	assistDepartment3Cost:undefined,
	            	enterprise:undefined,
	            	prjId:undefined,
   			}
    	    xindanwei.prjArea=city;
    	    xindanwei.importance=importance;
    	    xindanwei.prjType2=erji;
    	    xindanwei.prjNo=taskbianhao;
    	    xindanwei.mainPrjNo=mainPrjNo;
    	    xindanwei.prjName=taskName;
    	    xindanwei.prjManagementModel=moshi;
    	    xindanwei.prjCompany=gongsi;
    	    xindanwei.prjSource=prjSource;
    	    xindanwei.prjOwnerUnit=yezhudanwei;
    	    xindanwei.workContent=gaikuang;
    	    xindanwei.prjEstimateMoney=jine;
    	    xindanwei.contractMoney=hetonge;
    	    xindanwei.provisionalSum=zandingjin;
    	    xindanwei.prjStartTime=startTime;
    	    xindanwei.prjEndTime=endTime;
    	    xindanwei.mainDepartment=zhuban,
    	    xindanwei.mainDepartmentMoney=zhubanjine,
    	    xindanwei.mainDepartmentCost=chenbenfentanbili,
    	    xindanwei.assistDepartment1=xieban1,
    	    xindanwei.assistDepartment1Money=xieban1jine,
    	    xindanwei.assistDepartment1Cost=chenbenfentanbili1,
    	    xindanwei.assistDepartment2=xieban2,
    	    xindanwei.assistDepartment2Money=xieban2jine,
    	    xindanwei.assistDepartment2Cost=chenbenfentanbili2,
    	    xindanwei.assistDepartment3=xieban3,
    	    xindanwei.assistDepartment3Money=xieban3jine,
    	    xindanwei.assistDepartment3Cost=chenbenfentanbili3,
    	    xindanwei.enterprise=lianxibiao;
    	    xindanwei.prjId=xiugaiid;
    	    xindanwei.yugongkebili = yugongke;
    	    xindanwei.chushebili = chushe;
    	    xindanwei.shishebili = shishe;
    	    danwei.push(xindanwei);
    		
    	      $.ajax({
	            type: 'POST',
	            url: getContextPath()+'/task/updateTask2',
	            dataType: 'json',
	            contentType: "application/json", 
	            data:JSON.stringify(danwei),
	            success: function (json) {
	            	lianjie=json.url;
	            	if(json.receiver!=null&&json.receiver.length>=1){
	            		  quxiao2();
		        		  $("#tijiaogei").modal('show');
		        		  $("#tijiaoren tbody").empty("");
		        		  for(var i=0;i<json.receiver.length;i++){
		        			  $("#tijiaoren tbody").append('<tr><td>'
		        					  +'<input type="radio" name="tijiaorenming" data-id="'+json.receiver[i].userId+'" data-id2="'+json.receiver[i].omId+'" data-id3="'+json.receiver[i].dutyId+'">'
		        					  +'</td><td>'
		        					  +json.receiver[i].omName
		        					  +'</td><td>'
		        					  +json.receiver[i].dutyName
		        					  +'</td><td>'
		        					  +json.receiver[i].uName
		        					  +'</td></tr>');
		        		  }
		        	  }else if(json.receiver.length==1){
		        		  $.ajax({
		        	          type: 'POST',
		        	          url: getContextPath()+'/task/addTask4',
		        	          dataType: 'json',
		        	          data:{
		        	        	  url:json.url,
		        	        	  userId:json.receiver.userId,
		        	        	  uName:json.receiver.uName,
		        	        	  omName:json.receiver.omName,
		        	        	  dutyName:json.receiver.dutyName,
		        	        	  omId:json.receiver.omId,
		        	        	  dutyId:json.receiver.dutyId
		        	          },
		        	          success: function (json) {
		        	        	  toastr.success('提交成功');
		        	          }
		        	      }); 
		        	  }
	            }
	        }); 
    }
    
    
    function xgsaverenwudan(){
    	var danwei= new Array();
    	var lianxibiao= new Array();
    	$("#xglianxibiaoge tbody").find("tr").each(function(){
    		var name = $(this).find("input").eq(0).val();
    	    var way = $(this).find("input").eq(1).val();
    	   
    	    var xinlianxibiao={
    	    		eId:undefined,
    				eMan:undefined,
    				eTel:undefined
    	    }
    	    xinlianxibiao.eId=null;
    	    xinlianxibiao.eMan=name;
    	    xinlianxibiao.eTel=way;
    	    lianxibiao.push(xinlianxibiao);
    	})
    	
    	var a=1;
    	$("#messages").find("input").each(function(){
    		var name=$(this).val();
    		if(name==''||name==null){
    			a=0;
    		}
    	});
    	
    	//if(a==0){
    		//toastr.error('存在数据未填写');
    		//return;
    	//}
           	var erji=$("#xgerjileixing").find("option:selected").val();
    		var taskName=$("#xgtaskName").val();
        	var taskbianhao=$("#xgtaskbianhao").val();
        	var mainPrjNo=$("#xg_main_task_no").val();
        	var moshi=$("#xgmoshi").find("option:selected").val();
        	var gongsi=$("#xggongsi").find("option:selected").val();
        	var city=$("#edit_city").val();
        	var importance=$("#edit_importance").val();
        	var yezhudanwei=$("#xgyezhudanwei").val();
        	var prjSource=$("#xg_prj_source").val();
        	var jine=$("#xgjine").val();
        	var hetonge=$("#xghetonge").val();
        	var zandingjin=$("#xgzandingjin").val();
        	var startTime=$("#xgstartTime").val();
        	var endTime=$("#xgendTime").val();
        	var zhuban=$("#xgzhuban").val();
        	var zhubanjine=$("#xgzhubanjine").val();
        	var chenbenfentanbili=$("#xgchenbenfentanbili").val();
        	var xieban1=$("#xgxieban1").find("option:selected").val();
        	var xieban1jine=$("#xgxiebanMoney1").val();
        	var chenbenfentanbili1=$("#xgchenbenfentanbili1").val();
        	var xieban2=$("#xgxieban2").find("option:selected").val();
        	var xieban2jine=$("#xgxiebanMoney2").val();
        	var chenbenfentanbili2=$("#xgchenbenfentanbili2").val();
        	var xieban3=$("#xgxieban3").find("option:selected").val();
        	var xieban3jine=$("#xgxiebanMoney3").val();
        	var chenbenfentanbili3=$("#xgchenbenfentanbili3").val();
        	var gaikuang=$("#xggaikuang").val();
        	
        	/* if(taskName==''){
	    		toastr.error("项目名称不能为空");
	    		return;
	    	}
        	if(city==''){
	    		toastr.error("所属区域不能为空");
	    		return;
	    	}
        	if(moshi==''){
	    		toastr.error("项目经营模式不能为空");
	    		return;
	    	}
        	if(erji==''){
	    		toastr.error("项目类型不能为空");
	    		return;
	    	}
        	if(gongsi==''){
	    		toastr.error("项目所属公司不能为空");
	    		return;
	    	}
        	if(yezhudanwei==''){
	    		toastr.error("甲方单位不能为空");
	    		return;
	    	}
        	if(jine==''){
	    		toastr.error("任务金额不能为空");
	    		return;
	    	}
        	if(hetonge==''){
	    		toastr.error("合同金额不能为空");
	    		return;
	    	}
        	if(prjSource==''){
	    		toastr.error("项目来源不能为空");
	    		return;
	    	}
        	if(zhuban==''){
	    		toastr.error("主办部门不能为空");
	    		return;
	    	}
        	if(zandingjin==''){
	    		toastr.error("暂定金不能为空");
	    		return;
	    	}
        	var all_bili=0;
        	if(zhuban!=''&&zhuban!=undefined){
        		if(chenbenfentanbili==''){
        			toastr.error("成本分摊比例不能为空");
    	    		return;
        		}else{
        			var bili=chenbenfentanbili.replace("%","");
        			all_bili=all_bili+parseInt(bili);
        		}
        	}
        	if(xieban1!=''&&xieban1!=undefined){
        		if(chenbenfentanbili1==''){
        			toastr.error("成本分摊比例不能为空");
    	    		return;
        		}else{
        			var bili1=chenbenfentanbili1.replace("%","");
        			all_bili=all_bili+parseInt(bili1);
        		}
        	}
			if(xieban2!=''&&xieban2!=undefined){
				if(chenbenfentanbili2==''){
        			toastr.error("成本分摊比例不能为空");
    	    		return;
        		}else{
        			var bili2=chenbenfentanbili2.replace("%","");
        			all_bili=all_bili+parseInt(bili2);
        		}
        	}
			if(xieban3!=''&&xieban3!=undefined){
				if(chenbenfentanbili3==''){
        			toastr.error("成本分摊比例不能为空");
    	    		return;
        		}else{
        			var bili3=chenbenfentanbili3.replace("%","");
        			all_bili=all_bili+parseInt(bili3);
        		}
        	}
			if(all_bili!=100){
				toastr.error("成本分摊比例总和不等于100%");
	    		return;
			}
			var yugongke = $("#xgyugongke").val().replace("%","");
    	    var chushe = $("#xgchushe").val().replace("%","");
    	    var shishe = $("#xgshishe").val().replace("%","");
    	    var allLei=0;
    	    if(yugongke!=""&&yugongke!=null){
    	    	yugongke = parseInt(yugongke);
    	    	allLei+=yugongke;
    	    }
    	    if(chushe!=""&&chushe!=null){
    	    	chushe = parseInt(chushe);
    	    	allLei+=chushe
    	    }
    	    if(shishe!=""&&shishe!=null){
    	    	shishe = parseInt(shishe);
    	    	allLei+=shishe
    	    }
    	    if(erji.indexOf("B")>=0){
   	    	 if(allLei!=100){
 					toastr.error("项目B类百分比分配有误");
 		    		return;
  				}
  			} */
    	    var xindanwei={
    	    		prjType2:undefined,
    	    		prjNo:undefined,
    	    		prjName:undefined,
    	    		prjArea:undefined,
    	    		mainPrjNo:undefined,
    	    		importance:undefined,
	            	prjManagementModel:undefined,
	            	prjCompany:undefined,
	            	prjSource:undefined,
	            	prjOwnerUnit:undefined,
	            	workContent:undefined,
	            	prjEstimateMoney:undefined,
	            	contractMoney:undefined,
	            	provisionalSum:undefined,
	            	prjStartTime:undefined,
	            	prjEndTime:undefined,
	            	mainDepartment:undefined,
	            	mainDepartmentMoney:undefined,
	            	mainDepartmentCost:undefined,
	            	assistDepartment1:undefined,
	            	assistDepartment1Money:undefined,
	            	assistDepartment1Cost:undefined,
	            	assistDepartment2:undefined,
	            	assistDepartment2Money:undefined,
	            	assistDepartment2Cost:undefined,
	            	assistDepartment3:undefined,
	            	assistDepartment3Money:undefined,
	            	assistDepartment3Cost:undefined,
	            	enterprise:undefined,
	            	prjId:undefined,
   			}
    	    
    	    xindanwei.prjArea=city;
    	    xindanwei.importance=importance;
    	    xindanwei.prjType2=erji;
    	    xindanwei.prjNo=taskbianhao;
    	    xindanwei.mainPrjNo=mainPrjNo;
    	    xindanwei.prjName=taskName;
    	    xindanwei.prjManagementModel=moshi;
    	    xindanwei.prjCompany=gongsi;
    	    xindanwei.prjSource=prjSource;
    	    xindanwei.prjOwnerUnit=yezhudanwei;
    	    xindanwei.workContent=gaikuang;
    	    xindanwei.prjEstimateMoney=jine;
    	    xindanwei.contractMoney=hetonge;
    	    xindanwei.provisionalSum=zandingjin;
    	    xindanwei.prjStartTime=startTime;
    	    xindanwei.prjEndTime=endTime;
    	    xindanwei.mainDepartment=zhuban,
    	    xindanwei.mainDepartmentMoney=zhubanjine,
    	    xindanwei.mainDepartmentCost=chenbenfentanbili,
    	    xindanwei.assistDepartment1=xieban1,
    	    xindanwei.assistDepartment1Money=xieban1jine,
    	    xindanwei.assistDepartment1Cost=chenbenfentanbili1,
    	    xindanwei.assistDepartment2=xieban2,
    	    xindanwei.assistDepartment2Money=xieban2jine,
    	    xindanwei.assistDepartment2Cost=chenbenfentanbili2,
    	    xindanwei.assistDepartment3=xieban3,
    	    xindanwei.assistDepartment3Money=xieban3jine,
    	    xindanwei.assistDepartment3Cost=chenbenfentanbili3,
    	    xindanwei.enterprise=lianxibiao;
    	    xindanwei.prjId=xiugaiid;
    	    xindanwei.yugongkebili = yugongke;
    	    xindanwei.chushebili = chushe;
    	    xindanwei.shishebili = shishe;
    	    danwei.push(xindanwei);
    		
    	      $.ajax({
	            type: 'POST',
	            url: getContextPath()+'/task/updateTask',
	            dataType: 'json',
	            contentType: "application/json", 
	            data:JSON.stringify(danwei),
	            success: function (json) {
	            	if(json==0){
	            		toastr.error('保存失败');
	            	}else{
	            		 toastr.success('保存成功');
	            		 quxiao2();
	            	}
	            }
	        }); 
    }
    
    
    function GetQueryString(name){
        var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if(r!=null)return  unescape(r[2]); return null;
   }
   // 调用方法
   	id=GetQueryString("prjId");
   	no=GetQueryString("prjNo");
   	//var title = decodeURI(id)
   	if(id!=null&&no!=null){
   		$("#diyi").removeClass("active");
        $("#disi").addClass("active");
        $("#diyi a").show();
        $("#disi a").show();
        $("#home").removeClass("active");
        $("#settings").addClass("active");
        
   		$.ajax({
            type: 'POST',
            url: getContextPath()+'/task/selectTaskHistory',
            dataType: 'json',
            data: {
            	id:id,
            	no:no
            },
            success: function (json) {
            	var task=json.task;
            	var taskList=json.taskList;
            	$("#looktaskName").text(task.prjName);
            	$("#looktaskbianhao").text(task.prjNo);
            	$("#lookmoshi").text(task.prjManagementModel);
            	$("#lookgongsi").text(task.prjCompany1);
            	$("#lookleixing").text(task.prjType2);
            	$("#look_prj_area").text(task.prjArea);
            	$("#look_importance").text(task.importance);
            	var mainPrjNo = task.mainPrjNo;
            	if(mainPrjNo==null||mainPrjNo==undefined||mainPrjNo=='null'){
            		mainPrjNo="";
            	}
            	$("#look_main_task_no").text(mainPrjNo);
            	$("#lookyezhudanwei").text(task.ccName);
            	$("#look_prj_source").text(task.prjSource);
            	$("#lookjine").text(task.prjEstimateMoney);
            	$("#lookhetonge").text(task.contractMoney);
            	$("#lookzandingjin").text(task.provisionalSum);
            	$("#lookstartTime").text(task.prjStartTime);
            	$("#lookendTime").text(task.prjEndTime);
            	$("#lookgaikuang").text(task.workContent);
            	
            	$("#look_xieban_table tbody").html('');
            	$("#look_xieban_table tbody").append("<tr><td style='width:15%;'>主办部门</td><td style='width:20%;'>"+task.omName+"</td><td style='width:10%;'>金额</td><td style='width:20%;'>"+task.mainDepartmentMoney+"</td><td style='width:15%;'>成本分摊比例</td><td style='width:20%;'>"+task.mainDepartmentCost+"</td></tr>")
            	
            	if(task.name1!=null&&task.name1!=''){
            		$("#look_xieban_table tbody").append("<tr><td>协办部门</td><td>"+task.name1+"</td><td>金额</td><td>"+task.assistDepartment1Money+"</td><td>成本分摊比例</td><td>"+task.assistDepartment1Cost+"</td></tr>")
            	}
				if(task.name2!=null&&task.name2!=''){
					$("#look_xieban_table tbody").append("<tr><td>协办部门</td><td>"+task.name2+"</td><td>金额</td><td>"+task.assistDepartment2Money+"</td><td>成本分摊比例</td><td>"+task.assistDepartment2Cost+"</td></tr>")
            	}
				if(task.name3!=null&&task.name3!=''){
					$("#look_xieban_table tbody").append("<tr><td>协办部门</td><td>"+task.name3+"</td><td>金额</td><td>"+task.assistDepartment3Money+"</td><td>成本分摊比例</td><td>"+task.assistDepartment3Cost+"</td></tr>")
				}
            	
            	$("#looklianxibiaoge tbody").empty("");
            	for(var i=0;i<task.enterprise.length;i++){
            		$("#looklianxibiaoge").append("<tr><td>"
											    			+task.enterprise[i].eMan
											    			+"</td><td>"
											    			+task.enterprise[i].eTel
											    			+"</td></tr>")
            	}
            	$('#history_table').dataTable().fnClearTable();
                $('#history_table').DataTable().rows.add(taskList).draw(false);
            	
            	
            }
        }); 
   	}
  //查看单个具体信息
  	$('#mainContent').delegate('#lookDetall','click', function () {
  		var dom = $(this).parents('tr');
		var data=$('#mainContent').DataTable().row(dom).data();
  		
		 $.ajax({
            type: 'POST',
            url: getContextPath()+'/task/selectTaskHistory',
            dataType: 'json',
            data: {
            	id:data.prjId,
            	no:data.prjNo
            },
            success: function (json) {
            	var task=json.task;
            	var taskList=json.taskList;
            	$("#looktaskName").text(task.prjName);
            	$("#looktaskbianhao").text(task.prjNo);
            	$("#lookmoshi").text(task.prjManagementModel);
            	$("#lookgongsi").text(task.prjCompany1);
            	$("#lookleixing").text(task.prjType2);
            	$("#look_prj_area").text(task.prjArea);
            	$("#look_importance").text(task.importance);
            	var mainPrjNo = task.mainPrjNo;
            	if(mainPrjNo==null||mainPrjNo==undefined||mainPrjNo=='null'){
            		mainPrjNo="";
            	}
            	$("#look_main_task_no").text(mainPrjNo);
            	$("#lookyezhudanwei").text(task.ccName);
            	$("#look_prj_source").text(task.prjSource);
            	$("#lookjine").text(task.prjEstimateMoney);
            	$("#lookhetonge").text(task.contractMoney);
            	$("#lookzandingjin").text(task.provisionalSum);
            	$("#lookstartTime").text(task.prjStartTime);
            	$("#lookendTime").text(task.prjEndTime);
            	$("#lookgaikuang").text(task.workContent);
            	
            	$("#look_xieban_table tbody").html('');
            	$("#look_xieban_table tbody").append("<tr><td style='width:15%;'>主办部门</td><td style='width:20%;'>"+task.omName+"</td><td style='width:10%;'>金额</td><td style='width:20%;'>"+task.mainDepartmentMoney+"</td><td style='width:15%;'>成本分摊比例</td><td style='width:20%;'>"+task.mainDepartmentCost+"</td></tr>")
            	
            	if(task.name1!=null&&task.name1!=''){
            		$("#look_xieban_table tbody").append("<tr><td>协办部门</td><td>"+task.name1+"</td><td>金额</td><td>"+task.assistDepartment1Money+"</td><td>成本分摊比例</td><td>"+task.assistDepartment1Cost+"</td></tr>")
            	}
				if(task.name2!=null&&task.name2!=''){
					$("#look_xieban_table tbody").append("<tr><td>协办部门</td><td>"+task.name2+"</td><td>金额</td><td>"+task.assistDepartment2Money+"</td><td>成本分摊比例</td><td>"+task.assistDepartment2Cost+"</td></tr>")
            	}
				if(task.name3!=null&&task.name3!=''){
					$("#look_xieban_table tbody").append("<tr><td>协办部门</td><td>"+task.name3+"</td><td>金额</td><td>"+task.assistDepartment3Money+"</td><td>成本分摊比例</td><td>"+task.assistDepartment3Cost+"</td></tr>")
				}
            	
            	$("#looklianxibiaoge tbody").empty("");
            	for(var i=0;i<task.enterprise.length;i++){
            		$("#looklianxibiaoge").append("<tr><td>"
											    			+task.enterprise[i].eMan
											    			+"</td><td>"
											    			+task.enterprise[i].eTel
											    			+"</td></tr>")
            	}
            	$('#history_table').dataTable().fnClearTable();
                $('#history_table').DataTable().rows.add(taskList).draw(false);
            	
            	$("#diyi").removeClass("active");
                $("#disi").addClass("active");
                $("#diyi a").show();
                $("#disi a").show();
                $("#home").removeClass("active");
                $("#settings").addClass("active");
            }
        }); 
  	})
    
  	function deleteLianxiren(obj){
    	var tr=$(obj).parent().parent();
    	$(tr).remove();
    }
  	
  	//项目中止
  	$('#mainContent').delegate('#stopTask','click', function () {
  		var dom = $(this).parents('tr');
		var data=$('#mainContent').DataTable().row(dom).data();
  		$.ajax({
            type: 'POST',
            url: getContextPath()+'',
            dataType: 'json',
            data: {
            	id:data.prjId
            },
            success: function (json) {
            	if(json==0){
            		
            	}else{
            		$('#mainContent').DataTable().row(dom).remove().draw(true); //删除行立即显示
            	}
            }
        }); 
  	})

  	//项目完结
  	$('#mainContent').delegate('#finishTask','click', function () {
  		var dom = $(this).parents('tr');
		var data=$('#mainContent').DataTable().row(dom).data();
  		$.ajax({
            type: 'POST',
            url: getContextPath()+'',
            dataType: 'json',
            data: {
            	id:data.prjId
            },
            success: function (json) {
            	if(json==0){
            		
            	}else{
            		$('#mainContent').DataTable().row(dom).remove().draw(true); //删除行立即显示
            	}
            }
        }); 
  		
  	})
  	
  	function lookHistory(obj){
  		var dom = $(obj).parents('tr');
		var data=$('#history_table').DataTable().row(dom).data();
  		
		 $.ajax({
            type: 'POST',
            url: getContextPath()+'/task/selectTaskById',
            dataType: 'json',
            data: {
            	id:data.prjId
            },
            success: function (json) {
            	$("#historyName").text(json.prjName);
            	$("#historybianhao").text(json.prjNo);
            	$("#historymoshi").text(json.prjManagementModel);
            	$("#historygongsi").text(json.prjCompany1);
            	$("#historyleixing").text(json.prjType2);
            	$("#historyyezhudanwei").text(json.ccName);
            	$("#historyjine").text(json.prjEstimateMoney);
            	$("#historyhetonge").text(json.contractMoney);
            	$("#historyzandingjin").text(json.provisionalSum);
            	$("#historystartTime").text(json.prjStartTime);
            	$("#historyendTime").text(json.prjEndTime);
            	$("#historygaikuang").text(json.workContent);
            	
            	$("#history_xieban_table tbody").html('');
            	$("#history_xieban_table tbody").append("<tr><td>主办部门</td><td>"+json.omName+"</td><td>金额</td><td>"+json.mainDepartmentMoney+"</td></tr>")
            	
            	if(json.name1!=null&&json.name1!=''){
            		$("#history_xieban_table tbody").append("<tr><td>协办部门</td><td>"+json.name1+"</td><td>金额</td><td>"+json.assistDepartment1Money+"</td></tr>")
            	}
				if(json.name2!=null&&json.name2!=''){
					$("#history_xieban_table tbody").append("<tr><td>协办部门</td><td>"+json.name2+"</td><td>金额</td><td>"+json.assistDepartment2Money+"</td></tr>")
            	}
				if(json.name3!=null&&json.name3!=''){
					$("#history_xieban_table tbody").append("<tr><td>协办部门</td><td>"+json.name3+"</td><td>金额</td><td>"+json.assistDepartment3Money+"</td></tr>")
				}
            	
            	$("#historylianxibiaoge tbody").empty("");
            	for(var i=0;i<json.enterprise.length;i++){
            		$("#historylianxibiaoge").append("<tr><td>"
											    			+json.enterprise[i].eMan
											    			+"</td><td>"
											    			+json.enterprise[i].eTel
											    			+"</td></tr>")
            	}
  				$("#look_history_info").modal("show");
  			}
		 });
  	}
  	
  /* $("#lookContract").bind("click",function(){
	    var dom = $(this).parents('tr');
		var data=$('#mainContent').DataTable().row(dom).data();
		var prjId =data.prjId;
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/task/getContracts',
            dataType: 'json',
            data: {
            	id:data.prjId
            },
            success: function (json) {
            	if(json==0){
            		
            	}else{
            		$('#mainContent').DataTable().row(dom).remove().draw(true); //删除行立即显示
            	}
            }
        });
  }); */
  	
  	var stateArray=[];
  	function lookContract(s){
	    var tr = $(s).parents('tr');
		var data=$('#mainContent').DataTable().row(tr).data();
		/* var cj=data.cj; */
		var id=data.prjId;
		if(stateArray.indexOf(id)>=0){
			stateArray.splice($.inArray(id,stateArray),1);// $.inArray(data.idFirst,stateArray)获取idFirst在数组中的索引值 ；stateArray.splice(索引值，数量)删除数组中指定索引值的元素
			$(".inTr"+id).remove();
		}else{
			stateArray.push(id);
			$(tr).after("<tr class='inTr"+id+"'><td style='width:100px;color:green;' class='details-control'>1</td><td style='width:100px;color:green;' colspan='3' >合同名称：    <a onclick='tiaozhuan(this)' data-id='"+data.cjId+"' style='color:green;' class='zhuashou'>"+data.contractName+"</a></td><td colspan='3' style='width:100px;color:green;'>合同金额：    "+data.contractMoney+"</td><td></td></tr>")
		}
    }
  	function tiaozhuan(s){
  		var cjId = $(s).attr("data-id");
  		$(s).attr("href",'../shengchanGuanli/ContractManagement.html?cjId='+cjId+'');
  	}
  	
  	function appendBfh(obj){
  		var value=$(obj).val().replace("%","")+"%"
  		$(obj).val(value)
  	}
  	
  	var ctype;
  	function chooseMainTask(obj){
  		ctype=obj;
  		 $.ajax({
	            type: 'POST',
	            url: getContextPath()+'/task/selectTaskByStatus2',
	            dataType: 'json',
	            data: {
	            	status:2,
	            },
	            success: function (json) {
	                $('#xiangmubiao').dataTable().fnClearTable();
	                $('#xiangmubiao').DataTable().rows.add(json).draw(false);
	                $("#xiangmumd").modal("show");
	            }
	      });
  	}
  	
  	function saveTask(){
  		var tr= $('input[name="xiangmuName"]:checked').parents("tr");
  		var data=$('#xiangmubiao').DataTable().row(tr).data();
  		if(ctype==0){
  			$("#main_task_no").val(data.prjNo);
  		}else if(ctype==1){
  			$("#xg_main_task_no").val(data.prjNo);
  		}
  		$("#xiangmumd").modal("hide");
  	}
  	
  	 $('#mainContent').delegate('#chaiFenTask','click',function(){
  		var dom = $(this).parents('tr');
		var data=$('#mainContent').DataTable().row(dom).data();
		var jsonData = JSON.stringify(data);
		setCookie("chaiFenData",jsonData);
		location.href = "../shengchanGuanli/TaskManagementChaiFen.html";
  	});
</script>

</html>