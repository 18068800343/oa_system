<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="../../font2/iconfont.css">
    <link rel="stylesheet" href="../../font3/iconfont.css">
	<link href="../../style/bootstrap.min.css" rel="stylesheet">
    <link href="../../style/style.css" rel="stylesheet">
    <link href="../../toastr/toastr.css" rel="stylesheet">
    <link href="../../font3/bootstrap-select.css" rel="stylesheet">
    <link rel="stylesheet" href="../../style/jquery.dataTables.min.css">
    <!-- <link rel="stylesheet" href="../../style/jquery-editable-select.css"> -->
    <style lang="">
        
        .UpperPart{
            display: flex;
            justify-content:space-between;
            border-bottom: 1px solid #ccc;
            padding-bottom: 4px;
        }
        .UpperPartL{
            font-size: 16px;
        }
        .selected{
            background: rgba(247, 161, 3,0.2);
        }
        #mainContent th{
            cursor: pointer;
            font-size: 14px;
        }
        @media screen and (max-width: 1920px) {
		    #myModal4{
		        margin-bottom:120px !important;
		    }
		}
    </style>
</head>
<body>
    
    <!-- 面包屑 -->
    <div class="mianbao">
    	<ul class="breadcrumb">
    		<li><i class="iconfont icon-knowledgebase"></i></li>
			<li>生产管理</li>
			<li>合同管理</li>
			<li class="active">承接合同管理</li>
		</ul>
    </div>
    
<div class="zhuti-content">  
	    
	<div>
	
	  <!-- Tab panes -->
	  <div class="tab-content">
	    <form class="form-inline" method="post" id="edit_form" enctype="multipart/form-data">
	    		<table class="table table-bordered table-condensed">
	                    <thead>
	                    		<tr>
	                    			<th colspan="10">项目基本信息</th>
	                    		</tr>
	                    </thead>
                    	<tbody>
                    			<tr>
			                       	   <td style="width:15%;">任务单号:</td>
			                           <td style="width:35%;">
			                                <input type="text" style="width:70%;" class="form-control" id="edit_work_no" disabled>
			                                <button type="button" class="btn btn-primary" onclick="chooseNo(1)">选择任务单号</button>
			                           </td>
			                           <td style="width:15%;">项目名称:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
			                           <td style="width:35%;">
			                               <input type="text" style="width:70%;" class="form-control" id="edit_prj_name" disabled>
			                               <button type="button" class="btn btn-primary" onclick="chooseName(1)">选择项目名称</button>
			                           </td>
			                       </tr>
			                       <tr>
			                       		<td>项目类型:</td>
			                           <td><input type="text" style="width:70%;" class="form-control" id="edit_prj_type" disabled></td>
			                           <td>经营模式:</td>
			                           <td><input type="text" style="width:70%;" class="form-control" id="edit_prj_jyms" disabled></td>
			                       </tr>
                    	</tbody>
                   </table>
	    		<table class="table table-bordered table-condensed">
	    			<thead>
	                    		<tr>
	                    			<th colspan="10">承接合同信息</th>
	                    		</tr>
	                    </thead>
                    	<tbody>
                    			<tr>
		                           <td style="width:15%;">承接合同名称:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
		                           <td style="width:35%;">
	 	                               	<input type="text" class="form-control" id="edit_contract_name" style="width:80%;">
		                           </td>
		                           <td style="width:15%;">承接合同编号:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
		                           <td style="width:35%;">
		                               	<input type="text" class="form-control" id="edit_contract_no" disabled style="width:80%;">
		                           </td>
		                       </tr>
		                       <tr>
		                       	   <td>合同甲方名称:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
		                           <td  colspan="3">
		                               <select class="selectpicker form-control"  id="edit_jiafangName" style="width:80%;" multiple data-max-options="2" data-live-search="true">
		                               </select>
		                           </td>
		                       
		                       </tr>
		                       <tr>
		                       	    <td>合同乙方名称:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
		                           <td>
		                               <select class="form-control" style="width:80%;" id="edit_yifangName">
		                                      <option value="华通">华通</option>
				                              <option value="华汇">华汇</option>
			                                  <option value="宿迁分公司">宿迁分公司</option>
		                               </select>
		                           </td>
		                       	   <td>承接部门:</td>
		                           <td>
		                               <select class="form-control"  style="width:80%;" id="edit_yifang_department">
		                               </select>
		                           </td>
		                       </tr>
		                       <tr>
                  					  <td>合同起讫日期:</td>
				                      <td>
				                              <input class="form-control" id="edit_year" style="width:35%;"></input>&nbsp; -- &nbsp;
				                              <input class="form-control" id="edit_year2" style="width:35%;"></input>
				                      </td>
				                       <td>合同工期(天):</td>
			                           <td>
			                               <input class="form-control" id="edit_work_date" style="width:80%;">
			                           </td>
				                      <!-- <td>合同金额(元):</td>
				                      <td class="form-inline">
				                            <input class="form-control" id="edit_contract_money" style="width:50%;">
                               				<button type="button" class="btn btn-primary" onclick="splitContractMoney(1)">拆分合同额</button>
				                      </td> -->
	                  				</tr>
		                       <tr>
		                  		  <td>合同金额(元):</td>
			                      <td>
			                          <input class="form-control" placeholder="不含暂定金" id="edit_contract_money" onchange="edit_changeRWD(this)" style="width:80%;">
			                      </td>
			                      <td>暂定金(元):</td>
			                      <td>
			                          <input class="form-control" id="edit_temporary_money" style="width:80%;">
			                      </td> 
		                     </tr>
		                       <tr>
		                           <td>合同签订时间:</td>
		                           <td>
		                               <input class="form-control" id="edit_year3" style="width:80%;">
		                           </td>
		                           <td></td>
		                           <td></td>
		                       </tr>
		                       <tr>
		                           <td>收款条件:</td>
		                           <td colspan="3">
		                                   <textarea class="form-control" rows="4" style="width:100%;" id="edit_receieve_money_condition"></textarea>
		                           </td>
		                       </tr>
		                       <tr>
		                           <td>主要概况及工作内容:</td>
		                           <td colspan="3">
		                                   <textarea class="form-control" rows="4" style="width:100%;" id="edit_work_info"></textarea>
		                           </td>
		                       </tr>
                    	</tbody>
	                   </table>
	                   
	                   <!-- <table class="table table-bordered table-condensed" id="">
	                  			<thead>
		                  			<tr>
		                  				<th colspan="6">拆分合同(跨年度合同)</th>
		                  			</tr>
	                  			</thead>
	                  			<tbody>
	                  				
	                  			</tbody>
	                  </table> -->
	                  <!--  <table class="table table-bordered table-condensed" id="edit_split_table">
							<thead>
								<tr>
		                        	<td style="width:20%;">年份</td>
		                       		<td>金额(元)</td>
		                      	</tr>
							</thead>
							<tbody></tbody>
					    </table> -->
					    
						<table class="table table-bordered table-condensed" id="edit_accessory">
							<thead>
								<tr>
					                            <td  style="width:20%;">合同文本附件:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
					                            <td colspan="2">
					                                <button type="button" class="btn btn-primary" onclick="edit_accessory()">增加附件</button>
					                            </td>
					                       	</tr>
							</thead>
							<tbody></tbody>
							<tfoot></tfoot>
						</table>
						<table class="table table-bordered table-condensed" id="edit_accessory2">
							<thead>
								<tr>
					                            <td  style="width:20%;">法律顾问签字:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
					                            <td colspan="2">
					                                <button type="button" class="btn btn-primary" onclick="edit_accessory2()">增加附件</button>
					                            </td>
					                       	</tr>
							</thead>
							<tbody></tbody>
							<tfoot></tfoot>
						</table>
						<div id="edit_renwudanFenpei"></div>
		  </form>
	    <!-- 修改 -->
	    <div role="tabpanel" class="tab-pane" id="messages">
	    
		               <!-- <div class="modal-footer">
				            <button type="button" class="btn btn-default"  onclick="quxiaob()">取消</button>
				            <button type="button" class="btn btn-success" onclick="edit_save()">保存</button>
				            <button type="button" class="btn btn-success" onclick="edit_submit()">提交</button>
				        </div> -->
	    </div>
	    

	  </div>
	
	</div>

</div>

 
<!-- 提交 modal -->
<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="tijiaogei">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="gridSystemModalLabel">提交给</h4>
            </div>
            <div class="modal-body">
                <table class="table table-bordered table-condensed" id="tijiaoren">
                        	<thead>
                        			<tr>
		                            	<th></th>
		                                <th>部门</th>
		                                <th>职务</th>
		                                <th>审批人</th>
		                            </tr>
                        	</thead>
                            <tbody>
                            	
                            </tbody>
                        </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-success" data-dismiss="modal" onclick="submitPerson()">提交</button>
            </div>
        </div>
    </div>
</div>
<!-- 提交 modal结束 -->

<!-- Modal2 -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="myModal2">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>取消承接合同</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline">
                        <table class="table table-bordered table-condensed">
                            <tr>
                                <td>承接合同取消原因</td>
                                <td colspan="3"><textarea name="" id="" cols="50" rows="5"></textarea></td>
                            </tr>
                        </table>
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-default">保存</button>
            <button type="button" class="btn btn-success">提交</button>
        </div>
        </div>
    </div>
</div>
<!-- model2结束 -->
<!-- Modal3 -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="myModal3">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>承接合同重新启用申请表</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline">
                        <table class="table table-bordered table-condensed">
                            <tr>
                                <td>承接合同重新启用原因</td>
                                <td colspan="3"><textarea name="" id="" cols="50" rows="5"></textarea></td>
                            </tr>
                        </table>
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-default">保存</button>
            <button type="button" class="btn btn-success">提交</button>
        </div>
        </div>
    </div>
</div>
<!-- model3结束 -->
<!-- 查看取消原因modal -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="look_cancel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
	        <div class="modal-header">
	            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	            <h4 class="modal-title" id="myModalLabel"><b>承接合同取消原因</b></h4>
	        </div>
	        <div class="modal-body">
	                <div>     
	                    <form class="form-inline">
	                        <table class="table table-bordered table-condensed">
	                            <thead>
	                            	<tr>
	                            		<th style="width:8%;">序号</th>
	                            		<th style="width:70%;">取消原因</th>
	                            		<th style="width:22%;">取消时间</th>
	                            	</tr>
	                            </thead>
	                            <tbody>
	                            	<tr>
	                            		<td></td>
	                            		<td></td>
	                            		<td></td>
	                            	</tr>
	                            </tbody>
	                        </table>
	                    </form>  
	                </div>
	        </div>
	        <div class="modal-footer">
	            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
	        </div>
        </div>
    </div>
</div>
<!-- model结束 -->

    <!-- Modal -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="chooseNo">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>选择任务单号</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline" method="post" id="new_form" enctype="multipart/form-data">
                        <table class="table table-bordered table-condensed">
                        	<tr>
                        		<td style="width:20%;">任务单号：</td>
                        		<td>
                        			<select class="selectpicker show-tick form-control"  style="width:100%;"  id="selectpicker_no" multiple data-live-search="true">
                                    </select>
                        		</td>
                        	</tr>
                        </table>
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" onclick="quxiao2()">取消</button>
            <button type="button" class="btn btn-success" onclick="saveNo()">保存</button>
        </div>
        </div>
    </div>
</div>
<!-- model结束 -->

<!-- Modal -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="chooseName">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>选择项目名称</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline" method="post" id="new_form" enctype="multipart/form-data">
                        <table class="table table-bordered table-condensed">
                        	<tr>
                        		<td style="width:20%;">项目名称：</td>
                        		<td>
                        			<select class="selectpicker show-tick form-control"  style="width:100%;"  id="selectpicker_name" multiple data-live-search="true">
                                    </select>
                        		</td>
                        	</tr>
                        </table>
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" onclick="quxiao()">取消</button>
            <button type="button" class="btn btn-success" onclick="saveName()">保存</button>
        </div>
        </div>
    </div>
</div>
<!-- model结束 -->

<!-- allMsg2 -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="allMsg2">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>所有信息</b></h4>
        </div>
        <div class="modal-body">
            <div>     
                <form class="form-inline">
                    <table class="table table-bordered">
                        <tr>
                            <td>承接合同名称:</td>
                            <td id="look_contract_name2"></td>
                            <td>承接合同编号:</td>
                            <td id="look_contract_no2"></td>
                        </tr>
                        <tr>
                        	<td>任务单号:</td>
                            <td id="look_work_no2"></td>
                            <td>项目名称:</td>
                            <td id="look_prj_name2"></td>
                        </tr>
                        <tr>
                        	<td>项目类型:</td>
                            <td id="look_prj_type2"></td>
                            <td>合同甲方名称:</td>
                            <td id="look_jiafangName2"></td>
                        </tr>
                        <tr>
                        	<td>合同乙方名称:</td>
                            <td id="look_yifangName2"></td>
                            <td>合同起日期:</td>
                            <td id="look_year_2"></td>
                        </tr>
                        <tr>
                        	<td>合同讫日期:</td>
                            <td id="look_year2_2"></td>
                            <td>乙方承接部门:</td>
                            <td id="look_yifang_department2"></td>
                        </tr>
                        <tr>
                        	<td>合同工期:</td>
                            <td id="look_work_date2"></td>
                            <td>收款条件:</td>
                            <td id="look_receieve_money_condition2"></td>
                        </tr>
                        <tr>
                        	<td>合同金额(元):</td>
                            <td id="look_contract_money2"></td>
                            <td>暂定金(元):</td>
                            <td id="look_temporary_money2"></td>
                        </tr>
                        <tr>
                        	<td>合同签订时间:</td>
                            <td id="look_year3_2"></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>主要概况及工作内容:</td>
                            <td colspan="3" id="look_work_info2"></td>
                        </tr>
                    </table>
                    <table class="table table-bordered table-condensed" id="look_split_table2">
							<thead>
								<tr>
		                        	<td>年份</td>
		                       		<td>金额(元)</td>
		                      	</tr>
							</thead>
							<tbody></tbody>
					 	</table>
                    <table class="table table-bordered table-condensed" id="look_accessory3">
                    	<thead>
                        		<tr>
                                	<td style="width:15%;">合同文本附件  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                	<td colspan="3"></td>
                            	</tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <table class="table table-bordered table-condensed" id="look_accessory4">
                    	<thead>
                        		<tr>
                                	<td style="width:15%;">法律顾问签字  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                	<td colspan="3"></td>
                            	</tr>
                        </thead>
                        <tbody></tbody>
                    </table>

                    <table class="table table-bordered table-condensed" id="look_xieban2">
                        <thead>
                            <tr>
                                <th colspan="2">部门</th>
                                <th colspan="2">金额</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </form>  
            </div>
        </div>
        
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        </div>
        </div>
    </div>
</div>
<!-- allMsg结束 -->
<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="split">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel" style='width:60%;'><b>拆分合同额</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline">
                        <table class="table table-bordered table-condensed" id="split_table">
                        	<thead>
                        		<tr>
                        			<td>年份</td>
                        			<td>金额(元)</td>
                        		</tr>
                        	</thead>
                        	<tbody>
                        	</tbody>
                        </table>
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" onclick="quxiaoSplit()">取消</button>
            <button type="button" class="btn btn-success" onclick="saveSplitMoney()">保存</button>
        </div>
        </div>
    </div>
</div>
<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="xgsplit">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel" style='width:60%;'><b>拆分合同额</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline">
                        <table class="table table-bordered table-condensed" id="xgsplit_table">
                        	<thead>
                        		<tr>
                        			<td>年份</td>
                        			<td>金额(元)</td>
                        		</tr>
                        	</thead>
                        	<tbody>
                        	</tbody>
                        </table>
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" onclick="checkquxiaoSplit()">取消</button>
            <button type="button" class="btn btn-success" onclick="checkSaveSplitMoney()">保存</button>
        </div>
        </div>
    </div>
</div>
</body>
<script src="../../js/jquery.js"></script>
<script src="../../js/common-scripts.js"></script>
<script src="../../js/jquery.dataTables.min.js"></script>
<script src="../../js/bootstrap.min.js"></script>
<!-- <script src="../../js/jquery-editable-select.js"></script> -->
<script src="../../js/laydate/laydate.js"></script>
<script src="../../toastr/toastr.js"></script>
<script src="../../js/jquery-form.min.js"></script>
<script src="../../js/bootstrap-select.js"></script>
<script>
    $(document).ready( function () {
        laydate.render({
            elem: '#year' //指定元素
        });
        laydate.render({
            elem: '#year2' //指定元素
        });
        laydate.render({
            elem: '#year3' //指定元素
        });
        laydate.render({
            elem: '#edit_year' //指定元素
        });
        laydate.render({
            elem: '#edit_year2' //指定元素
           	,done: function(value, date, endDate){
           		if($("#edit_year").val()!=""||$("#edit_year").val()!=null){
               		var t1 = $("#edit_year").val();
                   	var d1 = t1.replace(/\-/g, "/");
                   	var date1 = new Date(d1);
                   	
                   	var t2 = $("#edit_year2").val();
                   	var d2 = t2.replace(/\-/g, "/");
                   	var date2 = new Date(d2);
                   	
                   	var timeType =1000*3600*24;
                   	var aa=parseInt((date2.getTime() - date1.getTime()) / parseInt(timeType));
                   	$("#edit_work_date").val(aa+"天");
               	}
          	  }
        });
        laydate.render({
            elem: '#edit_year3' //指定元素
        });
        
        laydate.render({
            elem: '#seach_start_time_min' //指定元素
        });
        laydate.render({
            elem: '#seach_start_time_max' //指定元素
        });
        laydate.render({
            elem: '#seach_end_time_min' //指定元素
        });
        laydate.render({
            elem: '#seach_end_time_max' //指定元素
        });
        laydate.render({
        	  elem: 'input[name=split_date]',
        	  type: 'year'
        	}); 
        $("#zhuangtai").trigger("change");
        initbumen();
        initSelect();
        initCooperator();
        initDetailContract();
        initFenGs();
        
       	initTable();
	});
    function GetQueryString(name){
        var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if(r!=null)return  unescape(r[2]); return null;
   }
   // 调用方法
   	id=GetQueryString("prjId");

function quxiaoSplit(){
	$("#split").modal('hide')
}
function checkquxiaoSplit(){
	$("#xgsplit").modal('hide')
}


    
    var table2=$('#history_table').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 10,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
		            { "data": "taskCode"}, 
		            { "data": "contractName"}, 
		            { "data": null},
		        ],
		        "columnDefs": [
								{	
										 "class": "tcenter",
										    "targets": 2,
										    "searchable": true,
										    "render": function(data, type, full) {
										    	return '<i class="iconfont icon-icon-test" style="font-size:18px;cursor:pointer;" title="查看详细信息"  onclick="lookHistory(this)"></i>'
										    	}
										  }
								],
        "order": [[1, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
        
	});
    

    
     //增加部门
    function addBumen(){
    	for(var i in pageNameList){
    	var num=$("#xieban"+i+" tr").length-1;
    	if(($("#xieban"+i+" tr").length)<=4){
	    	$("#xieban"+i+" tbody").append("<tr><td>"+"协办部门"+num+"</td><td>"
	                +'<form class="form-inline">'
	                    +'<select class="form-control" id="xieban'+num+''+i+'" style="width:150px;">'
	                    +'</select>'
	                    +'<input type="text" id="xiebanMoney'+i+'" class="form-control" style="width:150px;" placeholder="金额">'
	                    +"<button style='margin-left:15px;' type='button' class='btn btn-primary' onclick='removeXieBan(this)'>移除协办部门</button>"
	                +'</form>'
	                +"</td><td>"
                    +'<div class="yihang" ><div style="width:80px;">分摊比例:</div>'
                    +'<input type="text" id="xiebanMoney'+i+'" class="form-control" style="width:150px;" placeholder="金额"></div>'
	                +"</td></tr>");
	                $.ajax({
	                    type: 'POST',
	                    url: getContextPath()+'/organizationManagement/selectProductionDepartment',
	                    dataType: 'json',
	                    async:false,
	                    data: {
	
	                    },
	                    error: function (msg) {
	                    	toastr.error("请求失败");
	                    },
	                    success: function (json) {
	                    	$("#xieban"+num+""+i+"").empty();
	                        for(var j=0;j<json.length;j++){
	                        	$("#xieban"+num+""+i+"").append("<option value="+json[j].omId+">"+json[j].omName+"</option>");
	                        }
	                    }
	        		});
    	}else{
    		toastr.error("协办部门已达上限")
    	}
    	}
    }
    
    function xgaddBumen(){
    	if(($("#xgxieban tr").length)<=4){
    		var num=$("#xgxieban tr").length-1;
	    	$("#xgxieban tbody").append("<tr class='xieban'><td>"+"协办部门"+num+"</td><td>"
	                +'<form class="form-inline">'
	                    +'<select class="form-control" id="xgxieban'+num+'" style="width:150px;">'
	                    +'</select>'
	                    +'  <input type="text" id="xgxiebanMoney'+num+'" class="form-control" style="width:150px;" placeholder="金额">'
	                    +"<button style='margin-left:15px;' type='button' class='btn btn-primary' onclick='removeXieBan(this)'>移除协办部门</button>"
	                +'</form>'
	                +"</td></tr>");
	                $.ajax({
	                    type: 'POST',
	                    url: getContextPath()+'/organizationManagement/getOrgIdAndName',
	                    dataType: 'json',
	                    data: {
	
	                    },
	                    error: function (msg) {
	                    	toastr.error("请求失败");
	                    },
	                    success: function (json) {
	                    	$("#xgxieban"+num).empty();
	                        for(var i=0;i<json.length;i++){
	                        	$("#xgxieban"+num).append("<option value="+json[i].omId+">"+json[i].omName+"</option>");
	                        }
	                    }
	        		});
    	}else{
    		toastr.error("协办部门已达上限")
    	}
    }
    function bgaddBumen(){
    	if(($("#bgxieban tr").length)<=4){
	    	$("#bgxieban").append("<tr><td>"+"协办部门"+($("#bgxieban tr").length-1)+"</td><td>"
	                +'<form class="form-inline">'
	                    +'<select class="form-control" id="bgxieban'+($("#bgxieban tr").length-1)+'" style="width:150px;">'
	                    +'</select>'
	                    +'  <input type="text" id="bgxiebanjine'+($("#bgxieban tr").length-1)+'" class="form-control" style="width:150px;" placeholder="金额">'
	                	+"<button style='margin-left:15px;' type='button' class='btn btn-primary' onclick='removeXieBan(this)'>移除协办部门</button>"
	                +'</form>'
	                +"</td></tr>");
	                $.ajax({
	                    type: 'POST',
	                    url: getContextPath()+'/organizationManagement/getOrgIdAndName',
	                    dataType: 'json',
	                    data: {
	
	                    },
	                    error: function (msg) {
	                    	toastr.error("请求失败");
	                    },
	                    success: function (json) {
	                    	$("#bgxieban1").empty();
	                    	$("#bgxieban2").empty();
	                    	$("#bgxieban3").empty();
	                        for(var i=0;i<json.length;i++){
	                        	$("#bgxieban1").append("<option value="+json[i].omId+">"+json[i].omName+"</option>");
	                        	$("#bgxieban2").append("<option value="+json[i].omId+">"+json[i].omName+"</option>");
	                        	$("#bgxieban3").append("<option value="+json[i].omId+">"+json[i].omName+"</option>");
	                        }
	                    }
	        		});
    	}else{
    		toastr.error("协办部门已达上限")
    	}
    }
    //回显协办部门
    function xiebanhuixian(obj,num){ 
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/organizationManagement/getOrgIdAndName',
            dataType: 'json',
            async:false,
            data: {

            },
            error: function (msg) {
            	toastr.error("请求失败");
            },
            success: function (json) {
            	$("#xgxieban"+num).empty();
                for(var i=0;i<json.length;i++){
                	$("#xgxieban"+num).append("<option value="+json[i].omId+">"+json[i].omName+"</option>");
                }
                $("#xgxieban"+num).val(obj);
            }
		});
    }
  //初始化提交部门
	function initbumen(){
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/organizationManagement/getOrgIdAndName',
            dataType: 'json',
            data: {
            	
            },
            error: function (msg) {
            	toastr.error("请求失败");
            },
            success: function (json) {
            	$("#seach_main_department").append("<option value='%'>全部</option>")
            	$("#seach_xb_department").append("<option value='%'>全部</option>")
                for(var i=0;i<json.length;i++){
                	$("#yifang_department").append("<option value="+json[i].omId+">"+json[i].omName+"</option>");
                	$("#zhuban").append("<option value="+json[i].omId+">"+json[i].omName+"</option>");
                	$("#xgzhuban").append("<option value="+json[i].omId+">"+json[i].omName+"</option>");
                	$("#edit_yifang_department").append("<option value="+json[i].omId+">"+json[i].omName+"</option>");
                	$("#seach_main_department").append("<option value="+json[i].omId+">"+json[i].omName+"</option>");
                	$("#seach_xb_department").append("<option value="+json[i].omId+">"+json[i].omName+"</option>");
                }
            }
		});
	}
  
	function initSelect(){
  		$.ajax({
            type: 'POST',
            url: getContextPath()+'/task/selectPrjNameAndWorkNo',
            dataType: 'json',
            data: {
            },
            error: function (msg) {
            	toastr.error("请求失败");
            },
            success: function (json) {
            	$("#selectpicker_no").html('');
            	$("#selectpicker_name").html('');
            	for(var i=0;i<json.length;i++){
            		$("#selectpicker_name").append("<option  value="+json[i].prjName+">"+json[i].prjName+"</option>");
            		$("#selectpicker_no").append("<option  value="+json[i].prjNo+">"+json[i].prjNo+"</option>");
            	}
            	$('#selectpicker_no').selectpicker('refresh');
            	$('#selectpicker_name').selectpicker('refresh');
            }
  		});
  	}  
	
	var noType;
	function chooseNo(obj){
		noType=obj;
		$('.selectpicker').selectpicker('deselectAll'); 
		$("#chooseNo").modal("show");
		if(obj==1){
			var prjNoArray = $("#edit_work_no").val().split(",");
	  		$("#selectpicker_no").val(prjNoArray);
	  		$("#selectpicker_no").selectpicker("refresh");
		}
	}
	
	var nameType;
	function chooseName(obj){
		nameType=obj;
		$('.selectpicker').selectpicker('deselectAll'); 
		$("#chooseName").modal("show");
		if(obj==1){
			var prjNameArray = $("#edit_prj_name").val().split(",");
			$("#selectpicker_name").val(prjNameArray);
	  		$("#selectpicker_name").selectpicker("refresh");
		}
	}
	
	function quxiao(){
		$('#chooseNo').on('hidden.bs.modal', function () {//解决模态框页面滚动问题
            if ($('.modal.in').size() >= 1) {
                $('body').addClass('modal-open')
            }
        })
        $('#chooseName').modal("hide");
	}
	
	function quxiao2(){
		$('#chooseNo').on('hidden.bs.modal', function () {//解决模态框页面滚动问题
            if ($('.modal.in').size() >= 1) {
                $('body').addClass('modal-open')
            }
        })
        $('#chooseNo').modal("hide");
	}
  	
	function saveNo(){
		$('#chooseNo').on('hidden.bs.modal', function () {//解决模态框页面滚动问题
            if ($('.modal.in').size() >= 1) {
                $('body').addClass('modal-open')
            }
        })
		
		var no_list=$("#selectpicker_no").val();
		if(no_list!=null){
		  		$.ajax({
		            type: 'POST',
		            url: getContextPath()+'/task/selectTaskPrjName',
		            dataType: 'json',
		            async:false,
		            data: {
		            	prjNo:no_list.toString()
		            },
		            success: function (json) {
		            	var deptArray=new Array();
		            	for(var ii=0;ii<json.length;ii++){
		            		var mainDept=json[ii].mainDepartment;
		            		var omName=json[ii].omName;
		            		var xbDept=json[ii].assist_department1;
		            		var xbname=json[ii].name1;
		            		var xbDept2=json[ii].assist_department2;
		            		var xbname2=json[ii].name2;
		            		var xbDept3=json[ii].assist_department3;
		            		var xbname3=json[ii].name3;
		            		if(mainDept!=null&&mainDept!=''){
		            			var dept={
			            				id:undefined,
			            				name:undefined
			            		}
		            			dept.id=mainDept;
		            			dept.name=omName;
		            			if(deptArray.length>0){
		            				var count=0;
		            				for(var d=0;d<deptArray.length;d++){
			            				if(deptArray[d].id==mainDept){
			            					count=1;
			            				}
			            			}
		            				if(count!=1){
		            					deptArray.push(dept);
		            				}
		            			}else{
		            				deptArray.push(dept);
		            			}
		            		}
		            		
		            		if(xbDept!=null&&xbDept!=''){
		            			var dept2={
			            				id:undefined,
			            				name:undefined
			            		}
		            			dept2.id=xbDept;
		            			dept2.name=xbname;
		            			if(deptArray.length>0){
		            				var count=0;
		            				for(var d=0;d<deptArray.length;d++){
			            				if(deptArray[d].id==xbDept){
			            					count=1;
			            				}
			            			}
		            				if(count!=1){
		            					deptArray.push(dept2);
		            				}
		            			}else{
		            				deptArray.push(dept2);
		            			}
		            		}
		            		
		            		if(xbDept2!=null&&xbDept2!=''){
		            			var dept3={
			            				id:undefined,
			            				name:undefined
			            		}
		            			dept3.id=xbDept2;
		            			dept3.name=xbname2;
		            			if(deptArray.length>0){
		            				var count=0;
		            				for(var d=0;d<deptArray.length;d++){
			            				if(deptArray[d].id==xbDept2){
			            					count=1;
			            				}
			            			}
		            				if(count!=1){
		            					deptArray.push(dept3);
		            				}
		            			}else{
		            				deptArray.push(dept3);
		            			}
		            		}
		            		if(xbDept3!=null&&xbDept3!=''){
		            			var dept4={
			            				id:undefined,
			            				name:undefined
			            		}
		            			dept4.id=xbDept3;
		            			dept4.name=xbname3;
		            			if(deptArray.length>0){
		            				var count=0;
		            				for(var d=0;d<deptArray.length;d++){
			            				if(deptArray[d].id==xbDept3){
			            					count=1;
			            				}
			            			}
		            				if(count!=1){
		            					deptArray.push(dept4);
		            				}
		            			}else{
		            				deptArray.push(dept4);
		            			}
		            		}
		            		
		            	}
		            	$("#yifang_department").html('');
		            	for(var c=0;c<deptArray.length;c++){
		            		$("#yifang_department").append("<option value="+deptArray[c].id+">"+deptArray[c].name+"</option>")
		            	}
		            	var array=new Array();
		            	var array2=new Array();
		            	for(var i=0;i<json.length;i++){
		            		array.push(json[i].prjName)
		            		var type=json[i].prjType2;
		            		if($.inArray(type, array2)==-1){
		            			array2.push(type)
		            		}
		            	}
		            	if(noType==0){
		            		$('#work_no').val(no_list)
			            	$('#prj_name').val(array.toString())
			            	$('#prj_type').val(array2.toString())
			            	var tasks = getTaskBytaskCode(no_list.toString());
			            	pinjieRenwudanChaifen(array,no_list,tasks);
			            	var jyms = getJYMS(tasks);
			            	$('#prj_jyms').val(jyms);
			            	$("#chooseNo").modal("hide");
		            	}else if(noType==1){
		            		$('#edit_work_no').val(no_list)
			            	$('#edit_prj_name').val(array.toString())
			            	$('#edit_prj_type').val(array2.toString())
			            	var tasks = getTaskBytaskCode(no_list.toString());
		            		
		            		editpinjieRenwudanChaifen(array,no_list,tasks);
			            	$("#chooseNo").modal("hide");
		            	}
		            	
		            }
		  		});
	  		}else{
	  			toastr.error("任务单号为空");
	  		}
	}
	
	function saveName(){
		$('#chooseName').on('hidden.bs.modal', function () {//解决模态框页面滚动问题
            if ($('.modal.in').size() >= 1) {
                $('body').addClass('modal-open')
            }
        })
        
		var name_list=$("#selectpicker_name").val();
		if(name_list!=null){
	  		$.ajax({
	            type: 'POST',
	            url: getContextPath()+'/task/selectTaskPrjNo',
	            dataType: 'json',
	            async:false,
	            data: {
	            	prjName:name_list.toString()
	            },
	            success: function (json) {
	            	var deptArray=new Array();
	            	for(var ii=0;ii<json.length;ii++){
	            		var mainDept=json[ii].mainDepartment;
	            		var omName=json[ii].omName;
	            		var xbDept=json[ii].assist_department1;
	            		var xbname=json[ii].name1;
	            		var xbDept2=json[ii].assist_department2;
	            		var xbname2=json[ii].name2;
	            		var xbDept3=json[ii].assist_department3;
	            		var xbname3=json[ii].name3;
	            		if(mainDept!=null&&mainDept!=''){
	            			var dept={
		            				id:undefined,
		            				name:undefined
		            		}
	            			dept.id=mainDept;
	            			dept.name=omName;
	            			if(deptArray.length>0){
	            				var count=0;
	            				for(var d=0;d<deptArray.length;d++){
		            				if(deptArray[d].id==mainDept){
		            					count=1;
		            				}
		            			}
	            				if(count!=1){
	            					deptArray.push(dept);
	            				}
	            			}else{
	            				deptArray.push(dept);
	            			}
	            		}
	            		
	            		if(xbDept!=null&&xbDept!=''){
	            			var dept2={
		            				id:undefined,
		            				name:undefined
		            		}
	            			dept2.id=xbDept;
	            			dept2.name=xbname;
	            			if(deptArray.length>0){
	            				var count=0;
	            				for(var d=0;d<deptArray.length;d++){
		            				if(deptArray[d].id==xbDept){
		            					count=1;
		            				}
		            			}
	            				if(count!=1){
	            					deptArray.push(dept2);
	            				}
	            			}else{
	            				deptArray.push(dept2);
	            			}
	            		}
	            		
	            		if(xbDept2!=null&&xbDept2!=''){
	            			var dept3={
		            				id:undefined,
		            				name:undefined
		            		}
	            			dept3.id=xbDept2;
	            			dept3.name=xbname2;
	            			if(deptArray.length>0){
	            				var count=0;
	            				for(var d=0;d<deptArray.length;d++){
		            				if(deptArray[d].id==xbDept2){
		            					count=1;
		            				}
		            			}
	            				if(count!=1){
	            					deptArray.push(dept3);
	            				}
	            			}else{
	            				deptArray.push(dept3);
	            			}
	            		}
	            		if(xbDept3!=null&&xbDept3!=''){
	            			var dept4={
		            				id:undefined,
		            				name:undefined
		            		}
	            			dept4.id=xbDept3;
	            			dept4.name=xbname3;
	            			if(deptArray.length>0){
	            				var count=0;
	            				for(var d=0;d<deptArray.length;d++){
		            				if(deptArray[d].id==xbDept3){
		            					count=1;
		            				}
		            			}
	            				if(count!=1){
	            					deptArray.push(dept4);
	            				}
	            			}else{
	            				deptArray.push(dept4);
	            			}
	            		}
	            		
	            	}
	            	$("#edit_yifang_department").html('');
	            	for(var c=0;c<deptArray.length;c++){
	            		$("#edit_yifang_department").append("<option value="+deptArray[c].id+">"+deptArray[c].name+"</option>")
	            	}
	            	
	            	var array=new Array();
	            	var array2=new Array();
	            	for(var i=0;i<json.length;i++){
	            		array.push(json[i].prjNo)
	            		var type=json[i].prjType2;
	            		if($.inArray(type, array2)==-1){
	            			array2.push(type)
	            		}
	            	}
	            	if(nameType==0){
	            		$('#prj_name').val(name_list)
		            	$('#work_no').val(array.toString())
	            		var tasks = getTaskBytaskCode(array.toString());
			            pinjieRenwudanChaifen(name_list,array,tasks);
			            var jyms = getJYMS(tasks);
		            	$('#prj_jyms').val(jyms);
		            	$('#prj_type').val(array2.toString());
		            	$("#chooseName").modal("hide");
	            	}else if(nameType==1){
	            		$('#edit_prj_name').val(name_list)
		            	$('#edit_work_no').val(array.toString())
		            	$('#edit_prj_type').val(array2.toString())
		            	var tasks = getTaskBytaskCode(array.toString());
		            	editpinjieRenwudanChaifen(name_list,array,tasks);
		            	$("#chooseName").modal("hide");
	            	}
	            	
	            }
	  		});
  		}else{
  			toastr.error("项目名称为空");
  		}
	}
	
  	function initCooperator(){
  		$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/cooperator/selectCooperatorIdAndName',
	        dataType: 'json',
	        async:false,
	        data: {
	           
	        },
	        success: function (json) {
	        	$("#jiafangName").html('');
	        	$("#edit_jiafangName").html('');
	        	 for(var i=0;i<json.length;i++){
	        		$("#jiafangName").append( "<option value='" + json[i].ccId + "'>"
		                    + json[i].ccName + "</option>")
                    $("#edit_jiafangName").append( "<option value='" + json[i].ccId + "'>"
                    		+ json[i].ccName + "</option>")
	        	 }
        	    $("#edit_jiafangName").selectpicker('refresh');
	        }
	    });
  	}
  	
  	
  	function new_accessory(){
  		$("#new_accessory tbody").append("<tr><td>新附件</td><td><input type='file' name='file' class='form-control'></td><td style='width:150px;'><button type='button' class='btn btn-primary' onclick='removeFile(this)'>移除附件</button></td></tr>")
  	}
  	function new_accessory2(){
  		$("#new_accessory2 tbody").append("<tr><td>新附件</td><td><input type='file' name='file2' class='form-control'></td><td style='width:150px;'><button type='button' class='btn btn-primary' onclick='removeFile(this)'>移除附件</button></td></tr>")
  	}
  	
  	function edit_accessory(){
  		$("#edit_accessory tfoot").append("<tr><td>新附件</td><td><input type='file' name='file' style='width:60%;' class='form-control'></td><td style='width:150px;'><button type='button' class='btn btn-primary' onclick='removeFile(this)'>移除附件</button></td></tr>")
  	}
  	function edit_accessory2(){
  		$("#edit_accessory2 tfoot").append("<tr><td>新附件</td><td><input type='file' name='file2' style='width:60%;' class='form-control'></td><td style='width:150px;'><button type='button' class='btn btn-primary' onclick='removeFile(this)'>移除附件</button></td></tr>")
  	}
  	
  	function removeFile(obj){
  		var tr=$(obj).parents("tr");
  		$(tr).remove();
  	}
  	
  	function removeXieBan(obj){
  		var tr=$(obj).parent().parent().parent();
  		$(tr).remove();
  	}
  	
  	function new_save(){
  		var splitArray=new Array();
  		$("#new_split_table tbody").find("tr").each(function(){
				var years=$(this).find("td").eq(0).text();
				var moneys=$(this).find("td").eq(1).text();
				var arr={
						cjId:null,
						year:undefined,
						money:undefined
				}
				arr.cjId=null;
				arr.year=years;
				arr.money=moneys;
				splitArray.push(arr)
			})
		var contract_name=$("#contract_name").val();
		var work_no=$("#work_no").val();
		var prj_name=$("#prj_name").val();
		var prj_type=$("#prj_type").val();
		var jiafangName=$("#jiafangName").val();
		var yifangName=$("#yifangName").val();
		var year=$("#year").val();
		var year2=$("#year2").val();
		var yifang_department=$("#yifang_department").val();
		var work_date=$("#work_date").val();
		var receieve_money_condition=$("#receieve_money_condition").val();
		var contract_money=$("#contract_money").val();
		var temporary_money=$("#temporary_money").val();
		var year3=$("#year3").val();
		var work_info=$("#work_info").val();
		var zhuban=$("#zhuban").val();
		var zhubanjine=$("#zhubanjine").val();
	  	var xieban1=$("#xieban1").find("option:selected").val();
	  	var xieban1jine=$("#xiebanMoney1").val();
	  	var xieban2=$("#xieban2").find("option:selected").val();
	  	var xieban2jine=$("#xiebanMoney2").val();
	  	var xieban3=$("#xieban3").find("option:selected").val();
	  	var xieban3jine=$("#xiebanMoney3").val();
	  	var split_state=0;
	  	if($("#new_split_table tbody").find('tr').length>0){
			split_state=1;
		}
	  	var cjContract={
	  			cjId:null,
	  			taskCode:undefined,
	  			contractName:undefined,
	  			contractNo:undefined,
	  			prjName:undefined,
	  			prjType:undefined,
	  			contractNameJia:undefined,
	  			contractNameYi:undefined,
	  			contractStartTime:undefined,
	  			contractEndTime:undefined,
	  			yiCjDepartment:undefined,
	  			contractLongTime:undefined,
	  			receieveMoneyCondition:undefined,
	  			contractMoney:undefined,
	  			temporaryMoney:undefined,
	  			contractSignTime:undefined,
	  			workInfo:undefined,
	  			mainDepartment:undefined,
	  			mainDepartmentMoney:undefined,
	  			assistDepartment1:undefined,
	  			assistDepartment1Money:undefined,
	  			assistDepartment2:undefined,
	  			assistDepartment2Money:undefined,
	  			assistDepartment3:undefined,
	  			assistDepartment3Money:undefined,
	  			splitState:undefined,
	  			cjSplitMoney:undefined
			}
	  	cjContract.cjId=null;
	  	cjContract.taskCode=work_no;
	  	cjContract.contractName=contract_name;
	  	cjContract.contractNo=null;
	  	cjContract.prjName=prj_name;
	  	cjContract.prjType=prj_type;
	  	cjContract.contractNameJia=jiafangName;
	  	cjContract.contractNameYi=yifangName;
	  	cjContract.contractStartTime=year;
	  	cjContract.contractEndTime=year2;
	  	cjContract.yiCjDepartment=yifang_department;
	  	cjContract.contractLongTime=work_date;
	  	cjContract.receieveMoneyCondition=receieve_money_condition;
	  	cjContract.contractMoney=contract_money;
	  	cjContract.temporaryMoney=temporary_money;
	  	cjContract.contractSignTime=year3;
	  	cjContract.workInfo=work_info;
	  	cjContract.mainDepartment=zhuban;
	  	cjContract.mainDepartmentMoney=zhubanjine;
	  	cjContract.assistDepartment1=xieban1;
	  	cjContract.assistDepartment1Money=xieban1jine;
	  	cjContract.assistDepartment2=xieban2;
	  	cjContract.assistDepartment2Money=xieban2jine;
	  	cjContract.assistDepartment3=xieban3;
	  	cjContract.assistDepartment3Money=xieban3jine;
	  	cjContract.splitState=split_state;
	  	cjContract.cjSplitMoney=splitArray;
	  	console.log(cjContract)
	  	var formData = new FormData();
		formData.append("cjContract", JSON.stringify(cjContract));
			
		$("#new_accessory tbody").find("tr").each(function(){
				formData.append("file", $(this).find("input")[0].files[0]);
		})
		$("#new_accessory2 tbody").find("tr").each(function(){
				formData.append("file2", $(this).find("input")[0].files[0]);
		})
    	
    	
    	$.ajax({
			type: 'POST',
		        url: getContextPath()+'/cj/addCjContractBySave',
		     	data: formData,  
	            cache: false,
	            processData: false,
	            contentType: false,
	            async: false,
	            dataType: 'json',
		        success: function (json) {
					if(json>0){
						toastr.success("保存成功");
						quxiaoa();
					}else{
						toastr.error("保存失败");
					}
		        }
		})
  	}  	
  	
  	var lianjie;
  	function new_submit(){
  		var splitArray=new Array();
  		$("#new_split_table tbody").find("tr").each(function(){
				var years=$(this).find("td").eq(0).text();
				var moneys=$(this).find("td").eq(1).text();
				var arr={
						cjId:null,
						year:undefined,
						money:undefined
				}
				arr.cjId=null;
				arr.year=years;
				arr.money=moneys;
				splitArray.push(arr)
			})
		var contract_name=$("#contract_name").val();
		var work_no=$("#work_no").val();
		var prj_name=$("#prj_name").val();
		var prj_type=$("#prj_type").val();
		var jiafangName=$("#jiafangName").val();
		var yifangName=$("#yifangName").val();
		var year=$("#year").val();
		var year2=$("#year2").val();
		var yifang_department=$("#yifang_department").val();
		var work_date=$("#work_date").val();
		var receieve_money_condition=$("#receieve_money_condition").val();
		var contract_money=$("#contract_money").val();
		var temporary_money=$("#temporary_money").val();
		var year3=$("#year3").val();
		var work_info=$("#work_info").val();
		var zhuban=$("#zhuban").val();
		var zhubanjine=$("#zhubanjine").val();
	  	var xieban1=$("#xieban1").find("option:selected").val();
	  	var xieban1jine=$("#xiebanMoney1").val();
	  	var xieban2=$("#xieban2").find("option:selected").val();
	  	var xieban2jine=$("#xiebanMoney2").val();
	  	var xieban3=$("#xieban3").find("option:selected").val();
	  	var xieban3jine=$("#xiebanMoney3").val();
	  	var split_state=0;
	  	if($("#new_split_table tbody").find('tr').length>0){
			split_state=1;
		}
	  	var cjContract={
	  			cjId:null,
	  			taskCode:undefined,
	  			contractName:undefined,
	  			contractNo:undefined,
	  			prjName:undefined,
	  			prjType:undefined,
	  			contractNameJia:undefined,
	  			contractNameYi:undefined,
	  			contractStartTime:undefined,
	  			contractEndTime:undefined,
	  			yiCjDepartment:undefined,
	  			contractLongTime:undefined,
	  			receieveMoneyCondition:undefined,
	  			contractMoney:undefined,
	  			temporaryMoney:undefined,
	  			contractSignTime:undefined,
	  			workInfo:undefined,
	  			mainDepartment:undefined,
	  			mainDepartmentMoney:undefined,
	  			assistDepartment1:undefined,
	  			assistDepartment1Money:undefined,
	  			assistDepartment2:undefined,
	  			assistDepartment2Money:undefined,
	  			assistDepartment3:undefined,
	  			assistDepartment3Money:undefined,
	  			splitState:undefined,
	  			cjSplitMoney:undefined
			}
	  	cjContract.cjId=null;
	  	cjContract.taskCode=work_no;
	  	cjContract.contractName=contract_name;
	  	cjContract.contractNo=null;
	  	cjContract.prjName=prj_name;
	  	cjContract.prjType=prj_type;
	  	cjContract.contractNameJia=jiafangName;
	  	cjContract.contractNameYi=yifangName;
	  	cjContract.contractStartTime=year;
	  	cjContract.contractEndTime=year2;
	  	cjContract.yiCjDepartment=yifang_department;
	  	cjContract.contractLongTime=work_date;
	  	cjContract.receieveMoneyCondition=receieve_money_condition;
	  	cjContract.contractMoney=contract_money;
	  	cjContract.temporaryMoney=temporary_money;
	  	cjContract.contractSignTime=year3;
	  	cjContract.workInfo=work_info;
	  	cjContract.mainDepartment=zhuban;
	  	cjContract.mainDepartmentMoney=zhubanjine;
	  	cjContract.assistDepartment1=xieban1;
	  	cjContract.assistDepartment1Money=xieban1jine;
	  	cjContract.assistDepartment2=xieban2;
	  	cjContract.assistDepartment2Money=xieban2jine;
	  	cjContract.assistDepartment3=xieban3;
	  	cjContract.assistDepartment3Money=xieban3jine;
	  	cjContract.splitState=split_state;
	  	cjContract.cjSplitMoney=splitArray;
	  	console.log(cjContract)
	  	var formData = new FormData();
		formData.append("cjContract", JSON.stringify(cjContract));
			
		$("#new_accessory tbody").find("tr").each(function(){
				formData.append("file", $(this).find("input")[0].files[0]);
		})
		$("#new_accessory2 tbody").find("tr").each(function(){
				formData.append("file2", $(this).find("input")[0].files[0]);
		})
    	
    	
    	$.ajax({
			type: 'POST',
		        url: getContextPath()+'/cj/addCjContractBySubmit',
		     	data: formData,  
	            cache: false,
	            processData: false,
	            contentType: false,
	            async: false,
	            dataType: 'json',
		        success: function (json) {
		        	if(json=='0'){
		        		toastr.error("保存失败");
		        	}else{
		        		quxiaoa();
		        		lianjie=json.url;
		            	if(json.receiver!=null&&json.receiver.length>=1){
			        		  $("#tijiaogei").modal('show');
			        		  $("#tijiaoren tbody").empty("");
			        		  for(var i=0;i<json.receiver.length;i++){
			        			  $("#tijiaoren tbody").append('<tr><td>'
			        					  +'<input type="radio" name="tijiaorenming" data-id="'+json.receiver[i].userId+'" data-id2="'+json.receiver[i].omId+'" data-id3="'+json.receiver[i].dutyId+'">'
			        					  +'</td><td>'
			        					  +json.receiver[i].omName
			        					  +'</td><td>'
			        					  +json.receiver[i].dutyName
			        					  +'</td><td>'
			        					  +json.receiver[i].uName
			        					  +'</td></tr>');
			        		  }
			        	  }else if(json.receiver.length==1){
			        		  $.ajax({
			        	          type: 'POST',
			        	          url: getContextPath()+'/task/addTask4',
			        	          dataType: 'json',
			        	          data:{
			        	        	  url:json.url,
			        	        	  userId:json.receiver.userId,
			        	        	  uName:json.receiver.uName,
			        	        	  omName:json.receiver.omName,
			        	        	  dutyName:json.receiver.dutyName,
			        	        	  omId:json.receiver.omId,
			        	        	  dutyId:json.receiver.dutyId
			        	          },
			        	          success: function (json) {
			        	        	  toastr.success('提交成功');
			        	          }
			        	      }); 
			        	  }
		        	}
		        	
					/* if(json>0){
						//$("#myModal").modal("hide");
						toastr.success("保存成功");
						quxiaoa();
					}else{
						toastr.error("保存失败");
					} */
		        }
		})
  	} 
  	
  	function submitPerson(){
  		var uid=$("input[name='tijiaorenming']:checked").attr("data-id");
  	  var omid=$("input[name='tijiaorenming']:checked").attr("data-id2");
  	  var dutyid=$("input[name='tijiaorenming']:checked").attr("data-id3");
  	  var bmmc=$("input[name='tijiaorenming']:checked").parent().next().text();
  	  var zw=$("input[name='tijiaorenming']:checked").parent().next().next().text();
  	  var uname=$("input[name='tijiaorenming']:checked").parent().next().next().next().text();
  	  //var uname=$("input[name='tijiaorenming']:checked").val();
  	  $.ajax({
            type: 'POST',
            url: getContextPath()+'/task/addTask4',
            dataType: 'json',
            data:{
          	  url:lianjie,
          	  userId:uid,
          	  uName:uname,
          	  omName:bmmc,
          	  dutyName:zw,
          	  omId:omid,
          	  dutyId:dutyid
            },
            success: function (json) {
          	  toastr.success('提交成功');
            }
        });  
  	}
  	
  	
  	function lookDetall(obj){
  		var tr=$(obj).parents("tr");
  		var data=$("#mainContent").DataTable().row(tr).data();
  		console.log(data)
  		$("#look_contract_name").text(data.contractName);
  		$("#look_contract_no").text(data.contractNo);
  		$("#look_work_no").text(data.taskCode);
  		$("#look_prj_name").text(data.prjName);
  		$("#look_prj_type").text(data.prjType);
  		$("#look_jiafangName").text(data.ccName);
  		$("#look_yifangName").text(data.contractNameYi);
  		$("#look_year").text(data.contractStartTime);
  		$("#look_year2").text(data.contractEndTime);
  		$("#look_yifang_department").text(data.omName);
  		$("#look_work_date").text(data.contractLongTime);
  		$("#look_receieve_money_condition").text(data.receieveMoneyCondition);
  		$("#look_contract_money").text(data.contractMoney);
  		$("#look_temporary_money").text(data.temporaryMoney);
  		$("#look_year3").text(data.contractSignTime);
  		$("#look_work_info").text(data.workInfo);
  		var cs=data.cjSplitMoney;
    	$("#look_split_table tbody").empty();
    	for(var i=0;i<cs.length;i++){
				$("#look_split_table tbody").append("<tr><td>"
						+""+cs[i].year+""
						+"</td><td>"
						+""+cs[i].money+""
						+"</td></tr>")
		}
    	
  		$("#look_xieban tbody").html('');
  		$("#look_xieban tbody").append("<tr><td>主办部门</td><td>"+data.name+"</td><td>金额</td><td>"+data.mainDepartmentMoney+"</td></tr>")
  		if(data.assistDepartment1!=null&&data.assistDepartment1!=""){
  			$("#look_xieban tbody").append("<tr><td>协办部门</td><td>"+data.name2+"</td><td>金额</td><td>"+data.assistDepartment1Money+"</td></tr>")
    	}
    	if(data.assistDepartment2!=null&&data.assistDepartment2!=""){
    		$("#look_xieban tbody").append("<tr><td>协办部门</td><td>"+data.name3+"</td><td>金额</td><td>"+data.assistDepartment2Money+"</td></tr>")
    	}
    	if(data.assistDepartment3!=null&&data.assistDepartment3!=""){
    		$("#look_xieban tbody").append("<tr><td>协办部门</td><td>"+data.name4+"</td><td>金额</td><td>"+data.assistDepartment3Money+"</td></tr>")
    	}
    	
  		$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/announcement/selectAccessoryById',
	        dataType: 'json',
	        data: {
	           id:data.cjId
	        },
	        success: function (json) {
	        	$("#look_accessory tbody").html('');
	        	$("#look_accessory2 tbody").html('');
	        	for(var i=0;i<json.length;i++){
	          		//$("#look_accessory tbody").append("<tr><td>附件"+(i+1)+"</td><td>"+json[i].acName+"</td><td style='width:150px;'><button type='button' class='btn btn-primary' data="+json[i].acUrl+" data2="+json[i].acName+" onclick='downloadFile(this)'>下载附件</button></td></tr>")
	          		if(json[i].aType=="承接合同文本"){
		            	   $("#look_accessory tbody").append("<tr>"+
									"<td>附件</td>"+
				         	    	"<td ><input type='text' class='form-control' style='width:70%;' value='"+json[i].acName+"' disabled></td>"+
				         	    	"<td style='width:150px;'><button type='button' class='btn btn-primary' data='"+json[i].acUrl+"' data2='"+json[i].acName+"' onclick='downloadFile(this)'>下载附件</button></td>"+
				         	    "</tr>");
	            	   }
	          		if(json[i].aType=="法律顾问签字"){
		            	   $("#look_accessory2 tbody").append("<tr>"+
									"<td>附件</td>"+
				         	    	"<td ><input type='text' class='form-control' style='width:70%;' value='"+json[i].acName+"' disabled></td>"+
				         	    	"<td style='width:150px;'><button type='button' class='btn btn-primary' data='"+json[i].acUrl+"' data2='"+json[i].acName+"' onclick='downloadFile(this)'>下载附件</button></td>"+
				         	    "</tr>");
	            	   }
	        	}
	        }
    	});
  		
    	$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/cj/selectCjHistory',
	        dataType: 'json',
	        data: {
	           no:data.contractNo
	        },
	        success: function (json) {
	        	$('#history_table').dataTable().fnClearTable();
                $('#history_table').DataTable().rows.add(json).draw(false);
	        }
    	});
  		
  		//$("#allMsg1").modal("show");
    	$("#diyi").removeClass("active");
        $("#disi").addClass("active");
        $("#diyi a").show();
        $("#disi a").show();
        $("#home").removeClass("active");
        $("#settings").addClass("active");
  	}
  	
  	function downloadFile(obj){
  		var filePath=$(obj).attr("data");
  		var fileName=$(obj).attr("data2");
  		window.location.href=encodeURI(getContextPath()+"/FileDownLoad?fileName="+fileName+"&filePath="+filePath);
  	}
  	
  	var pageNameList;
  	function initTable(){
  		$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/cj/selectCjContractById',
	        dataType: 'json',
	        data:{
	        	id:id
	        },
	        success: function (json) {
	        	console.log(json)
	        	data=json;
	        	$("#edit_contract_name").val(data.contractName);
	      		$("#edit_contract_no").val(data.contractNo);
	      		$("#edit_work_no").val(data.taskCode);
	      		$("#edit_prj_name").val(data.prjName);
	      		var prjNameArray = data.prjName.split(",");
	      		var taskCodeArray = data.taskCode.split(",");
	      		var tasks = getTaskBytaskCode(data.taskCode);
	      		editpinjieRenwudanChaifen(prjNameArray,taskCodeArray,tasks);
	      		
	      		$("#edit_prj_type").val(data.prjType);
	      		var contractNameJiaArray = data.contractNameJia.split(",");
	      		$("#edit_jiafangName").val(contractNameJiaArray);
	      		$("#edit_jiafangName").selectpicker("refresh");
	      		$("#edit_yifangName").val(data.contractNameYi);
	      		$("#edit_year").val(data.contractStartTime);
	      		$("#edit_year2").val(data.contractEndTime);
	      		$("#edit_prj_jyms").val(data.jyms);
	      		
	      		$.ajax({
	    	        type: 'POST',
	    	        url: getContextPath()+'/task/selectTaskPrjName',
	    	        dataType: 'json',
	    	        data: {
	    	        	prjNo:data.taskCode
	    	        },
	    	        success: function (json) {
	                	var deptArray=new Array();
	                	for(var ii=0;ii<json.length;ii++){
	                		var mainDept=json[ii].mainDepartment;
	                		var omName=json[ii].omName;
	                		var xbDept=json[ii].assist_department1;
	                		var xbname=json[ii].name1;
	                		var xbDept2=json[ii].assist_department2;
	                		var xbname2=json[ii].name2;
	                		var xbDept3=json[ii].assist_department3;
	                		var xbname3=json[ii].name3;
	                		if(mainDept!=null&&mainDept!=''){
	                			var dept={
	    	            				id:undefined,
	    	            				name:undefined
	    	            		}
	                			dept.id=mainDept;
	                			dept.name=omName;
	                			if(deptArray.length>0){
	                				var count=0;
	                				for(var d=0;d<deptArray.length;d++){
	    	            				if(deptArray[d].id==mainDept){
	    	            					count=1;
	    	            				}
	    	            			}
	                				if(count!=1){
	                					deptArray.push(dept);
	                				}
	                			}else{
	                				deptArray.push(dept);
	                			}
	                		}
	                		
	                		if(xbDept!=null&&xbDept!=''){
	                			var dept2={
	    	            				id:undefined,
	    	            				name:undefined
	    	            		}
	                			dept2.id=xbDept;
	                			dept2.name=xbname;
	                			if(deptArray.length>0){
	                				var count=0;
	                				for(var d=0;d<deptArray.length;d++){
	    	            				if(deptArray[d].id==xbDept){
	    	            					count=1;
	    	            				}
	    	            			}
	                				if(count!=1){
	                					deptArray.push(dept2);
	                				}
	                			}else{
	                				deptArray.push(dept2);
	                			}
	                		}
	                		
	                		if(xbDept2!=null&&xbDept2!=''){
	                			var dept3={
	    	            				id:undefined,
	    	            				name:undefined
	    	            		}
	                			dept3.id=xbDept2;
	                			dept3.name=xbname2;
	                			if(deptArray.length>0){
	                				var count=0;
	                				for(var d=0;d<deptArray.length;d++){
	    	            				if(deptArray[d].id==xbDept2){
	    	            					count=1;
	    	            				}
	    	            			}
	                				if(count!=1){
	                					deptArray.push(dept3);
	                				}
	                			}else{
	                				deptArray.push(dept3);
	                			}
	                		}
	                		if(xbDept3!=null&&xbDept3!=''){
	                			var dept4={
	    	            				id:undefined,
	    	            				name:undefined
	    	            		}
	                			dept4.id=xbDept3;
	                			dept4.name=xbname3;
	                			if(deptArray.length>0){
	                				var count=0;
	                				for(var d=0;d<deptArray.length;d++){
	    	            				if(deptArray[d].id==xbDept3){
	    	            					count=1;
	    	            				}
	    	            			}
	                				if(count!=1){
	                					deptArray.push(dept4);
	                				}
	                			}else{
	                				deptArray.push(dept4);
	                			}
	                		}
	                		
	                	}
	                	$("#edit_yifang_department").html('');
	                	for(var c=0;c<deptArray.length;c++){
	                		$("#edit_yifang_department").append("<option value="+deptArray[c].id+">"+deptArray[c].name+"</option>")
	                	}
	    	        	$("#edit_yifang_department").val(data.yiCjDepartment);
	    	        }
	        	});
	      		
	      		$("#edit_work_date").val(data.contractLongTime);
	      		$("#edit_receieve_money_condition").val(data.receieveMoneyCondition);
	      		$("#edit_contract_money").val(data.contractMoney);
	      		$("#edit_temporary_money").val(data.temporaryMoney);
	      		$("#edit_year3").val(data.contractSignTime);
	      		$("#edit_work_info").val(data.workInfo);
	      		$("#xgzhuban").val(data.mainDepartment);
	        	$("#xgzhubanjine").val(data.mainDepartmentMoney);
	        	
	        	/* var cs=data.cjSplitMoney;
	        	$("#edit_split_table tbody").empty();
	        	for(var i=0;i<cs.length;i++){
	    				$("#edit_split_table tbody").append("<tr><td>"
	    						+""+cs[i].year+""
	    						+"</td><td>"
	    						+""+cs[i].money+""
	    						+"</td></tr>")
	    		} */
	    		
	    		$.ajax({
        	        type: 'POST',
        	        url: getContextPath()+'/announcement/selectAccessoryById',
        	        dataType: 'json',
        	        data: {
        	           id:id
        	        },
        	        success: function (json) {
        	        	$("#edit_accessory tbody").html('');
        	        	$("#edit_accessory2 tbody").html('');
        	        	for(var i=0;i<json.length;i++){
        	          		if(json[i].aType=="承接合同文本"){
        		            	   $("#edit_accessory tbody").append("<tr>"+
        									"<td>附件</td>"+
        									"<td><a href='"+getLocalPath()+"/oa_file/"+json[i].acUrl+"' target='view_window' style='color:blue;'>"+json[i].acName+"</a></td>"+
        				         	    	"<td><button type='button' class='btn btn-primary' data1='"+json[i].aId+"' data2='"+json[i].acUrl+"'  data4="+json[i].acName+" onclick='deletefile(this)'>删除附件</button></td>"+
        									/* "<td ><input type='text' class='form-control' style='width:70%;' value='"+json[i].acName+"' disabled></td>"+
        				         	    	"<td style='width:150px;'><button type='button' class='btn btn-primary' data='"+json[i].acUrl+"' data2='"+json[i].acName+"' onclick='downloadFile(this)'>下载附件</button></td>"+ */
        				         	    "</tr>");
        	            	   }
        	          		if(json[i].aType=="法律顾问签字"){
        		            	   $("#edit_accessory2 tbody").append("<tr>"+
        									"<td>附件</td>"+
        									"<td><a href='"+getLocalPath()+"/oa_file/"+json[i].acUrl+"' target='view_window' style='color:blue;'>"+json[i].acName+"</a></td>"+
        									"<td><button type='button' class='btn btn-primary' data1='"+json[i].aId+"' data2='"+json[i].acUrl+"'  data4="+json[i].acName+" onclick='deletefile(this)'>删除附件</button></td>"+
        				         	    	/* "<td ><input type='text' class='form-control' style='width:70%;' value='"+json[i].acName+"' disabled></td>"+
        				         	    	"<td style='width:150px;'><button type='button' class='btn btn-primary' data='"+json[i].acUrl+"' data2='"+json[i].acName+"' onclick='downloadFile(this)'>下载附件</button></td>"+ */
        				         	    "</tr>");
        	            	   }
        	        	}
        	        }
            	});
	        	
	        	$("#xgxieban .xieban").empty();
	      		if(data.assistDepartment1!=null&&data.assistDepartment1!=""){
	        		$("#xgxieban tbody").append("<tr class='xieban'><td>"+"协办部门1"+"</td><td>"
	    	                +'<form class="form-inline">'
	    	                    +'<select class="form-control" id="xgxieban1" style="width:160px;">'
	    	                    +'</select>'
	    	                    +'<input type="text" id="xgxiebanMoney1" class="form-control" style="width:160px;margin-left:5px;" placeholder="金额">'
	    	                	+"<button type='button' style='margin-left:15px;' class='btn btn-primary' onclick='deleteXieBan(this)'>移除协办单位</button>"
	    	                +'</form>'
	    	                +"</td><td></td></tr>");
	        		xiebanhuixian(data.assistDepartment1,1);
	        		$("#xgxiebanMoney1").val(data.assistDepartment1Money);
	        	}
	        	if(data.assistDepartment2!=null&&data.assistDepartment2!=""){
	        		$("#xgxieban tbody").append("<tr class='xieban'><td>"+"协办部门2"+"</td><td>"
	    	                +'<form class="form-inline">'
	    	                    +'<select class="form-control" id="xgxieban2" style="width:160px;">'
	    	                    +'</select>'
	    	                    +'<input type="text" id="xgxiebanMoney2" class="form-control" style="width:160px;margin-left:5px;" placeholder="金额">'
	    	                	+"<button type='button' style='margin-left:15px;' class='btn btn-primary' onclick='deleteXieBan(this)'>移除协办单位</button>"
	    	                +'</form>'
	    	                +"</td><td></td></tr>");
	        		xiebanhuixian(data.assistDepartment2,2);
	        		$("#xgxiebanMoney2").val(data.assistDepartment2Money);
	        	}
	        	if(data.assistDepartment3!=null&&data.assistDepartment3!=""){
	        		$("#xgxieban tbody").append("<tr class='xieban'><td>协办部门3</td><td>"
	    	                +'<form class="form-inline">'
	    	                    +'<select class="form-control" id="xgxieban3" style="width:160px;">'
	    	                    +'</select>'
	    	                    +'<input type="text" id="xgxiebanMoney3" class="form-control" style="width:160px;margin-left:5px;" placeholder="金额">'
	    	                	+"<button type='button' style='margin-left:15px;' class='btn btn-primary' onclick='deleteXieBan(this)'>移除协办单位</button>"
	    	                +'</form>'
	    	                +"</td><td></td></tr>");
	        		xiebanhuixian(data.assistDepartment3,3);
	        		$("#xgxiebanMoney3").val(data.assistDepartment3Money);
	        	}
	        	
	        }
	    });
  		
  	}
  	
	var page_money;
	function getChaifenXinXiArray(idName){
		var array = new Array();
		
		for(var i in pageTaskNoArray){
  			var chaiFenXinXi = {
  					prjNo:undefined,
  	  				mainDepartment:undefined,
  	  				mainDepartmentMoney:undefined,
  	  				mainDepartmentCost:undefined,
  					assistDepartment1:undefined,
  	  				assistDepartment1Money:undefined,
  	  				assistDepartment1Cost:undefined,
  	  				assistDepartment2:undefined,
  	  				assistDepartment2Money:undefined,
  	  				assistDepartment2Cost:undefined,
  					assistDepartment3:undefined,
  	  				assistDepartment3Money:undefined,
  	  				assistDepartment3Cost:undefined,
  	  		}
  			chaiFenXinXi.prjNo = $("#xieban"+i+" thead").find("th").eq(0).find("div").eq(1).text();
	  		$("#xieban"+i+" tbody").find("tr").each(function(index,element){
	  			 if(index==0){
	  				chaiFenXinXi.mainDepartment = $(this).find("select").eq(0).val();
	  				
	  				chaiFenXinXi.mainDepartmentMoney = parseFloat($(this).find("input").eq(0).val());
	  				chaiFenXinXi.mainDepartmentCost = $(this).find("input").eq(1).val();
	  			 }else if(index==1){
	  				chaiFenXinXi.assistDepartment1 = $(this).find("select").eq(0).val();
	  				chaiFenXinXi.assistDepartment1Money = parseFloat($(this).find("input").eq(0).val());
	  				chaiFenXinXi.assistDepartment1Cost = $(this).find("input").eq(1).val();
	  			 }else if(index==2){
	  				chaiFenXinXi.assistDepartment2 = $(this).find("select").eq(0).val();
	  				chaiFenXinXi.assistDepartment2Money = parseFloat($(this).find("input").eq(0).val());
	  				chaiFenXinXi.assistDepartment2Cost = $(this).find("input").eq(1).val();
	  			 }else if(index==3){
	  				chaiFenXinXi.assistDepartment3 = $(this).find("select").eq(0).val();
	  				chaiFenXinXi.assistDepartment3Money = parseFloat($(this).find("input").eq(0).val());
	  				chaiFenXinXi.assistDepartment3Cost = $(this).find("input").eq(1).val();
	  			 }
	  			page_money +=$(this).find("input").eq(0).val();
			})
			var renwuMoney =  $("#xieban"+i+" thead").find("input").eq(0).val();
	  		var frenwuMoney = parseFloat(renwuMoney);
	  		chaiFenXinXi.prjEstimateMoney = frenwuMoney;
	  		chaiFenXinXi.contractMoney =  parseFloat($("#"+idName+"").val());
			array.push(chaiFenXinXi);
  		}	
		return array;
	}
	function judgeInputMoney(idName){
		var allRenwuMoney;
		for(var i in pageTaskNoArray){
			var money = undefined;
	  		$("#xieban"+i+" tbody").find("tr").each(function(index,element){
  				var mainDepartmentMoney = $(this).find("input").eq(0).val();
  				var mainMoney = parseFloat(mainDepartmentMoney);
  				if(money==undefined){
  					money=mainMoney;
  				}else{
  				 money=money+mainMoney;
  				}
			})
			var renwuMoney =  $("#xieban"+i+" thead").find("input").eq(0).val();
	  		var frenwuMoney = parseFloat(renwuMoney);
	  		if(allRenwuMoney==undefined){
	  			allRenwuMoney= frenwuMoney;
	  		}else{
	  			allRenwuMoney+=frenwuMoney;
	  		}
			if(money!=frenwuMoney){
				return false;
			}
  		}	
		var hetongMoney = $("#"+idName+"").val();
		var fhetongMoney = parseFloat(hetongMoney);
		if(allRenwuMoney!=hetongMoney){
			return false;
		}
		return true;
	}
	function judgeFentanbili(){
		var a =undefined
		for(var i in pageTaskNoArray){
	  		$("#xieban"+i+" tbody").find("tr").each(function(index,element){
	  			var bili = $(this).find("input").eq(1).val();
	  			if(bili==""||bili==undefined||bili==null){
	  				a= 1;
	  			}
			})
  		}	
		return a;
	}
	
  	/* function liuchengGaibian(){
  		var splitArray=new Array();
		var deptSplitArray=new Array();
		var chaiFenXinXiArray=new Array();
		chaiFenXinXiArray = getChaifenXinXiArray("edit_contract_money");
		var moneyFlag = judgeInputMoney("edit_contract_money");
		if(!moneyFlag){
			toastr.error("金额分配有误!请检查!");
			return false;
		}
		var fentanFlag = judgeFentanbili();
		if(fentanFlag==1){
			toastr.error("分摊比例未填!请检查!");
			return false;
		}
		var contract_name=$("#edit_contract_name").val();
  		var contract_no=$("#edit_contract_no").val();
  		var work_no=$("#edit_work_no").val();
  		var prj_name=$("#edit_prj_name").val();
  		var prj_type=$("#edit_prj_type").val();
  		var jiafangName=$("#edit_jiafangName").val();
  		var yifangName=$("#edit_yifangName").val();
  		var jfId=$("#edit_jiafangName").val().toString();
		var ccName=$("#edit_jiafangName").parent("td").find("button").attr("title");
  		var year=$("#edit_year").val();
  		var year2=$("#edit_year2").val();
  		var yifang_department=$("#edit_yifang_department").val();
  		var work_date=$("#edit_work_date").val();
  		var receieve_money_condition=$("#edit_receieve_money_condition").val();
  		var contract_money=$("#edit_contract_money").val();
  		var temporary_money=$("#edit_temporary_money").val();
  		var year3=$("#edit_year3").val();
  		var work_info=$("#edit_work_info").val();
  		var zhuban=$("#xgzhuban").val();
  		var zhubanjine=$("#xgzhubanjine").val();
    	var xieban1=$("#xgxieban1").find("option:selected").val();
    	var xieban1jine=$("#xgxiebanMoney1").val();
    	var xieban2=$("#xgxieban2").find("option:selected").val();
    	var xieban2jine=$("#xgxiebanMoney2").val();
    	var xieban3=$("#xgxieban3").find("option:selected").val();
    	var xieban3jine=$("#xgxiebanMoney3").val();
	  	var split_state=0;
	  	if($("#edit_split_table tbody").find('tr').length>0){
			split_state=1;
		}
	  	var cjContract={
	  			cjId:null,
	  			taskCode:undefined,
	  			contractName:undefined,
	  			contractNo:undefined,
	  			prjName:undefined,
	  			prjType:undefined,
	  			contractNameJia:undefined,
	  			ccName:undefined,
	  			contractNameYi:undefined,
	  			contractStartTime:undefined,
	  			contractEndTime:undefined,
	  			yiCjDepartment:undefined,
	  			contractLongTime:undefined,
	  			receieveMoneyCondition:undefined,
	  			contractMoney:undefined,
	  			temporaryMoney:undefined,
	  			contractSignTime:undefined,
	  			workInfo:undefined,
	  			mainDepartment:undefined,
	  			mainDepartmentMoney:undefined,
	  			assistDepartment1:undefined,
	  			assistDepartment1Money:undefined,
	  			assistDepartment2:undefined,
	  			assistDepartment2Money:undefined,
	  			assistDepartment3:undefined,
	  			assistDepartment3Money:undefined,
	  			splitState:undefined,
	  			cjSplitMoney:undefined
			}
	  	cjContract.cjId=id;
	  	cjContract.taskCode=work_no;
	  	cjContract.contractName=contract_name;
	  	cjContract.contractNo=contract_no;
	  	cjContract.prjName=prj_name;
	  	cjContract.prjType=prj_type;
	  	cjContract.contractNameJia=jfId;
	  	cjContract.ccName=ccName;
	  	cjContract.contractNameYi=yifangName;
	  	cjContract.contractStartTime=year;
	  	cjContract.contractEndTime=year2;
	  	cjContract.yiCjDepartment=yifang_department;
	  	cjContract.contractLongTime=work_date;
	  	cjContract.receieveMoneyCondition=receieve_money_condition;
	  	cjContract.contractMoney=contract_money;
	  	cjContract.temporaryMoney=temporary_money;
	  	cjContract.contractSignTime=year3;
	  	cjContract.workInfo=work_info;
	  	cjContract.mainDepartment=zhuban;
	  	cjContract.mainDepartmentMoney=zhubanjine;
	  	cjContract.assistDepartment1=xieban1;
	  	cjContract.assistDepartment1Money=xieban1jine;
	  	cjContract.assistDepartment2=xieban2;
	  	cjContract.assistDepartment2Money=xieban2jine;
	  	cjContract.assistDepartment3=xieban3;
	  	cjContract.assistDepartment3Money=xieban3jine;
	  	cjContract.splitState=split_state;
	  	cjContract.cjSplitMoney=splitArray;
	  	cjContract.chaiFenXinXiArray=chaiFenXinXiArray;
	  	console.log(cjContract)
	  	var formData = new FormData();
		formData.append("cjContract", JSON.stringify(cjContract));
			
		$("#edit_accessory tbody").find("tr").each(function(){
				formData.append("file", $(this).find("input")[0].files[0]);
		})
    	$("#edit_accessory2 tbody").find("tr").each(function(){
				formData.append("file2", $(this).find("input")[0].files[0]);
		})
    	
    	$.ajax({
			type: 'POST',
		        url: getContextPath()+'/cj/updateCjContractFlow',
		     	data: formData,  
	            cache: false,
	            processData: false,
	            contentType: false,
	            dataType: 'json',
	            async: false,
		        success: function (json) {
		        	if(json=='0'){
		        		toastr.error("保存失败");
		        	}else{
		        		quxiaob();
		        		lianjie=json.url;
		            	if(json.receiver!=null&&json.receiver.length>=1){
			        		  $("#tijiaogei").modal('show');
			        		  $("#tijiaoren tbody").empty("");
			        		  for(var i=0;i<json.receiver.length;i++){
			        			  $("#tijiaoren tbody").append('<tr><td>'
			        					  +'<input type="radio" style="width:20px;height:20px;" name="tijiaorenming" data-id="'+json.receiver[i].userId+'" data-id2="'+json.receiver[i].omId+'" data-id3="'+json.receiver[i].dutyId+'">'
			        					  +'</td><td>'
			        					  +json.receiver[i].omName
			        					  +'</td><td>'
			        					  +json.receiver[i].dutyName
			        					  +'</td><td>'
			        					  +json.receiver[i].uName
			        					  +'</td></tr>');
			        		  }
			        	  }else if(json.receiver.length==1){
			        		  $.ajax({
			        	          type: 'POST',
			        	          url: getContextPath()+'/task/addTask4',
			        	          dataType: 'json',
			        	          data:{
			        	        	  url:json.url,
			        	        	  userId:json.receiver.userId,
			        	        	  uName:json.receiver.uName,
			        	        	  omName:json.receiver.omName,
			        	        	  dutyName:json.receiver.dutyName,
			        	        	  omId:json.receiver.omId,
			        	        	  dutyId:json.receiver.dutyId
			        	          },
			        	          success: function (json) {
			        	        	  toastr.success('提交成功');
			        	          }
			        	      }); 
			        	  }
		        	}
		        }
		})
  	} */
  	
  	function delteFile(obj){
  		var id=$(obj).attr("data");
  		var name=$(obj).attr("data2");
  		$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/accessory/deleteAccessoryByIdAndName',
	        dataType: 'json',
	        data: {
	           aId:id,
	           acName:name
	        },
	        success: function (json) {
	        	if(json>0){
	        		$(obj).parent().parent().remove();
	        		toastr.success("删除成功");
	        	}else{
	        		toastr.error("删除失败");
	        	}
	        }
  		});
  	}
  	
  	function liuchengGaibian(obj){
		var deptSplitArray=new Array();
		var chaiFenXinXiArray=new Array();
		var chaiFenXinXiArray=new Array();
		chaiFenXinXiArray = getChaifenXinXiArray("edit_contract_money");
		var moneyFlag = judgeInputMoney("edit_contract_money");
		if(!moneyFlag){
			toastr.error("金额分配有误!请检查!");
			return "金额分配有误!请检查!";
		}
		var fentanFlag = judgeFentanbili();
		if(fentanFlag==1){
			toastr.error("分摊比例未填!请检查!");
			return "分摊比例未填!请检查!";
		}
		
		var contract_name=$("#edit_contract_name").val();
  		var contract_no=$("#edit_contract_no").val();
  		var work_no=$("#edit_work_no").val();
  		var prj_name=$("#edit_prj_name").val();
  		var prj_type=$("#edit_prj_type").val();
  		var jfId=$("#edit_jiafangName").val();
  		if(jfId!=null){
			jfId=jfId.toString()
		}else{
			jfId='';
		}
  		var ccName=$("#edit_jiafangName").parent("td").find("button").attr("title");
  		
  		var yifangName=$("#edit_yifangName").val();
  		
  		var year=$("#edit_year").val();
  		var year2=$("#edit_year2").val();
  		var yifang_department=$("#edit_yifang_department").val();
  		var work_date=$("#edit_work_date").val();
  		
  		var receieve_money_condition=$("#edit_receieve_money_condition").val();
  		var contract_money=$("#edit_contract_money").val();
  		var temporary_money=$("#edit_temporary_money").val();
  		var year3=$("#edit_year3").val();
  		var work_info=$("#edit_work_info").val();
  		var zhuban=$("#xgzhuban").val();
  		var zhubanjine=$("#xgzhubanjine").val();
    	var xieban1=$("#xgxieban1").find("option:selected").val();
    	var xieban1jine=$("#xgxiebanMoney1").val();
    	var xieban2=$("#xgxieban2").find("option:selected").val();
    	var xieban2jine=$("#xgxiebanMoney2").val();
    	var xieban3=$("#xgxieban3").find("option:selected").val();
    	var xieban3jine=$("#xgxiebanMoney3").val();
	  	var split_state=0;
	  	if($("#edit_split_table tbody").find('tr').length>0){
			split_state=1;
		}
	  	var jyms = $("#edit_prj_jyms").val();
	  	if(obj=='1'){
			if(contract_name==''){
				toastr.error("合同名称为空");
				return "合同名称为空";
			}
			if(prj_name==''){
				toastr.error("项目为空");
				return "项目为空";
			}
			if(jfId==''){
				toastr.error("甲方名称为空");
				return "甲方名称为空";
			}
			if(yifang_department==''){
				toastr.error("承接部门为空");
				return "承接部门为空";
			}
			if(contract_money==''){
				toastr.error("合同金额为空");
				return "合同金额为空";
			}
			if(temporary_money==''){
				toastr.error("暂定金为空");
				return "暂定金为空";
			}
			if($("#edit_accessory tbody").find('tr').length<1){
				if($("#edit_accessory tfoot").find('tr').length<1 || $("#edit_accessory tfoot").find("tr").eq(0).find("input").val()==''){
					toastr.error("请上传合同文本")
					return "请上传合同文本";
				}
			}
			
	  	}
	  	var cjContract={
	  			cjId:null,
	  			taskCode:undefined,
	  			contractName:undefined,
	  			contractNo:undefined,
	  			prjName:undefined,
	  			prjType:undefined,
	  			contractNameJia:undefined,
	  			contractNameYi:undefined,
	  			contractStartTime:undefined,
	  			contractEndTime:undefined,
	  			yiCjDepartment:undefined,
	  			contractLongTime:undefined,
	  			receieveMoneyCondition:undefined,
	  			contractMoney:undefined,
	  			temporaryMoney:undefined,
	  			contractSignTime:undefined,
	  			workInfo:undefined,
	  			mainDepartment:undefined,
	  			mainDepartmentMoney:undefined,
	  			assistDepartment1:undefined,
	  			assistDepartment1Money:undefined,
	  			assistDepartment2:undefined,
	  			assistDepartment2Money:undefined,
	  			assistDepartment3:undefined,
	  			assistDepartment3Money:undefined,
	  			splitState:undefined
			}
	  	cjContract.cjId=id;
	  	cjContract.taskCode=work_no;
	  	cjContract.contractName=contract_name;
	  	cjContract.contractNo=contract_no;
	  	cjContract.ccName=ccName;
	  	cjContract.prjName=prj_name;
	  	cjContract.prjType=prj_type;
	  	cjContract.contractNameJia=jfId;
	  	cjContract.contractNameYi=yifangName;
	  	cjContract.contractStartTime=year;
	  	cjContract.contractEndTime=year2;
	  	cjContract.yiCjDepartment=yifang_department;
	  	cjContract.contractLongTime=work_date;
	  	cjContract.receieveMoneyCondition=receieve_money_condition;
	  	cjContract.contractMoney=contract_money;
	  	cjContract.temporaryMoney=temporary_money;
	  	cjContract.contractSignTime=year3;
	  	cjContract.workInfo=work_info;
	  	cjContract.mainDepartment=zhuban;
	  	cjContract.mainDepartmentMoney=zhubanjine;
	  	cjContract.assistDepartment1=xieban1;
	  	cjContract.assistDepartment1Money=xieban1jine;
	  	cjContract.assistDepartment2=xieban2;
	  	cjContract.assistDepartment2Money=xieban2jine;
	  	cjContract.assistDepartment3=xieban3;
	  	cjContract.assistDepartment3Money=xieban3jine;
	  	cjContract.splitState=split_state;
	  	cjContract.jyms=jyms;
	  	cjContract.cjDeptSplitMoney=deptSplitArray;
	  	cjContract.chaiFenXinXiArray=chaiFenXinXiArray;
	  	var formData = new FormData();
		formData.append("cjContract", JSON.stringify(cjContract));
		$("#edit_accessory tfoot").find("tr").each(function(){
			if(undefined!=$(this).find("input")[0]){
				formData.append("file", $(this).find("input")[0].files[0]);
			}
		})
		$("#edit_accessory2 tfoot").find("tr").each(function(){
			if(undefined!=$(this).find("input")[0]){
				formData.append("file2", $(this).find("input")[0].files[0]);
			}
		})
    	var result;
    	$.ajax({
			type: 'POST',
		        url: getContextPath()+'/cj/updateCjContractById',
		     	data: formData,  
	            cache: false,
	            processData: false,
	            contentType: false,
	            async: false,
		        success: function (json) {
					if(json>0){
						toastr.success("保存成功");
					}else{
						toastr.error("保存失败");
					}
					result = json; 
		        }
		})
		return result;
  	} 
  	
  	function liuchengGaibianTJ(){
  		var splitArray=new Array();
  		$("#edit_split_table tbody").find("tr").each(function(){
				var years=$(this).find("td").eq(0).text();
				var moneys=$(this).find("td").eq(1).text();
				var arr={
						cjId:null,
						year:undefined,
						money:undefined
				}
				arr.cjId=null;
				arr.year=years;
				arr.money=moneys;
				splitArray.push(arr)
			})
		var contract_name=$("#edit_contract_name").val();
  		var contract_no=$("#edit_contract_no").val();
  		var work_no=$("#edit_work_no").val();
  		var prj_name=$("#edit_prj_name").val();
  		var prj_type=$("#edit_prj_type").val();
  		var jiafangName=$("#edit_jiafangName").val();
  		var yifangName=$("#edit_yifangName").val();
  		var year=$("#edit_year").val();
  		var year2=$("#edit_year2").val();
  		var yifang_department=$("#edit_yifang_department").val();
  		var work_date=$("#edit_work_date").val();
  		var receieve_money_condition=$("#edit_receieve_money_condition").val();
  		var contract_money=$("#edit_contract_money").val();
  		var temporary_money=$("#edit_temporary_money").val();
  		var year3=$("#edit_year3").val();
  		var work_info=$("#edit_work_info").val();
  		var zhuban=$("#xgzhuban").val();
  		var zhubanjine=$("#xgzhubanjine").val();
    	var xieban1=$("#xgxieban1").find("option:selected").val();
    	var xieban1jine=$("#xgxiebanMoney1").val();
    	var xieban2=$("#xgxieban2").find("option:selected").val();
    	var xieban2jine=$("#xgxiebanMoney2").val();
    	var xieban3=$("#xgxieban3").find("option:selected").val();
    	var xieban3jine=$("#xgxiebanMoney3").val();
	  	var split_state=0;
	  	if($("#edit_split_table tbody").find('tr').length>0){
			split_state=1;
		}
	  	var cjContract={
	  			cjId:null,
	  			taskCode:undefined,
	  			contractName:undefined,
	  			contractNo:undefined,
	  			prjName:undefined,
	  			prjType:undefined,
	  			contractNameJia:undefined,
	  			contractNameYi:undefined,
	  			contractStartTime:undefined,
	  			contractEndTime:undefined,
	  			yiCjDepartment:undefined,
	  			contractLongTime:undefined,
	  			receieveMoneyCondition:undefined,
	  			contractMoney:undefined,
	  			temporaryMoney:undefined,
	  			contractSignTime:undefined,
	  			workInfo:undefined,
	  			mainDepartment:undefined,
	  			mainDepartmentMoney:undefined,
	  			assistDepartment1:undefined,
	  			assistDepartment1Money:undefined,
	  			assistDepartment2:undefined,
	  			assistDepartment2Money:undefined,
	  			assistDepartment3:undefined,
	  			assistDepartment3Money:undefined,
	  			splitState:undefined,
	  			cjSplitMoney:undefined
			}
	  	cjContract.cjId=id;
	  	cjContract.taskCode=work_no;
	  	cjContract.contractName=contract_name;
	  	cjContract.contractNo=contract_no;
	  	cjContract.prjName=prj_name;
	  	cjContract.prjType=prj_type;
	  	cjContract.contractNameJia=jiafangName;
	  	cjContract.contractNameYi=yifangName;
	  	cjContract.contractStartTime=year;
	  	cjContract.contractEndTime=year2;
	  	cjContract.yiCjDepartment=yifang_department;
	  	cjContract.contractLongTime=work_date;
	  	cjContract.receieveMoneyCondition=receieve_money_condition;
	  	cjContract.contractMoney=contract_money;
	  	cjContract.temporaryMoney=temporary_money;
	  	cjContract.contractSignTime=year3;
	  	cjContract.workInfo=work_info;
	  	cjContract.mainDepartment=zhuban;
	  	cjContract.mainDepartmentMoney=zhubanjine;
	  	cjContract.assistDepartment1=xieban1;
	  	cjContract.assistDepartment1Money=xieban1jine;
	  	cjContract.assistDepartment2=xieban2;
	  	cjContract.assistDepartment2Money=xieban2jine;
	  	cjContract.assistDepartment3=xieban3;
	  	cjContract.assistDepartment3Money=xieban3jine;
	  	cjContract.splitState=split_state;
	  	cjContract.cjSplitMoney=splitArray;
	  	console.log(cjContract)
	  	var formData = new FormData();
		formData.append("cjContract", JSON.stringify(cjContract));
			
		$("#edit_accessory tbody").find("tr").each(function(){
				formData.append("file", $(this).find("input")[0].files[0]);
		})
    	$("#edit_accessory2 tbody").find("tr").each(function(){
				formData.append("file2", $(this).find("input")[0].files[0]);
		})
    	
    	$.ajax({
			type: 'POST',
		        url: getContextPath()+'/cj/updateCjContractBySubmit',
		     	data: formData,  
	            cache: false,
	            processData: false,
	            contentType: false,
	            async: false,
		        success: function (json) {
					if(json>0){
						//$("#myModal").modal("hide");
						toastr.success("保存成功");
						quxiaob();
					}else{
						toastr.error("保存失败");
					}
		        }
		})
  	} 
  	
  	
  	
  	function lookCancel(obj){
  		$("#look_cancel").modal("show");
  	}
  	
  	function lookHistory(obj){
  		var tr=$(obj).parents("tr");
  		var data=$("#history_table").DataTable().row(tr).data();
  		
  		$("#look_contract_name2").text(data.contractName);
  		$("#look_contract_no2").text(data.contractNo);
  		$("#look_work_no2").text(data.taskCode);
  		$("#look_prj_name2").text(data.prjName);
  		$("#look_prj_type2").text(data.prjType);
  		$("#look_jiafangName2").text(data.ccName);
  		$("#look_yifangName2").text(data.contractNameYi);
  		$("#look_year_2").text(data.contractStartTime);
  		$("#look_year2_2").text(data.contractEndTime);
  		$("#look_yifang_department2").text(data.omName);
  		$("#look_work_date2").text(data.contractLongTime);
  		$("#look_receieve_money_condition2").text(data.receieveMoneyCondition);
  		$("#look_contract_money2").text(data.contractMoney);
  		$("#look_temporary_money2").text(data.temporaryMoney);
  		$("#look_year3_2").text(data.contractSignTime);
  		$("#look_work_info2").text(data.workInfo);
  		var cs=data.cjSplitMoney;
    	$("#look_split_table2 tbody").empty();
    	for(var i=0;i<cs.length;i++){
				$("#look_split_table2 tbody").append("<tr><td>"
						+""+cs[i].year+""
						+"</td><td>"
						+""+cs[i].money+""
						+"</td></tr>")
		}
    	
  		$("#look_xieban2 tbody").html('');
  		$("#look_xieban2 tbody").append("<tr><td>主办部门</td><td>"+data.name+"</td><td>金额</td><td>"+data.mainDepartmentMoney+"</td></tr>")
  		if(data.assistDepartment1!=null&&data.assistDepartment1!=""){
  			$("#look_xieban2 tbody").append("<tr><td>协办部门</td><td>"+data.name2+"</td><td>金额</td><td>"+data.assistDepartment1Money+"</td></tr>")
    	}
    	if(data.assistDepartment2!=null&&data.assistDepartment2!=""){
    		$("#look_xieban2 tbody").append("<tr><td>协办部门</td><td>"+data.name3+"</td><td>金额</td><td>"+data.assistDepartment2Money+"</td></tr>")
    	}
    	if(data.assistDepartment3!=null&&data.assistDepartment3!=""){
    		$("#look_xieban2 tbody").append("<tr><td>协办部门</td><td>"+data.name4+"</td><td>金额</td><td>"+data.assistDepartment3Money+"</td></tr>")
    	}
  		$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/announcement/selectAccessoryById',
	        dataType: 'json',
	        data: {
	           id:data.cjId
	        },
	        success: function (json) {
	        	$("#look_accessory3 tbody").html('');
	        	$("#look_accessory4 tbody").html('');
	        	for(var i=0;i<json.length;i++){
	        		if(json[i].aType=="承接合同文本"){
		            	   $("#look_accessory3 tbody").append("<tr>"+
									"<td>附件</td>"+
				         	    	"<td ><a href='"+getLocalPath()+"/oa_file/"+json[i].acUrl+"' target='view_window' style='color:blue;'>"+json[i].acName+"</a></td>"+
				         	    	"<td style='width:150px;'></td>"+
				         	    "</tr>");
	            	   }
	          		if(json[i].aType=="法律顾问签字"){
		            	   $("#look_accessory4 tbody").append("<tr>"+
									"<td>附件</td>"+
				         	    	"<td ><a href='"+getLocalPath()+"/oa_file/"+json[i].acUrl+"' target='view_window' style='color:blue;'>"+json[i].acName+"</a></td>"+
				         	    	"<td style='width:150px;'></td>"+
				         	    "</tr>");
	            	   }
	        	}
	        }
    	});
  		$("#allMsg2").modal("show");
  	}
  	
  	
  	
  	//拆分合同额
  	function splitContractMoney(obj){
  		if(obj==0){//添加
			var startTime=$("#year").val();
			var endTime=$("#year2").val();
			var contractMoney=$("#contract_money").val()
			if(startTime==''||startTime==null){
				toastr.error("合同起日期不能为空");
				return;
			}
			if(endTime==''||endTime==null){
				toastr.error("合同讫日期不能为空");
				return;
			}
	  		if(contractMoney==""||contractMoney==null){
	  			toastr.error("合同金额不能为空")
	  			return;
	  		}
	  		var time1 = Date.parse(new Date(startTime));
			var time2 = Date.parse(new Date(endTime));
			if(parseInt(time1)>parseInt(time2)){
				toastr.error("合同起日期不能大于合同讫日期");
				return;
			}
			var t1=startTime.substring(0,4);
			var t2=endTime.substring(0,4);
			var y=t2-t1;
			if(y>0){
				$("#split").modal("show")
				$("#split_table tbody").empty();
				for(var i=0;i<y;i++){
					$("#split_table tbody").append("<tr><td>"
							+"<input type='text' style='width:100%;'  name='split_date' class='form-control'></td><td>"
							+"<input type='text' style='width:100%;' class='form-control'></td>"
							+"</tr>")
					lay('input[name=split_date]').each(function() {	
								laydate.render({
									elem: this,
									type: 'year'
								});
					});
				}
			}else{
				toastr.error("合同起讫日期不足1年")
			}
			
  		}else if(obj==1){
  			var startTime=$("#edit_year").val();
			var endTime=$("#edit_year2").val();
			var contractMoney=$("#edit_contract_money").val()
			if(startTime==''||startTime==null){
				toastr.error("合同起日期不能为空");
				return;
			}
			if(endTime==''||endTime==null){
				toastr.error("合同讫日期不能为空");
				return;
			}
	  		if(contractMoney==""||contractMoney==null){
	  			toastr.error("合同金额不能为空")
	  			return;
	  		}
			var time1 = Date.parse(new Date(startTime));
			var time2 = Date.parse(new Date(endTime));
			if(parseInt(time1)>parseInt(time2)){
				toastr.error("合同起日期不能大于合同讫日期");
				return;
			}
			var t1=startTime.substring(0,4);
			var t2=endTime.substring(0,4);
			var y=t2-t1;
			if(y>0){
				$("#xgsplit").modal("show")
				$("#xgsplit_table tbody").empty();
				for(var i=0;i<y;i++){
					$("#xgsplit_table tbody").append("<tr><td>"
							+"<input type='text' style='width:100%;'  name='split_date' class='form-control'></td><td>"
							+"<input type='text' style='width:100%;' class='form-control'></td>"
							+"</tr>")
					lay('input[name=split_date]').each(function() {	
								laydate.render({
									elem: this,
									type: 'year'
								});
					});
				}
			}else{
				toastr.error("合同起讫日期不足1年")
			}
  		}
  	}
  	
  	
  	//保存拆分合同额
  	function saveSplitMoney(){
  		var allMoney=0;
		var yearArr=[];
		var moneyArr=[];
  		var contractMoney=$("#contract_money").val()
  		$("#split_table tbody").find("tr").each(function(){
  			var year=$(this).find("td").eq(0).find("input").val();
  			var money=$(this).find("td").eq(1).find("input").val();
  			if(year==''|| year==null){
  				toastr.error("年份不能为空");
  				return;
  			}
  			if(money==''|| money==null){
  				toastr.error("金额不能为空");
  				return;
  			}
  			yearArr.push(year)
  			moneyArr.push(money)
  			allMoney+=Number(money)
  		})
  		if(allMoney==contractMoney){
  			$("#new_split_table tbody").empty();
  			for(var i=0;i<yearArr.length;i++){
  				for(var i=0;i<moneyArr.length;i++){
  					$("#new_split_table tbody").append("<tr><td>"
  							+""+yearArr[i]+""
  							+"</td><td>"
  							+""+moneyArr[i]+""
  							+"</td><td>"
  							+"<button type='button' class='btn btn-primary' onclick='deleteSplitMoney(this)'>移除</button>"
  							+"</td></tr>")
  				}
  			}
  			
  		$("#split").modal("hide")
  		}else{
  			toastr.error("拆分总金额必须等于合同金额")
  			return;
  		}
  	}
  	
  	//修改保存合同拆分额
  	function checkSaveSplitMoney(){
  		var allMoney=0;
		var yearArr=[];
		var moneyArr=[];
  		var contractMoney=$("#edit_contract_money").val()
  		$("#xgsplit_table tbody").find("tr").each(function(){
  			var year=$(this).find("td").eq(0).find("input").val();
  			var money=$(this).find("td").eq(1).find("input").val();
  			if(year==''|| year==null){
  				toastr.error("年份不能为空");
  				return;
  			}
  			if(money==''|| money==null){
  				toastr.error("金额不能为空");
  				return;
  			}
  			yearArr.push(year)
  			moneyArr.push(money)
  			allMoney+=Number(money)
  		})
  		if(allMoney==contractMoney){
  			$("#edit_split_table tbody").empty();
  			for(var i=0;i<yearArr.length;i++){
  				for(var i=0;i<moneyArr.length;i++){
  					$("#edit_split_table tbody").append("<tr><td>"
  							+""+yearArr[i]+""
  							+"</td><td>"
  							+""+moneyArr[i]+""
  							+"</td><td>"
  							+"<button type='button' class='btn btn-primary' onclick='deleteSplitMoney(this)'>移除</button>"
  							+"</td></tr>")
  				}
  			}
  			
  		$("#xgsplit").modal("hide")
  		}else{
  			toastr.error("拆分总金额必须等于合同金额")
  			return;
  		}
  	}
  	
  	function deleteSplitMoney(obj){
		var tr=$(obj).parents("tr");
		$(tr).remove();
	}
  	
  	function initDetailContract(){
  	   // 调用方法
  	   cjId=GetQueryString("cjId");
  	   if(cjId!=null&&""!=cjId&&cjId!=undefined){
  	   $("#"+cjId).trigger("click");
  	   }
  	}
	function GetQueryString(name){
        var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if(r!=null)return  unescape(r[2]); return null;
    }
	function countMoney(){
		var length=$("#new_split_table tbody").find("tr").length;
		if(length==0){
			toastr.error("合同金额未拆分")
  			return;
		}
		var contractMoney=$("#contract_money").val();
		var splitList=new Array();
		$("#new_split_table tbody").find("tr").each(function(){
			var splitMoney={
					year:undefined,
					money:undefined,
					zb:undefined
			}
			var year=$(this).find("td").eq(0).text();
			var money=$(this).find("td").eq(1).text();
			var zb=money/contractMoney;
			splitMoney.year=year;
			splitMoney.money=money;
			splitMoney.zb=zb;
			splitList.push(splitMoney);
		})
		for(var i in pageNameList){
		$("#xieban"+i+" tbody").find("tr").each(function(){
			$(this).find("td").eq(2).html('');
			var department=$(this).find("td").eq(1).find("select").eq(0).val();
			var deptAllMoney=$(this).find("td").eq(1).find("input").eq(0).val();
			for(var i=0;i<splitList.length;i++){
				var deptMoney=splitList[i].zb*deptAllMoney;
				$(this).find("td").eq(2).append("<lable>"+splitList[i].year+"：</lable><input class='form-control' data="+splitList[i].year+" data2="+department+" style='width:150px;' value="+deptMoney+" disabled> ")
			}
		})
		}
		
	}
	
	function xgcountMoney(){
		var length=$("#edit_split_table tbody").find("tr").length;
		if(length==0){
			toastr.error("合同金额未拆分")
  			return;
		}
		var contractMoney=$("#edit_contract_money").val();
		var splitList=new Array();
		$("#edit_split_table tbody").find("tr").each(function(){
			var splitMoney={
					year:undefined,
					money:undefined,
					zb:undefined
			}
			var year=$(this).find("td").eq(0).text();
			var money=$(this).find("td").eq(1).text();
			var zb=money/contractMoney;
			splitMoney.year=year;
			splitMoney.money=money;
			splitMoney.zb=zb;
			splitList.push(splitMoney);
		})
		$("#xgxieban tbody").find("tr").each(function(){
			$(this).find("td").eq(2).html('');
			var department=$(this).find("td").eq(1).find("select").eq(0).val();
			var deptAllMoney=$(this).find("td").eq(1).find("input").eq(0).val();
			for(var i=0;i<splitList.length;i++){
				var deptMoney=splitList[i].zb*deptAllMoney;
				$(this).find("td").eq(2).append("<lable>"+splitList[i].year+"：</lable><input class='form-control' data="+splitList[i].year+" data2="+department+" style='width:150px;' value="+deptMoney+" disabled> ")
			}
		})
		
	}
	
	$("#contract_money").on("change",function(){
		$("#new_split_table tbody").html('');
	})
	
	$("#edit_contract_money").on("change",function(){
		$("#edit_split_table tbody").html('');
	})
	var pageNameList;
	var pageTaskNoArray;
	function pinjieRenwudanChaifen(namelist,array,tasks){
		var namestr = namelist;
		pageNameList=namelist;
		pageTaskNoArray=array;
		$("#renwudanFenpei").empty();
		if(namelist.length!=array.length){
			toastr.error("任务单编号信息有误");
			return false;
		}
		for( var i in namestr){
		$("#renwudanFenpei").append('<table class="table table-bordered table-condensed" id="xieban'+i+'">'
	               +'<thead>'
	               +'<tr>'
	        	   +'<th style="text-align:left;"><div style="width:300px">任务单:'+namestr[i]+'</div><div hidden="hidden">'+array[i]+'</div></th>'
	        	   +'<th colspan="2" >'
	        	   +'<div class="yihang2"><div>&nbsp;任务单金额分配:&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" class="renwudanMoney'+i+' form-control" style="width:150px;" placeholder="任务单金额" id=renwudanMoney></input></div>'
	        	   +'<div><button type="button" class="btn btn-primary"  onclick="addBumen()">添加协办部门</button></div></div></th>'
	        +'</tr>'
	        +'</thead>'
	        +'<tbody>'
	        +'<tr>'
	        +'<td style="width:13%;">主办部门</td>'
	        +'<td style="width:32%;">'
	        +'<form class="form-inline">'
	        +'<select class="zhuban'+i+' form-control" style="width:150px;" name="zhuban" id="zhuban">'
	                        
	        +'</select>'
	        +'<input type="text" class="zhubanjine'+i+' form-control" style="width:150px;" placeholder="金额" id="zhubanjine">'
	        +'</form>'
	        +'</td>'
	        +"<td>"
            +'<div class="yihang" ><div style="width:80px;">分摊比例:</div>'
            +'<input type="text" id="zhubanFentan" class="zhubanFentan'+i+' form-control" style="width:150px;" placeholder="比例"></div>'
            +'</td>'
	        +'</tr>'
	        +'</tbody>'
	        +'</table>');
		initbumenByClass(i);
		if(tasks[i]!=null&&tasks[i]!=undefined){
		 $(".zhuban"+i+"").val(tasks[i].mainDepartment);
		 }
		 if(tasks[i]!=null&&tasks[i]!=undefined){
			 $(".zhubanFentan"+i+"").val(tasks[i].mainDepartmentCost);
		 }
		 if(tasks[i]!=null&&tasks[i]!=undefined){
			 $(".zhubanjine"+i+"").val(tasks[i].mainDepartmentMoney);
		 }
		 if(tasks[i]!=null&&tasks[i]!=undefined){
			 $(".renwudanMoney"+i+"").val(tasks[i].prjEstimateMoney);
		 }
		 if(tasks[i]!=null&&tasks[i]!=undefined){
		 addBumenEdit(i,tasks[i]);
		 }
		}
		
	}
	
	function editpinjieRenwudanChaifen(namelist,array,tasks){
		var namestr = namelist;
		pageNameList=namelist;
		pageTaskNoArray=array;
		$("#edit_renwudanFenpei").empty();
		if(namelist.length!=array.length){
			toastr.error("任务单编号信息有误");
			return false;
		}
		for( var i in namestr){
		$("#edit_renwudanFenpei").append('<table class="table table-bordered table-condensed" id="xieban'+i+'">'
	               +'<thead>'
	               +'<tr>'
	        	   +'<th style="text-align:left;"><div style="width:300px">任务单:'+namestr[i]+'</div><div hidden="hidden">'+array[i]+'</div></th>'
	        	   +'<th colspan="2" >'
	        	   +'<div class="yihang2"><div>&nbsp;任务单金额分配:&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" onchange="edit_renwudanMoneyChange()" class="renwudanMoney'+i+' form-control" style="width:150px;" placeholder="任务单金额" value="" id=renwudanMoney></input></div>'
	        	   +'<div><button type="button" class="btn btn-primary"  onclick="addBumen()">添加协办部门</button></div></div></th>'
	        +'</tr>'
	        +'</thead>'
	        +'<tbody>'
	        +'<tr>'
	        +'<td style="width:13%;">主办部门</td>'
	        +'<td style="width:32%;">'
	        +'<form class="form-inline">'
	        +'<select class="zhuban'+i+' form-control" style="width:150px;" name="zhuban" id="zhuban">'
	        +'</select>'
	        +'<input type="text" class="zhubanjine'+i+' form-control" style="width:150px;" value="" placeholder="金额" id="zhubanjine">'
	        +'</form>'
	        +'</td>'
	        +"<td>"
            +'<div class="yihang" ><div style="width:80px;">分摊比例:</div>'
            +'<input type="text" id="zhubanFentan" class="zhubanFentan'+i+' form-control" style="width:150px;" value="" placeholder="比例"></div>'
            +'</td>'
	        +'</tr>'
	        +'</tbody>'
	        +'</table>');
		 initbumenByClass(i);
		 if(tasks[i]!=null&&tasks[i]!=undefined){
		 $(".zhuban"+i+"").val(tasks[i].mainDepartment);
		 }
		 if(tasks[i]!=null&&tasks[i]!=undefined){
			 $(".zhubanFentan"+i+"").val(tasks[i].mainDepartmentCost);
		 }
		 if(tasks[i]!=null&&tasks[i]!=undefined){
			 $(".zhubanjine"+i+"").val(tasks[i].mainDepartmentMoney);
		 }
		 if(tasks[i]!=null&&tasks[i]!=undefined){
			 $(".renwudanMoney"+i+"").val(tasks[i].prjEstimateMoney);
		 }
		 if(tasks[i]!=null&&tasks[i]!=undefined){
		 addBumenEdit(i,tasks[i]);
		 }
		}
	}
	
	function edit_renwudanMoneyChange(){
		var len=$("#edit_renwudanFenpei>table").length;
		for(var i=0;i<len;i++){
			var trLength=$("#xieban"+i+">tbody>tr").length
			if(trLength==1){
				$(".zhubanjine"+i+"").val($(".renwudanMoney"+i+"").val())
			}
		}
	}
	
	function lookpinjieRenwudanChaifen(namelist,array,tasks){
		var namestr = namelist;
		pageNameList=namelist;
		pageTaskNoArray=array;
		$("#look_renwudanFenpei").empty();
		if(namelist.length!=array.length){
			toastr.error("任务单编号信息有误");
			return false;
		}
		for( var i in namestr){
		$("#look_renwudanFenpei").append('<table class="table table-bordered table-condensed" id="lookxieban'+i+'">'
	               +'<thead>'
	               +'<tr>'
	        	   +'<th style="text-align:left;"><div style="width:300px">任务单:'+namestr[i]+'</div><div hidden="hidden">'+array[i]+'</div></th>'
	        	   +'<th colspan="2" >'
	        	   +'<div class="yihang"><div class="yihang">&nbsp;任务单金额分配:&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" disabled class="renwudanMoney'+i+' form-control" style="width:150px;" placeholder="任务单金额" value="" id=renwudanMoney></input></div>'
	        	   +'<div></div></th>'
	        +'</tr>'
	        +'</thead>'
	        +'<tbody>'
	        +'<tr>'
	        +'<td style="width:13%;">主办部门</td>'
	        +'<td style="width:32%;">'
	        +'<form class="form-inline">'
	        +'<select class="zhuban'+i+' form-control" disabled style="width:150px;" name="zhuban" id="zhuban">'
	        +'</select>'
	        +'<input type="text" class="zhubanjine'+i+' form-control" disabled style="width:150px;" value="" placeholder="金额" id="zhubanjine">'
	        +'</form>'
	        +'</td>'
	        +"<td>"
            +'<div class="yihang" ><div style="width:80px;">分摊比例:</div>'
            +'<input type="text" id="zhubanFentan" disabled class="zhubanFentan'+i+' form-control" style="width:150px;" value="" placeholder="比例"></div>'
            +'</td>'
	        +'</tr>'
	        +'</tbody>'
	        +'</table>');
		 initbumenByClass(i);
		 if(tasks[i]!=null&&tasks[i]!=undefined){
		 $(".zhuban"+i+"").val(tasks[i].mainDepartment);
		 }
		 if(tasks[i]!=null&&tasks[i]!=undefined){
			 $(".zhubanFentan"+i+"").val(tasks[i].mainDepartmentCost);
		 }
		 if(tasks[i]!=null&&tasks[i]!=undefined){
			 $(".zhubanjine"+i+"").val(tasks[i].mainDepartmentMoney);
		 }
		 if(tasks[i]!=null&&tasks[i]!=undefined){
			 $(".renwudanMoney"+i+"").val(tasks[i].prjEstimateMoney);
		 }
		 if(tasks[i]!=null&&tasks[i]!=undefined){
			 addBumenLookNew(i,tasks[i]);
		 }
		}
	}
	var page_money;
	function getChaifenXinXiArray(idName){
		var array = new Array();
		
		for(var i in pageTaskNoArray){
  			var chaiFenXinXi = {
  					prjNo:undefined,
  	  				mainDepartment:undefined,
  	  				mainDepartmentMoney:undefined,
  	  				mainDepartmentCost:undefined,
  					assistDepartment1:undefined,
  	  				assistDepartment1Money:undefined,
  	  				assistDepartment1Cost:undefined,
  	  				assistDepartment2:undefined,
  	  				assistDepartment2Money:undefined,
  	  				assistDepartment2Cost:undefined,
  					assistDepartment3:undefined,
  	  				assistDepartment3Money:undefined,
  	  				assistDepartment3Cost:undefined,
  	  		}
  			chaiFenXinXi.prjNo = $("#xieban"+i+" thead").find("th").eq(0).find("div").eq(1).text();
	  		$("#xieban"+i+" tbody").find("tr").each(function(index,element){
	  			 if(index==0){
	  				chaiFenXinXi.mainDepartment = $(this).find("select").eq(0).val();
	  				
	  				chaiFenXinXi.mainDepartmentMoney = parseFloat($(this).find("input").eq(0).val());
	  				chaiFenXinXi.mainDepartmentCost = $(this).find("input").eq(1).val();
	  			 }else if(index==1){
	  				chaiFenXinXi.assistDepartment1 = $(this).find("select").eq(0).val();
	  				chaiFenXinXi.assistDepartment1Money = parseFloat($(this).find("input").eq(0).val());
	  				chaiFenXinXi.assistDepartment1Cost = $(this).find("input").eq(1).val();
	  			 }else if(index==2){
	  				chaiFenXinXi.assistDepartment2 = $(this).find("select").eq(0).val();
	  				chaiFenXinXi.assistDepartment2Money = parseFloat($(this).find("input").eq(0).val());
	  				chaiFenXinXi.assistDepartment2Cost = $(this).find("input").eq(1).val();
	  			 }else if(index==3){
	  				chaiFenXinXi.assistDepartment3 = $(this).find("select").eq(0).val();
	  				chaiFenXinXi.assistDepartment3Money = parseFloat($(this).find("input").eq(0).val());
	  				chaiFenXinXi.assistDepartment3Cost = $(this).find("input").eq(1).val();
	  			 }
	  			page_money +=$(this).find("input").eq(0).val();
			})
			var renwuMoney =  $("#xieban"+i+" thead").find("input").eq(0).val();
	  		var frenwuMoney = parseFloat(renwuMoney);
	  		chaiFenXinXi.prjEstimateMoney = frenwuMoney;
	  		chaiFenXinXi.contractMoney =  parseFloat($("#"+idName+"").val());
			array.push(chaiFenXinXi);
  		}	
		return array;
	}
	function judgeInputMoney(idName){
		var allRenwuMoney;
		for(var i in pageTaskNoArray){
			var money = undefined;
	  		$("#xieban"+i+" tbody").find("tr").each(function(index,element){
	  			if(i!=undefined&&i!=null){
	  			   var mainDepartmentMoney = $(this).find("input").eq(0).val();
	  			   var mainMoney = parseFloat(mainDepartmentMoney);
	  			   if(money==undefined){
	  					money=mainMoney;
	  			   }else{
	  				 money=money+mainMoney;
	  			   }
	  			}
			})
			var renwuMoney =  $("#xieban"+i+" thead").find("input").eq(0).val();
	  		var frenwuMoney = parseFloat(renwuMoney);
	  		if(allRenwuMoney==undefined){
	  			allRenwuMoney= frenwuMoney;
	  		}else{
	  			allRenwuMoney+=frenwuMoney;
	  		}
			if(money!=frenwuMoney){
				return false;
			}
  		}	
		var hetongMoney = $("#"+idName+"").val();
		var fhetongMoney = parseFloat(hetongMoney);
		if(allRenwuMoney!=hetongMoney){
			return false;
		}
		return true;
	}
	function judgeFentanbili(){
		var a =undefined
		for(var i in pageTaskNoArray){
	  		$("#xieban"+i+" tbody").find("tr").each(function(index,element){
	  			var bili = $(this).find("input").eq(1).val();
	  			if(bili==""||bili==undefined||bili==null){
	  				a= 1;
	  			}
			})
  		}	
		return a;
	}
    function getTaskBytaskCode(taskNos){
    	var array ;
    	$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/task/selectTaskPrjName',
	        dataType: 'json',
	        async:false,
	        data: {
	        	prjNo:taskNos
	        },
	        success: function (json) {
	        	array = json;
	        }
    	})
    	return array;
    }
	function initbumenByClass(k){
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/organizationManagement/selectProductionDepartment',
            dataType: 'json',
            async:false,
            data: {
            	
            },
            error: function (msg) {
            	toastr.error("请求失败");
            },
            success: function (json) {
                for(var i=0;i<json.length;i++){
                	$(".zhuban"+k+"").append("<option value="+json[i].omId+">"+json[i].omName+"</option>");
                }
            }
		});
	}
    //增加部门
    function addBumenEdit(i,task){
    	if(task.assistDepartment1!=""&&task.assistDepartment1!=null){
    		$("#xieban"+i+" tbody").append("<tr><td>协办部门1</td><td>"
    		  +'<form class="form-inline">'
              +'<select class="form-control" id="xieban1'+task.prjNo+'" style="width:150px;">'
              +'</select>'
              +'<input type="text" id="xiebanMoney'+task.prjNo+'" value="'+task.assistDepartment1Money+'" class="form-control" style="width:150px;" placeholder="金额">'
              +'</form>'
              +"</td><td>"
              +'<div class="yihang" ><div style="width:80px;">分摊比例:</div>'
              +'<input type="text" id="xiebanCost'+task.prjNo+'" value="'+task.assistDepartment1Cost+'" class="form-control" style="width:150px;" placeholder="金额">'
              +"<button style='margin-left:10px;' type='button' class='btn btn-primary' onclick='removeXieBan(this)'>移除协办部门</button></div>"
              +"</td></tr>");
	    	  initXiebanSelect(task,1);
	    	  $("#xieban1"+task.prjNo+"").val(task.assistDepartment1);
	    	  
    	}
    	if(task.assistDepartment2!=""&&task.assistDepartment2!=null){
    		$("#xieban"+i+" tbody").append("<tr><td>协办部门2</td><td>"
    	    		  +'<form class="form-inline">'
    	              +'<select class="form-control" id="xieban2'+task.prjNo+'" style="width:150px;">'
    	              +'</select>'
    	              +'<input type="text" id="xiebanMoney'+task.prjNo+'" value="'+task.assistDepartment2Money+'" class="form-control" style="width:150px;" placeholder="金额">'
    	              +'</form>'
    	              +"</td><td>"
    	              +'<div class="yihang" ><div style="width:80px;">分摊比例:</div>'
    	              +'<input type="text" id="xiebanCost'+task.prjNo+'" value="'+task.assistDepartment2Cost+'" class="form-control" style="width:150px;" placeholder="金额">'
    	              +"<button style='margin-left:10px;' type='button' class='btn btn-primary' onclick='removeXieBan(this)'>移除协办部门</button></div>"
    	              +"</td></tr>");
    		    	  initXiebanSelect(task,2);
    	    $("#xieban2"+task.prjNo+"").val(task.assistDepartment2);
    	}
    	if(task.assistDepartment3!=""&&task.assistDepartment3!=null){
    		$("#xieban"+i+" tbody").append("<tr><td>协办部门3</td><td>"
    	    		  +'<form class="form-inline">'
    	              +'<select class="form-control" id="xieban3'+task.prjNo+'" style="width:150px;">'
    	              +'</select>'
    	              +'<input type="text" id="xiebanMoney'+task.prjNo+'" value="'+task.assistDepartment3Money+'" class="form-control" style="width:150px;" placeholder="金额">'
    	              +'</form>'
    	              +"</td><td>"
    	              +'<div class="yihang" ><div style="width:80px;">分摊比例:</div>'
    	              +'<input type="text" id="xiebanCost'+task.prjNo+'" value="'+task.assistDepartment3Cost+'" class="form-control" style="width:150px;" placeholder="金额">'
    	              +"<button style='margin-left:10px;' type='button' class='btn btn-primary' onclick='removeXieBan(this)'>移除协办部门</button></div>"
    	              +"</td></tr>");
    		    	  initXiebanSelect(task,3);
    		    	  $("#xieban3"+task.prjNo+"").val(task.assistDepartment3);
    	}
	    	
    }
    function initXiebanSelect(task,k){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/organizationManagement/selectProductionDepartment',
            dataType: 'json',
            async:false,
            data: {
            },
            error: function (msg) {
            	toastr.error("请求失败");
            },
            success: function (json) {
            	$("#xieban"+k+""+task.prjNo+"").empty();
                for(var j=0;j<json.length;j++){
                	$("#xieban"+k+""+task.prjNo+"").append("<option value="+json[j].omId+">"+json[j].omName+"</option>");
                }
            }
		});
    }
	function changeRWD(obj){
		var money=$(obj).val();
		var length=$("#renwudanFenpei").find("table").length;
		if(length==1){
			$("#xieban0 thead").find("input").eq(0).val(money);
			var trlength=$("#xieban0 tbody").find("tr").length;
			if(trlength==1){
				$("#zhubanjine").val(money)
			}
		}
	}
	function edit_changeRWD(obj){
		var money=$(obj).val();
		var length=$("#edit_renwudanFenpei").find("table").length;
		if(length==1){
			$("#xieban0 thead").find("input").eq(0).val(money);
			var trlength=$("#xieban0 tbody").find("tr").length;
			if(trlength==1){
				$("#zhubanjine").val(money)
			}
		}
	}
	
	function getLocalPath(){
		var pathArray = window.location.pathname.split('/');
		var secondLevelLocation = pathArray[1];
		var loginUrl = window.location.protocol + "//"  + window.location.host ;
		return loginUrl;
	}
	
	//删除附件
	function deletefile(obj){
		var id=$(obj).attr("data1");
		var name=$(obj).attr("data4");
		var url=$(obj).attr("data2");
		$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/accessory/deleteAccessoryByIdAndName',
	        dataType: 'json',
	        data: {
	        	aId:id,
	        	acName:name,
	        	acUrl:url
	        },
	        success: function (json) {
	        	if(json==0){
	        		toastr.error("删除失败");
	        	}else{
	        		toastr.success("删除成功");
        			$(obj).parents("tr").remove();
	        	}
	        }
		});
	}
	
	function initFenGs(){
  		$.ajax({
            type: 'POST',
            url: getContextPath()+'/job/selectAllJobLv',
            dataType: 'json',
            async:false,
            data: {
            },
            success: function (json) {
            	 $("#edit_yifangName").html("");
                 for(var i=0;i<json.length;i++){
                 	$("#edit_yifangName").append("<option value='"+json[i].jobLvName+"'>"+json[i].jobLvName+"</option>")
                 }
            }
      });
  	 }
</script>
</html>