<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Document</title>
<link rel="stylesheet" href="../../font2/iconfont.css">
<link rel="stylesheet" href="../../font3/iconfont.css">
<link href="../../style/bootstrap.min.css" rel="stylesheet">
<link href="../../style/style.css" rel="stylesheet">
<link href="../../toastr/toastr.css" rel="stylesheet">
<link href="../../font3/bootstrap-select.css" rel="stylesheet">
<link rel="stylesheet" href="../../style/jquery.dataTables.min.css">
<link rel="stylesheet" href="../../style/jquery-editable-select.css">
<link href="../../select/css/select2.min.css" rel="stylesheet">
<!-- SmartAdmin Styles : Caution! DO NOT change the order -->
<link rel="stylesheet" type="text/css" media="screen"
	href="../../css/smartadmin-production-plugins.min.css">
<link rel="stylesheet" type="text/css" media="screen"
	href="../../css/smartadmin-production.min.css">
<link rel="stylesheet" type="text/css" media="screen"
	href="../../css/smartadmin-skins.min.css">
<link rel="stylesheet" type="text/css" media="screen"
	href="../../css/font.css">
<!-- SmartAdmin RTL Support  -->
<link rel="stylesheet" type="text/css" media="screen"
	href="../../css/smartadmin-rtl.min.css">
<style lang="">
.UpperPart {
	display: flex;
	justify-content: space-between;
	border-bottom: 1px solid #ccc;
	padding-bottom: 12px;
}

.UpperPartL {
	font-size: 16px;
}

.selected {
	background: rgba(247, 161, 3, 0.2);
}

#mainContent th {
	cursor: pointer;
	font-size: 14px;
}

body {
	font: 12px/1.125 Arial, Helvetica, sans-serif;
	background: #fff;
}

.none {
	display: none
}

.wrap {
	width: 100%;
	overflow-y: scroll
}
</style>
</head>
<body>

	<!-- 面包屑 -->
	<div class="mianbao">
		<ul class="breadcrumb">
			<li><i class="iconfont icon-knowledgebase"></i></li>
			<li>生产管理</li>
			<li>合同管理</li>
			<li>项目合同管理</li>
			<li>采购合同管理</li>
			<li class="active">材料设备采购合同审签</li>
		</ul>
	</div>

	<div class="zhuti-content">
		<div class="UpperPart">
			<div class="UpperPartL" style="font-size: 18px;">
				<form class="form-inline">
					<label>状态筛选:</label> <select class="zhuangtai form-control"
						style="width: 160px;">
						<option>审批结束</option>
						<option>审批中</option>
						<option>合同取消</option>
					</select>
				</form>
			</div>
			<div class="UpperPartR">
				<div class="yihang">
					<button type="button" class="btn btn-primary Pecca"
						data-toggle="modal" data-target="#myModal">填报材料设备采购合同</button>
					<div id="tabBtn" style="margin-left: 10px;"></div>
				</div>
			</div>
			<!-- Modal -->
			<div class="modal fade bs-example-modal-lg" tabindex="-1"
				role="dialog" aria-labelledby="myLargeModalLabel" id="myModal">
				<div class="modal-dialog modal-lg" role="document"
					style="width: 75%;">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal"
								aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
							<h4 class="modal-title" id="myModalLabel">
								<b>填报材料设备采购合同</b>
							</h4>
						</div>
						<div class="modal-body">
							<div>
								<form id="new_form" class="form-inline" method="post"
									enctype="multipart/form-data">
									<table class="table table-bordered table-condensed">
										<tr>
											<td style="width: 15%;">采购合同名称 <i
												class="iconfont icon-xingxing-copy" style="color: red;"></i></td>
											<td style="width: 30%;"><input type="text"
												id="cghetongming" class="form-control" style="width: 60%;">
											</td>
											<td style="width: 15%;">采购合同编号</td>
											<td style="width: 30%;"><input type="text" id="cgNo"
												class="form-control" disabled style="width: 60%;"></td>
										</tr>
										<tr>
											<td style="width: 15%;">采购单号 <i
												class="iconfont icon-xingxing-copy" style="color: red;"></i></td>
											<td style="width: 30%;"><input type="text" id="cgdNo"
												class="form-control" disabled style="width: 60%;">
												<button type="button" class="btn btn-primary"
													onclick="chooseNo()">选择采购单号</button></td>
											<td style="width: 15%;">采购合同类型 <i
												class="iconfont icon-xingxing-copy" style="color: red;"></i></td>
											<td style="width: 30%;"><select class="form-control"
												id="cghetongType" style="width: 60%;">
													<option>A 材料采购</option>
													<option>B 设备采购</option>
													<option>C 其他采购</option>
											</select></td>
										</tr>
										<tr>
											<td style="width: 15%;">项目名称: <i
												class="iconfont icon-xingxing-copy" style="color: red;"></i></td>
											<td style="width: 30%;"><input type="text" id="prjName"
												class="form-control" style="width: 60%;"> <!-- <select class="form-control" style="width:60%;" id="prjName">
                                    </select>  -->
												<button type="button" style="margin-left: 5px;"
													class="btn btn-primary" id="chosexm">选择项目</button></td>
											<td style="width: 15%;">任务单号</td>
											<td style="width: 30%;"><input type="text" id="task_no"
												class="form-control" style="width: 60%;" disabled> <!-- <select class="form-control" style="width:60%;" id="task_no">
                                       </select> --></td>
										</tr>
										<tr>
											<td style="width: 15%;">是否代购</td>
											<td style="width: 30%;"><select class="form-control"
												id="isdaigou" style="width: 60%;">
													<option>是</option>
													<option>否</option>
											</select></td>
											<td style="width: 15%;">分包合同</td>
											<td style="width: 30%;">
												<!-- <input type="text" id="fbhetong" class="form-control" style="width:60%;" disabled>
                                	<button type="button" class="btn btn-primary weui-uploader__input" data-toggle="modal" data-target="#fbcontract">关联分包合同</button> -->
												<input type="text" class="form-control" id="fbhetong"
												disabled style="width: 60%;">
												<button type="button" id="fbbutton"
													class="btn btn-primary weui-uploader__input"
													onclick="chooseFb()">关联分包</button>
											</td>
										</tr>
										<tr>
											<td style="width: 15%;">借款合同号</td>
											<td style="width: 30%;"><select class="form-control"
												id="borrow_no" style="width: 60%;">
											</select></td>
											<td style="width: 15%;">代购类型</td>
											<td style="width: 30%;"><select class="form-control"
												id="daigouType" style="width: 60%;">
											</select></td>
										</tr>
										<tr>
											<td style="width: 15%;" class="jinqianyanse">代购金额(元)</td>
											<td style="width: 30%;"><input type="text"
												id="daigouMoney" class="form-control" style="width: 60%;"></td>
											<td style="width: 15%;" class="jinqianyanse">采购合同金额(元)</td>
											<td style="width: 30%;"><input type="text"
												id="cghetongMoney" class="form-control" placeholder="元"
												style="width: 60%;"></td>
										</tr>
										<tr>
											<td style="width: 15%;">合同甲方名称 <i
												class="iconfont icon-xingxing-copy" style="color: red;"></i></td>
											<td style="width: 30%;"><select class="form-control"
												id="hetongjiafang" style="width: 60%;">
													<option value="华通">华通</option>
													<option value="华汇">华汇</option>
													<option value="宿迁分公司">宿迁分公司</option>
											</select></td>
											<td style="width: 15%;">乙方 <i
												class="iconfont icon-xingxing-copy" style="color: red;"></i></td>
											<td style="width: 30%;"><select class="form-control"
												id="yifang" style="width: 60%;">

											</select></td>
										</tr>
										<tr>
											<td style="width: 15%;">付款方式</td>
											<td style="width: 30%;"><input type="text"
												class="form-control" id="fukuangfangshi" style="width: 60%;">
											</td>
											<td style="width: 15%;">采购合同签订时间</td>
											<td style="width: 30%;"><input type="text"
												class="form-control" id="year" style="width: 60%;"></td>
										</tr>
										<tr>
											<td style="width: 15%;">采购部门</td>
											<td style="width: 30%;">
												<!-- <input type="text" class="form-control" id="cg_bumen" style="width:60%;" disabled> -->
												<select class="form-control" id="cg_bumen"
												style="width: 60%;">
											</select>
											</td>
											<td style="width: 15%;" class="jinqianyanse">运费(元)</td>
											<td style="width: 30%;"><input type="text"
												class="form-control" id="yunfei" style="width: 60%;"></td>
										</tr>
										<tr>
											<td class="jinqianyanse" style="width: 15%;">税率</td>
											<td style="width: 30%;"><input type="text"
												placeholder="小数" class="form-control" id="shuilv"
												style="width: 60%;" onchange="jisuanshuijin(this)">
												<!-- <button type="button" class="btn btn-primary weui-uploader__input" onclick="jisuanshuijin()">计算税金</button> -->
											</td>
											<td class="jinqianyanse" style="width: 15%;">税金</td>
											<td style="width: 30%;"><input type="text"
												class="form-control" id="shuijin" style="width: 60%;"
												disabled></td>
										</tr>
										<tr>
											<td>采购合同概述</td>
											<td colspan="3"><textarea class="form-control"
													id="hetonggaishu" rows="4" style="width: 100%;"></textarea></td>
										</tr>
										<!-- <tr>
                                <td>主要概况及工作内容</td>
                                <td colspan="3"><textarea class="form-control" id="gaikuang" rows="4" style="width:100%;"></textarea></td>
                            </tr> -->

									</table>
									<table class="table table-bordered table-condensed"
										id="new_accessory">
										<thead>
											<tr>
												<td style="width: 15%;">采购合同文本 <i
													class="iconfont icon-xingxing-copy" style="color: red;"></i></td>
												<td colspan="3"><button type="button"
														class="btn btn-primary weui-uploader__input"
														onclick="addFile()">添加附件</button></td>
											</tr>
										</thead>
										<tbody></tbody>
									</table>
									
									
									
									<!-- <table class="table table-bordered table-condensed" id="new_accessory1">
                        	<thead>
                        		<tr>
                                	<td style="width:15%;">法律顾问签字  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                	<td colspan="3"><button type="button" class="btn btn-primary weui-uploader__input" onclick="addFile1()">添加附件</button></td>
                            	</tr>
                        	</thead>
                        	<tbody></tbody>
                        </table> -->

									<div class="wrap">
										<div>
											<button type='button' id="yijianjiesuanMoney"
												onclick='yijianjiesuan(1)' class='btn btn-primary'>一键结算金额</button>
										</div>
										<div>
											<table class="table table-bordered table-condensed"
												style="width: 1580px;border=1" id="cl_table">
												<thead>
													<tr>
														<td style="font-size: 24px;" colspan="8">添加材料、设备 <i
															class="iconfont icon-xingxing-copy" style="color: red;"></i></td>
														<td style="width: 5%;"><button type="button"
																class="btn btn btn-primary" onclick="add()">添加</button></td>
													</tr>
													<tr>
														<th>名称</th>
														<th style='width: 10%;'>类型</th>
														<th>型号</th>
														<th style='width: 8%;'>单位</th>
														<th>数量</th>
														<th>单价</th>
														<th>金额</th>
														<!--<th>项目部推荐供应商</th>
			                             <th>公司确定供应商</th> -->
														<th style='width: 10%;'>备注</th>
														<th>操作</th>
													</tr>
												</thead>
												<tbody>
												</tbody>
											</table>
										</div>

										<!--材料信息表格  -->
										<div id="cailiaobiaoDiv"></div>
									</div>
								</form>
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default"
								data-dismiss="modal" onclick="clearP()">取消</button>
							<button type="button" class="btn btn-default" onclick="saveCg()">保存</button>
							<button type="button" class="btn btn-success"
								onclick="submitCg()">提交</button>
						</div>
					</div>
				</div>
			</div>
			<!-- model结束 -->
			<!-- Modal项目 -->
			<div class="modal fade bs-example-modal-lg" tabindex="-1"
				role="dialog" aria-labelledby="myLargeModalLabel" id="xiangmumd">
				<div class="modal-dialog modal-lg" role="document"
					style="width: 60%;">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal"
								aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
							<h4 class="modal-title" id="myModalLabel">
								<b>选择项目</b>
							</h4>
						</div>
						<div class="modal-body">
							<div>
								<form class="form-inline">
									<table class="table table-bordered table-condensed"
										id="xiangmubiao" style="width: 100%;">
										<thead>
											<tr>
												<th style="width: 8%;"></th>
												<th style="width: 12%;">编号</th>
												<th style="width: 30%;">项目名称</th>
												<th style="width: 15%;">项目所属公司</th>
												<th style="width: 15%;">项目类型</th>
												<th style="width: 20%;">甲方单位</th>
											</tr>
										</thead>
										<tbody>

										</tbody>
									</table>
								</form>
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default"
								data-dismiss="modal">取消</button>
							<button type="button" class="btn btn-success" id="quedingxm">保存</button>
						</div>
					</div>
				</div>
			</div>
			<!-- model项目结束 -->

			<!-- 提交 modal -->
			<div class="modal fade" tabindex="-1" role="dialog"
				aria-labelledby="myLargeModalLabel" id="tijiaogei">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal"
								aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
							<h4 class="modal-title" id="gridSystemModalLabel">提交给</h4>
						</div>
						<div class="modal-body">
							<table class="table table-bordered table-condensed"
								id="tijiaoren">
								<thead>
									<tr>
										<th></th>
										<th>部门</th>
										<th>职务</th>
										<th>审批人</th>
									</tr>
								</thead>
								<tbody>

								</tbody>
							</table>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default"
								data-dismiss="modal">取消</button>
							<button type="button" class="btn btn-success"
								 onclick="submitPerson()">提交</button>
						</div>
					</div>
				</div>
			</div>
			<!-- 提交 modal结束 -->

			<!-- Modal选择分包合同 -->
			<div class="modal fade bs-example-modal-lg" tabindex="-1"
				role="dialog" aria-labelledby="myLargeModalLabel" id="choose_fb">
				<div class="modal-dialog modal-lg" role="document"
					style="width: 60%;">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal"
								aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
							<h4 class="modal-title" id="myModalLabel">
								<b>选择分包合同</b>
							</h4>
						</div>
						<div class="modal-body">
							<div>
								<form class="form-inline">
									<table class="table table-bordered table-condensed"
										style="width: 100%;" id="fb_table">
										<thead>
											<tr>
												<th></th>
												<th>分包合同名称</th>
												<th>分包合同编号</th>
												<th>甲方单位</th>
												<th>合同起日期</th>
												<th>合同讫日期</th>
											</tr>
										</thead>
										<tbody>

										</tbody>
									</table>
								</form>
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default"
								data-dismiss="modal">取消</button>
							<button type="button" class="btn btn-success"
								onclick="saveFbName()">保存</button>
						</div>
					</div>
				</div>
			</div>
			<!-- model项目结束 -->
			<!-- 修改Modal -->
			<div class="modal fade bs-example-modal-lg" tabindex="-1"
				role="dialog" aria-labelledby="myLargeModalLabel" id="change">
				<div class="modal-dialog modal-lg" role="document"
					style="width: 75%;">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal"
								aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
							<h4 class="modal-title" id="myModalLabel">
								<b>修改采购合同</b>
							</h4>
						</div>
						<div class="modal-body">
							<div>
								<form id="edit_form" class="form-inline" method="post"
									enctype="multipart/form-data">
									<table class="table table-bordered table-condensed">
										<tr>
											<td style="width: 15%;">采购合同名称 <i
												class="iconfont icon-xingxing-copy" style="color: red;"></i></td>
											<td style="width: 30%;"><input type="text"
												id="xgcghetongming" class="form-control" style="width: 60%;">
											</td>
											<td style="width: 15%;">采购合同编号</td>
											<td style="width: 30%;"><input type="text" id="xgcgNo"
												class="form-control" disabled style="width: 60%;"></td>
										</tr>
										<tr>
											<td>采购单号 <i class="iconfont icon-xingxing-copy"
												style="color: red;"></i></td>
											<td><input type="text" id="xgcgdNo" class="form-control"
												disabled style="width: 60%;">
												<button type="button" class="btn btn-primary"
													onclick="chooseNo2()">选择采购单号</button></td>
											<td>采购合同类型 <i class="iconfont icon-xingxing-copy"
												style="color: red;"></i></td>
											<td><select class="form-control" id="xgcghetongType"
												style="width: 60%;">
													<option>A 材料采购</option>
													<option>B 设备采购</option>
													<option>C 其他采购</option>
											</select></td>
										</tr>
										<tr>
											<td>项目名称: <i class="iconfont icon-xingxing-copy"
												style="color: red;"></i></td>
											<td><input type="text" id="xgprjName"
												class="form-control" style="width: 60%;"> <!-- <select class="form-control" id="xgprjName" style="width:60%;">
                                    </select> -->
												<button type="button" style="margin-left: 5px;"
													class="btn btn-primary" id="xgchosexm">选择项目</button></td>
											<td>任务单号</td>
											<td><input type="text" id="xgtask_no"
												class="form-control" style="width: 60%;" disabled> <!-- <select class="form-control" id="xgtask_no" style="width:60%;">
                                    </select> --></td>
										</tr>
										<tr>
											<td>是否代购</td>
											<td><select class="form-control" id="xgisdaigou"
												style="width: 60%;">
													<option>是</option>
													<option>否</option>
											</select></td>
											<td style="width: 15%;">分包合同</td>
											<td style="width: 30%;">
												<!-- <input type="text" id="xgfbhetong" class="form-control" style="width:60%;" disabled>
                                	<button type="button" class="btn btn-primary weui-uploader__input" data-toggle="modal" data-target="#xgfbcontract">关联分包合同</button> -->
												<input type="text" class="form-control" id="xgfbhetong"
												disabled style="width: 60%;">
												<button type="button" id="xgchooseFbbutton"
													class="btn btn-primary weui-uploader__input"
													onclick="xgchooseFb()">关联分包</button>
											</td>
										</tr>
										<tr>
											<td style="width: 15%;">借款合同号</td>
											<td style="width: 30%;"><select class="form-control"
												id="xgborrow_no" style="width: 60%;">
											</select></td>
											<td>代购类型</td>
											<td><select class="form-control" id="xgdaigouType"
												style="width: 60%;">
											</select></td>
										</tr>
										<tr>
											<td class="jinqianyanse">代购金额(元)</td>
											<td><input type="text" id="xgdaigouMoney"
												class="form-control" style="width: 60%;"></td>
											<td class="jinqianyanse">采购合同金额(元)</td>
											<td><input type="text" id="xgcghetongMoney"
												class="form-control" placeholder="元" style="width: 60%;"></td>
										</tr>
										<tr>
											<td>合同甲方名称 <i class="iconfont icon-xingxing-copy"
												style="color: red;"></i></td>
											<td><select class="form-control" id="xghetongjiafang"
												style="width: 60%;">
													<option value="江苏华通工程检测有限公司">江苏华通工程检测有限公司</option>
													<option value="江苏华汇工程检测有限公司">江苏华汇工程检测有限公司</option>
													<option value="宿迁分公司">宿迁分公司</option>
											</select></td>
											<td>乙方 <i class="iconfont icon-xingxing-copy"
												style="color: red;"></i></td>
											<td><select class="form-control" id="xgyifang"
												style="width: 60%;">

											</select></td>
										</tr>
										<tr>
											<td>付款方式</td>
											<td><input type="text" class="form-control"
												id="xgfukuangfangshi" style="width: 60%;"></td>
											<td>采购合同签订时间</td>
											<td><input type="text" class="form-control" id="xgyear"
												style="width: 60%;"></td>
										</tr>
										<tr>
											<td>采购部门</td>
											<td>
												<!-- <input type="text" class="form-control" id="xgcg_bumen" style="width:60%;" disabled> -->
												<select class="form-control" id="xgcg_bumen"
												style="width: 60%;">

											</select>
											</td>
											<td style="width: 15%;" class="jinqianyanse">运费(元)</td>
											<td style="width: 30%;"><input type="text"
												class="form-control" id="xgyunfei" style="width: 60%;"></td>
										</tr>
										<tr>
											<td class="jinqianyanse" style="width: 15%;">税率</td>
											<td style="width: 30%;"><input type="text"
												placeholder="小数" class="form-control" id="xgshuilv"
												style="width: 60%;" onchange="xgjisuanshuijin(this)">
												<!-- <button type="button" class="btn btn-primary weui-uploader__input" onclick="xgjisuanshuijin()">计算税金</button> -->
											</td>
											<td class="jinqianyanse" style="width: 15%;">税金</td>
											<td style="width: 30%;"><input type="text"
												class="form-control" id="xgshuijin" style="width: 60%;"
												disabled></td>
										</tr>
										<tr>
											<td>采购合同概述</td>
											<td colspan="3"><textarea class="form-control"
													id="xghetonggaishu" rows="4" style="width: 100%;"></textarea></td>
										</tr>
										<!-- <tr>
                                <td>主要概况及工作内容</td>
                                <td colspan="3"><textarea class="form-control" id="xggaikuang" rows="4" style="width:100%;"></textarea></td>
                            </tr> -->

									</table>
									<table class="table table-bordered table-condensed"
										id="edit_accessory">
										<thead>
											<tr>
												<td style="width: 15%;">采购合同文本 <i
													class="iconfont icon-xingxing-copy" style="color: red;"></i></td>
												<td colspan="3"><button type="button"
														class="btn btn-primary weui-uploader__input"
														onclick="addFile2()">添加附件</button></td>
											</tr>
										</thead>
										<tbody>
										</tbody>
									</table>
									<!-- <table class="table table-bordered table-condensed" id="edit_accessory1">
                        	<thead>
                        		<tr>
                                	<td style="width:15%;">法律顾问签字  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                               	 	<td colspan="3"><button type="button" class="btn btn-primary weui-uploader__input" onclick="addFile3()">添加附件</button></td>
                           		</tr>
                        	</thead>
                        	<tbody>
                        	</tbody>
                        </table> -->
									<div class="wrap">
										<div>
											<button type='button' id="xgyijianjiesuanMoney"
												onclick='yijianjiesuan(2)' class='btn btn-primary'>一键结算金额</button>
										</div>
										<div>
											<table class="table table-bordered table-condensed"
												style="width: 1580px;border=1" id="edit_cl_table">
												<thead>
													<tr>
														<td style="font-size: 24px;" colspan="8">添加材料、设备 <i
															class="iconfont icon-xingxing-copy" style="color: red;"></i></td>
														<td style="width: 5%;"><button type="button"
																class="btn btn btn-primary" onclick="add2()">添加</button></td>
													</tr>
													<tr>
														<th>名称</th>
														<th style='width: 10%;'>类型</th>
														<th>型号</th>
														<th style='width: 8%;'>单位</th>
														<th>数量</th>
														<th>单价</th>
														<th>金额</th>
														<!--<th>项目部推荐供应商</th>
			                             <th>公司确定供应商</th> -->
														<th style="width: 10%;">备注</th>
														<th style="width: 5%;">操作</th>
													</tr>
												</thead>
												<tbody>

												</tbody>
											</table>
										</div>
										<!--材料信息表格  -->
										<div id="xgcailiaobiaoDiv"></div>
									</div>
								</form>
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default"
								data-dismiss="modal">取消</button>
							<button type="button" class="btn btn-default"
								onclick="checksaveCgC()">保存</button>
							<button type="button" class="btn btn-success"
								onclick="checksubmitCgC()">提交</button>
						</div>
					</div>
				</div>
			</div>
			<!-- 修改model结束 -->
			<!-- xg项目 Modalxg -->
			<div class="modal fade bs-example-modal-lg" tabindex="-1"
				role="dialog" aria-labelledby="myLargeModalLabel" id="xgxiangmumd">
				<div class="modal-dialog modal-lg" role="document"
					style="width: 60%;">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal"
								aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
							<h4 class="modal-title" id="myModalLabel">
								<b>选择项目</b>
							</h4>
						</div>
						<div class="modal-body">
							<div>
								<form class="form-inline">
									<table class="table table-bordered table-condensed"
										id="xgxiangmubiao" style="width: 100%;">
										<thead>
											<tr>
												<th></th>
												<th>编号</th>
												<th>项目名称</th>
												<th>项目所属公司</th>
												<th>项目类型</th>
												<th>甲方单位</th>
											</tr>
										</thead>
										<tbody>

										</tbody>
									</table>
								</form>
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default"
								data-dismiss="modal">取消</button>
							<button type="button" class="btn btn-success" id="xgquedingxm">保存</button>
						</div>
					</div>
				</div>
			</div>
			<!--xg项目  modelxg结束 -->
			<!-- Modal选择分包合同 -->
			<div class="modal fade bs-example-modal-lg" tabindex="-1"
				role="dialog" aria-labelledby="myLargeModalLabel" id="xgchoose_fb">
				<div class="modal-dialog modal-lg" role="document"
					style="width: 60%;">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal"
								aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
							<h4 class="modal-title" id="myModalLabel">
								<b>选择分包合同</b>
							</h4>
						</div>
						<div class="modal-body">
							<div>
								<form class="form-inline">
									<table class="table table-bordered table-condensed"
										id="xgfb_table">
										<thead>
											<tr>
												<th></th>
												<th>分包合同名称</th>
												<th>分包合同编号</th>
												<th>甲方单位</th>
												<th>合同起日期</th>
												<th>合同讫日期</th>
											</tr>
										</thead>
										<tbody>

										</tbody>
									</table>
								</form>
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default"
								data-dismiss="modal">取消</button>
							<button type="button" class="btn btn-success"
								onclick="xgsaveFbName()">保存</button>
						</div>
					</div>
				</div>
			</div>
			<!-- model项目结束 -->
			<!-- Modal2 -->
			<div class="modal fade bs-example-modal-lg" tabindex="-1"
				role="dialog" aria-labelledby="myLargeModalLabel" id="myModal2">
				<div class="modal-dialog modal-lg" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal"
								aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
							<h4 class="modal-title" id="myModalLabel">
								<b>采购合同取消</b>
							</h4>
						</div>
						<div class="modal-body">
							<div>
								<form class="form-inline">
									<table class="table table-bordered table-condensed">
										<tr>
											<td>采购合同取消原因</td>
											<td colspan="3"><textarea class="form-control"
													id="cancel_reason" rows="4" cols="50"></textarea></td>
										</tr>
									</table>
								</form>
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default"
								data-dismiss="modal">取消</button>
							<button type="button" class="btn btn-success"
								onclick="submitCgCancel()">提交</button>
						</div>
					</div>
				</div>
			</div>
			<!-- model2结束 -->
			<!-- Modal3 -->
			<div class="modal fade bs-example-modal-lg" tabindex="-1"
				role="dialog" aria-labelledby="myLargeModalLabel" id="myModal3">
				<div class="modal-dialog modal-lg" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal"
								aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
							<h4 class="modal-title" id="myModalLabel">
								<b>采购合同重启</b>
							</h4>
						</div>
						<div class="modal-body">
							<div>
								<form class="form-inline">
									<table class="table table-bordered table-condensed">
										<tr>
											<td>采购合同取消原因</td>
											<td colspan="3"><textarea class="form-control"
													id="look_cancel_reason" rows="4" cols="50" disabled></textarea></td>
										</tr>
									</table>
									<table class="table table-bordered table-condensed">
										<tr>
											<td>采购合同重启原因</td>
											<td colspan="3"><textarea class="form-control"
													id="restart_reason" rows="4" cols="50"></textarea></td>
										</tr>
									</table>
								</form>
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default"
								data-dismiss="modal">取消</button>
							<button type="button" class="btn btn-success"
								onclick="submitCgRestart()">提交</button>
						</div>
					</div>
				</div>
			</div>
			<!-- model3结束 -->
		</div>
		<div class="LowerPart" style="margin-top: 3px;">
			<div class="chaojisousuo" style="margin-bottom: 12px;">
				<div class="sousuoClick"
					style="display: flex; justify-content: space-between; margin-bottom: 12px;">
					<div></div>
					<div>
						<button type="button" class="btn btn-info" onclick="seachAll()">
							<span class="glyphicon glyphicon-search" aria-hidden="true"></span>搜索
						</button>
						<button type="button" class="btn btn-primary"
							style="width: 100px;" id="zhedieBtn">
							<span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span>
						</button>
					</div>
				</div>
				<div class="sousuoInput" id="sousuodiv">
					<div id="sousuoTable" style="border: 1px solid #eee; padding: 5px;">

						<div class="yihang2">
							<div style="width: 25%;">
								<form class="form-inline">
									<div class="form-group"
										style="display: flex; align-items: center;">
										<label for="exampleInput">合同签订时间:&nbsp;</label> <input
											type="text" class="form-control" id="seach_time_min"
											style="width: 30%;"> <label>-</label> <input
											type="text" class="form-control" id="seach_time_max"
											style="width: 30%;">
									</div>
								</form>
							</div>
							<div style="width: 25%;">
								<form class="form-inline">
									<div class="form-group"
										style="display: flex; align-items: center;">
										<label for="exampleInput">是否代购:&nbsp;</label> <select
											class="form-control" id="sf_htboom" style="width: 60%;">
											<option value="%">全部</option>
											<option value="是">是</option>
											<option value="否">否</option>
										</select>
									</div>
								</form>
							</div>
							<div style="width: 25%;">
								<form class="form-inline">
									<div class="form-group"
										style="display: flex; align-items: center;">
										<label for="exampleInput">采购合同金额:&nbsp;</label> <input
											type="text" class="form-control" id="seach_cg_min"
											style="width: 30%;"> <label>-</label> <input
											type="text" class="form-control" id="seach_cg_max"
											style="width: 30%;">
									</div>
								</form>
							</div>
							<div style="width: 25%;">
								<form class="form-inline">
									<div class="form-group"
										style="display: flex; align-items: center;">
										<label for="exampleInput">代购金额:&nbsp;</label> <input
											type="text" class="form-control" id="seach_dg_min"
											style="width: 30%;"> <label>-</label> <input
											type="text" class="form-control" id="seach_dg_max"
											style="width: 30%;">
									</div>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
			<table class="table table-bordered table-condensed" id="mainContent">
				<thead>
					<tr>
						<th style="width: 4%;">序号</th>
						<th style="width: 10%;">采购合同编号</th>
						<th style="width: 30%;">采购合同名称</th>
						<th style="width: 10%;">任务单号</th>
						<th style="width: 10%;">采购合同类型</th>
						<th style="width: 15%;">合同乙方</th>
						<th style="width: 10%;" class="jinqianyanse">采购合同金额(元)</th>
						<th style="width: 10%;">签订时间</th>
						<th style="width: 110px;">操作</th>
					</tr>
				</thead>
				<tbody>

				</tbody>
			</table>
		</div>
	</div>
	<!-- allMsg -->
	<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog"
		aria-labelledby="myLargeModalLabel" id="allMsg1">
		<div class="modal-dialog modal-lg" role="document" style="width: 75%;">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title" id="myModalLabel">
						<b>所有信息</b>
					</h4>
				</div>
				<div class="modal-body">
					<div>
						<form class="form-inline">
							<table class="table table-bordered table-condensed">
								<tr>
									<td style="width: 20%">采购合同名称</td>
									<td style="width: 30%" id="lookcghetongming"></td>
									<td style="width: 20%">采购合同编号</td>
									<td style="width: 30%" id="lookcgNo"></td>
								</tr>
								<tr>
									<td>采购单号</td>
									<td id="lookcgdNo"></td>
									<td style="width: 100px;">采购合同类型</td>
									<td id="lookcgType"></td>
								</tr>
								<tr>
									<td>项目名称</td>
									<td id="lookprjName"></td>
									<td>任务单号</td>
									<td id="looktask_no"></td>
								</tr>
								<tr>
									<td>是否代购</td>
									<td id="lookisdaigou"></td>
									<td>分包合同</td>
									<td id="lookfbhetong"></td>
								</tr>
								<tr>
									<td>借款合同号</td>
									<td id="lookborrow_no"></td>
									<td>代购类型</td>
									<td id="lookdaigouType"></td>
								</tr>
								<tr>
									<td class="jinqianyanse">代购金额(元)</td>
									<td id="lookdaigouMoney"></td>
									<td class="jinqianyanse">采购合同金额(元)</td>
									<td id="lookcghetongMoney"></td>
								</tr>
								<tr>
									<td>合同甲方名称</td>
									<td id="lookjiafang"></td>
									<td>乙方</td>
									<td id="lookyifang"></td>
								</tr>
								<tr>
									<td>付款方式</td>
									<td id="lookfukuanfangshi"></td>
									<td>采购合同签订时间</td>
									<td id="lookyear"></td>
								</tr>
								<tr>
									<td>采购部门</td>
									<td id="lookcg_bumen"></td>
									<td class="jinqianyanse">运费(元)</td>
									<td id="lookyunfei"></td>
								</tr>
								<tr>
									<td class="jinqianyanse" style="width: 15%;">税率</td>
									<td id="look_shuilv"></td>
									<td class="jinqianyanse" style="width: 15%;">税金</td>
									<td id="look_shuijin"></td>
								</tr>
								<tr>
									<td>采购合同概述</td>
									<td colspan="3" id="lookcghetonggaishu"></td>
								</tr>
								<!-- <tr>
                            <td>主要概况及工作内容</td>
                            <td colspan="3" id="lookgaikuang"></td>
                        </tr> -->
								<!-- <tr>
                            <td>采购合同文本</td>
                            <td colspan="3"></td>
                        </tr> -->
							</table>
							<table class="table table-bordered table-condensed"
								id="look_all_table">

							</table>
							<!--  <table class="table table-bordered table-condensed"  id="look_all_table1">
				                        		
				    </table> -->
							<div class="wrap">
								<div id="lookcailiaobiaoDiv" style="width: 1580px;border=1">

								</div>
							</div>
							<!-- 历史信息表格 -->
							<table style="width: 100%;"
								class="table table-bordered table-condensed" id="lookHistory">
								<thead>
									<tr>
										<th colspan="6">历史信息</th>
									</tr>
									<tr>
										<td style="width: 20%;">采购合同编号</td>
										<td style="width: 20%;">采购合同名称</td>
										<td style="width: 20%;">合同类型</td>
										<td style="width: 20%;">修改时间</td>
										<td style="width: 20%;">操作</td>
									</tr>
								</thead>
								<tbody>

								</tbody>
							</table>
							<br/>
					<h2 style="color:red;">审批详情</h2>
					<table class="table table-bordered table-condensed" id="d_table">
                    		<thead>
                    			<tr>
                    				<th style="width:30%;">业务名称</th>
                    				<th style="width:12%;">操作人</th>
                    				<th style="width:23%;">意见</th>
                    				<th style="width:12%;">操作类型</th>
                    				<th style="width:23%;">操作时间</th>
                    			</tr>
                    		</thead>
                    		<tbody></tbody>
                    	</table>
							
						</form>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
					<button type="button" class="btn btn-success"
						onclick="dayinyulan()">打印预览</button>
				</div>
			</div>
		</div>
	</div>
	<!-- allMsg结束 -->
	<!-- 历史详细信息 -->
	<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog"
		aria-labelledby="myLargeModalLabel" id="History">
		<div class="modal-dialog modal-lg" role="document" style="width: 75%;">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title" id="myModalLabel">
						<b>所有信息</b>
					</h4>
				</div>
				<div class="modal-body">
					<div>
						<form class="form-inline">
							<table class="table table-bordered table-condensed">
								<tr>
									<td>采购合同名称</td>
									<td id="Historycghetongming"></td>
									<td style="width: 100px;">采购合同编号</td>
									<td id="HistorycgNo"></td>
								</tr>
								<tr>
									<td style="width: 100px;">采购单号</td>
									<td id="HistorycgdNo"></td>
									<td style="width: 100px;">采购合同类型</td>
									<td id="HistorycgType"></td>
								</tr>
								<tr>
									<td>项目名称</td>
									<td id="HistoryprjName"></td>
									<td>任务单号</td>
									<td id="Historytask_no"></td>
								</tr>
								<tr>
									<td>是否代购</td>
									<td id="Historyisdaigou"></td>
									<td>分包合同</td>
									<td id="Historyfbhetong"></td>
								</tr>
								<tr>
									<td>借款合同号</td>
									<td id="Historyborrow_no"></td>
									<td>代购类型</td>
									<td id="HistorydaigouType"></td>
								</tr>
								<tr>
									<td>代购金额(元)</td>
									<td id="HistorydaigouMoney"></td>
									<td>采购合同金额(元)</td>
									<td id="HistorycghetongMoney"></td>
								</tr>
								<tr>
									<td>合同甲方名称</td>
									<td id="Historyjiafang"></td>
									<td>乙方</td>
									<td id="Historyyifang"></td>
								</tr>
								<tr>
									<td>付款方式</td>
									<td id="Historyfukuanfangshi"></td>
									<td>采购合同签订时间</td>
									<td id="Historyyear"></td>
								</tr>
								<tr>
									<td>采购部门</td>
									<td id="Historycg_bumen"></td>
									<td class="jinqianyanse">运费(元)</td>
									<td id="Historyyunfei"></td>
								</tr>
								<tr>
									<td class="jinqianyanse" style="width: 15%;">税率</td>
									<td id="History_shuilv"></td>
									<td class="jinqianyanse" style="width: 15%;">税金</td>
									<td id="History_shuijin"></td>
								</tr>
								<tr>
									<td>采购合同概述</td>
									<td colspan="3" id="Historycghetonggaishu"></td>
								</tr>
								<!-- <tr>
                            <td>主要概况及工作内容</td>
                            <td colspan="3" id="Historygaikuang"></td>
                        </tr> -->
								<!-- <tr>
                            <td>采购合同文本</td>
                            <td colspan="3"></td>
                        </tr> -->
							</table>
							<table class="table table-bordered table-condensed"
								id="History_all_table">

							</table>

							<div class="wrap">
								<div id="HistorycailiaobiaoDiv" style="width: 1580px;border=1">

								</div>
							</div>


							<!--  <table class="table table-bordered table-condensed"  id="History_all_table1">
				                        		
				    </table> -->
						</form>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Modal -->
	<!-- 添加 -->
	<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog"
		aria-labelledby="myLargeModalLabel" id="chooseNo">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title" id="myModalLabel">
						<b>选择采购单号</b>
					</h4>
				</div>
				<div class="modal-body">
					<div>
						<form class="form-inline" method="post"
							enctype="multipart/form-data">
							<table class="table table-bordered table-condensed">
								<tr>
									<td style="width: 20%;">采购单号：</td>
									<td><select class="selectpicker show-tick form-control"
										style="width: 100%;" id="selectpicker_no" multiple
										data-live-search="true">

									</select></td>
								</tr>
							</table>
						</form>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" onclick="quxiao()">取消</button>
					<button type="button" class="btn btn-success" onclick="saveNo()">保存</button>
				</div>
			</div>
		</div>
	</div>
	<!-- 修改 -->
	<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog"
		aria-labelledby="myLargeModalLabel" id="chooseNo2">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title" id="myModalLabel">
						<b>选择采购单号</b>
					</h4>
				</div>
				<div class="modal-body">
					<div>
						<form class="form-inline" method="post"
							enctype="multipart/form-data">
							<table class="table table-bordered table-condensed">
								<tr>
									<td style="width: 20%;">采购单号：</td>
									<td><select class="selectpicker2 show-tick form-control"
										style="width: 100%;" id="selectpicker_no2" multiple
										data-live-search="true">

									</select></td>
								</tr>
							</table>
						</form>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" onclick="quxiao2()">取消</button>
					<button type="button" class="btn btn-success" onclick="saveNo2()">保存</button>
				</div>
			</div>
		</div>
	</div>
	<!-- model结束 -->
	<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog"
		aria-labelledby="myLargeModalLabel" id="fbcontract">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title" id="myModalLabel">
						<b>选择分包合同</b>
					</h4>
				</div>
				<div class="modal-body">
					<div>
						<form class="form-inline" method="post"
							enctype="multipart/form-data">
							<table class="table table-bordered table-condensed">
								<tr>
									<td style="width: 15%;">分包合同编号：</td>
									<td style="width: 35%;"><select style="width: 80%;"
										class="selectpicker show-tick form-control" id="fbNo">

									</select></td>
									<td style="width: 15%;">分包合同名称：</td>
									<td style="width: 35%;"><select style="width: 80%;"
										class="selectpicker show-tick form-control" id="fbName">

									</select></td>
								</tr>
							</table>
						</form>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" onclick="quxiaofb()">取消</button>
					<button type="button" class="btn btn-success" onclick="savefb()">保存</button>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog"
		aria-labelledby="myLargeModalLabel" id="xgfbcontract">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title" id="myModalLabel">
						<b>选择分包合同</b>
					</h4>
				</div>
				<div class="modal-body">
					<div>
						<form class="form-inline" method="post"
							enctype="multipart/form-data">
							<table class="table table-bordered table-condensed">
								<tr>
									<td style="width: 15%;">分包合同编号：</td>
									<td style="width: 35%;"><select style="width: 80%;"
										class="selectpicker show-tick form-control" id="xgfbNo">

									</select></td>
									<td style="width: 15%;">分包合同名称：</td>
									<td style="width: 35%;"><select style="width: 80%;"
										class="selectpicker show-tick form-control" id="xgfbName">

									</select></td>
								</tr>
							</table>
						</form>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" onclick="quxiaofb2()">取消</button>
					<button type="button" class="btn btn-success" onclick="savefb2()">保存</button>
				</div>
			</div>
		</div>
	</div>
	<!-- 查看取消原因modal -->
	<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog"
		aria-labelledby="myLargeModalLabel" id="look_cancel">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title" id="myModalLabel">
						<b>分包合同取消原因</b>
					</h4>
				</div>
				<div class="modal-body">
					<div>
						<form class="form-inline">
							<table class="table table-bordered table-condensed">
								<thead>
									<tr>
										<th style="width: 8%;">序号</th>
										<th style="width: 70%;">取消原因</th>
										<th style="width: 22%;">取消时间</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<td></td>
										<td></td>
										<td></td>
									</tr>
								</tbody>
							</table>
						</form>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
				</div>
			</div>
		</div>
	</div>
	<!-- model结束 -->
	<!-- 补录Modal -->
	<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog"
		aria-labelledby="myLargeModalLabel" id="blue">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title" id="myModalLabel">
						<b>补录项目</b>
					</h4>
				</div>
				<div class="modal-body">
					<div>
						<form class="form-inline">
							<table class="table table-bordered">
								<!-- <tr>
                        		<td style="width:25%;">发票编号</td>
                        		<td style="width:75%;"><input type="text" id="fp_no" class="form-control" style="width:80%;"></td>
                        	</tr> -->
								<tr>
									<td>项目名称 <i class="iconfont icon-xingxing-copy"
										style="color: red;"></i></td>
									<td>
										<!-- <select class="form-control" style="width:70%;" id="prj_name">
                                    </select> --> <input type="text"
										class="form-control" id="prj_name_bl" style="width: 70%;"
										disabled>
										<button type="button" class="btn btn-primary" id="chosexm_bl">选择</button>
									</td>
									<td>任务单号</td>
									<td><select class="form-control" style="width: 70%;"
										id="prj_no_bl">
									</select></td>
								</tr>
								<tr>
									<td>分包合同 <i class="iconfont icon-xingxing-copy"
										style="color: red;"></i></td>
									<td>
										<!-- <select class="form-control" style="width:70%;" id="prj_name">
                                    </select> --> <input type="text"
										class="form-control" id="fbhetong_bl" style="width: 70%;"
										disabled>
										<button type="button" class="btn btn-primary"
											onclick="choseFbxm_bl()">选择</button>
									</td>
									<td>借款合同</td>
									<td><select class="form-control" style="width: 70%;"
										id="borrow_no_bl">
									</select></td>
								</tr>
								<tr>
									<td>代购类型</td>
									<td>
										<!-- <select class="form-control" id="daigouType_bl" style="width:60%;">
                                    </select> --> <input type="text"
										class="form-control" style="width: 70%;" id="daigouType_bl"
										disabled>
									</td>
									<td class="jinqianyanse">代购金额</td>
									<td><input type="text" class="form-control"
										style="width: 70%;" id="daigoujin_bl"></td>
								</tr>
							</table>
						</form>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
					<button type="button" class="btn btn-success" onclick="saveBule()">保存</button>
				</div>
			</div>
		</div>
	</div>
	<!-- model结束 -->
	<!-- Modal项目 -->
	<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog"
		aria-labelledby="myLargeModalLabel" id="xiangmumd_bl">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title" id="myModalLabel">
						<b>选择项目</b>
					</h4>
				</div>
				<div class="modal-body">
					<div>
						<form class="form-inline">
							<table class="table table-bordered table-condensed"
								style="width: 100%;" id="xiangmubiao_bl">
								<thead>
									<tr>
										<th></th>
										<th>编号</th>
										<th>项目名称</th>
										<th>项目所属公司</th>
										<th>项目类型</th>
										<th>甲方单位</th>
									</tr>
								</thead>
								<tbody>

								</tbody>
							</table>
						</form>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
					<button type="button" class="btn btn-success" id="quedingxm_bl">保存</button>
				</div>
			</div>
		</div>
	</div>
	<!-- model项目结束 -->
	<!-- Modal选择分包合同 -->
	<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog"
		aria-labelledby="myLargeModalLabel" id="choose_fb_bl">
		<div class="modal-dialog modal-lg" role="document" style="width: 60%;">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title" id="myModalLabel">
						<b>选择分包合同</b>
					</h4>
				</div>
				<div class="modal-body">
					<div>
						<form class="form-inline">
							<table class="table table-bordered table-condensed"
								style="width: 100%;" id="fb_table_bl">
								<thead>
									<tr>
										<th></th>
										<th>分包合同名称</th>
										<th>分包合同编号</th>
										<th>甲方单位</th>
										<th>合同起日期</th>
										<th>合同讫日期</th>
									</tr>
								</thead>
								<tbody>

								</tbody>
							</table>
						</form>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
					<button type="button" class="btn btn-success"
						onclick="saveFbName_bl()">保存</button>
				</div>
			</div>
		</div>
	</div>
	<!-- model项目结束 -->
	
<!-- Modal合同扫描件开始 -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="addSaoMiaohtModel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>合同扫描件</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form id="new_form" class="form-inline" method="post" enctype="multipart/form-data">
                        <table class="table table-bordered table-condensed">
		                	<tr >
		                		<td style="width:15%;">合同扫描件文件名</td>
		                		<td style="width:35%;">
		                			<input type="file" id="saomiaofileUrl" name="file" class="form-control" style="width:75%;" multiple="multiple">
		                			<!--<button type="button" style="margin-left: 5px;" class="btn btn-primary" id="chosexm">选择文件</button>-->
		                		</td>
		                		
		                	</tr>
		            	</table>
                    </form> 
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-primary" onclick="savesaomiaohetongjian(this)">上传文件</button>
        </div>
        </div>
    </div>
</div>
<!-- model结束 合同扫描件 -->

</body>
<script src="../../js/jquery.js"></script>
<script src="../../js/common-scripts.js"></script>
<script src="../../js/bootstrap.min.js"></script>
<script src="../../js/laydate/laydate.js"></script>
<script src="../../js/jquery-editable-select.js"></script>
<script src="../../js/jquery-form.min.js"></script>
<script src="../../toastr/toastr.js"></script>
<script src="../../js/bootstrap-select.js"></script>
<script src="../../js/quanxian.js"></script>

<script src="../../js/datatables/jquery.dataTables.min.js"></script>
<script src="../../js/datatables/dataTables.colVis.min.js"></script>
<script src="../../js/datatables/dataTables.tableTools.min.js"></script>
<!-- <script src="../../js/datatables/dataTables.bootstrap.min.js"></script> -->
<script src="../../js/datatables/datatables.responsive.min.js"></script>
<script src="../../js/datatables/dataTables.buttons.min.js"></script>
<script src="../../js/datatables/buttons.html5.min.js"></script>
<script src="../../js/datatables/buttons.flash.min.js"></script>
<script src="../../js/datatables/jszip.min.js"></script>

<script src="../../select/js/select2.min.js"></script>
<script src="../../js/SmartNotification.min.js"></script>
<script src="../../js/myTool.js"></script>

<script>
    $(document).ready( function () {
    	initTable();
    	initSelect();
    	selectDepartment();
    	inityifang();
    	//initSelectfb();
    	initPrj();
        laydate.render({
            elem: '#year' //指定元素
        });
        laydate.render({
            elem: '#xgyear' //指定元素
        });
        laydate.render({
            elem: '#seach_time_min' //指定元素
        });
        laydate.render({
            elem: '#seach_time_max' //指定元素
        });
    	
        $("#sousuodiv").hide();//超级搜索折叠div
        $("#isdaigou").trigger("change");
        initFenGs();
	});
    
  //超级搜索折叠div
    var zhediepanduan=true;
    $("#zhedieBtn").click(function(){
    	if(zhediepanduan==true){
    		$("#sousuodiv").show(300);
    		zhediepanduan=false;
    	}else{
    		$("#sousuodiv").hide(300);
    		zhediepanduan=true;
    	}
    })
    
    $.fn.dataTable.Buttons.swfPath = '../../js/datatables/swf/flashExport.swf';
    var table=$('#mainContent').DataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 10,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
            { "data": null}, 
            { "data": "cgNo"},
            { "data": "contractName"}, 
            { "data": null},
            { "data": "cgcType"}, 
            { "data": "spName"}, 
            { "data": "cgContractMoney",render: $.fn.dataTable.render.number( ',', '.', 2, '' )}, 
            { "data": "contractSignTime"}, 
        ],
        "columnDefs": [
			        	{	
							 "class": "tcenter",
							  "targets": 3,
							  "searchable": true,
							  "render": function(data, type, full) {
								  return '<a href="../chankanxiangqing/taskDetails.html?prjNo='+data.workNo+'" style="color:#4876FF;cursor: pointer;" target="_blank" >'+data.workNo+'</a>'
							  }
							},
        					{	
								 "class": "tcenter",
								    "targets": 8,
								    "searchable": true,
								    "render": function(data, type, full) {
								    		var html='<i class="iconfont icon-icon-test Peccb" style="font-size:20px;cursor:pointer;margin-left:5px;display:none;" title="查看详细信息" onclick="lookCgC(this)" data-toggle="modal" data-target="#allMsg1"   id="lookDetall"></i>'
								    			+'<i class="iconfont icon-xiugai iconxiugai Peccc" style="font-size:20px;cursor:pointer;margin-left:5px;display:none;" title="合同变更" onclick="checkCgC(this)" data-toggle="modal" data-target="#change"  id="Changedanwei"></i>'
								    			+'<i class="iconfont icon-arrow chongqi Peccf" style="font-size:20px;cursor:pointer;display:none;margin-left:5px;" title="重启" onclick="openModal3(this)"></i>'
								    			+'<i class="iconfont icon-tuichu iconzhongzhi Peccd" style="font-size:20px;cursor:pointer;margin-left:5px;display:none;" title="采购合同取消"  onclick="openModal2(this)"></i>'
								    			+'<i class="iconfont icon-kaibiao Peccd" style="font-size:18px;cursor:pointer;display:none;" title="补录扫描合同件" onclick="addsaomiaohetongjian(this)"></i>';
								    			if(full.workNo==""||full.workNo==null){
									  	  		html=html+'<i class="iconfont icon-icon_edit bulu" style="font-size:18px;cursor:pointer;display:none;" title="补录项目" onclick="buluxiangmu(this)"></i>';
									  	  	}else if(full.isProgram=="是"&&full.fbNo==""||full.isProgram=="是"&&full.borrowNo==""){
									  	  		html=html+'<i class="iconfont icon-icon_edit bulu" style="font-size:18px;cursor:pointer;display:none;" title="补录项目" onclick="buluxiangmu(this)"></i>';
									  	  	}else{
									    		
									    	}
								  	  		return html;
								        }
								  }
						],
        "order": [[0, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
        "fnDrawCallback"  : function(){
          　　this.api().column(0).nodes().each(function(cell, i) {
          　　　　cell.innerHTML =  i + 1;
         });
	        $.ajax({
	     		type:"post",
	     		url:getContextPath()+"/login/getUser",
	     		async:false,
	     		data:{
	     		},
	     		success:function(json){
	     			
	     			if(json!=null &&json!=""){
	     				var arr = json.uPermissions.split(',');
	     				for(var i=0;i<arr.length;i++){
	     					var arr2 = arr[i].replace("+","");
	     					if(arr[i].indexOf("Peccb") >= 0 ){
	     						$(".Peccb").show();
	     						$(".bulu").show();
	     					}
	     					if(arr[i].indexOf("Peccc") >= 0 ){
	     						$(".Peccc").show();
	     						$(".bulu").show();
	     					}
	     					if(arr[i].indexOf("Peccd") >= 0 ){
	     						$(".Peccd").show();
	     						$(".bulu").show();
	     					}
	     				}
	     			}
	     		}
	     	});
        },
        "buttons": [
		        	{
		                extend: "csv",
		                text: "导出csv",
		                bom: true,
		                filename: '材料设备采购合同',
		                fieldSeparator: ',',
		                exportOptions: {
		                	format: {
		                        header: function ( data) {
		                            return data;
		                        },
		                        body: function ( data, columnIdx, rowIdx, code ) {
					                return data;
					            }
		                    },
		                    columns:[1,2,3,4,5,6,7]
		                }
		            }
		        ]
	});
    
    $(".hasinput").on( 'change', function () {
        table
            .column( $(this).parent().index()+':visible' )
            .search( this.value )
            .draw(false);
    } );
 
 
  table.buttons().container().appendTo( $('#tabBtn') );
   $('.buttons-csv').addClass('btn btn-primary');
    
    <!-- 历史表格 -->
    var table2=$('#lookHistory').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 5,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
            { "data": "cgNo"}, 
            { "data": "contractName"}, 
            { "data": "cgcType"}, 
            { "data": "makeTime"}, 
        ],
        "columnDefs": [
						{	
								 "class": "tcenter",
								    "targets": 4,
								    "searchable": true,
								    "render": function(data, type, full) {
								  	  		return '<i class="iconfont icon-icon-test" style="font-size:20px;cursor:pointer;" title="查看详细信息" onclick="lookHistoryDetails(this)" data-toggle="modal" data-target="#History"   id="lookDetall"></i>'
								        }
								  }
						],
        "order": [[1, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
	});
    var table3=$('#fb_table').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 5,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
            { "data": null}, 
            { "data": "contractName"},
            { "data": "fbNo"}, 
            { "data": "ccName"}, 
            { "data": "contractStartTime"},
            { "data": "contractEndTime"}
        ],
        "columnDefs": [
						{
								 "class": "tcenter",
								    "targets": 0,
								    "searchable": true,
								    "render": function(data, type, full) {
								  	  		return '<input type="radio" name="fbName" style="width:16px;height:16px;">'
								        }
								  }
						],
        "order": [[0, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
        
	});
    var xgtable3=$('#xgfb_table').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 5,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
            { "data": null}, 
            { "data": "contractName"},
            { "data": "fbNo"}, 
            { "data": "ccName"}, 
            { "data": "contractStartTime"},
            { "data": "contractEndTime"}
        ],
        "columnDefs": [
						{
								 "class": "tcenter",
								    "targets": 0,
								    "searchable": true,
								    "render": function(data, type, full) {
								  	  		return '<input type="radio" name="xgfbName" style="width:16px;height:16px;">'
								        }
								  }
						],
        "order": [[0, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
        
	});
    var tablexm=$('#xiangmubiao').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 5,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
					{ "data": null},
		            { "data": "prjNo"},
		            { "data": "prjName"},
		            { "data": "prjCompany"},
		            { "data": "prjType2"},
		            { "data": "ccName"},
		            
		        ],
		        "columnDefs": [
								{
										 "class": "tcenter",
										    "targets": 0,
										    "searchable": true,
										    "render": function(data, type, full) {
										  	  		return '<input type="radio" name="xiangmuName" style="width:16px;height:16px;">'
										        }
										  }
								],
        "order": [[1, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
	});
    var tablexmxg=$('#xgxiangmubiao').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 5,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
					{ "data": null},
		            { "data": "prjNo"}, 
		            { "data": "prjName"},
		            { "data": "prjCompany"}, 
		            { "data": "prjType2"},
		            { "data": "ccName"},
		        ],
		        "columnDefs": [
								{	
										 "class": "tcenter",
										    "targets": 0,
										    "searchable": true,
										    "render": function(data, type, full) {
										  	  		return '<input type="radio" name="xgxiangmuName" style="width:16px;height:16px;">'
										        }
										  }
								],
        "order": [[1, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
        
	});
    var table3_bl=$('#xiangmubiao_bl').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 5,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
					{ "data": null},
		            { "data": "prjNo"},
		            { "data": "prjName"},
		            { "data": "prjCompany"},
		            { "data": "prjType2"},
		            { "data": "ccName"},
		            
		        ],
		        "columnDefs": [
								{
										 "class": "tcenter",
										    "targets": 0,
										    "searchable": true,
										    "render": function(data, type, full) {
										  	  		return '<input type="radio" name="xiangmuName_bl" style="width:16px;height:16px;">'
										        }
										  }
								],
        "order": [[1, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
        
	});
    var tableFb_bl=$('#fb_table_bl').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 5,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
            { "data": null}, 
            { "data": "contractName"},
            { "data": "fbNo"}, 
            { "data": "ccName"}, 
            { "data": "contractStartTime"},
            { "data": "contractEndTime"}
        ],
        "columnDefs": [
						{
								 "class": "tcenter",
								    "targets": 0,
								    "searchable": true,
								    "render": function(data, type, full) {
								  	  		return '<input type="radio" name="fbName_bl" style="width:16px;height:16px;">'
								        }
								  }
						],
        "order": [[0, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
        
	});
	function initTable(){
        $.ajax({
            type: 'POST',
            url:getContextPath()+'/cgcontract/selectCgContractByStatus',
            dataType: 'json',
            data: {
            	status:2
            },
            success: function (json) {
            	console.log(json)
                $('#mainContent').dataTable().fnClearTable();
                $('#mainContent').DataTable().rows.add(json).draw(false);
            }
        });
    }
	
	/* 初始化任务单号，项目名称 以及承接编号 承接名称 change事件 */
    function initPrj(){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/task/selectPrjNameAndWorkNo',
            dataType: 'json',
            data: {
            },
            error: function (msg) {
            	toastr.error("请求失败");
            },
            success: function (json) {
            	$("#prj_no_bl").empty();
                for(var i=0;i<json.length;i++){
                	//$("#prj_name").append("<option value="+json[i].prjName+">"+json[i].prjName+"</option>");
                	//$("#prj_no").append("<option value="+json[i].prjNo+">"+json[i].prjNo+"</option>");
                	$("#prj_no_bl").append("<option value="+json[i].prjNo+">"+json[i].prjNo+"</option>");
                }
		        /* $('#prj_no').editableSelect().on('select.editable-select', function (e, dom) {
		          		$.ajax({
		                    type: 'POST',
		                    url: getContextPath()+'/task/selectCjByTaskNo',
		                    dataType: 'json',
		                    data: {
		                    	no:$('#prj_no').val()
		                    },
		                    success: function (json) {
		                    	var task=json.task;
		                    	var cj=json.cj;
		                    	$('#prj_name').val(task.prjName);
		                    	$("#cj_name").val(cj[0].contractName);
		                    	$("#cj_no").val(cj[0].contractNo);
				  		}
	            	})
				}) */
				
				$('#prj_no_bl').editableSelect().on('select.editable-select', function (e, dom) {
		          		$.ajax({
		                    type: 'POST',
		                    url: getContextPath()+'/task/selectCjByTaskNo',
		                    dataType: 'json',
		                    data: {
		                    	no:$('#prj_no_bl').val()
		                    },
		                    success: function (json) {
		                    	var task=json.task;
		                    	var cj=json.cj;
		                    	$('#prj_name_bl').val(task.prjName);
		                    	$("#cj_name_bl").val(cj[0].contractName);
		                    	$("#cj_no_bl").val(cj[0].contractNo);
				  		}
	            	})
				})
            }
    	})
    }
	
	//选择项目
	$("#chosexm_bl").click(function(){
		$("#xiangmumd_bl").modal("show");
		 $.ajax({
	            type: 'POST',
	            url: getContextPath()+'/task/selectPrjNameAndWorkNo',
	            dataType: 'json',
	            async:false,
	            data: {
	            },
	            success: function (json) {
	            	//console.log(json)
	                $('#xiangmubiao_bl').dataTable().fnClearTable();
	                $('#xiangmubiao_bl').DataTable().rows.add(json).draw(false);
	            }
	        });
	})

	$("#quedingxm_bl").click(function(){
		var tr=$("input[name='xiangmuName_bl']:checked").parents("tr");
  		var data=$("#xiangmubiao_bl").DataTable().row(tr).data();
		$("#prj_name_bl").val(data.prjName);
		$("#prj_no_bl").val(data.prjNo);
		$("#xiangmumd_bl").modal("hide");
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/task/selectCjByTaskName',
            dataType: 'json',
            data: {
            	name:$('#prj_name_bl').val()
            },
            success: function (json) {
            	var task=json.task;
            	var cj=json.cj;
            	$('#prj_no_bl').val(task.prjNo);
            	$("#cj_name_bl").val(cj[0].contractName);
            	$("#cj_no_bl").val(cj[0].contractNo);
            }
  		})
	})
	
	var tr_bl;
	var data_bl;
	function buluxiangmu(obj){
		tr_bl=$(obj).parents("tr");
		data_bl=$("#mainContent").DataTable().row(tr_bl).data();
		//console.log(data_bl)
		$('#prj_name_bl').val(data_bl.prjName)
		$('#prj_no_bl').val(data_bl.workNo);
		$("#fbhetong_bl").val(data_bl.fbNo);
		//$("#borrow_no_bl").val(data_bl.borrowNo);
		xgselectBorrowByFbNo(data_bl.fbNo,data_bl.borrowNo)
		$("#daigouType_bl").val(data_bl.programType);
		$("#daigoujin_bl").val(data_bl.programMoney);
    	$("#blue").modal("show");
	}
	
	function saveBule(){
		var prj_name_bl=$('#prj_name_bl').val()
		var prj_no_bl=$('#prj_no_bl').val();
		var fbht=$("#fbhetong_bl").val();
		var borrowNo=$("#borrow_no_bl").val();
		var dagouleixing=$("#daigouType_bl").val();
		var daigoujin_bl=$("#daigoujin_bl").val();
		if(borrowNo=="请选择"){
			borrowNo="";
		}
		 $.ajax({
				type:"POST",
				url:getContextPath()+"/cgcontract/updatePrjNameAndNoById",
				dataType:"json",
				data:{ 
					cgId:data_bl.cgId,
					workNo:prj_no_bl,
					prjName:prj_name_bl,
					fbNo:fbht,
					borrowNo:borrowNo,
					programType:dagouleixing,
					programMoney:daigoujin_bl,
				},
				success:function(json){
					if(json>0){
						data_bl.workNo=prj_no_bl;
						data_bl.prjName=prj_name_bl;
						data_bl.fbNo=fbht;
						data_bl.borrowNo=borrowNo
						$("#mainContent").DataTable().row(tr_bl).data(data_bl).draw(false);
						toastr.success("补录成功")
						$("#blue").modal("hide");
					}else{
						toastr.error("补录失败")
					}
				}
			}) 
	 }
	
	//初始化
    $(".zhuangtai").change(function(){
        var zt=$(".zhuangtai").val();
        if(zt=="审批结束"){
        	$.ajax({
                type: 'POST',
                url: getContextPath()+'/cgcontract/selectCgContractByStatus',
                dataType: 'json',
                data: {
                	status:2,
                },
                success: function (json) {
                    $('#mainContent').dataTable().fnClearTable();
                    $('#mainContent').DataTable().rows.add(json).draw(false);
                    $(".chongqi").hide();
                    $(".iconxiugai").show();
                    $(".iconzhongzhi").show();
                    $(".iconlywj").show();
                    $(".icon-icon_edit").show()
                }
            });
            
        }else if(zt=="合同取消"){
        	$.ajax({
                type: 'POST',
                url: getContextPath()+'/cgcontract/selectCgContractByStatus',
                dataType: 'json',
                data: {
                	status:3,
                },
                success: function (json) {
                    $('#mainContent').dataTable().fnClearTable();
                    $('#mainContent').DataTable().rows.add(json).draw(false);
                    $(".chongqi").show();
                    $(".iconxiugai").hide();
                    $(".iconzhongzhi").hide();
                    $(".iconlywj").hide();
                    $(".icon-icon_edit").hide()
                }
            });
            
        }else if(zt=="审批中"){
        	$.ajax({
                type: 'POST',
                url: getContextPath()+'/cgcontract/selectCgContractByStatus',
                dataType: 'json',
                data: {
                	status:1,
                },
                success: function (json) {
                    $('#mainContent').dataTable().fnClearTable();
                    $('#mainContent').DataTable().rows.add(json).draw(false);
                    $(".chongqi").hide();
                	$(".iconxiugai").hide();
                	$(".iconzhongzhi").hide();
                    $(".iconlywj").hide();
                    $(".icon-icon_edit").hide()
                }
            });
        	
        }
    })
    
    //计算税金
    function jisuanshuijin(obj){
		var shuilv=$(obj).val();
		var contractMoney=$("#cghetongMoney").val();
		if(contractMoney==''){
			toastr.error("合同金额不能为空")
			$(obj).val('');
			return;
		}
		var shuijin=shuilv/1*contractMoney/1;
		$("#shuijin").val(shuijin)
	}
    function xgjisuanshuijin(obj){
    	var xgshuilv=$(obj).val();
		var xgcontractMoney=$("#xgcghetongMoney").val();
		if(xgcontractMoney==''){
			toastr.error("合同金额不能为空")
			$(obj).val('');
			return;
		}
		var xgshuijin=xgshuilv/1*xgcontractMoney/1;
		$("#xgshuijin").val(xgshuijin)
    }
    
    //初始化部门
    function selectDepartment(){
    	$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/organizationManagement/getAllOrganizationManagement',
	        dataType: 'json',
	        data: {
	           
	        },
	        success: function (json) {
	        	//console.log(json)
        		 $("#cg_bumen").empty();
        		$("#xgcg_bumen").empty();
	        	 for(var i=0;i<json.length;i++){
	        		$("#cg_bumen").append("<option value="+json[i].omName+" selected>"+json[i].omName+"</option>")
	        		$("#xgcg_bumen").append("<option value="+json[i].omName+" selected>"+json[i].omName+"</option>")
	        	} 
	        }
	    });
	}
    
  //初始化材料单位
    function selectMaterialCompany(obj){
    	$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/MaterialCompany/getAllMaterialCompany',
	        dataType: 'json',
	        data: {
	        },
	        success: function (json) {
	        	//console.log(json)
	        	for(var i=0;i<json.length;i++){
            		$("#cl_dw"+obj).append("<option value="+json[i].mcName+">"+json[i].mcName+"</option>");
            		$("#edit_cl_dw"+obj).append("<option value="+json[i].mcName+">"+json[i].mcName+"</option>");
            	}
	        }
	    });
	}
	
    //选择项目
	$("#chosexm").click(function(){
		$('#xiangmumd').on('hidden.bs.modal', function () {//解决模态框页面滚动问题
            if ($('.modal.in').size() >= 1) {
                $('body').addClass('modal-open')
            }
        })
		 $.ajax({
	            type: 'POST',
	            url: getContextPath()+'/task/selectPrjNameAndWorkNo',
	            dataType: 'json',
	            data: {
	            },
	            success: function (json) {
	                $('#xiangmubiao').dataTable().fnClearTable();
	                $('#xiangmubiao').DataTable().rows.add(json).draw(false);
	                $("#xiangmumd").modal("show");
	            }
	        });
	})
    
	$("#quedingxm").click(function(){
		var tr=$("input[name='xiangmuName']:checked").parents("tr");
		var data=$('#xiangmubiao').DataTable().row(tr).data();
		//console.log(data)
		$("#prjName").val(data.prjName);
		$("#task_no").val(data.prjNo);
		//$("#prjName").append("<option value="+data.prjName+" selected>"+data.prjName+"</option>")
		//$("#task_no").append("<option value="+data.prjNo+" selected>"+data.prjNo+"</option>")
		$("#xiangmumd").modal("hide");
	})
	
	$("#xgchosexm").click(function(){
		 $.ajax({
	            type: 'POST',
	            url: getContextPath()+'/task/selectPrjNameAndWorkNo',
	            dataType: 'json',
	            async:false,
	            data: {
	            },
	            success: function (json) {
	            	$("#xgxiangmumd").modal("show");
	                $('#xgxiangmubiao').dataTable().fnClearTable();
	                $('#xgxiangmubiao').DataTable().rows.add(json).draw(false);
	            }
	        });
		   $('#xgxiangmumd').on('hidden.bs.modal', function () {//解决模态框页面滚动问题
	            if ($('.modal.in').size() >= 1) {
	                $('body').addClass('modal-open')
	            }
	        })
	})
	$("#xgquedingxm").click(function(){
		var tr=$("input[name='xgxiangmuName']:checked").parents("tr");
		var data=$('#xgxiangmubiao').DataTable().row(tr).data();
		/* var prjName=$("input[name='xgxiangmuName']:checked").parent().next().next().text();
		var prjNo=$("input[name='xgxiangmuName']:checked").parent().next().text();
		var jiafang=$("input[name='xgxiangmuName']:checked").parent().next().next().next().next().next().text(); */
		$("#xgprjName").val(data.prjName);
		$("#xgtask_no").val(data.prjNo);
		//$("#xgprjName").append("<option value="+data.prjName+" selected>"+data.prjName+"</option>")
		//$("#xgtask_no").append("<option value="+data.prjNo+" selected>"+data.prjNo+"</option>")
		//$("#xgcg_bumen").val(data.omName)
		$("#xgxiangmumd").modal("hide");
		 
	})
	
	var len=1;
	function add(){
    	//var length=$("#cl_table tbody").find("tr").length;
    	len+=1;
    	$("#cl_table tbody").append("<tr>"+
       												'<td><input style="width:100%;" type="text" class="form-control"></td>'+
       												'<td>'+
       													'<select style="width:100%;" class="form-control" id="cl_type'+len+'"></select>'+
       												'</td>'+
       												'<td><input style="width:100%;" type="text" class="form-control"></td>'+
       												'<td>'+
           												'<select class="form-control" id="cl_dw'+len+'">'+
           												'</select>'+
       												'</td>'+
											        '<td><input style="width:100%;" type="text" class="form-control"></td>'+
											        '</td>'+
											        '<td><input style="width:100%;" type="text" class="form-control"></td>'+
											        '</td>'+
											        '<td><input style="width:100%;" type="text" class="form-control"></td>'+
											        /*'<td>'+
											        	'<select class="form-control" style="width:100%;" id="department_tj'+len+'">'+
											            '</select>'+
											        '</td>'+
											         '<td>'+
											        	'<select class="form-control" style="width:100%;" id="company_sure'+len+'">'+
											            '</select>'+
											        '</td>'+ */
											        '<td><input style="width:100%;" type="text" class="form-control"></td>'+
											        '<td><button type="button" class="btn btn btn-danger" onclick="removeThis(this)">移除</button></td>'+
   												"</tr>")
   												/* var xmSupplier;
    											var gsSupplier;
    											var clbiao_length=$("#cl_table tbody").find("tr").length;
   												if(clbiao_length==1){//为添加的第一行
   													xmSupplier=$("#yifang").val();
   							    					gsSupplier=$("#yifang").val();
   												}else{
								   					xmSupplier=$("#department_tj"+(len-1)).val()
													gsSupplier=$("#company_sure"+(len-1)).val()
													if(xmSupplier==undefined&&gsSupplier==undefined){
														for(var i=1;i<20;i++){
															xmSupplier=$("#department_tj"+(len-i)).val();
									    					gsSupplier=$("#company_sure"+(len-i)).val();
									    					if(xmSupplier!=undefined&&gsSupplier!=undefined){
									    						break;
									    					}
														}
													}
   													
   												}
							    				initSupplier2(len,xmSupplier,gsSupplier); */
							    				initClType2(len);
							    				selectMaterialCompany(len);
    }
    function initSupplier2(obj,obj2,obj3){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/supplier/selectIdAndName',
            dataType: 'json',
            async:false,
            data: {
            	
            },
            success: function (json) {
            	for(var i=0;i<json.length;i++){
            		$("#department_tj"+obj).append("<option value="+json[i].spId+">"+json[i].spName+"</option>");
            		$("#company_sure"+obj).append("<option value="+json[i].spId+">"+json[i].spName+"</option>");
            	}
            	$.fn.modal.Constructor.prototype.enforceFocus = function () { }
           	 $("#department_tj"+obj).select2({
                    tags: true,
                    placeholder: '请搜索或选择语言',
                    allowClear: true,
                });
           	 $.fn.modal.Constructor.prototype.enforceFocus = function () { }
                $("#company_sure"+obj).select2({
                    tags: true,
                    placeholder: '请搜索或选择语言',
                    allowClear: true,
                });
                if(obj2!=undefined && obj3!=undefined){
             	   $("#department_tj"+obj).val(obj2).select2()
             	   $("#company_sure"+obj).val(obj3).select2()
                }
            }
  		});
    }
    function initClType2(obj){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/MaterialType/selectMaterialType',
            dataType: 'json',
            data: {
            },
            success: function (json) {
            	for(var i=0;i<json.length;i++){
            		$("#cl_type"+obj).append("<option value="+json[i].materialType+">"+json[i].materialType+"</option>");
            		$("#edit_cl_type"+obj).append("<option value="+json[i].materialType+">"+json[i].materialType+"</option>");
            	}
            }
  		});
    }
    var length=1;
    function add2(){
    	//var length=$("#edit_cl_table tbody").find("tr").length;
    	length+=1;
    	$("#edit_cl_table tbody").append("<tr>"+
        												'<td><input style="width:100%;" type="text" class="form-control"></td>'+
        												'<td>'+
       													'<select style="width:100%;" class="form-control" id="edit_cl_type'+length+'"></select>'+
       												'</td>'+
        												'<td><input style="width:100%;" type="text" class="form-control"></td>'+
        												'<td>'+
            												'<select style="width:100%;" class="form-control" id="edit_cl_dw'+length+'">'+
            												'</select>'+
        												'</td>'+
												        '<td><input style="width:100%;" type="text" class="form-control"></td>'+
												        '<td><input style="width:100%;" type="text" class="form-control"></td>'+
												        '<td><input style="width:100%;" type="text" class="form-control"></td>'+
												        /*'<td>'+
												        	'<select class="form-control" style="width:100%;"id="edit_department_tj'+length+'">'+
												            '</select>'+
												        '</td>'+
												         '<td>'+
												        	'<select class="form-control"style="width:100%;" id="edit_company_sure'+length+'">'+
												            '</select>'+
												        '</td>'+ */
												        '<td><input style="width:100%;" type="text" class="form-control"></td>'+
												        '<td><button type="button" class="btn btn btn-danger" onclick="removeThis(this)">移除</button></td>'+
    												"</tr>")
    				/* var xmSupplier;
    				var gsSupplier;
    				var xgclbiao_length=$("#edit_cl_table tbody").find("tr").length;
					if(xgclbiao_length==1){//为添加的第一行
						xmSupplier=$("#xgyifang").val();
						gsSupplier=$("#xgyifang").val();
					}else{
	    				xmSupplier=$("#edit_department_tj"+(length-1)).val()
						gsSupplier=$("#edit_company_sure"+(length-1)).val()
						if(xmSupplier==undefined&&gsSupplier==undefined){
							for(var i=1;i<20;i++){
								xmSupplier=$("#edit_department_tj"+(length-i)).val();
		    					gsSupplier=$("#edit_company_sure"+(length-i)).val();
		    					if(xmSupplier!=undefined&&gsSupplier!=undefined){
		    						break;
		    					}
							}
						}
					} 
    				initSupplier3(length,xmSupplier,gsSupplier);*/
					initClType2(length);
					selectMaterialCompany(length);
    }
    function initSupplier3(obj,obj2,obj3){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/supplier/selectIdAndName',
            dataType: 'json',
            data: {
            	
            },
            success: function (json) {
            	for(var i=0;i<json.length;i++){
            		$("#edit_department_tj"+obj).append("<option value="+json[i].spId+">"+json[i].spName+"</option>");
            		$("#edit_company_sure"+obj).append("<option value="+json[i].spId+">"+json[i].spName+"</option>");
            	}
            	$.fn.modal.Constructor.prototype.enforceFocus = function () { }
              	 $("#edit_department_tj"+obj).select2({
                       tags: true,
                       placeholder: '请搜索或选择语言',
                       allowClear: true,
                   });
                   $("#edit_company_sure"+obj).select2({
                       tags: true,
                       placeholder: '请搜索或选择语言',
                       allowClear: true,
                   });
                   if(obj2!=undefined && obj3!=undefined){
                	   $("#edit_department_tj"+obj).val(obj2).select2()
                	   $("#edit_company_sure"+obj).val(obj3).select2()
                   }
            	
            }
  		});
    }
    
    
    function chooseFb(){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/subcontract/getFBNameAndNo',
            dataType: 'json',
            async:false,
            data: {
            },
            success: function (json) {
                $('#fb_table').dataTable().fnClearTable();
                $('#fb_table').DataTable().rows.add(json).draw(false);
            }
        });
    	$("#choose_fb").modal("show");
    	$('#choose_fb').on('hidden.bs.modal', function () {//解决模态框页面滚动问题
            if ($('.modal.in').size() >= 1) {
                $('body').addClass('modal-open')
            }
        })
    }

    function saveFbName(){
    	var tr=$("input[name='fbName']:checked").parents("tr");
    	var data=$("#fb_table").DataTable().row(tr).data();
    	if(data==null){
    		toastr.error("请选择")
    		return;
    	}
        $('#fbhetong').val(data.fbNo);
    	$("#choose_fb").modal("hide");
    	selectBorrowByFbNo(data.fbNo);
    }
    
    function selectBorrowByFbNo(obj){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/cgcontract/getRateAndMoney',
            dataType: 'json',
            async:false,
            data: {
            	no:obj,
            },
            success: function (json) {
                $('#borrow_no').html("");
            	$('#borrow_no').append("<option data-id='请选择' value='请选择'>--请选择--</option>")
            	$('#xgborrow_no').html("");
            	$('#xgborrow_no').append("<option data-id='请选择' value='请选择'>--请选择--</option>")
            	$('#borrow_no_bl').html("");
            	$('#borrow_no_bl').append("<option data-id='请选择' value='请选择'>--请选择--</option>")
                for(var i=0;i<json.length;i++){
                	 $('#borrow_no').append("<option data-id="+json[i].rate+" value="+json[i].bNo+">"+json[i].bNo+"</option>")
                	 $('#xgborrow_no').append("<option data-id="+json[i].rate+" value="+json[i].bNo+">"+json[i].bNo+"</option>")
                	 $('#borrow_no_bl').append("<option data-id="+json[i].rate+" value="+json[i].bNo+">"+json[i].bNo+"</option>")
                }
                $('#borrow_no').trigger("change");
                $('#xgborrow_no').trigger("change");
                $('#borrow_no_bl').trigger("change");
            }
        });
    }
    $('#borrow_no').change(function(){
    	var rate=$('#borrow_no').find("option:selected").attr("data-id")
    	if(rate=="请选择"){
    		$("#daigouType").val("对方打款")
    	}else if(rate=="0"){
    		$("#daigouType").val("无息代购")
    	}else{
    		$("#daigouType").val("有息代购")
    	}
    })
    $('#xgborrow_no').change(function(){
    	var rate=$('#xgborrow_no').find("option:selected").attr("data-id")
    	if(rate=="请选择"){
    		$("#xgdaigouType").val("对方打款")
    	}else if(rate=="0"){
    		$("#xgdaigouType").val("无息代购")
    	}else{
    		$("#xgdaigouType").val("有息代购")
    	}
    })
    $('#borrow_no_bl').change(function(){
    	var rate=$('#borrow_no_bl').find("option:selected").attr("data-id")
    	if(rate=="请选择"){
    		$("#daigouType_bl").val("对方打款")
    	}else if(rate=="0"){
    		$("#daigouType_bl").val("无息代购")
    	}else{
    		$("#daigouType_bl").val("有息代购")
    	}
    })
    
    function xgchooseFb(){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/subcontract/getFBNameAndNo',
            dataType: 'json',
            async:false,
            data: {
            },
            success: function (json) {
                $('#xgfb_table').dataTable().fnClearTable();
                $('#xgfb_table').DataTable().rows.add(json).draw(false);
            }
        });
    	$("#xgchoose_fb").modal("show");
    	$('#xgchoose_fb').on('hidden.bs.modal', function () {//解决模态框页面滚动问题
            if ($('.modal.in').size() >= 1) {
                $('body').addClass('modal-open')
            }
        })
    }

    function xgsaveFbName(){
    	var tr=$("input[name='xgfbName']:checked").parents("tr");
    	var data=$("#xgfb_table").DataTable().row(tr).data();
    	if(data==null){
    		toastr.error("请选择")
    		return;
    	}
        $('#xgfbhetong').val(data.fbNo);
    	$("#xgchoose_fb").modal("hide");
    	selectBorrowByFbNo(data.fbNo);
    }
    
		function lookCancel(obj){
	  		$("#look_cancel").modal("show");
	  	}
    
    //补录时选择的分包合同
	  function choseFbxm_bl(){
			$("#choose_fb_bl").modal("show");
	    	$.ajax({
	            type: 'POST',
	            url: getContextPath()+'/subcontract/getFBNameAndNo',
	            dataType: 'json',
	            async:false,
	            data: {
	            },
	            success: function (json) {
	                $('#fb_table_bl').dataTable().fnClearTable();
	                $('#fb_table_bl').DataTable().rows.add(json).draw(false);
	            }
	        });
	    	$('#choose_fb_bl').on('hidden.bs.modal', function () {//解决模态框页面滚动问题
	            if ($('.modal.in').size() >= 1) {
	                $('body').addClass('modal-open')
	            }
	        })
	    }
    
     function saveFbName_bl(){
    	var tr=$("input[name='fbName_bl']:checked").parents("tr");
    	var data=$("#fb_table_bl").DataTable().row(tr).data();
    	if(data==null){
    		toastr.error("请选择")
    		return;
    	}
        $('#fbhetong_bl').val(data.fbNo);
    	$("#choose_fb_bl").modal("hide");
    	selectBorrowByFbNo(data.fbNo);
    }
		
		
		
    //初始化采购单号
    function initSelect(){
  		$.ajax({
            type: 'POST',
            url: getContextPath()+'/PrjMaterialBuy/selectBuyCode',
            dataType: 'json',
            data: {
            },
            error: function (msg) {
            	toastr.error("请求失败");
            },
            success: function (json) {
            	//console.log(json)
            	$("#selectpicker_no").html('');
            	$("#selectpicker_no2").html('');
            	for(var i=0;i<json.length;i++){
            		if(json[i]!=null){
	            		$("#selectpicker_no").append("<option  value="+json[i].taskCode+">"+json[i].taskCode+"</option>");
	            		$("#selectpicker_no2").append("<option  value="+json[i].taskCode+">"+json[i].taskCode+"</option>");
            		}
            	}
            	$('#selectpicker_no').selectpicker('refresh');
            	$('#selectpicker_no2').selectpicker('refresh');
            }
  		});
  	}  
	
	
	function chooseNo(){
		$('.selectpicker').selectpicker('deselectAll'); 
		$("#chooseNo").modal("show");
	}
	function chooseNo2(){
		$('.selectpicker2').selectpicker('deselectAll'); 
		$("#chooseNo2").modal("show");
	}
	
	function quxiao(){
		$('#chooseNo').on('hidden.bs.modal', function () {//解决模态框页面滚动问题
            if ($('.modal.in').size() >= 1) {
                $('body').addClass('modal-open')
            }
        })
        $('#chooseNo').modal("hide");
	}
	function quxiao2(){
		$('#chooseNo2').on('hidden.bs.modal', function () {//解决模态框页面滚动问题
            if ($('.modal.in').size() >= 1) {
                $('body').addClass('modal-open')
            }
        })
        $('#chooseNo2').modal("hide");
	}
	
	
	//保存选择采购单号
	//$("#yijianjiesuanMoney").hide();
	function saveNo(){
		$('#chooseNo').on('hidden.bs.modal', function () {//解决模态框页面滚动问题
            if ($('.modal.in').size() >= 1) {
                $('body').addClass('modal-open')
            }
        })
		
		var no_list=$("#selectpicker_no").val();
		if(no_list!=null){
			$("#cghetongMoney").val("");
			$("#cailiaobiaoDiv table").remove();
			//$("#yijianjiesuanMoney").show();
			for(var i=0;i<no_list.length;i++){
        		$("#cailiaobiaoDiv").append(
        				"<table  class='table table-bordered table-condensed' style='width:1580px;border=1' id='cailiaobiao"+i+"'>"+
                    	"<thead>"+
                    		/* "<tr>"+
                            	"<td>采购部门</td>"+
                                "<td dataId='' id='cgbumen"+i+"'></td>"+
                                "<td  colspan='2'>部门采购金额</td>"+
                                "<td id='bumencgMoney"+i+"' colspan='2'></td>"+
                            	"<th colspan='5' style='text-align:right;'></th>"+
                        	"</tr>"+ */
                        	"<tr>"+
                            	"<th>名称</th>"+
                            	"<th style='width:10%;'>类型</th>"+
	                            "<th>型号</th>"+
	                            "<th style='width:8%;'>单位</th>"+
	                            "<th>数量</th>"+
	                            "<th>单价</th>"+
	                            "<th>金额</th>"+
	                            /*"<th>项目部推荐供应商</th>"+
	                             "<th>公司确定供应商</th>"+ */
	                            "<th style='width:10%;'>备注</th>"+
	                            "<th>操作</th>"+
                        	"</tr>"+
                    	"</thead>"+
                    	"<tbody>"+
                    	"</tbody>"+
                    "</table>"
                    )}
		  		$.ajax({
		            type: 'POST',
		            url: getContextPath()+'/PrjMaterialBuy/selectBuyByIds',
		            dataType: 'json',
		            async:false,
		            data: {
		            	ids:no_list.toString()
		            },
		            success: function (json) {
		            	//console.log(json)
	                    $('#prjName').empty();
                		$("#task_no").empty();
		            	for(var i=0;i<json.length;i++){
                    		$("#prjName").val(json[0].applyPrj)
                    		$("#task_no").val(json[0].applyCode)
		            		$("#cg_bumen").val(json[0].omName)
		            		var omName=json[i].omName
		            		var pmbId=json[i].pmbId;
		            		
		            		$.ajax({
		                        type: 'POST',
		                        url: getContextPath()+'/cgcontract/getMdById',
		                        dataType: 'json',
		                        async:false,
		                        data: {
		                        	id:pmbId
		                        },
		                        success: function (json) {
		                        	for(var k=0;k<json.length;k++){
		                        		$("#cailiaobiao"+i+" tbody").append("<tr dataId="+json[k].mdlId+"><td>"
		                		  				+'<input type="text" class="form-control" style="width:100%;" value='+json[k].materialName+' >'
		                		  				+"</td><td>"
		                		  				+'<select class="form-control" id="cl_type'+json[k].mdlId+'"></select>'
		                		  				+"</td><td>"
		                		  				+'<input type="text" class="form-control" style="width:100%;" value='+json[k].modeType+' >' 
		                		  				+"</td><td>"
		                		  				+'<select class="form-control"  id=cl_danwei'+json[k].mdlId+'>'
														+'</select>'
		                		  				+"</td><td>"
		                		  				+'<input type="text" class="form-control" style="width:100%;" value='+json[k].num+' >'
		                		  				+"</td><td>"
		                		  				+'<input type="text" class="form-control"  style="width:100%;">'
		                		  				+"</td><td>"
		                		  				+'<input type="text" class="form-control" style="width:100%;" value='+json[k].price+' >'
		                		  				+"</td><td>"
		                		  				/* +'<select  class="form-control" style="width:100%;" id=xm'+json[k].mdlId+'></select>'
		                		  				+"</td><td>"
		                		  				+'<select  class="form-control" style="width:100%;" id=gs'+json[k].mdlId+'></select>'
		                		  				+"</td><td>" */
		                		  				+'<input type="text" class="form-control" style="width:100%;" value='+json[k].infos+' >'
		                		  				+"</td><td>"
		                		  				+'<button type="button" class="btn btn-danger" onclick="removeThis(this)">删除</button>'
		                		  				+"</td></tr>")
		                		  				initClType(json[k].materialType,json[k].mdlId);
		                		  				//initName1(json[k].provideCompany,json[k].mdlId);
		                        				//initName2(json[k].sureMaterialMode,json[k].mdlId);
		                        				initMaterialCompany(json[k].buyCompany,json[k].mdlId)
		                        				//$("#cl_danwei"+json[k].mdlId).val(json[k].buyCompany);
		                		  				
		                        	} 
		                        }
		              		});
		            		
		            	}
	            		$("#cgdNo").val(no_list)
		            	//$('#prjName').trigger('change')
                    	//$('#task_no').trigger('change')
		            	$("#chooseNo").modal("hide");
		            }
		  		});
		  		
	  		}else{
	  			toastr.error("采购单号为空");
	  		}
	}
	$("#prjName").change(function(){
		var name=$('#prjName').val()
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/task/selectTaskPrjNo',
            dataType: 'json',
            data: {
            	prjName:name
            },
            success: function (json) {
            	for(var i=0;i<json.length;i++){
	                $('#task_no').val(json[i].prjNo);
            	}
            }
  		});
	})
	$("#task_no").on("change",function(){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/task/selectTaskPrjName',
            dataType: 'json',
            data: {
            	prjNo:$('#task_no').val()
            },
            success: function (json) {
            	for(var i=0;i<json.length;i++){
                	$('#prjName').val(json[i].prjName);
            	}
            }
  		});
    })
	
	function removeThis(obj){
    	var tr=$(obj).parent().parent();
    	$(tr).remove();
    	toastr.success("移除成功");
	}
	
	 function initMaterialCompany(obj1,obj2){
	    	$.ajax({
		        type: 'POST',
		        url: getContextPath()+'/MaterialCompany/getAllMaterialCompany',
		        dataType: 'json',
		        data: {
		        },
		        success: function (json) {
		        	//console.log(json)
		        	$("#cl_danwei"+obj2).empty();
            		$("#xgcl_danwei"+obj2).empty();
		        	for(var i=0;i<json.length;i++){
	            		$("#cl_danwei"+obj2).append("<option value="+json[i].mcName+">"+json[i].mcName+"</option>");
	            		$("#xgcl_danwei"+obj2).append("<option value="+json[i].mcName+">"+json[i].mcName+"</option>");
	            	}
		        	$("#cl_danwei"+obj2).val(obj1);
            		$("#xgcl_danwei"+obj2).val(obj1);
		        }
		    });
		}
	
	function initClType(obj1,obj2){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/MaterialType/selectMaterialType',
            dataType: 'json',
            data: {
            },
            success: function (json) {
            	$("#cl_type"+obj2).empty();
            	$("#xgcl_type"+obj2).empty();
            	for(var i=0;i<json.length;i++){
            		$("#cl_type"+obj2).append("<option value="+json[i].materialType+">"+json[i].materialType+"</option>");
            		$("#xgcl_type"+obj2).append("<option value="+json[i].materialType+">"+json[i].materialType+"</option>");
            	}
            	$("#cl_type"+obj2).val(obj1)
            	$("#xgcl_type"+obj2).val(obj1)
            }
  		});
    }
	//初始化供应商
	function initName1(obj1,obj2){
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/supplier/selectIdAndName',
            dataType: 'json',
            data: {

            },
            success: function (json) {
            	$("#xm"+obj2).empty();
            	$("#xgxm"+obj2).empty();
            	$("#edit_department_tj"+obj2).empty()
                for(var i=0;i<json.length;i++){
                	$("#xm"+obj2).append("<option value="+json[i].spId+">"+json[i].spName+"</option>");
                	$("#xgxm"+obj2).append("<option value="+json[i].spId+">"+json[i].spName+"</option>");
                	$("#edit_department_tj"+obj2).append("<option value="+json[i].spId+">"+json[i].spName+"</option>");
                }
                $("#xm"+obj2).val(obj1);
                $("#xgxm"+obj2).val(obj1);
                $("#edit_department_tj"+obj2).val(obj1);
                $.fn.modal.Constructor.prototype.enforceFocus = function () { }
                $("#xm"+obj2).select2({
	                 tags: true,
	                 placeholder: '请搜索或选择语言',
	                 allowClear: true
	             });
                $("#xgxm"+obj2).select2({
	                 tags: true,
	                 placeholder: '请搜索或选择语言',
	                 allowClear: true
	             });
                $("#edit_department_tj"+obj2).select2({
	                 tags: true,
	                 placeholder: '请搜索或选择语言',
	                 allowClear: true
	             });
            }
		});
	}
	function initName2(obj1,obj2){
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/supplier/selectIdAndName',
            dataType: 'json',
            data: {

            },
            success: function (json) {
            	$("#gs"+obj2).empty();
            	$("#xggs"+obj2).empty();
            	$("#edit_company_sure"+obj2).empty();
                for(var i=0;i<json.length;i++){
                	$("#gs"+obj2).append("<option value="+json[i].spId+">"+json[i].spName+"</option>");
                	$("#xggs"+obj2).append("<option value="+json[i].spId+">"+json[i].spName+"</option>");
                	$("#edit_company_sure"+obj2).append("<option value="+json[i].spId+">"+json[i].spName+"</option>");
                }
                $("#gs"+obj2).val(obj1);
                $("#xggs"+obj2).val(obj1);
                $("#edit_company_sure"+obj2).val(obj1);
                $.fn.modal.Constructor.prototype.enforceFocus = function () { }
                $("#gs"+obj2).select2({
	                 tags: true,
	                 placeholder: '请搜索或选择语言',
	                 allowClear: true
	             });
                $("#xggs"+obj2).select2({
	                 tags: true,
	                 placeholder: '请搜索或选择语言',
	                 allowClear: true
	             });
                $("#edit_company_sure"+obj2).select2({
	                 tags: true,
	                 placeholder: '请搜索或选择语言',
	                 allowClear: true
	             });
            }
		});
	}
	
	
    //一键结算金额
	function yijianjiesuan(type){
		//console.log(obj)
		if(type==1){
			var hetongMoney=0;
			$("#cailiaobiaoDiv table").each(function(){
				var bumenMoney=0;
				$(this).find("tbody").eq(0).find("tr").each(function(){
					var danjia=$(this).find("td").eq(5).find("input").val();
					var num=$(this).find("td").eq(4).find("input").val();
					if(danjia==''||danjia==null){
						toastr.error("单价不能为空");
						return;
					}
					var money=danjia*num
					$(this).find("td").eq(6).find("input").val(money);
					bumenMoney+=money;
				})
				//$(this).find("thead").eq(0).find("tr").eq(0).find("td").eq(3).text(bumenMoney)
				hetongMoney+=bumenMoney;
			})
			$("#cl_table tbody").each(function(){
				var bumenMoney=0;
				$(this).find("tr").each(function(){
					var num=$(this).find("td").eq(4).find("input").val();
					var danjia=$(this).find("td").eq(5).find("input").val();
					if(danjia==''||danjia==null){
						toastr.error("单价不能为空");
						return;
					}
					var money=danjia*num
					$(this).find("td").eq(6).find("input").val(money);
					bumenMoney+=money;
				})
				hetongMoney+=bumenMoney;
			})
			var yunfei=$("#yunfei").val();
			$("#cghetongMoney").val(hetongMoney/1+yunfei/1);
		}else if(type==2){
			var hetongMoney=0;
			$("#xgcailiaobiaoDiv table").each(function(){
				var bumenMoney=0;
				$(this).find("tbody").eq(0).find("tr").each(function(){
					var danjia=$(this).find("td").eq(5).find("input").val();
					var num=$(this).find("td").eq(4).find("input").val();
					if(danjia==''||danjia==null){
						toastr.error("单价不能为空");
						return;
					}
					var money=danjia*num
					$(this).find("td").eq(6).find("input").val(money);
					bumenMoney+=money;
				})
				//$(this).find("thead").eq(0).find("tr").eq(0).find("td").eq(3).text(bumenMoney)
				hetongMoney+=bumenMoney;
			})
			$("#edit_cl_table tbody").each(function(){
				var bumenMoney=0;
				$(this).find("tr").each(function(){
					var num=$(this).find("td").eq(4).find("input").val();
					var danjia=$(this).find("td").eq(5).find("input").val();
					if(danjia==''||danjia==null){
						toastr.error("单价不能为空");
						return;
					}
					var money=danjia*num
					$(this).find("td").eq(6).find("input").val(money);
					bumenMoney+=money;
				})
				hetongMoney+=bumenMoney;
			})
			var xgyunfei=$("#xgyunfei").val();
			$("#xgcghetongMoney").val(hetongMoney/1+xgyunfei/1);
		}
	}
	
	//修改保存选择采购单号
	//$("#xgyijianjiesuanMoney").hide();
	function saveNo2(){
		$('#chooseNo2').on('hidden.bs.modal', function () {//解决模态框页面滚动问题
            if ($('.modal.in').size() >= 1) {
                $('body').addClass('modal-open')
            }
        })
		
		var no_list2=$("#selectpicker_no2").val();
		if(no_list2!=null){
			$("#xgcghetongMoney").val("");
			$("#xgcailiaobiaoDiv table").remove();
			//$("#xgyijianjiesuanMoney").show();
			for(var i=0;i<no_list2.length;i++){
        		$("#xgcailiaobiaoDiv").append(
        				"<table  class='table table-bordered table-condensed' style='width:1580px;border=1' id='xgcailiaobiao"+i+"'>"+
                    	"<thead>"+
                        	"<tr>"+
                            	"<th>名称</th>"+
                            	"<th style='width:10%;'>类型</th>"+
	                            "<th>型号</th>"+
	                            "<th style='width:8%;'>单位</th>"+
	                            "<th>数量</th>"+
	                            "<th>单价</th>"+
	                            "<th>金额</th>"+
	                            /*"<th>项目部推荐供应商</th>"+
	                             "<th>公司确定供应商</th>"+ */
	                            "<th style='width:10%;'>备注</th>"+
	                            "<th style='width:5%;'>操作</th>"+
                        	"</tr>"+
                    	"</thead>"+
                    	"<tbody>"+
                    	"</tbody>"+
                    "</table>"
                    )}
		  		$.ajax({
		            type: 'POST',
		            url: getContextPath()+'/PrjMaterialBuy/selectBuyByIds',
		            dataType: 'json',
		            data: {
		            	ids:no_list2.toString()
		            },
		            success: function (json) {
		            	$("#xgprjName").empty()
		            	$("#xgtask_no").empty()
		            	for(var i=0;i<json.length;i++){
		            		$("#xgprjName").append(json[0].applyPrj)
                    		$("#xgtask_no").append(json[0].applyCode)
		            		$("#xgcg_bumen").val(json[0].omName)
		            		var omName=json[i].omName
		            		var pmbId=json[i].pmbId;
		            		
		            		$.ajax({
		                        type: 'POST',
		                        url: getContextPath()+'/cgcontract/getMdById',
		                        dataType: 'json',
		                        async:false,
		                        data: {
		                        	id:pmbId
		                        },
		                        success: function (json) {
		                        	//console.log(json)
		                        	for(var k=0;k<json.length;k++){
		                        		$("#xgcailiaobiao"+i+" tbody").append("<tr dataId="+json[k].mdlId+"><td>"
		                		  				+'<input type="text" class="form-control" style="width:100%;" value='+json[k].materialName+' >'
		                		  				+"</td><td>"
		                		  				//+'<input type="text" class="form-control" value='+json[k].materialType+' style="width:100%;">'
		                		  				+'<select style="width:100%;" class="form-control" id="xgcl_type'+json[k].mdlId+'"></select>'
		                		  				+"</td><td>"
		                		  				+'<input type="text" class="form-control" style="width:100%;" value='+json[k].modeType+' >'
		                		  				+"</td><td>"
		                		  				//+'<input type="text" class="form-control" value='+json[k].buyCompany+' style="width:100%;">'
		                		  				+'<select class="form-control" style="width:100%;"  id=xgcl_danwei'+json[k].mdlId+'>'
														+'</select>'
		                		  				+"</td><td>"
		                		  				+'<input type="text" class="form-control" style="width:100%;" value='+json[k].num+' >'
		                		  				+"</td><td>"
		                		  				+'<input type="text" class="form-control"  style="width:100%;">'
		                		  				+"</td><td>"
		                		  				+'<input type="text" class="form-control" style="width:100%;" value='+json[k].price+' >'
		                		  				+"</td><td>"
		                		  				/*+'<select style="width:100%;" class="form-control" id=xgxm'+json[k].mdlId+'></select>'
		                		  				+"</td><td>"
		                		  				 +'<select style="width:100%;" class="form-control" id=xggs'+json[k].mdlId+'></select>'
		                		  				+"</td><td>" */
		                		  				+'<input type="text" class="form-control" style="width:100%;" value='+json[k].infos+' >'
		                		  				+"</td><td>"
		                		  				+'<button type="button" class="btn btn-danger" onclick="removeThis(this)">删除</button>'
		                		  				+"</td></tr>")
		                		  				initClType(json[k].materialType,json[k].mdlId);
		                		  				//initName1(json[k].provideCompany,json[k].mdlId);
                        						//initName2(json[k].sureMaterialMode,json[k].mdlId);
		                        				//$("#xgcl_danwei"+json[k].mdlId).val(json[k].buyCompany);
		                        				initMaterialCompany(json[k].buyCompany,json[k].mdlId)
		                        	} 
		                        }
		              		});
		            		
		            	}
	            		$('#xgcgdNo').val(no_list2)
		            	//$("#xgprjName").trigger("change")
		            	//$("#xgtask_no").trigger("change")
		            	$("#chooseNo2").modal("hide");
		            	
		            }
		  		});
		  		
	  		}else{
	  			toastr.error("采购单号为空");
	  		}
	}
	
	$("#xgprjName").change(function(){
		var name=$('#xgprjName').val()
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/task/selectTaskPrjNo',
            dataType: 'json',
            data: {
            	prjName:name
            },
            success: function (json) {
            	for(var i=0;i<json.length;i++){
	                $('#xgtask_no').val(json[i].prjNo);
            	}
            }
  		});
	})
	$("#xgtask_no").on("change",function(){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/task/selectTaskPrjName',
            dataType: 'json',
            data: {
            	prjNo:$('#xgtask_no').val()
            },
            success: function (json) {
            	for(var i=0;i<json.length;i++){
                	$('#xgprjName').val(json[i].prjName);
            	}
            }
  		});
    })
	
	//初始化乙方
    function inityifang(){
	    $.ajax({
	        type: 'POST',
	        url: getContextPath()+'/supplier/selectIdAndName',
	        dataType: 'json',
	        data: {
	        },
	        success: function (json) {
	        	$("#yifang").html('');
	        	$("#xgyifang").html('');
	        	 for(var i=0;i<json.length;i++){
	        		$("#yifang").append( "<option value='" + json[i].spId + "'>"
		                    + json[i].spName + "</option>")
		            $("#xgyifang").append( "<option value='" + json[i].spId + "'>"
		                    + json[i].spName + "</option>")
	        	}
	        	 $.fn.modal.Constructor.prototype.enforceFocus = function () { }
	        	 $("#yifang").select2({
	                 tags: true,
	                 placeholder: '请搜索或选择语言',
	                 allowClear: true
	             });
	             $("#xgyifang").select2({
	                 tags: true,
	                 placeholder: '请搜索或选择语言',
	                 allowClear: true
	             });
	        }
	    });
	}
	
	function clearP(){
		$("#myModal input").val("");
		$("#hetonggaishu").val("");
	}
	
	//填报保存
	function saveCg(){
		
		//保存材料信息
		var cgclArr=new Array();
		$("#cailiaobiaoDiv table").find("tbody").find("tr").each(function(){
				var clname=$(this).find("td").eq(0).find("input").val();
				var cltype=$(this).find("td").eq(1).find("option:selected").val();
				var clxinghao=$(this).find("td").eq(2).find("input").val();
				var danwei=$(this).find("td").eq(3).find("option:selected").val();
				var num=$(this).find("td").eq(4).find("input").val();
				var danjia=$(this).find("td").eq(5).find("input").val();
				var jine=$(this).find("td").eq(6).find("input").val();
				//var xm=$(this).find("td").eq(7).find("option:selected").val();
				//var gs=$(this).find("td").eq(8).find("option:selected").val();
				var beizhu=$(this).find("td").eq(7).find("input").val();
				var cgcl={
						 cgId:undefined,       
						 clName:undefined,         
						 clType:undefined,         
						 clMode:undefined,         
						 clUnit:undefined,         
						 clNumber:undefined,       
						 clPrice:0,         
						 clMoney:0,         
						 clPrjSupplier:undefined,  
						 clGsSupplier:undefined,   
						 clDesc:undefined,         
				}
				cgcl.clName=clname;
				cgcl.clType=cltype;        
				cgcl.clMode=clxinghao;         
				cgcl.clUnit=danwei;         
				cgcl.clNumber=num;     
				cgcl.clPrice=danjia;         
				cgcl.clMoney=jine;         
				//cgcl.clPrjSupplier=xm;
				//cgcl.clGsSupplier=gs;
				cgcl.clDesc=beizhu; 
				cgclArr.push(cgcl)
		})
		$("#cl_table tbody").find("tr").each(function(){
				var clname=$(this).find("td").eq(0).find("input").val();
				var cltype=$(this).find("td").eq(1).find("option:selected").val();
				var clxinghao=$(this).find("td").eq(2).find("input").val();
				var danwei=$(this).find("td").eq(3).find("option:selected").val();
				var num=$(this).find("td").eq(4).find("input").val();
				var danjia=$(this).find("td").eq(5).find("input").val();
				var jine=$(this).find("td").eq(6).find("input").val();
				//var xm=$(this).find("td").eq(7).find("option:selected").val();
				//var gs=$(this).find("td").eq(8).find("option:selected").val();
				var beizhu=$(this).find("td").eq(7).find("input").val();
				var cgcl={
						 cgId:undefined,       
						 clName:undefined,         
						 clType:undefined,         
						 clMode:undefined,         
						 clUnit:undefined,         
						 clNumber:undefined,       
						 clPrice:0,         
						 clMoney:0,         
						 clPrjSupplier:undefined,  
						 clGsSupplier:undefined,   
						 clDesc:undefined,         
				}
				cgcl.clName=clname;
				cgcl.clType=cltype;        
				cgcl.clMode=clxinghao;         
				cgcl.clUnit=danwei;         
				cgcl.clNumber=num;     
				cgcl.clPrice=danjia;         
				cgcl.clMoney=jine;         
				//cgcl.clPrjSupplier=xm;
				//cgcl.clGsSupplier=gs;
				cgcl.clDesc=beizhu; 
				cgclArr.push(cgcl)
		})
		var cghetongming=$("#cghetongming").val();
		var cgdNo=$("#cgdNo").val();
		var task_no=$("#task_no").val();
		var prjName=$("#prjName").val();
		var isdaigou=$("#isdaigou").val();
		var fbhetong=$("#fbhetong").val();
		var daigouType=$("#daigouType").val();
		var cghetongType=$("#cghetongType").val();
		var daigouMoney=$("#daigouMoney").val();
		var cghetongMoney=$("#cghetongMoney").val();
		var hetongjiafang=$("#hetongjiafang").val();
		var yifang=$("#yifang").val();
		var fukuangfangshi=$("#fukuangfangshi").val();
		var year=$("#year").val();
		var hetonggaishu=$("#hetonggaishu").val();
		var gaikuang=$("#gaikuang").val();
		var cg_bumen=$("#cg_bumen").val();
		var yunfei=$("#yunfei").val();
		var borrowNo=$("#borrow_no").val();
		var shuilv=$("#shuilv").val();
		var shuijin=$("#shuijin").val();
		if(borrowNo=="请选择"){
			borrowNo="";
		}
		
		if(cghetongming==''){
			toastr.error("采购合同名称不能为空");
			return;
		}
		/* if(cgdNo==''){
			toastr.error("采购单号不能为空");
			return;
		} */
		/* if(cghetongType==''){
			toastr.error("采购合同类型不能为空");
			return;
		}
		if(prjName==''){
			toastr.error("项目名称不能为空");
			return;
		} 
		if(hetongjiafang==''){
			toastr.error("合同甲方名称不能为空");
			return;
		}
		if(yifang==''){
			toastr.error("乙方不能为空");
			return;
		}
		if(cghetongMoney==0){
			toastr.error("采购合同金额不能为0");
			return;
		}
		if($("#new_accessory").find('tbody tr').length<1 || $("#file").val()==''){
			toastr.error("采购合同文本附件为空")
			return;
		} 
		
		var reg=/^\d+(\.\d{0,2})?$/;//只能输入数字或含两位小数的正则
		if(isdaigou=='是'){
			if(fbhetong==''){
				toastr.error("分包合同不能为空")
				return;
			}
			if(!reg.test(daigouMoney)){
				toastr.error("代购金额只能输入数字且只能有两位小数");
				return;
			}
		} */
		/* if(yunfei==""||!reg.test(yunfei)){
			toastr.error("运费只能输入数字且只能有两位小数");
			return;
		} */
		
		var cgContract={
				 cgId:undefined,   //编号                   
				 contractName:undefined,   // 采购合同名称      
				 cgNo:undefined,   //采购合同编号               
				 cgdNo:undefined,   //采购单号                
				 workNo:undefined,   // 任务单号              
				 prjName:undefined,   //项目名称              
				 isProgram:undefined,   // 是否代购           
				 programType:undefined,   // 代购类型         
				 cgcType:undefined,   // 采购合同类型           
				 programMoney:0,   // 代购金额         
				 cgContractMoney:0,   // 采购合同金额    
				 contractNameJia:undefined,   // 合同甲方名称   
				 contractNameYi:undefined,   // 乙方        
				 payMode:undefined,   // 付款方式             
				 contractSignTime:undefined,   // 采购合同签订时间
				 contractSummary:undefined,   // 采购合同概述   
				 workContent:undefined,   // 主要概况及工作内容    
				 makeTime:undefined,    //当前时间            
				 history:undefined,   //历史状态              
				 fbNo:undefined,   //关联的分保合同编号    
				 cgcl:undefined,
				 cgDepartment:undefined,
				 freight:0,
				 borrowNo:undefined,
				 shuilv:0,
				 shuijin:0,
		}
		cgContract.contractName=cghetongming;
		cgContract.cgdNo=cgdNo;
		cgContract.workNo=task_no;
		cgContract.prjName=prjName;
		cgContract.cgcType=cghetongType;
		cgContract.isProgram=isdaigou;
		cgContract.fbNo=fbhetong;
		cgContract.programType=daigouType;
		cgContract.programMoney=daigouMoney;
		cgContract.cgContractMoney=cghetongMoney;
		cgContract.contractNameJia=hetongjiafang;
		cgContract.contractNameYi=yifang;
		cgContract.payMode=fukuangfangshi;
		cgContract.contractSignTime=year;
		cgContract.contractSummary=hetonggaishu;
		cgContract.workContent=gaikuang;
		cgContract.cgcl=cgclArr;
		cgContract.cgDepartment=cg_bumen;
		cgContract.freight=yunfei;
		cgContract.borrowNo=borrowNo;
		cgContract.shuilv=shuilv;
		cgContract.shuijin=shuijin;
		//console.log(cgContract)
		var formData = new FormData();
  		formData.append("cgContract", JSON.stringify(cgContract));
  		
  		$("#new_accessory tbody").find("tr").each(function(){
  			formData.append("file", $(this).find("input")[0].files[0]);
  		})
  		
  		$("#new_accessory1 tbody").find("tr").each(function(){
  			formData.append("file1", $(this).find("input")[0].files[0]);
  		})
  		
  		showMask();
  		$.ajax({
	  			type: 'POST',
	            url: getContextPath()+'/cgcontract/addCgContractSave',
	            data: formData,  
	            processData: false,
	            contentType: false,
	            error:function(json){
	            	toastr.error("保存失败");
	            	location.reload();
	            },
	            success: function (json) {
	            	if(json>0){
	            		clearP();
	            		$("#myModal").modal("hide");
	            		toastr.success("保存成功");
	            		//location.reload([true]);
	            	}else{
	            		toastr.error("保存失败");
	            	}
	            	hidMask();
	            }
	  		}) 
	}
	
	//填报提交
	function submitCg(){
		//保存材料信息
		var cgclArr=new Array();
		$("#cailiaobiaoDiv table").find("tbody").find("tr").each(function(){
				var clname=$(this).find("td").eq(0).find("input").val();
				var cltype=$(this).find("td").eq(1).find("option:selected").val();
				var clxinghao=$(this).find("td").eq(2).find("input").val();
				var danwei=$(this).find("td").eq(3).find("option:selected").val();
				var num=$(this).find("td").eq(4).find("input").val();
				var danjia=$(this).find("td").eq(5).find("input").val();
				var jine=$(this).find("td").eq(6).find("input").val();
				//var xm=$(this).find("td").eq(7).find("option:selected").val();
				//var gs=$(this).find("td").eq(8).find("option:selected").val();
				var beizhu=$(this).find("td").eq(7).find("input").val();
				var cgcl={
						 cgId:undefined,       
						 clName:undefined,         
						 clType:undefined,         
						 clMode:undefined,         
						 clUnit:undefined,         
						 clNumber:undefined,       
						 clPrice:0,         
						 clMoney:0,         
						 clPrjSupplier:undefined,  
						 clGsSupplier:undefined,   
						 clDesc:undefined,         
				}
				cgcl.clName=clname;
				cgcl.clType=cltype;        
				cgcl.clMode=clxinghao;         
				cgcl.clUnit=danwei;         
				cgcl.clNumber=num;     
				cgcl.clPrice=danjia;         
				cgcl.clMoney=jine;         
				//cgcl.clPrjSupplier=xm;
				//cgcl.clGsSupplier=gs;
				cgcl.clDesc=beizhu; 
				cgclArr.push(cgcl)
		})
		$("#cl_table tbody").find("tr").each(function(){
				var clname=$(this).find("td").eq(0).find("input").val();
				var cltype=$(this).find("td").eq(1).find("option:selected").val();
				var clxinghao=$(this).find("td").eq(2).find("input").val();
				var danwei=$(this).find("td").eq(3).find("option:selected").val();
				var num=$(this).find("td").eq(4).find("input").val();
				var danjia=$(this).find("td").eq(5).find("input").val();
				var jine=$(this).find("td").eq(6).find("input").val();
				//var xm=$(this).find("td").eq(7).find("option:selected").val();
				//var gs=$(this).find("td").eq(8).find("option:selected").val();
				var beizhu=$(this).find("td").eq(7).find("input").val();
				var cgcl={
						 cgId:undefined,       
						 clName:undefined,         
						 clType:undefined,         
						 clMode:undefined,         
						 clUnit:undefined,         
						 clNumber:undefined,       
						 clPrice:0,         
						 clMoney:0,         
						 clPrjSupplier:undefined,  
						 clGsSupplier:undefined,   
						 clDesc:undefined,         
				}
				cgcl.clName=clname;
				cgcl.clType=cltype;        
				cgcl.clMode=clxinghao;         
				cgcl.clUnit=danwei;         
				cgcl.clNumber=num;     
				cgcl.clPrice=danjia;         
				cgcl.clMoney=jine;         
				//cgcl.clPrjSupplier=xm;
				//cgcl.clGsSupplier=gs;
				cgcl.clDesc=beizhu; 
				cgclArr.push(cgcl)
		})
		var cghetongming=$("#cghetongming").val();
		var cgdNo=$("#cgdNo").val();
		var task_no=$("#task_no").val();
		var prjName=$("#prjName").val();
		var isdaigou=$("#isdaigou").val();
		var fbhetong=$("#fbhetong").val();
		var daigouType=$("#daigouType").val();
		var cghetongType=$("#cghetongType").val();
		var daigouMoney=$("#daigouMoney").val();
		var cghetongMoney=$("#cghetongMoney").val();
		var hetongjiafang=$("#hetongjiafang").val();
		var yifang=$("#yifang").val();
		var fukuangfangshi=$("#fukuangfangshi").val();
		var year=$("#year").val();
		var hetonggaishu=$("#hetonggaishu").val();
		var gaikuang=$("#gaikuang").val();
		var cg_bumen=$("#cg_bumen").val();
		var yunfei=$("#yunfei").val();
		var borrowNo=$("#borrow_no").val();
		var shuilv=$("#shuilv").val();
		var shuijin=$("#shuijin").val();
		if(borrowNo=="请选择"){
			borrowNo="";
		}
		if(cghetongming==''){
			toastr.error("采购合同名称不能为空");
			return;
		}
		/* if(cgdNo==''){
			toastr.error("采购单号不能为空");
			return;
		} */
		if(cghetongType==''){
			toastr.error("采购合同类型不能为空");
			return;
		}
		if(prjName==''){
			toastr.error("项目名称不能为空");
			return;
		} 
		/* if(task_no==''){
			toastr.error("任务单号不能为空");
			return;
		} */
		if(hetongjiafang==''){
			toastr.error("合同甲方名称不能为空");
			return;
		}
		if(yifang==''){
			toastr.error("乙方不能为空");
			return;
		}
		if(cghetongMoney==0){
			toastr.error("采购合同金额不能为0");
			return;
		}
		if($("#new_accessory").find('tbody tr').length<1 || $("#file").val()==''){
			toastr.error("采购合同文本附件为空")
			return;
		} 
		/* if($("#new_accessory1").find('tbody tr').length<1 || $("#file1").val()==''){
			toastr.error("法律顾问签字附件为空")
			return;
		} */
		var reg=/^\d+(\.\d{0,2})?$/;//只能输入数字或含两位小数的正则
		if(isdaigou=='是'){
			/* if(fbhetong==''){
				toastr.error("分包合同不能为空")
				return;
			}*/
			if(daigouMoney==''){
				 daigouMoney=0;
				}
			if(!reg.test(daigouMoney)){
				toastr.error("代购金额只能输入数字且只能有两位小数");
				return;
			} 
			 
		}
		if(yunfei==""||!reg.test(yunfei)){
			toastr.error("运费只能输入数字且只能有两位小数");
			return;
		} 
		var reg=/^[0-1]{1}([.]([0-9]){1,2})?$/;
		if(shuilv==''||!reg.test(shuilv)){
			toastr.error("税率不能为空且税率只能填0-1之间的小数且只能有两位小数")
			return;
		}
		if(shuijin==''){
			toastr.error("税金不能为空")
			return;
		}
		
		var cgContract={
				 cgId:undefined,   //编号                   
				 contractName:undefined,   // 采购合同名称      
				 cgNo:undefined,   //采购合同编号               
				 cgdNo:undefined,   //采购单号                
				 workNo:undefined,   // 任务单号              
				 prjName:undefined,   //项目名称              
				 isProgram:undefined,   // 是否代购           
				 programType:undefined,   // 代购类型         
				 cgcType:undefined,   // 采购合同类型           
				 programMoney:0,   // 代购金额         
				 cgContractMoney:0,   // 采购合同金额    
				 contractNameJia:undefined,   // 合同甲方名称   
				 contractNameYi:undefined,   // 乙方        
				 payMode:undefined,   // 付款方式             
				 contractSignTime:undefined,   // 采购合同签订时间
				 contractSummary:undefined,   // 采购合同概述   
				 workContent:undefined,   // 主要概况及工作内容    
				 makeTime:undefined,    //当前时间            
				 history:undefined,   //历史状态              
				 fbNo:undefined,   //关联的分保合同编号    
				 cgcl:undefined,
				 cgDepartment:undefined,
				 freight:0,
				 borrowNo:undefined,
				 shuilv:0,
				 shuijin:0,
		}
		cgContract.contractName=cghetongming;
		cgContract.cgdNo=cgdNo;
		cgContract.workNo=task_no;
		cgContract.prjName=prjName;
		cgContract.cgcType=cghetongType;
		cgContract.isProgram=isdaigou;
		cgContract.fbNo=fbhetong;
		cgContract.programType=daigouType;
		cgContract.programMoney=daigouMoney;
		cgContract.cgContractMoney=cghetongMoney;
		cgContract.contractNameJia=hetongjiafang;
		cgContract.contractNameYi=yifang;
		cgContract.payMode=fukuangfangshi;
		cgContract.contractSignTime=year;
		cgContract.contractSummary=hetonggaishu;
		cgContract.workContent=gaikuang;
		cgContract.cgcl=cgclArr;
		cgContract.cgDepartment=cg_bumen;
		cgContract.freight=yunfei;
		cgContract.borrowNo=borrowNo;
		cgContract.shuilv=shuilv;
		cgContract.shuijin=shuijin;
		
		var formData = new FormData();
  		formData.append("cgContract", JSON.stringify(cgContract));
  		
  		$("#new_accessory tbody").find("tr").each(function(){
  			formData.append("file", $(this).find("input")[0].files[0]);
  		})
  		
  		$("#new_accessory1 tbody").find("tr").each(function(){
  			formData.append("file1", $(this).find("input")[0].files[0]);
  		})
  		showMask();
  		$.ajax({
	  			type: 'POST',
	            url: getContextPath()+'/cgcontract/addCgContractSubmit',
	            data: formData,  
	            processData: false,
	            contentType: false,
	            dataType: 'json',
	            success: function (json) {
	            	hidMask();
	            	if(json=='0'){
		        		toastr.error("保存失败");
		        	}else{
		        		clearP();
		        		$("#myModal").modal("hide")
		        		lianjie=json.url;
		            	if(json.receiver!=null&&json.receiver.length>=1){
			        		  $("#tijiaogei").modal('show');
			        		  $("#tijiaoren tbody").empty("");
			        		  for(var i=0;i<json.receiver.length;i++){
			        			  $("#tijiaoren tbody").append('<tr><td>'
			        					  +'<input type="radio" name="tijiaorenming" data-id="'+json.receiver[i].userId+'" data-id2="'+json.receiver[i].omId+'" data-id3="'+json.receiver[i].dutyId+'">'
			        					  +'</td><td>'
			        					  +json.receiver[i].omName
			        					  +'</td><td>'
			        					  +json.receiver[i].dutyName
			        					  +'</td><td>'
			        					  +json.receiver[i].uName
			        					  +'</td></tr>');
			        		  }
			        	  }else if(json.receiver.length==1){
			        		  $.ajax({
			        	          type: 'POST',
			        	          url: getContextPath()+'/task/addTask4',
			        	          dataType: 'json',
			        	          data:{
			        	        	  url:json.url,
			        	        	  userId:json.receiver.userId,
			        	        	  uName:json.receiver.uName,
			        	        	  omName:json.receiver.omName,
			        	        	  dutyName:json.receiver.dutyName,
			        	        	  omId:json.receiver.omId,
			        	        	  dutyId:json.receiver.dutyId
			        	          },
			        	          success: function (json) {
			        	        	  toastr.success('提交成功');
			        	          }
			        	      }); 
			        	  }
		        	}
	            	/* if(json>0){
	            		$("#myModal").modal("hide")
	            		toastr.success("保存成功")
	            		//location.reload([true]);
	            	}else{
	            		toastr.error("保存失败")
	            	} */
	            }
	  		})
	}
	
	
	var modal2Tr;
  	function openModal2(obj){
  		modal2Tr=$(obj).parents("tr");
  		$("#myModal2").modal("show");
  	}
	
	function submitCgCancel(){
		var stopReason=$("#cancel_reason").val();
  		var data=$("#mainContent").DataTable().row(modal2Tr).data();
  		var cgName=data.contractName;
  		var cgDepartment=data.cgDepartment;
  		var id=data.cgId;
  		$.ajax({
				type: 'POST',
		        url: getContextPath()+'/cgcontract/submitCgCancel',
	            dataType: 'json',
		     	data: {
		     		cancelReason:stopReason,
		     		id:id,
		     		cgName:cgName,
		     		cgDepartment:cgDepartment,
		     	},  
		        success: function (json) {
		        	if(json=='0'){
		        		toastr.error("保存失败");
		        	}else{
		        		$("#myModal2").modal("hide");
		        		lianjie=json.url;
		            	if(json.receiver!=null&&json.receiver.length>=1){
			        		  $("#tijiaogei").modal('show');
			        		  $("#tijiaoren tbody").empty("");
			        		  for(var i=0;i<json.receiver.length;i++){
			        			  $("#tijiaoren tbody").append('<tr><td>'
			        					  +'<input type="radio" style="width:20px;height:20px;" name="tijiaorenming" data-id="'+json.receiver[i].userId+'" data-id2="'+json.receiver[i].omId+'" data-id3="'+json.receiver[i].dutyId+'">'
			        					  +'</td><td>'
			        					  +json.receiver[i].omName
			        					  +'</td><td>'
			        					  +json.receiver[i].dutyName
			        					  +'</td><td>'
			        					  +json.receiver[i].uName
			        					  +'</td></tr>');
			        		  }
			        	  }else if(json.receiver.length==1){
			        		  $.ajax({
			        	          type: 'POST',
			        	          url: getContextPath()+'/task/addTask4',
			        	          dataType: 'json',
			        	          data:{
			        	        	  url:json.url,
			        	        	  userId:json.receiver.userId,
			        	        	  uName:json.receiver.uName,
			        	        	  omName:json.receiver.omName,
			        	        	  dutyName:json.receiver.dutyName,
			        	        	  omId:json.receiver.omId,
			        	        	  dutyId:json.receiver.dutyId
			        	          },
			        	          success: function (json) {
			        	        	  toastr.success('提交成功');
			        	          }
			        	      }); 
			        	  }
		        	}
		        }
		})
	}
	
	var modal3Tr;
  	function openModal3(obj){
  		modal3Tr=$(obj).parents("tr");
  		var data=$("#mainContent").DataTable().row(modal3Tr).data();
  		$.ajax({
			type: 'POST',
	        url: getContextPath()+'/ContractReason/selectContractReasonById',
            dataType: 'json',
	     	data: {
	     		id:data.cgId
	     	},  
	        success: function (json) {
	        	$("#look_cancel_reason").val(json.stopReason);
	        	$("#myModal3").modal("show");
	        }
  		});
  		
  	}
  	
  	
  	function submitCgRestart(){
  		var stopReason=$("#cancel_reason").val();
  		var data=$("#mainContent").DataTable().row(modal2Tr).data();
  		var cgName=data.contractName;
  		var cgDepartment=data.cgDepartment;
  		var id=data.cgId;
  		$.ajax({
				type: 'POST',
		        url: getContextPath()+'/cgcontract/submitCgRestart',
	            dataType: 'json',
		     	data: {
		     		stopReason:stopReason,
		     		id:id,
		     		cgName:cgName,
		     		cgDepartment:cgDepartment,
		     	},  
		        success: function (json) {
		        	if(json=='0'){
		        		toastr.error("保存失败");
		        	}else{
		        		$("#myModal3").modal("hide");
		        		lianjie=json.url;
		            	if(json.receiver!=null&&json.receiver.length>=1){
			        		  $("#tijiaogei").modal('show');
			        		  $("#tijiaoren tbody").empty("");
			        		  for(var i=0;i<json.receiver.length;i++){
			        			  $("#tijiaoren tbody").append('<tr><td>'
			        					  +'<input type="radio" style="width:20px;height:20px;" name="tijiaorenming" data-id="'+json.receiver[i].userId+'" data-id2="'+json.receiver[i].omId+'" data-id3="'+json.receiver[i].dutyId+'">'
			        					  +'</td><td>'
			        					  +json.receiver[i].omName
			        					  +'</td><td>'
			        					  +json.receiver[i].dutyName
			        					  +'</td><td>'
			        					  +json.receiver[i].uName
			        					  +'</td></tr>');
			        		  }
			        	  }else if(json.receiver.length==1){
			        		  $.ajax({
			        	          type: 'POST',
			        	          url: getContextPath()+'/task/addTask4',
			        	          dataType: 'json',
			        	          data:{
			        	        	  url:json.url,
			        	        	  userId:json.receiver.userId,
			        	        	  uName:json.receiver.uName,
			        	        	  omName:json.receiver.omName,
			        	        	  dutyName:json.receiver.dutyName,
			        	        	  omId:json.receiver.omId,
			        	        	  dutyId:json.receiver.dutyId
			        	          },
			        	          success: function (json) {
			        	        	  toastr.success('提交成功');
			        	          }
			        	      }); 
			        	  }
		        	}
		        }
		})
  	}
	
	function submitPerson(){
  		var uid=$("input[name='tijiaorenming']:checked").attr("data-id");
  	  var omid=$("input[name='tijiaorenming']:checked").attr("data-id2");
  	  var dutyid=$("input[name='tijiaorenming']:checked").attr("data-id3");
  	  var bmmc=$("input[name='tijiaorenming']:checked").parent().next().text();
  	  var zw=$("input[name='tijiaorenming']:checked").parent().next().next().text();
  	  var uname=$("input[name='tijiaorenming']:checked").parent().next().next().next().text();
  	  //var uname=$("input[name='tijiaorenming']:checked").val();
	  if(uname==""||uname==null){
		  toastr.error("请选择审批人!")
		  return;
	  }
  	  $.ajax({
            type: 'POST',
            url: getContextPath()+'/task/addTask4',
            dataType: 'json',
            data:{
          	  url:lianjie,
          	  userId:uid,
          	  uName:uname,
          	  omName:bmmc,
          	  dutyName:zw,
          	  omId:omid,
          	  dutyId:dutyid
            },
            success: function (json) {
              $("#tijiaogei").modal("hide");
          	  toastr.success('提交成功');
            }
        });  
  	}
	
	
	$("#isdaigou").on("change",function(){
		var isdaigou=$("#isdaigou").val();
		if(isdaigou=="是"){
			$("#daigouType").html("");
			$("#daigouType").append("<option value='对方打款'>对方打款</option><option value='无息代购'>无息代购</option><option value='有息代购'>有息代购</option>")
			$("#fbbutton").attr("disabled",false);
			$("#daigouType").attr("disabled",false);
			$("#daigouMoney").attr("disabled",false);
		}else if(isdaigou=="否"){
			$("#daigouType").html("");
			$('#borrow_no').html("")
			$("#fbhetong").val("");
			$("#daigouMoney").val("0");
			$("#daigouType").append("<option value='无'>无</option>")
			$("#fbbutton").attr("disabled",true);
			$("#daigouType").attr("disabled",true);
			$("#daigouMoney").attr("disabled",true);
		}
	})
	
	$("#xgisdaigou").on("change",function(){
		var isdaigou=$("#xgisdaigou").val();
		if(isdaigou=="是"){
			$("#xgdaigouType").html("");
			$("#xgdaigouType").append("<option value='对方打款'>对方打款</option><option value='无息代购'>无息代购</option><option value='有息代购'>有息代购</option>")
			$("#xgchooseFbbutton").attr("disabled",false);
			$("#xgdaigouType").attr("disabled",false);
			$("#xgdaigouMoney").attr("disabled",false);
		}else if(isdaigou=="否"){
			$("#xgdaigouType").html("");
			$("#xgfbhetong").val("");
			$('#xgborrow_no').html("")
			$("#xgdaigouMoney").val("0");
			$("#xgdaigouType").append("<option value='无'>无</option>")
			$("#xgchooseFbbutton").attr("disabled",true);
			$("#xgdaigouType").attr("disabled",true);
			$("#xgdaigouMoney").attr("disabled",true);
		}
	})
	
	
	function xgselectBorrowByFbNo(obj,obj2){
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/cgcontract/getRateAndMoney',
            dataType: 'json',
            async:false,
            data: {
            	no:obj,
            },
            success: function (json) {
                $('#borrow_no').html("");
            	$('#borrow_no').append("<option data-id='请选择' value='请选择'>--请选择--</option>")
            	 $('#xgborrow_no').html("");
            	$('#xgborrow_no').append("<option data-id='请选择' value='请选择'>--请选择--</option>")
            	$("#borrow_no_bl").html('');
            	$('#borrow_no_bl').append("<option data-id='请选择' value='请选择'>--请选择--</option>")
                for(var i=0;i<json.length;i++){
                	 $('#borrow_no').append("<option data-id="+json[i].rate+" value="+json[i].bNo+">"+json[i].bNo+"</option>")
                	 $('#xgborrow_no').append("<option data-id="+json[i].rate+" value="+json[i].bNo+">"+json[i].bNo+"</option>")
                	 $('#borrow_no_bl').append("<option data-id="+json[i].rate+" value="+json[i].bNo+">"+json[i].bNo+"</option>")
                }
            	$('#xgborrow_no').val(obj2)
            	$('#borrow_no_bl').val(obj2)
                /* $('#borrow_no').trigger("change");
                $('#xgborrow_no').trigger("change"); */
            }
        });
    }
	
	//修改回显
	var editId;
	var xm;
	var gs;
	function checkCgC(obj){
		var dom=$(obj).parents('tr');
		var data=$('#mainContent').DataTable().row(dom).data();
		//console.log(data)
		editId=data.cgId;
		$.ajax({
			type:"post",
			url:getContextPath()+"/cgcontract/selectCgContractById",
			dataType:"json",
			async:false,
			data:{
				id:editId,
			},
			success:function(json){
				//console.log(json)
				$("#xgcghetongming").val(json.contractName);
				$("#xgcgNo").val(json.cgNo)
				$("#xgcgdNo").val(json.cgdNo)
				$("#xgtask_no").val(json.workNo);
				$("#xgprjName").val(json.prjName); 
				//huixianPrjNameAndNo(json.cgdNo,json.prjName,json.workNo);
        		
				$("#xgisdaigou").val(json.isProgram);
				if(json.isProgram=="否"){
					$("#xgchooseFbbutton").attr("disabled",true);
					$("#xgdaigouType").attr("disabled",true);
					$("#xgdaigouMoney").attr("disabled",true);
				}else if(json.isProgram=="是"){
					$("#xgdaigouType").html("");
					$("#xgdaigouType").append("<option value='对方打款'>对方打款</option><option value='无息代购'>无息代购</option><option value='有息代购'>有息代购</option>")
					$("#xgchooseFbbutton").attr("disabled",false);
					$("#xgdaigouType").attr("disabled",false);
					$("#xgdaigouMoney").attr("disabled",false);
				}
				$("#xgfbhetong").val(json.fbNo);
				$("#xgdaigouType").val(json.programType);
				$("#xgcghetongType").val(json.cgcType);
				$("#xgdaigouMoney").val(json.programMoney);
				$("#xgcghetongMoney").val(json.cgContractMoney);
				$("#xghetongjiafang").val(json.contractNameJia);
				$("#xgyifang").val(json.contractNameYi).select2();
				$("#xgfukuangfangshi").val(json.payMode);
				$("#xgyear").val(json.contractSignTime);
				$("#xghetonggaishu").val(json.contractSummary);
				$("#xggaikuang").val(json.workContent);
				$("#xgcg_bumen").val(json.cgDepartment);
				$("#xgyunfei").val(json.freight)
				//$("#xgborrow_no").val(json.borrowNo)
				xgselectBorrowByFbNo(json.fbNo,json.borrowNo)
				
				$("#xgshuilv").val(json.shuilv);
				$("#xgshuijin").val(json.shuijin);
				/* $("#xgcailiaobiaoDiv").empty()
				$("#xgcailiaobiaoDiv").append(
					// "<button type='button' id='xgyijianjiesuanMoney' onclick='yijianjiesuan(2)' class='btn btn-primary' >一键结算金额</button>"+ 
        				"<table  class='table table-bordered table-condensed' id='xgcailiaobiao'>"+
                    	"<thead>"+
                        	"<tr>"+
                            	"<th>材料名称</th>"+
                            	"<th>材料类型</th>"+
	                            "<th>材料型号</th>"+
	                            "<th style='width:6%;'>单位</th>"+
	                            "<th>数量</th>"+
	                            "<th style='width:8%;'>单价</th>"+
	                            "<th style='width:8%;'>金额</th>"+
	                            "<th>项目部推荐供应商</th>"+
	                            "<th>公司确定供应商</th>"+
	                            "<th>备注</th>"+
	                            "<th>操作</th>"+
                        	"</tr>"+
                    	"</thead>"+
                    	"<tbody>"+
                    	"</tbody>"+
                    "</table>"
                    ) */
				$("#edit_cl_table tbody").empty();
				if(json.cgcl!=null){
					for(var k=0;k<json.cgcl.length;k++){
						length+=1;
                   		$("#edit_cl_table tbody").append("<tr><td>"
           		  				+'<input type="text" style="width:100%;" class="form-control"  value='+json.cgcl[k].clName+' >'
           		  				+"</td><td>"
           		  				+'<select style="width:100%;" class="form-control" id="cl_type'+k+'"></select>'
           		  				+"</td><td>"
           		  				+'<input type="text" style="width:100%;" class="form-control"  value='+json.cgcl[k].clMode+' >' 
           		  				+"</td><td>"
           		  				+'<select class="form-control"style="width:100%;" id=xgcl_danwei'+k+'>'
										+'</select>'
           		  				+"</td><td>"
           		  				+'<input type="text" style="width:100%;" class="form-control"  value='+json.cgcl[k].clNumber+' >'
           		  				+"</td><td>"
           		  				+'<input type="text" style="width:100%;" class="form-control"  value='+json.cgcl[k].clPrice+'  >'
           		  				+"</td><td>"
           		  				+'<input type="text" style="width:100%;" class="form-control" value='+json.cgcl[k].clMoney+' >'
           		  				+"</td><td>"
           		  			/*+'<select style="width:100%;" class="form-control" id=edit_department_tj'+k+'></select>'
           		  				+"</td><td>"
           		  				 +'<select style="width:100%;" class="form-control" id=edit_company_sure'+k+'></select>'
           		  				+"</td><td>" */
           		  				+'<input type="text" style="width:100%;" class="form-control"  value='+json.cgcl[k].clDesc+' >'
           		  				+"</td><td>"
           		  				+'<button type="button" class="btn btn-danger" onclick="removeThis(this)">删除</button>'
           		  				+"</td></tr>")
           		  				xm=json.cgcl[k].clPrjSupplier
								gs=json.cgcl[k].clGsSupplier
           		  				initClType(json.cgcl[k].clType,k);
           		  				//initName1(json.cgcl[k].clPrjSupplier,k);
                   				//initName2(json.cgcl[k].clGsSupplier,k);
                   				//$("#cl_danwei"+k).val(json.cgcl[k].clUnit);
                   				initMaterialCompany(json.cgcl[k].clUnit,k)
           		  				
                    	} 
				}
				
			}
		}) 
	}
	
	
	
	function huixianPrjNameAndNo(obj1,obj2,obj3){
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/PrjMaterialBuy/selectBuyByIds',
            dataType: 'json',
            data: {
            	ids:obj1
            },
            success: function (json) {
            	$("#xgprjName").empty()
            	$("#xgtask_no").empty()
            	for(var i=0;i<json.length;i++){
            		$("#xgprjName").append("<option value="+json[i].applyPrj+">"+json[i].applyPrj+"</option>")
            		$("#xgtask_no").append("<option value="+json[i].applyCode+">"+json[i].applyCode+"</option>")
            	}
            	$("#xgprjName").val(obj2)
            	$("#xgtask_no").val(obj3)
            }
		});
		
	}
	
	
	//删除附件
	function deletefile(obj){
		var id=$(obj).attr("data1");
		var name=$(obj).parents("tr").find("td").eq(1).find("input").val();
		var url=$(obj).attr("data2");
		$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/cgcontract/deleteAccessory',
	        dataType: 'json',
	        data: {
	        	aId:id,
	        	acName:name,
	        	acUrl:url
	        },
	        success: function (json) {
	        	if(json==0){
	        		toastr.error("删除失败");
	        	}else{
	        		toastr.success("删除成功");
	        		$(obj).parent().parent().remove();
	        		//$('#change').modal('hide');
	        	}
	        }
		});
	}
	
	
	//修改保存
	function checksaveCgC(){
		
		//保存材料信息
		var xgcgclArr=new Array();
		$("#xgcailiaobiaoDiv table").find("tbody").find("tr").each(function(){
				var clname=$(this).find("td").eq(0).find("input").val();
				var cltype=$(this).find("td").eq(1).find("option:selected").val();
				var clxinghao=$(this).find("td").eq(2).find("input").val();
				var danwei=$(this).find("td").eq(3).find("option:selected").val();
				var num=$(this).find("td").eq(4).find("input").val();
				var danjia=$(this).find("td").eq(5).find("input").val();
				var jine=$(this).find("td").eq(6).find("input").val();
				//var xm=$(this).find("td").eq(7).find("option:selected").val();
				//var gs=$(this).find("td").eq(8).find("option:selected").val();
				var beizhu=$(this).find("td").eq(7).find("input").val();
				var cgcl={
						 cgId:undefined,       
						 clName:undefined,         
						 clType:undefined,         
						 clMode:undefined,         
						 clUnit:undefined,         
						 clNumber:undefined,       
						 clPrice:0,         
						 clMoney:0,         
						 clPrjSupplier:undefined,  
						 clGsSupplier:undefined,   
						 clDesc:undefined,         
				}
				cgcl.clName=clname;
				cgcl.clType=cltype;        
				cgcl.clMode=clxinghao;         
				cgcl.clUnit=danwei;         
				cgcl.clNumber=num;     
				cgcl.clPrice=danjia;         
				cgcl.clMoney=jine;         
				//cgcl.clPrjSupplier=xm;
				//cgcl.clGsSupplier=gs;
				cgcl.clDesc=beizhu; 
				xgcgclArr.push(cgcl)
		})
		$("#edit_cl_table tbody").find("tr").each(function(){
				var clname=$(this).find("td").eq(0).find("input").val();
				var cltype=$(this).find("td").eq(1).find("option:selected").val();
				var clxinghao=$(this).find("td").eq(2).find("input").val();
				var danwei=$(this).find("td").eq(3).find("option:selected").val();
				var num=$(this).find("td").eq(4).find("input").val();
				var danjia=$(this).find("td").eq(5).find("input").val();
				var jine=$(this).find("td").eq(6).find("input").val();
				//var xm=$(this).find("td").eq(7).find("option:selected").val();
				//var gs=$(this).find("td").eq(8).find("option:selected").val();
				var beizhu=$(this).find("td").eq(7).find("input").val();
				var cgcl={
						 cgId:undefined,       
						 clName:undefined,         
						 clType:undefined,         
						 clMode:undefined,         
						 clUnit:undefined,         
						 clNumber:undefined,       
						 clPrice:0,         
						 clMoney:0,         
						 clPrjSupplier:undefined,  
						 clGsSupplier:undefined,   
						 clDesc:undefined,         
				}
				cgcl.clName=clname;
				cgcl.clType=cltype;        
				cgcl.clMode=clxinghao;         
				cgcl.clUnit=danwei;         
				cgcl.clNumber=num;     
				cgcl.clPrice=danjia;         
				cgcl.clMoney=jine;         
				//cgcl.clPrjSupplier=xm;
				//cgcl.clGsSupplier=gs;
				cgcl.clDesc=beizhu; 
				xgcgclArr.push(cgcl)
		})
		var xgcghetongming=$("#xgcghetongming").val();
		var xgcgNo=$("#xgcgNo").val();
		var xgcgdNo=$("#xgcgdNo").val();
		var xgtask_no=$("#xgtask_no").val();
		var xgprjName=$("#xgprjName").val();
		var xgisdaigou=$("#xgisdaigou").val();
		var xgfbhetong=$("#xgfbhetong").val();
		var xgdaigouType=$("#xgdaigouType").val();
		var xgcghetongType=$("#xgcghetongType").val();
		var xgdaigouMoney=$("#xgdaigouMoney").val();
		var xgcghetongMoney=$("#xgcghetongMoney").val();
		var xghetongjiafang=$("#xghetongjiafang").val();
		var xgyifang=$("#xgyifang").val();
		var xgfukuangfangshi=$("#xgfukuangfangshi").val();
		var xgyear=$("#xgyear").val();
		var xghetonggaishu=$("#xghetonggaishu").val();
		var xggaikuang=$("#xggaikuang").val();
		var xgcg_bumen=$("#xgcg_bumen").val()
		var xgyunfei=$("#xgyunfei").val();
		var xgborrowNo=$("#xgborrow_no").val();
		var xgshuilv=$("#xgshuilv").val();
		var xgshuijin=$("#xgshuijin").val();
		
		if(xgborrowNo=="请选择"){
			xgborrowNo="";
		}
		if(xgcghetongming==''){
			toastr.error("采购合同名称为空");
			return;
		}
		/* if(xgcgdNo==''){
			toastr.error("采购单号不能为空");
			return;
		} */
		/* if(xgcghetongType==''){
			toastr.error("采购合同类型不能为空");
			return;
		}
		if(xgprjName==''){
			toastr.error("项目名称不能为空");
			return;
		} 
		if(xghetongjiafang==''){
			toastr.error("合同甲方名称不能为空");
			return;
		}
		if(xgyifang==''){
			toastr.error("乙方不能为空");
			return;
		}
		if(xgcghetongMoney==0){
			toastr.error("采购合同金额不能为0");
			return;
		}
		if($("#edit_accessory").find('tbody tr').length<1 || $("#xgfile").val()==''){
			toastr.error("采购合同文本附件为空")
			return;
		} */
		/* if($("#edit_accessory1").find('tbody tr').length<1 || $("#xgfile1").val()==''){
			toastr.error("法律顾问签字附件为空")
			return;
		} */
		/* var reg=/^\d+(\.\d{0,2})?$/;//只能输入数字或含两位小数的正则
		if(xgisdaigou=='是'){
			if(xgfbhetong==''){
				toastr.error("分包合同不能为空")
				return;
			}
			if(!reg.test(xgdaigouMoney)){
				toastr.error("代购金额只能输入数字且只能有两位小数");
				return;
			}
		} */
		/* if(xgyunfei==""||!reg.test(xgyunfei)){
			toastr.error("运费只能输入数字且只能有两位小数");
			return;
		} */
		
		var cgContract={
				 cgId:undefined,   //编号                   
				 contractName:undefined,   // 采购合同名称      
				 cgNo:undefined,   //采购合同编号               
				 cgdNo:undefined,   //采购单号                
				 workNo:undefined,   // 任务单号              
				 prjName:undefined,   //项目名称              
				 isProgram:undefined,   // 是否代购           
				 programType:undefined,   // 代购类型         
				 cgcType:undefined,   // 采购合同类型           
				 programMoney:0,   // 代购金额         
				 cgContractMoney:0,   // 采购合同金额    
				 contractNameJia:undefined,   // 合同甲方名称   
				 contractNameYi:undefined,   // 乙方        
				 payMode:undefined,   // 付款方式             
				 contractSignTime:undefined,   // 采购合同签订时间
				 contractSummary:undefined,   // 采购合同概述   
				 workContent:undefined,   // 主要概况及工作内容    
				 makeTime:undefined,    //当前时间            
				 history:undefined,   //历史状态              
				 fbNo:undefined,   //关联的分保合同编号    
				 cgcl:undefined,
				 cgDepartment:undefined,
				 freight:0,
				 borrowNo:undefined,
				 shuilv:0,
				 shuijin:0,
		}
		cgContract.contractName=xgcghetongming;
		cgContract.cgNo=xgcgNo;
		cgContract.cgdNo=xgcgdNo;
		cgContract.workNo=xgtask_no;
		cgContract.prjName=xgprjName;
		cgContract.cgcType=xgcghetongType;
		cgContract.isProgram=xgisdaigou;
		cgContract.fbNo=xgfbhetong;
		cgContract.programType=xgdaigouType;
		cgContract.programMoney=xgdaigouMoney;
		cgContract.cgContractMoney=xgcghetongMoney;
		cgContract.contractNameJia=xghetongjiafang;
		cgContract.contractNameYi=xgyifang;
		cgContract.payMode=xgfukuangfangshi;
		cgContract.contractSignTime=xgyear;
		cgContract.contractSummary=xghetonggaishu;
		cgContract.workContent=xggaikuang;
		cgContract.cgcl=xgcgclArr;
		cgContract.cgDepartment=xgcg_bumen;
		cgContract.freight=xgyunfei;
		cgContract.borrowNo=xgborrowNo;
		cgContract.shuilv=xgshuilv;
		cgContract.shuijin=xgshuijin;
		
		var formData = new FormData();
 		formData.append("cgContract", JSON.stringify(cgContract));
 		
 		$("#edit_accessory tbody").find("tr").each(function(){
 			formData.append("file", $(this).find("input")[0].files[0]);
 		})
 		
 		$("#edit_accessory1 tbody").find("tr").each(function(){
 			formData.append("file1", $(this).find("input")[0].files[0]);
 		})
		showMask();
		 $.ajax({
	            type: 'POST',
	            url: getContextPath()+'/cgcontract/updateCgContractSave',
	            data: formData,  
	            processData: false,
	            contentType: false,
	            dataType: 'json',
	            success: function (json) {
	            	if(json==0){
						toastr.error("修改失败")
					}else if(json>0){
						//location.reload([true]);
						toastr.success("修改成功")
						$("#change").modal("hide")
					}
	            	hidMask();
	            }
	        });  
			
	}
	
	
	//修改提交
	function checksubmitCgC(){
		//保存材料信息
		var xgcgclArr=new Array();
		$("#xgcailiaobiaoDiv table").find("tbody").find("tr").each(function(){
				var clname=$(this).find("td").eq(0).find("input").val();
				var cltype=$(this).find("td").eq(1).find("option:selected").val();
				var clxinghao=$(this).find("td").eq(2).find("input").val();
				var danwei=$(this).find("td").eq(3).find("option:selected").val();
				var num=$(this).find("td").eq(4).find("input").val();
				var danjia=$(this).find("td").eq(5).find("input").val();
				var jine=$(this).find("td").eq(6).find("input").val();
				//var xm=$(this).find("td").eq(7).find("option:selected").val();
				//var gs=$(this).find("td").eq(8).find("option:selected").val();
				var beizhu=$(this).find("td").eq(7).find("input").val();
				var cgcl={
						 cgId:undefined,       
						 clName:undefined,         
						 clType:undefined,         
						 clMode:undefined,         
						 clUnit:undefined,         
						 clNumber:undefined,       
						 clPrice:0,         
						 clMoney:0,         
						 clPrjSupplier:undefined,  
						 clGsSupplier:undefined,   
						 clDesc:undefined,         
				}
				cgcl.clName=clname;
				cgcl.clType=cltype;        
				cgcl.clMode=clxinghao;         
				cgcl.clUnit=danwei;         
				cgcl.clNumber=num;     
				cgcl.clPrice=danjia;         
				cgcl.clMoney=jine;         
				//cgcl.clPrjSupplier=xm;
				//cgcl.clGsSupplier=gs;
				cgcl.clDesc=beizhu; 
				xgcgclArr.push(cgcl)
		})
		$("#edit_cl_table tbody").find("tr").each(function(){
				var clname=$(this).find("td").eq(0).find("input").val();
				var cltype=$(this).find("td").eq(1).find("option:selected").val();
				var clxinghao=$(this).find("td").eq(2).find("input").val();
				var danwei=$(this).find("td").eq(3).find("option:selected").val();
				var num=$(this).find("td").eq(4).find("input").val();
				var danjia=$(this).find("td").eq(5).find("input").val();
				var jine=$(this).find("td").eq(6).find("input").val();
				//var xm=$(this).find("td").eq(7).find("option:selected").val();
				//var gs=$(this).find("td").eq(8).find("option:selected").val();
				var beizhu=$(this).find("td").eq(7).find("input").val();
				var cgcl={
						 cgId:undefined,       
						 clName:undefined,         
						 clType:undefined,         
						 clMode:undefined,         
						 clUnit:undefined,         
						 clNumber:undefined,       
						 clPrice:0,         
						 clMoney:0,         
						 clPrjSupplier:undefined,  
						 clGsSupplier:undefined,   
						 clDesc:undefined,         
				}
				cgcl.clName=clname;
				cgcl.clType=cltype;        
				cgcl.clMode=clxinghao;         
				cgcl.clUnit=danwei;         
				cgcl.clNumber=num;     
				cgcl.clPrice=danjia;         
				cgcl.clMoney=jine;         
				//cgcl.clPrjSupplier=xm;
				//cgcl.clGsSupplier=gs;
				cgcl.clDesc=beizhu; 
				xgcgclArr.push(cgcl)
		})
		var xgcghetongming=$("#xgcghetongming").val();
		var xgcgNo=$("#xgcgNo").val();
		var xgcgdNo=$("#xgcgdNo").val();
		var xgtask_no=$("#xgtask_no").val();
		var xgprjName=$("#xgprjName").val();
		var xgisdaigou=$("#xgisdaigou").val();
		var xgfbhetong=$("#xgfbhetong").val();
		var xgdaigouType=$("#xgdaigouType").val();
		var xgcghetongType=$("#xgcghetongType").val();
		var xgdaigouMoney=$("#xgdaigouMoney").val();
		var xgcghetongMoney=$("#xgcghetongMoney").val();
		var xghetongjiafang=$("#xghetongjiafang").val();
		var xgyifang=$("#xgyifang").val();
		var xgfukuangfangshi=$("#xgfukuangfangshi").val();
		var xgyear=$("#xgyear").val();
		var xghetonggaishu=$("#xghetonggaishu").val();
		var xggaikuang=$("#xggaikuang").val();
		var xgcg_bumen=$("#xgcg_bumen").val()
		var xgyunfei=$("#xgyunfei").val();
		var xgborrowNo=$("#xgborrow_no").val();
		var xgshuilv=$("#xgshuilv").val();
		var xgshuijin=$("#xgshuijin").val();
		
		if(xgborrowNo=="请选择"){
			xgborrowNo="";
		}
		
		if(xgcghetongming==''){
			toastr.error("采购合同名称为空");
			return;
		}
		/* if(xgcgdNo==''){
			toastr.error("采购单号不能为空");
			return;
		} */
		if(xgcghetongType==''){
			toastr.error("采购合同类型不能为空");
			return;
		}
		if(xgprjName==''){
			toastr.error("项目名称不能为空");
			return;
		} 
		/* if(xgtask_no==''){
			toastr.error("任务单号不能为空");
			return;
		} */
		if(xghetongjiafang==''){
			toastr.error("合同甲方名称不能为空");
			return;
		}
		if(xgyifang==''){
			toastr.error("乙方不能为空");
			return;
		}
		/* if(xgcghetongMoney==''){
			toastr.error("采购合同金额为空");
			return;
		} */
		if(xgcghetongMoney==0){
			toastr.error("采购合同金额不能为0");
			return;
		}
		if($("#edit_accessory").find('tbody tr').length<1 || $("#xgfile").val()==''){
			toastr.error("采购合同文本附件为空")
			return;
		}
		/* if($("#edit_accessory1").find('tbody tr').length<1 || $("#xgfile1").val()==''){
			toastr.error("法律顾问签字附件为空")
			return;
		} */
		var reg=/^\d+(\.\d{0,2})?$/;//只能输入数字或含两位小数的正则
		if(xgisdaigou=='是'){
			/* if(xgfbhetong==''){
				toastr.error("分包合同不能为空")
				return;
			}*/
			if(xgdaigouMoney==''){
				xgdaigouMoney=0;
				}
			if(!reg.test(xgdaigouMoney)){
				toastr.error("代购金额只能输入数字且只能有两位小数");
				return;
			} 
			
		}
		if(xgyunfei==""||!reg.test(xgyunfei)){
			toastr.error("运费只能输入数字且只能有两位小数");
			return;
		} 
		var reg=/^[0-1]{1}([.]([0-9]){1,2})?$/;
		if(xgshuilv==''||!reg.test(xgshuilv)){
			toastr.error("税率不能为空且税率只能填0-1之间的小数且只能有两位小数")
			return;
		}
		if(xgshuijin==''){
			toastr.error("税金不能为空")
			return;
		}
		
		var cgContract={
				 cgId:undefined,   //编号                   
				 contractName:undefined,   // 采购合同名称      
				 cgNo:undefined,   //采购合同编号               
				 cgdNo:undefined,   //采购单号                
				 workNo:undefined,   // 任务单号              
				 prjName:undefined,   //项目名称              
				 isProgram:undefined,   // 是否代购           
				 programType:undefined,   // 代购类型         
				 cgcType:undefined,   // 采购合同类型           
				 programMoney:0,   // 代购金额         
				 cgContractMoney:0,   // 采购合同金额    
				 contractNameJia:undefined,   // 合同甲方名称   
				 contractNameYi:undefined,   // 乙方        
				 payMode:undefined,   // 付款方式             
				 contractSignTime:undefined,   // 采购合同签订时间
				 contractSummary:undefined,   // 采购合同概述   
				 workContent:undefined,   // 主要概况及工作内容    
				 makeTime:undefined,    //当前时间            
				 history:undefined,   //历史状态              
				 fbNo:undefined,   //关联的分保合同编号    
				 cgcl:undefined,
				 cgDepartment:undefined,
				 freight:0,
				 borrowNo:undefined,
				 shuilv:0,
				 shuijin:0,
		}
		cgContract.contractName=xgcghetongming;
		cgContract.cgNo=xgcgNo;
		cgContract.cgdNo=xgcgdNo;
		cgContract.workNo=xgtask_no;
		cgContract.prjName=xgprjName;
		cgContract.cgcType=xgcghetongType;
		cgContract.isProgram=xgisdaigou;
		cgContract.fbNo=xgfbhetong;
		cgContract.programType=xgdaigouType;
		cgContract.programMoney=xgdaigouMoney;
		cgContract.cgContractMoney=xgcghetongMoney;
		cgContract.contractNameJia=xghetongjiafang;
		cgContract.contractNameYi=xgyifang;
		cgContract.payMode=xgfukuangfangshi;
		cgContract.contractSignTime=xgyear;
		cgContract.contractSummary=xghetonggaishu;
		cgContract.workContent=xggaikuang;
		cgContract.cgcl=xgcgclArr;
		cgContract.cgDepartment=xgcg_bumen;
		cgContract.freight=xgyunfei;
		cgContract.borrowNo=xgborrowNo;
		cgContract.shuilv=xgshuilv;
		cgContract.shuijin=xgshuijin;
		
		var formData = new FormData();
 		formData.append("cgContract", JSON.stringify(cgContract));
 		
 		$("#edit_accessory tbody").find("tr").each(function(){
 			formData.append("file", $(this).find("input")[0].files[0]);
 		})
 		
 		$("#edit_accessory1 tbody").find("tr").each(function(){
 			formData.append("file1", $(this).find("input")[0].files[0]);
 		})
		
		$.ajax({
	            type: 'POST',
	            url: getContextPath()+'/cgcontract/updateCgContractSubmit',
	            data: formData,  
	            processData: false,
	            contentType: false,
	            dataType: 'json',
	            success: function (json) {
	            	if(json=='0'){
		        		toastr.error("保存失败");
		        	}else{
		        		$("#change").modal("hide");
		        		lianjie=json.url;
		            	if(json.receiver!=null&&json.receiver.length>=1){
			        		  $("#tijiaogei").modal('show');
			        		  $("#tijiaoren tbody").empty("");
			        		  for(var i=0;i<json.receiver.length;i++){
			        			  $("#tijiaoren tbody").append('<tr><td>'
			        					  +'<input type="radio" style="width:20px;height:20px;" name="tijiaorenming" data-id="'+json.receiver[i].userId+'" data-id2="'+json.receiver[i].omId+'" data-id3="'+json.receiver[i].dutyId+'">'
			        					  +'</td><td>'
			        					  +json.receiver[i].omName
			        					  +'</td><td>'
			        					  +json.receiver[i].dutyName
			        					  +'</td><td>'
			        					  +json.receiver[i].uName
			        					  +'</td></tr>');
			        		  }
			        	  }else if(json.receiver.length==1){
			        		  $.ajax({
			        	          type: 'POST',
			        	          url: getContextPath()+'/task/addTask4',
			        	          dataType: 'json',
			        	          data:{
			        	        	  url:json.url,
			        	        	  userId:json.receiver.userId,
			        	        	  uName:json.receiver.uName,
			        	        	  omName:json.receiver.omName,
			        	        	  dutyName:json.receiver.dutyName,
			        	        	  omId:json.receiver.omId,
			        	        	  dutyId:json.receiver.dutyId
			        	          },
			        	          success: function (json) {
			        	        	  toastr.success('提交成功');
			        	          }
			        	      }); 
			        	  }
		        	}
	            	 /* if(json==0){
						toastr.error("修改失败")
					}else if(json>0){
						//location.reload([true]);
						toastr.success("修改成功")
						$("#change").modal("hide")
						initTable();
					}  */
	            }
	        }); 
	}
	
	
	
	//查看详细信息
	var cgNo;
	var LookCgId;
	function lookCgC(obj){
		var dom=$(obj).parents('tr');
		var data=$('#mainContent').DataTable().row(dom).data();
		cgNo=data.cgNo;
		LookCgId=data.cgId;
		initTableHistory();
		
		$.ajax({
			type:"post",
			url:getContextPath()+"/cgcontract/selectCgContractById",
			dataType:"json",
			data:{
				id:data.cgId,
			},
			success:function(json){
				$("#lookcghetongming").text(json.contractName);
				$("#lookcgNo").text(json.cgNo);
				$("#lookcgdNo").text(json.cgdNo);
				$("#lookcgbianhao").text(json.cgId)
				
				$("#looktask_no").html("");
				if(json.workNo==""||json.workNo==null){
					$("#looktask_no").text(json.workNo);
				}else{
					var taskprjNoClick = '<a href="../chankanxiangqing/taskDetails.html?prjNo='
						+json.workNo
						+'" target="_blank" style="color:blue;">'+json.workNo+'</a>';		
					$("#looktask_no").append(taskprjNoClick);
				}
				
				//$("#looktask_no").text(json.workNo);
				$("#lookprjName").html("")
				if(json.workNo==""||json.workNo==null){
					$("#lookprjName").text(json.prjName);
				}else{
					var taskprjNoClick = '<a href="../chankanxiangqing/taskDetails.html?prjNo='
		    			+json.workNo
		    			+'" target="_blank" style="color:blue;">'+json.prjName+'</a>';		
					$("#lookprjName").append(taskprjNoClick);
				}
				//$("#lookprjName").text(json.prjName)
				$("#lookisdaigou").text(json.isProgram);
				$("#lookfbhetong").html("")
				if(json.fbNo==""||json.fbNo==null){
					$("#lookfbhetong").append('');
				}else{
					var fbprjNoClick = '<a href="../chankanxiangqing/fbContractDetails.html?fbNo='
		    			+json.fbNo
		    			+'" target="_blank" style="color:blue;">'+json.fbNo+'</a>';		
					$("#lookfbhetong").append(fbprjNoClick);
				}
				//$("#lookfbhetong").text(json.fbNo==""?"无":json.fbNo);
				$("#lookborrow_no").html("")
				if(json.borrowNo==""||json.borrowNo==null){
					$("#lookborrow_no").append("");
				}else{
					var borrowprjNoClick = '<a href="../chankanxiangqing/borrowDetails.html?borrowNo='
		    			+json.borrowNo
		    			+'" target="_blank" style="color:blue;">'+json.borrowNo+'</a>';		
					$("#lookborrow_no").append(borrowprjNoClick);
				}
				//$("#lookborrow_no").text(json.borrowNo==''||json.borrowNo==null?"无":json.borrowNo)
				$("#lookdaigouType").text(json.programType==null?"无":json.programType),
				$("#lookcgType").text(json.cgcType);
				$("#lookdaigouMoney").text(json.programMoney==null?"":json.programMoney);
				$("#lookcghetongMoney").text(json.cgContractMoney==null?"":json.cgContractMoney);
				$("#lookjiafang").text(json.contractNameJia==null?"":json.contractNameJia);
				$("#lookyifang").text(json.spName==null?"":json.spName);
				$("#lookfukuanfangshi").text(json.payMode==null?"":json.payMode);
				$("#lookyear").text(json.contractSignTime==null?"":json.contractSignTime);
				$("#lookcghetonggaishu").text(json.contractSummary==null?"":json.contractSummary);
				$("#lookgaikuang").text(json.workContent==null?"":json.workContent);
				$("#lookcg_bumen").text(json.cgDepartment);
				$("#lookyunfei").text(json.freight==null?"":json.freight);
				$("#look_shuilv").text(json.shuilv==null?"":json.shuilv);
				$("#look_shuijin").text(json.shuijin==null?"":json.shuijin);
				
				$("#lookcailiaobiaoDiv").empty();
				$("#lookcailiaobiaoDiv").append(
        				"<table  class='table table-bordered table-condensed' id='lookcailiaobiao'>"+
                    	"<thead>"+
                        	"<tr>"+
                            	"<th>名称</th>"+
                            	"<th>类型</th>"+
	                            "<th>型号</th>"+
	                            "<th style='width:6%;'>单位</th>"+
	                            "<th>数量</th>"+
	                            "<th style='width:8%;'>单价</th>"+
	                            "<th style='width:8%;'>金额</th>"+
	                            /*"<th>项目部推荐供应商</th>"+
	                             "<th>公司确定供应商</th>"+ */
	                            "<th>备注</th>"+
                        	"</tr>"+
                    	"</thead>"+
                    	"<tbody>"+
                    	"</tbody>"+
                    "</table>"
                    )
				if(json.cgcl!=null){
					for(var k=0;k<json.cgcl.length;k++){
                   		$("#lookcailiaobiao tbody").append("<tr><td style='width:10%;'>"
           		  				+''+(json.cgcl[k].clName==null?"":json.cgcl[k].clName)+''
           		  				+"</td><td style='width:9%;'>"
           		  				+''+(json.cgcl[k].clType==null?"":json.cgcl[k].clType)+''
           		  				+"</td><td style='width:9%;'>"
           		  				+''+(json.cgcl[k].clMode==null?"":json.cgcl[k].clMode)+'' 
           		  				+"</td><td style='width:9%;'>"
           		  				+''+(json.cgcl[k].clUnit==null?"":json.cgcl[k].clUnit)+''
           		  				+"</td><td style='width:9%;'>"
           		  				+''+(json.cgcl[k].clNumber==null?"":json.cgcl[k].clNumber)+''
           		  				+"</td><td style='width:9%;'>"
           		  				+''+(json.cgcl[k].clPrice==null?"":json.cgcl[k].clPrice)+''
           		  				+"</td><td style='width:9%;'>"
           		  				+''+(json.cgcl[k].clMoney==null?"":json.cgcl[k].clMoney)+''
           		  				+"</td><td style='width:9%;'>"
           		  			/*+''+(json.cgcl[k].clspName1==null?"":json.cgcl[k].clspName1)+''
           		  				+"</td><td style='width:10%;'>"
           		  				 +''+(json.cgcl[k].clspName2==null?"":json.cgcl[k].clspName2)+''
           		  				+"</td><td style='width:9%;'>" */
           		  				+''+(json.cgcl[k].clDesc==null?"":json.cgcl[k].clDesc)+''
           		  				+"</td></tr>")
                    	} 
				}
				
			}
		})
		
		$.ajax({
			type:"post",
			url:getContextPath()+"/cgcontract/selectAccessoryById",
			dataType:"json",
			async:false,
			data:{
				id:data.cgId,
			},
			success:function(json){
				$("#look_all_table").empty();
				//$("#look_all_table1").empty();
	            for(var i=0;i<json.length;i++){
	            	   if(json[i].aType=="采购合同文本"){
		            	   $("#look_all_table").append("<tr>"+
	      	   										"<td style='width:20%;'>采购合同文本</td>"+
	      	   										"<td colspan='3'><a href='"+getLocalPath()+"/oa_file/"+json[i].acUrl+"' target='view_window' style='color:blue'>"+json[i].acName+"</a></td>"+
							            	    	/* "<td colspan='2'><input type='text' class='form-control' style='width:100%;' value='"+json[i].acName+"' disabled></td>"+
							            	    	"<td><button type='button' class='btn btn-primary' data1='"+json[i].acUrl+"' onclick='download_all(this)'>下载附件</button></td>"+ */
							            	    "</tr>");
	            	   }
	            	   if(json[i].aType=="合同扫描件"){
		            	   $("#look_all_table").append("<tr>"+
	      	   										"<td style='width:20%;'>合同扫描件</td>"+
	      	   										"<td colspan='3'><a href='"+getLocalPath()+"/oa_file/"+json[i].acUrl+"' target='view_window' style='color:blue'>"+json[i].acName+"</a></td>"+
							            	    	/* "<td colspan='2'><input type='text' class='form-control' style='width:100%;' value='"+json[i].acName+"' disabled></td>"+
							            	    	"<td><button type='button' class='btn btn-primary' data1='"+json[i].acUrl+"' onclick='download_all(this)'>下载附件</button></td>"+ */
							            	    "</tr>");
		            	   }
	            	   /* if(json[i].aType=="法律顾问签字"){
		            	   $("#look_all_table1").append("<tr>"+
	      	   										"<td>法律顾问签字</td>"+
							            	    	"<td colspan='2'><input type='text' class='form-control' style='width:100%;' value='"+json[i].acName+"' disabled></td>"+
							            	    	"<td><button type='button' class='btn btn-primary' data1='"+json[i].acUrl+"' onclick='download_all(this)'>下载附件</button></td>"+
							            	    "</tr>");
	            	   } */
	               }
			}
		})
		

		 $.ajax({
			        	type: 'POST',
			            url: getContextPath()+'/flowHistory/getHistoryNowAndLastByModeId',
			            data:{
			            	id:data.cgId
			            },
			            success: function (json) {
			            	$("#d_table tbody").html('');
			            	for(var i=0;i<json.length;i++){
			            		var operatorType = json[i].operateType;
			            		operatorType = getCnByOt(operatorType);
			            		var date = json[i].doDate;
			            		var title = json[i].title;
			            		var name = json[i].actorname;
			            		if(date == null){
			            			date="";
			            			if(json[i].operateType==8){
			            				title="<lable style='color:red'>"+json[i].title+"</lable>";
			            				name="<lable style='color:red'>"+json[i].actorname+"</lable>";
			            				operatorType="<lable style='color:red'>"+operatorType+"</lable>";
			            			}else{
			            				title = json[i].title;
			            				name = json[i].actorname;
			            			}
			            		}
			                	$("#d_table tbody").append("<tr><td>"+title+"</td><td>"+name+"</td><td></td><td>"+operatorType+"</td><td>"+date+"</td></tr>");
			            	}
			            }
			        });
		
	}
	
	function getCnByOt(s){
		  if(s==1){
			  return "提交";
		  }else if(s==2){
			  return "退回";
		  }else if(s==3){
			  return "撤销";
		  }else if(s==0){
			  return "驳回";
		  }else if(s==8){
			  return "待审批";
		  }
	  }
	
	function getLocalPath(){
		var pathArray = window.location.pathname.split('/');
		var secondLevelLocation = pathArray[1];
		var loginUrl = window.location.protocol + "//"  + window.location.host ;
		return loginUrl;
	}
	
	//下载附件
	function download_all(obj){
		var url=$(obj).attr("data1");
		var name=$(obj).parents("tr").find("td").eq(1).find("input").val();
		
		window.location.href=encodeURI(getContextPath()+"/FileDownLoad?fileName="+name+"&filePath="+url);
	}
	
	//初始化历史列表
	function initTableHistory(){
        $.ajax({
            type: 'POST',
            url: getContextPath()+'/cgcontract/selectHistoryByNo',
            dataType: 'json',
            data: {
            	cgNo:cgNo,
            },
            error: function (msg) {
                errMessage("请求失败");
            },
            success: function (json) {
                $('#lookHistory').dataTable().fnClearTable();
                $('#lookHistory').DataTable().rows.add(json).draw(false);
            }
        });
    }
	
	//超级链接
	 function GetQueryString(name){
        var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if(r!=null)return  unescape(r[2]); return null;
   }
	// 调用方法
   	id=GetQueryString("prjId");
   	no=GetQueryString("prjNo");
   	//var title = decodeURI(id)
   	if(id!=null&&no!=null){
   		$("#allMsg1").modal("show");
   		var cgNo;
   		$.ajax({
			type:"POST",
			url:getContextPath()+"/cgcontract/selectByCgNo",
			dataTyepe:"json",
			async:false,
			data:{ 
				no:no
				},
			success:function(json){
				var data=json;
				cgNo=data.cgNo;
				initTableHistory();
				
				$("#lookcghetongming").text(data.contractName);
				$("#lookcgNo").text(data.cgNo);
				$("#lookcgdNo").text(data.cgdNo);
				$("#lookcgbianhao").text(data.cgId)
				$("#looktask_no").text(data.workNo);
				$("#lookprjName").text(data.prjName)
				$("#lookisdaigou").text(data.isProgram);
				$("#lookfbhetong").text(data.fbNo==''||data.fbNo==null?"无":data.fbNo);
				$("#lookborrow_no").text(json.borrowNo)
				$("#lookdaigouType").text(data.programType),
				$("#lookcgType").text(data.cgcType);
				$("#lookdaigouMoney").text(data.programMoney);
				$("#lookcghetongMoney").text(data.cgContractMoney);
				$("#lookjiafang").text(data.contractNameJia);
				$("#lookyifang").text(data.spName);
				$("#lookfukuanfangshi").text(data.payMode);
				$("#lookyear").text(data.contractSignTime);
				$("#lookcghetonggaishu").text(data.contractSummary);
				$("#lookgaikuang").text(data.workContent);
				$("#look_shuilv").text(json.shuilv);
				$("#look_shuijin").text(json.shuijin);
				
				var list=new Array();
				if(data.cgdNo.indexOf(",")){
					var no=data.cgdNo.split(",");
					for(var i=0;i<no.length;i++){
						list.push(no[i])
					}
				}else{
					list.push(data.cgdNo)
				}
				if(list!=null){
					$("#lookcghetongMoney").val("");
					$("#lookcailiaobiaoDiv table").remove();
					for(var i=0;i<list.length;i++){
						//console.log(list[i])
		        		$("#lookcailiaobiaoDiv").append(
		        				"<table  class='table table-bordered table-condensed' id='lookcailiaobiao"+i+"'>"+
		                    	"<thead>"+
		                    		"<tr>"+
		                            	"<td>采购部门</td>"+
		                                "<td dataId='' id='lookcgbumen"+i+"'></td>"+
		                                "<td  colspan='2'>部门采购金额</td>"+
		                                "<td id='lookbumencgMoney"+i+"' colspan='2'></td>"+
		                            	"<th colspan='3' style='text-align:right;'></th>"+
		                        	"</tr>"+
		                        	"<tr>"+
		                            	"<th>材料名称</th>"+
		                            	"<th>材料类型</th>"+
			                            "<th>材料型号</th>"+
			                            "<th style='width:6%;'>单位</th>"+
			                            "<th>数量</th>"+
			                            "<th style='width:8%;'>单价</th>"+
			                            "<th style='width:8%;'>金额</th>"+
			                            /*"<th>项目部推荐供应商</th>"+
			                             "<th>公司确定供应商</th>"+ */
			                            "<th>备注</th>"+
		                        	"</tr>"+
		                    	"</thead>"+
		                    	"<tbody>"+
		                    	"</tbody>"+
		                    "</table>"
		                    )}
				  		$.ajax({
				            type: 'POST',
				            url: getContextPath()+'/PrjMaterialBuy/selectBuyByIds',
				            dataType: 'json',
				            data: {
				            	ids:list.toString()
				            },
				            success: function (json) {
				            	//console.log(json)
				            	for(var i=0;i<json.length;i++){
				            		var omName=json[i].omName
				            		var sumPrice=json[i].sumPrice;
				            		var pmbId=json[i].pmbId;
				            		$("#lookcgbumen"+i+"").text(json[i].omName)
				            		$("#lookcgbumen"+i+"").attr("dataId",pmbId)
				            		$("#lookbumencgMoney"+i+"").text(json[i].sumPrice)
				            		
				            		$.ajax({
				                        type: 'POST',
				                        url: getContextPath()+'/cgcontract/getMdById',
				                        dataType: 'json',
				                        async:false,
				                        data: {
				                        	id:pmbId
				                        },
				                        success: function (json) {
				                        	//console.log(json)
				                        	for(var k=0;k<json.length;k++){
				                        		$("#lookcailiaobiao"+i+" tbody").append("<tr dataId="+json[k].mdlId+"><td>"
				                		  				+""+json[k].materialName+""
				                		  				+"</td><td>"
				                		  				+""+json[k].materialType+""
				                		  				+"</td><td>"
				                		  				+""+json[k].modeType+""
				                		  				+"</td><td>"
				                		  				+""+json[k].buyCompany+""
				                		  				+"</td><td>"
				                		  				+""+json[k].num+""
				                		  				+"</td><td>"
				                		  				+""+json[k].price+""
				                		  				+"</td><td>"
				                		  				+""+json[k].price+""
				                		  				+"</td><td>"
				                		  				/*+""+json[k].name+""
				                		  				+"</td><td>"
				                		  				 +""+json[k].name2+""
				                		  				+"</td><td>" */
				                		  				+""+json[k].infos+""
				                		  				+"</td></tr>")
				                        	} 
				                        }
				              		});
				            		
				            	}
				            }
				  		});
				  		
			  		}
				
				
				$.ajax({
					type:"post",
					url:getContextPath()+"/cgcontract/selectAccessoryById",
					dataType:"json",
					async:false,
					data:{
						id:data.cgId,
					},
					success:function(json){
						$("#look_all_table").empty();
						//$("#look_all_table1").empty();
			            for(var i=0;i<json.length;i++){
			            	   if(json[i].aType=="采购合同文本"){
				            	   $("#look_all_table").append("<tr>"+
			      	   										"<td style='width:20%;'>采购合同文本</td>"+
			      	   										"<td colspan='3'><a href='"+getLocalPath()+"/oa_file/"+json[i].acUrl+"' target='view_window' style='color:blue'>"+json[i].acName+"</a></td>"+
									            	    	/* "<td colspan='2'><input type='text' class='form-control' style='width:100%;' value='"+json[i].acName+"' disabled></td>"+
									            	    	"<td><button type='button' class='btn btn-primary' data1='"+json[i].acUrl+"' onclick='download_all(this)'>下载附件</button></td>"+ */
									            	    "</tr>");
			            	   }
			            	   
			            	   
			            	   /* if(json[i].aType=="法律顾问签字"){
				            	   $("#look_all_table1").append("<tr>"+
			      	   										"<td>法律顾问签字</td>"+
									            	    	"<td colspan='2'><input type='text' class='form-control' style='width:100%;' value='"+json[i].acName+"' disabled></td>"+
									            	    	"<td><button type='button' class='btn btn-primary' data1='"+json[i].acUrl+"' onclick='download_all(this)'>下载附件</button></td>"+
									            	    "</tr>");
			            	   } */
			               }
					}
				})
			}
		}) 
   	}
	//查看历史信息的详细信息
	function lookHistoryDetails(obj){
		var dom=$(obj).parents('tr');
		var data=$('#lookHistory').DataTable().row(dom).data();
		$('#History').on('hidden.bs.modal', function () {//解决模态框页面滚动问题
            if ($('.modal.in').size() >= 1) {
                $('body').addClass('modal-open')
            }
        })
		
        $.ajax({
			type:"post",
			url:getContextPath()+"/cgcontract/selectCgContractById",
			dataType:"json",
			data:{
				id:data.cgId,
			},
			success:function(json){
				$("#Historycghetongming").text(json.contractName);
				$("#HistorycgNo").text(json.cgNo==null?"":json.cgNo);
				$("#HistorycgdNo").text(json.cgdNo==null?"":json.cgdNo);
				$("#Historycgbianhao").text(json.cgId==null?"":json.cgId)
				$("#Historytask_no").text(json.workNo==null?"":json.workNo);
				$("#HistoryprjName").text(json.prjName==null?"":json.prjName)
				$("#Historyisdaigou").text(json.isProgram==null?"":json.isProgram);
				$("#Historyfbhetong").text(json.fbNo==''||data.fbNo==null?"":data.fbNo);
				$("#Historyborrow_no").text(json.borrowNo==''||json.borrowNo==null?"":json.borrowNo)
				$("#HistorydaigouType").text(json.programType==null?"":json.programType),
				$("#HistorycgType").text(json.cgcType==null?"":json.cgcType);
				$("#HistorydaigouMoney").text(json.programMoney==null?"":json.programMoney);
				$("#HistorycghetongMoney").text(json.cgContractMoney==null?"":json.cgContractMoney);
				$("#Historyjiafang").text(json.contractNameJia==null?"":json.contractNameJia);
				$("#Historyyifang").text(json.spName==null?"":json.spName);
				$("#Historyfukuanfangshi").text(json.payMode==null?"":json.payMode);
				$("#Historyyear").text(json.contractSignTime==null?"":json.contractSignTime);
				$("#Historycghetonggaishu").text(json.contractSummary==null?"":json.contractSummary);
				$("#Historygaikuang").text(json.workContent==null?"":json.workContent);
				$("#Historycg_bumen").text(json.cgDepartment==null?"":json.cgDepartment);
				$("#Historyyunfei").text(json.freight==null?"":json.freight);
				$("#History_shuilv").text(json.shuilv==null?"":json.shuilv);
				$("#History_shuijin").text(json.shuijin==null?"":json.shuijin);
				
				$("#HistorycailiaobiaoDiv").empty();
				$("#HistorycailiaobiaoDiv").append(
        				"<table  class='table table-bordered table-condensed' id='Historycailiaobiao'>"+
                    	"<thead>"+
                        	"<tr>"+
                            	"<th>名称</th>"+
                            	"<th>类型</th>"+
	                            "<th>型号</th>"+
	                            "<th style='width:6%;'>单位</th>"+
	                            "<th>数量</th>"+
	                            "<th style='width:8%;'>单价</th>"+
	                            "<th style='width:8%;'>金额</th>"+
	                            /*"<th>项目部推荐供应商</th>"+
	                             "<th>公司确定供应商</th>"+ */
	                            "<th>备注</th>"+
                        	"</tr>"+
                    	"</thead>"+
                    	"<tbody>"+
                    	"</tbody>"+
                    "</table>"
                    )
				if(json.cgcl!=null){
					for(var k=0;k<json.cgcl.length;k++){
                   		$("#Historycailiaobiao tbody").append("<tr><td style='width:10%;'>"
                   				+''+(json.cgcl[k].clName==null?"":json.cgcl[k].clName)+''
           		  				+"</td><td style='width:9%;'>"
           		  				+''+(json.cgcl[k].clType==null?"":json.cgcl[k].clType)+''
           		  				+"</td><td style='width:9%;'>"
           		  				+''+(json.cgcl[k].clMode==null?"":json.cgcl[k].clMode)+'' 
           		  				+"</td><td style='width:9%;'>"
           		  				+''+(json.cgcl[k].clUnit==null?"":json.cgcl[k].clUnit)+''
           		  				+"</td><td style='width:9%;'>"
           		  				+''+(json.cgcl[k].clNumber==null?"":json.cgcl[k].clNumber)+''
           		  				+"</td><td style='width:9%;'>"
           		  				+''+(json.cgcl[k].clPrice==null?"":json.cgcl[k].clPrice)+''
           		  				+"</td><td style='width:9%;'>"
           		  				+''+(json.cgcl[k].clMoney==null?"":json.cgcl[k].clMoney)+''
           		  				+"</td><td style='width:9%;'>"
           		  			/*+''+(json.cgcl[k].clspName1==null?"":json.cgcl[k].clspName1)+''
           		  				+"</td><td style='width:10%;'>"
           		  				 +''+(json.cgcl[k].clspName2==null?"":json.cgcl[k].clspName2)+''
           		  				+"</td><td style='width:9%;'>" */
           		  				+''+(json.cgcl[k].clDesc==null?"":json.cgcl[k].clDesc)+''
           		  				+"</td></tr>")
                    	} 
				}
				
			}
		})
        
		
		
		
		/* var list=new Array();
		if(data.cgdNo.indexOf(",")){
			var no=data.cgdNo.split(",");
			for(var i=0;i<no.length;i++){
				list.push(no[i])
			}
		}else{
			list.push(data.cgdNo)
		}
		if(list!=null){
			$("#HistorycghetongMoney").val("");
			$("#HistorycailiaobiaoDiv table").remove();
			for(var i=0;i<list.length;i++){
        		$("#HistorycailiaobiaoDiv").append(
        				"<table  class='table table-bordered table-condensed' id='Historycailiaobiao"+i+"'>"+
                    	"<thead>"+
                    		"<tr>"+
                            	"<td>采购部门</td>"+
                                "<td dataId='' id='Historycgbumen"+i+"'></td>"+
                                "<td  colspan='2'>部门采购金额</td>"+
                                "<td id='HistorybumencgMoney"+i+"' colspan='2'></td>"+
                            	"<th colspan='3' style='text-align:right;'></th>"+
                        	"</tr>"+
                        	"<tr>"+
                            	"<th>材料名称</th>"+
                            	"<th>材料类型</th>"+
	                            "<th>材料型号</th>"+
	                            "<th style='width:6%;'>单位</th>"+
	                            "<th>数量</th>"+
	                            "<th style='width:8%;'>单价</th>"+
	                            "<th style='width:8%;'>金额</th>"+
	                            "<th>项目部推荐供应商</th>"+
	                            "<th>公司确定供应商</th>"+
	                            "<th>备注</th>"+
                        	"</tr>"+
                    	"</thead>"+
                    	"<tbody>"+
                    	"</tbody>"+
                    "</table>"
                    )}
		  		$.ajax({
		            type: 'POST',
		            url: getContextPath()+'/PrjMaterialBuy/selectBuyByIds',
		            dataType: 'json',
		            data: {
		            	ids:list.toString()
		            },
		            success: function (json) {
		            	for(var i=0;i<json.length;i++){
		            		var omName=json[i].omName
		            		var sumPrice=json[i].sumPrice;
		            		var pmbId=json[i].pmbId;
		            		$("#Historycgbumen"+i+"").text(json[i].omName)
		            		$("#Historycgbumen"+i+"").attr("dataId",pmbId)
		            		$("#HistorybumencgMoney"+i+"").text(json[i].sumPrice)
		            		
		            		$.ajax({
		                        type: 'POST',
		                        url: getContextPath()+'/cgcontract/getMdById',
		                        dataType: 'json',
		                        async:false,
		                        data: {
		                        	id:pmbId
		                        },
		                        success: function (json) {
		                        	//console.log(json)
		                        	for(var k=0;k<json.length;k++){
		                        		$("#Historycailiaobiao"+i+" tbody").append("<tr dataId="+json[k].mdlId+"><td>"
		                		  				+""+json[k].materialName+""
		                		  				+"</td><td>"
		                		  				+""+json[k].materialType+""
		                		  				+"</td><td>"
		                		  				+""+json[k].modeType+""
		                		  				+"</td><td>"
		                		  				+""+json[k].buyCompany+""
		                		  				+"</td><td>"
		                		  				+""+json[k].num+""
		                		  				+"</td><td>"
		                		  				+""+json[k].price+""
		                		  				+"</td><td>"
		                		  				+""+json[k].price+""
		                		  				+"</td><td>"
		                		  				+""+json[k].name+""
		                		  				+"</td><td>"
		                		  				+""+json[k].name2+""
		                		  				+"</td><td>"
		                		  				+""+json[k].infos+""
		                		  				+"</td></tr>")
		                        	} 
		                        }
		              		});
		            		
		            	}
		            }
		  		});
		  		
	  		} */
		
		
		$.ajax({
			type:"post",
			url:getContextPath()+"/cgcontract/selectAccessoryById",
			dataType:"json",
			async:false,
			data:{
				id:data.cgId,
			},
			success:function(json){
				$("#History_all_table").empty();
				//$("#History_all_table1").empty();
	               for(var i=0;i<json.length;i++){
	            	   if(json[i].aType=="采购合同文本"){
		            	   $("#History_all_table").append("<tr>"+
	      	   										"<td style='width:20%;'>采购合同文本</td>"+
	      	   										"<td colspan='3'><a href='"+getLocalPath()+"/oa_file/"+json[i].acUrl+"' target='view_window' style='color:blue'>"+json[i].acName+"</a></td>"+
							            	    	/* "<td colspan='2'><input type='text' class='form-control' style='width:100%;' value='"+json[i].acName+"' disabled></td>"+
							            	    	"<td><button type='button' class='btn btn-primary' data1='"+json[i].acUrl+"' onclick='download_all(this)'>下载附件</button></td>"+ */
							            	    "</tr>");
	            	   }
	            	   /* if(json[i].aType=="法律顾问签字"){
		            	   $("#History_all_table1").append("<tr>"+
	      	   										"<td>法律顾问签字</td>"+
							            	    	"<td colspan='2'><input type='text' class='form-control' style='width:100%;' value='"+json[i].acName+"' disabled></td>"+
							            	    	"<td><button type='button' class='btn btn-primary' data1='"+json[i].acUrl+"' onclick='download_all(this)'>下载附件</button></td>"+
							            	    "</tr>");
	            	   } */
	               }
			}
		})
		
	}
	
	
	
	
	//点击填报材料设备采购合同时默认添加的一个附件
	/*function newFile(){
		$("#new_accessory tbody").html('');
		$("#new_accessory tbody").append("<tr><td>新附件</td><td><input type='file' name='file' id='file'><td style='width:150px;'></td></tr>")
		 
	} */
	
	function addFile(){
		$("#new_accessory tbody").append("<tr><td>新附件</td><td><input type='file' name='file' id='file' style='width:70%;' class='form-control'></td><td style='width:150px;'><button type='button' class='btn btn-danger' onclick='removeFile(this)'>移除附件</button></td></tr>");
	}
	function addFile1(){
		$("#new_accessory1 tbody").append("<tr><td>新附件</td><td><input type='file' name='file1' id='file1' style='width:70%;' class='form-control'></td><td style='width:150px;'><button type='button' class='btn btn-danger' onclick='removeFile(this)'>移除附件</button></td></tr>");
	}
	
	function addFile2(){
		$("#edit_accessory tbody").append("<tr><td>新附件</td><td><input type='file' name='file' id='xgfile' style='width:70%;' class='form-control'></td><td style='width:150px;'><button type='button' class='btn btn-danger' onclick='removeFile(this)'>移除附件</button></td></tr>");
	}
	function addFile3(){
		$("#edit_accessory1 tbody").append("<tr><td>新附件</td><td><input type='file' name='file1' id='xgfile1' style='width:70%;' class='form-control'></td><td style='width:150px;'><button type='button' class='btn btn-danger' onclick='removeFile(this)'>移除附件</button></td></tr>");
	}
	
	function removeFile(obj){
  		var tr=$(obj).parents("tr");
  		$(tr).remove();
  	}
	
	 function showMask() {
	    	myTool.mask.show('保存中...');
	 }
	 function hidMask() {
	 	myTool.mask.hide();
	 }
	
	
    function getCreat(bb){
        var EnterpriseRating= $(bb).parent().prev().text();
        var Remarks= $(bb).parent().prev().prev().text();
        var ContactPhone1= $(bb).parent().prev().prev().prev().text();
        var Contacts= $(bb).parent().prev().prev().prev().prev().text();
        var address= $(bb).parent().prev().prev().prev().prev().prev().text();
        var ProprietorUnit= $(bb).parent().prev().prev().prev().prev().prev().prev().text();
        var Code= $(bb).parent().prev().prev().prev().prev().prev().prev().prev().text();
        $("#CEnterprise-rating").val(EnterpriseRating);
        $("#CRemarks").val(Remarks);
        $("#CContact-phone1").val(ContactPhone1);
        $("#CContacts").val(Contacts);
        $("#Caddress").val(address);
        $("#CProprietor-unit").val(ProprietorUnit);
        $("#CCode").val(Code);
        rowIndex = bb.parentNode.parentNode.rowIndex; 
    }

    // $("#mainContent tbody tr").click(function (){
    //     $(this).addClass('selected')
    //     .siblings().removeClass('selected')
    //     .end();
    // })
//数组去重
Array.prototype.unique3 = function(){
 var res = [];
 var json = {};
 for(var i = 0; i < this.length; i++){
  if(!json[this[i]]){
   res.push(this[i]);
   json[this[i]] = 1;
  }
 }
 return res;
}

    var arr=[];
    // $('#renwuDanhao')[0].selectedIndex = -1;
    $("#renwuDanhao").change(function(){
        arr.push($("#renwuDanhao").val())
        $("#rwdh").text(arr.unique3())
    })
    var arr2=[];
    // $('#renwuDanhao2')[0].selectedIndex = -1;
    $("#renwuDanhao2").change(function(){
        arr2.push($("#renwuDanhao2").val())
        $("#rwdh2").text(arr2.unique3())
    })

    $(".zhuangtai").change(function(){
        var zt=$(".zhuangtai").val();
        if(zt=="合同终止"){
            $(".quxiao").hide();
            $(".chongqi").show()
        }else{
            $(".quxiao").show();
            $(".chongqi").hide();
        }
    })
    
    
    //打印预览
    function dayinyulan(){
    	window.open("../contractyulan/ProcurementContract.html?id="+LookCgId+"");
    }
    
    
    function initFenGs(){
  		$.ajax({
            type: 'POST',
            url: getContextPath()+'/job/selectAllJobLv',
            dataType: 'json',
            data: {
            },
            success: function (json) {
            	 $("#hetongjiafang").html("");
            	 $("#xghetongjiafang").html("");
                 for(var i=0;i<json.length;i++){
                 	$("#hetongjiafang").append("<option value='"+json[i].jobLvName+"'>"+json[i].jobLvName+"</option>")
                 	$("#xghetongjiafang").append("<option value='"+json[i].jobLvName+"'>"+json[i].jobLvName+"</option>")
                 }
            }
      });
  	 }
    
    var smht_cgId;
	function addsaomiaohetongjian(obj){
		tr_smht=$(obj).parents("tr");
		data_smht=$("#mainContent").DataTable().row(tr_smht).data();
		//console.log(data_bl)
		smht_cgId=data_smht.cgId;
    	$("#addSaoMiaohtModel").modal("show");
	}
    
	 function savesaomiaohetongjian(){
		 var saomiaoUrl=$("#saomiaofileUrl").val();	 
		 if(saomiaoUrl==''){
				toastr.error("请选择上传文件");
				return;
			 }
		 var formData = new FormData();
		 formData.append("cgId", smht_cgId);
		 formData.append("file",$("#saomiaofileUrl")[0].files[0]);
		 $.ajax({
		        type: 'POST',
		        url: getContextPath()+'/cgcontract/addSaoMiaoHeTong',
	            data: formData,  
	            cache: false,
	            processData: false,
	            contentType: false,
	            async: false,
		        success: function (json) {
	        		var result=json.result;
	        		if(result>0){
	        			toastr.success('保存成功');
	        			//$('#mainContent').DataTable().row.add(OtherFile).draw(false);
	        			$("#addSaoMiaohtModel").modal("hide");
	        			$("#saomiaofileUrl").val("");
	        		}else if(result==-2){
	        			toastr.error('请先刷新页面后登陆');
	        		}else{
	        			toastr.error('保存失败');
	        		}
		        }
		    });		
	 }
	 

    
</script>
</html>