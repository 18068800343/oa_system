<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Document</title>
<link rel="stylesheet" href="../../font2/iconfont.css">
<link rel="stylesheet" href="../../font3/iconfont.css">
<link href="../../style/bootstrap.min.css" rel="stylesheet">
<link href="../../style/style.css" rel="stylesheet">
<link href="../../toastr/toastr.css" rel="stylesheet">
<link href="../../font3/bootstrap-select.css" rel="stylesheet">
<link rel="stylesheet" href="../../style/jquery.dataTables.min.css">
<!-- <link rel="stylesheet" href="../../style/jquery-editable-select.css"> -->
<!-- 固定表列引入css文件 -->
<link href="../../css/fixedColumns.dataTables.css">
<style lang="">
.UpperPart {
	display: flex;
	justify-content: space-between;
	border-bottom: 1px solid #ccc;
	padding-bottom: 4px;
}

.UpperPartL {
	font-size: 16px;
}

.selected {
	background: rgba(247, 161, 3, 0.2);
}

#mainContent th {
	cursor: pointer;
	font-size: 14px;
}

@media screen and (max-width: 1920px) {
	#myModal4 {
		margin-bottom: 120px !important;
	}
	@media screen and (max-width: 1366px) {
		.odd td:nth-child(2) {
			width: 20%;
		}
	}
}
</style>
</head>
<body>

	<!-- 面包屑 -->
	<div class="mianbao">
		<ul class="breadcrumb">
			<li><i class="iconfont icon-knowledgebase"></i></li>
			<li>生产管理</li>
			<li>项目合同管理</li>
			<li>承接合同管理</li>
			<li class="active">承接合同审签</li>
		</ul>
	</div>

	<div class="zhuti-content">

		<div>
			<!-- Nav tabs -->
			<ul class="nav nav-tabs" role="tablist">
				<li role="presentation" class="active" id="diyi"><a
					href="#home" aria-controls="home" role="tab" data-toggle="tab">主页</a></li>
				<li role="presentation" id="dier"><a href="#profile"
					aria-controls="profile" role="tab" data-toggle="tab">新建</a></li>
				<li role="presentation" id="disan"><a href="#messages"
					aria-controls="messages" role="tab" data-toggle="tab">修改</a></li>
				<li role="presentation" id="disi"><a href="#settings"
					aria-controls="settings" role="tab" data-toggle="tab">查看详细信息</a></li>
			</ul>

			<!-- Tab panes -->
			<div class="tab-content">
				<div role="tabpanel" class="tab-pane active" id="home">
					<!-- <div class="UpperPart">
		            <div class="UpperPartL" style="font-size:18px;">
		                <form class="form-inline">
		                    <label>状态筛选:</label>
		                    <select id="zhuangtai" class="form-control" style="width:180px;">
		                        <option>审批结束</option>
		                        <option>审批中</option>
		                        <option>合同取消</option>
		                    </select>
		                </form>
		            </div>
		            <div class="UpperPartR">
		            	
		                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal4">合同变更</button>
		            </div>
		        </div> -->

					<div class="LowerPart" style="margin-top: 3px;">
						<div class="chaojisousuo" style="margin-bottom: 4px;">
							<div class="sousuoClick"
								style="display: flex; justify-content: space-between; margin-bottom: 4px;">
								<div class="yihang">
									<button type="button" style="margin-left: 10px;"
										class="btn btn-primary Pecaa" id="zenjia">填报合同单</button>
									<div id="tabBtn" style="margin-left: 10px;"></div>
									&nbsp;&nbsp;
									<button type="button" class="btn btn-info" onclick="seachAll()">
										<span class="glyphicon glyphicon-search" aria-hidden="true"></span>搜索
									</button>
									&nbsp;&nbsp
									<button type="button" class="btn btn-primary"
										style="width: 100px;" id="zhedieBtn">
										<span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span>
									</button>
								</div>
								<div class='yihang'>
									<input class="form-control" id="searchData" value=""
										placeholder="搜索" type="text">
								</div>
							</div>
							<div class="sousuoInput" id="sousuodiv">
								<div id="sousuoTable"
									style="border: 1px solid #eee; padding: 5px;">

									<div class="yihang2">
										<div style="width: 25%;">
											<form class="form-inline">
												<div class="form-group"
													style="display: flex; align-items: center;">
													<label for="exampleInput">合同开始时间:&nbsp;</label> <input
														type="text" class="form-control" id="seach_start_time_min"
														style="width: 30%;"> <label>-</label> <input
														type="text" class="form-control" id="seach_start_time_max"
														style="width: 30%;">
												</div>
											</form>
										</div>
										<div style="width: 25%;">
											<form class="form-inline">
												<div class="form-group"
													style="display: flex; align-items: center;">
													<label for="exampleInput">合同结束时间:&nbsp;</label> <input
														type="text" class="form-control" id="seach_end_time_min"
														style="width: 30%;"> <label>-</label> <input
														type="text" class="form-control" id="seach_end_time_max"
														style="width: 30%;">
												</div>
											</form>
										</div>
										<div style="width: 25%;">
											<form class="form-inline">
												<div class="form-group"
													style="display: flex; align-items: center;">
													<label for="exampleInput">主办部门:&nbsp;</label> <select
														class="form-control" id="seach_main_department"
														style="width: 64%;"></select>
												</div>
											</form>
										</div>
										<div style="width: 25%;">
											<form class="form-inline">
												<div class="form-group"
													style="display: flex; align-items: center;">
													<label for="exampleInput">协办部门:&nbsp;</label> <select
														class="form-control" id="seach_xb_department"
														style="width: 64%;"></select>
												</div>
											</form>
										</div>
									</div>
									<hr />
									<div class="yihang2">
										<div style="width: 25%;">
											<form class="form-inline">
												<div class="form-group"
													style="display: flex; align-items: center;">
													<label for="exampleInput">合&nbsp;同&nbsp;金&nbsp;额&nbsp;：&nbsp;</label>
													<input type="text" class="form-control"
														id="seach_contract_money_min" style="width: 30%;">
													<label>-</label> <input type="text" class="form-control"
														id="seach_contract_money_max" style="width: 30%;">
												</div>
											</form>
										</div>
										<div style="width: 25%;">
											<form class="form-inline">
												<div class="form-group"
													style="display: flex; align-items: center;">
													<label for="exampleInput">暂&nbsp;&nbsp;&nbsp;定&nbsp;&nbsp;&nbsp;金：&nbsp;&nbsp;</label>
													<input type="text" class="form-control"
														id="seach_zd_money_min" style="width: 31%;"> <label>-</label>
													<input type="text" class="form-control"
														id="seach_zd_money_max" style="width: 30%;">
												</div>
											</form>
										</div>
										<div style="width: 25%;">
											<form class="form-inline">
												<div class="form-group"
													style="display: flex; align-items: center;">
													<label for="exampleInput">审&nbsp;批&nbsp;时&nbsp;间&nbsp;：&nbsp;</label>
													<input type="text" class="form-control"
														id="seach_lx_date_min" style="width: 30%;"> <label>-</label>
													<input type="text" class="form-control"
														id="seach_lx_date_max" style="width: 30%;">
												</div>
											</form>
										</div>
										<div style="width: 25%;">
											<form class="form-inline">
												<div class="form-group"
													style="display: flex; align-items: center;">
													<label for="exampleInput">项&nbsp;目&nbsp;类&nbsp;型:&nbsp;</label>
													<select class="form-control" style="width: 30%;"
														id="search_erjileixing"></select>
												</div>
											</form>
										</div>
										<div style="width: 25%;"></div>
									</div>
								</div>
							</div>
						</div>
						<table class="table table-bordered table-condensed"
							id="mainContent">
							<thead>
								<tr>
									<th style="width: 90px; background-color: #ffffff">承接合同号</th>
									<th style="width: 280px;">承接合同名称</th>
									<th style="width: 220px;">甲方</th>
									<th style="width: 90px">任务单号</th>
									<th style="width: 60px;">乙方</th>
									<th style="width: 110px;" class="jinqianyanse">合同金额(元)</th>
									<th style="width: 120px;" class="jinqianyanse">原合同金额(元)</th>
									<th style="width: 90px;">签订日期</th>
									<th style="width: 90px;">审批完成日期</th>
									<th style="width: 150px;">合同工期</th>
									<th style="width: 60px;">发起人</th>
									<th style="width: 70px;">主办部门</th>
									<th style="width: 70px;">审批状态</th>
									<th style="width: 85px;">操作</th>

								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
					</div>

				</div>

				<div role="tabpanel" class="tab-pane" id="profile">
					<!--startprint-->
					<form class="form-inline" method="post" id="new_form"
						enctype="multipart/form-data">
						<table class="table table-bordered table-condensed">
							<thead>
								<tr>
									<th colspan="10">项目基本信息</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>项目名称: <i class="iconfont icon-xingxing-copy"
										style="color: red;"></i></td>
									<!-- onchange="clickPrjName(this)" -->
									<td><input type="text" style="width: 70%;"
										class="form-control" id="prj_name" disabled>
										<button type="button" class="btn btn-primary"
											onclick="chooseName(0)">选择项目名称</button></td>
									<td>任务单号:<i class="iconfont icon-xingxing-copy"
										style="color: red;"></i></td>
									<!-- onchange="clickWorkNo(this)" -->
									<td><input type="text" style="width: 70%;"
										class="form-control" id="work_no" disabled>
										<button type="button" class="btn btn-primary"
											onclick="chooseNo(0)">选择任务单号</button></td>
								</tr>
								<tr>
									<td class="jingyongkk">项目类型:</td>
									<td><input type="text" style="width: 70%;"
										class="form-control" id="prj_type" disabled></td>
									<td class="jingyongkk">经营模式:</td>
									<td><input type="text" style="width: 70%;"
										class="form-control" id="prj_jyms" disabled></td>
								</tr>
							</tbody>
						</table>
						<table class="table table-bordered table-condensed">
							<thead>
								<tr>
									<th colspan="10">承接合同信息</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td style="width: 13%;">承接合同名称: <i
										class="iconfont icon-xingxing-copy" style="color: red;"></i></td>
									<td><input type="text" class="form-control"
										id="contract_name" style="width: 70%;"></td>
									<td style="width: 13%;">
										<!-- 承接合同编号: -->
									</td>
									<td>
										<!-- <input type="text" class="form-control" id="contract_no" disabled style="width:80%;"> -->
									</td>
								</tr>
								<tr>
									<td>合同甲方名称: <i class="iconfont icon-xingxing-copy"
										style="color: red;"></i></td>
									<td colspan="3"><select class="selectpicker form-control"
										id="jiafangName" style="width: 70%;" multiple
										data-max-options="2" data-live-search="true">
									</select></td>
								</tr>
								<tr>
									<td>合同乙方名称: <i class="iconfont icon-xingxing-copy"
										style="color: red;"></i></td>
									<td><select class="form-control" style="width: 70%;"
										id="yifangName">
											<option value="华通">华通</option>
											<option value="华汇">华汇</option>
											<option value="宿迁分公司">宿迁分公司</option>
									</select></td>
									<td>承接部门:</td>
									<td><select class="form-control" style="width: 70%;"
										id="yifang_department">
									</select></td>
								</tr>
								<tr>
									<td>合同起讫日期:</td>
									<td><input class="form-control" id="year"
										style="width: 32%;"></input>&nbsp; -- &nbsp; <input
										class="form-control" id="year2" style="width: 32%;"></input></td>
									<td class="shuziyanse">合同工期(天):</td>
									<td><input class="form-control" id="work_date"
										style="width: 70%;"></td>
									<!-- <td>合同金额(元):</td>
					                      <td class="form-inline">
					                          <input class="form-control" id="contract_money" style="width:50%;">
						                      <button type="button" class="btn btn-primary" onclick="splitContractMoney(0)">拆分合同额</button>
					                      </td> -->
								</tr>
								<tr>
									<td class="jinqianyanse">合同金额(元):</td>
									<td><input class="form-control" id="contract_money"
										style="width: 70%;" placeholder="不含暂定金"
										onchange="changeRWD(this)"></td>
									<td class="jinqianyanse">暂定金(元):</td>
									<td><input class="form-control" id="temporary_money"
										style="width: 70%;"></td>
								</tr>
								<tr>
									<td>合同签订时间:</td>
									<td><input class="form-control" id="year3"
										style="width: 70%;"></td>
									<td></td>
									<td></td>
								</tr>
								<tr>
									<td>收款条件:</td>
									<td colspan="8"><textarea class="form-control" rows="4"
											style="width: 100%;" id="receieve_money_condition"></textarea>
									</td>
								</tr>
								<tr>
									<td>主要概况及工作内容:</td>
									<td colspan="8"><textarea class="form-control" rows="4"
											style="width: 100%;" id="work_info"></textarea></td>
								</tr>
							</tbody>
						</table>
						<!-- <table class="table table-bordered table-condensed" id="">
	                  			<thead>
		                  			<tr>
		                  				<th colspan="6">拆分合同(跨年度合同)</th>
		                  			</tr>
	                  			</thead>
	                  			<tbody>
	                  				
	                  			</tbody>
	                  </table> -->
						<!-- <table class="table table-bordered table-condensed" id="new_split_table">
							<thead>
								<tr>
		                        	<td style="width:13%;">年份</td>
		                       		<td>金额(元)</td>
		                      	</tr>
							</thead>
							<tbody></tbody>
					    </table> -->
						<table class="table table-bordered table-condensed"
							id="new_accessory">
							<thead>
								<tr>
									<td style="width: 13%;">合同文本附件: <i
										class="iconfont icon-xingxing-copy" style="color: red;"></i></td>
									<td colspan="2">
										<button type="button" class="btn btn-primary"
											onclick="new_accessory()">增加附件</button>
									</td>
								</tr>
							</thead>
							<tbody></tbody>
						</table>
						<table class="table table-bordered table-condensed"
							id="new_accessory2">
							<thead>
								<tr>
									<td style="width: 13%;">法律顾问签字:</td>
									<td colspan="2">
										<button type="button" class="btn btn-primary"
											onclick="new_accessory2()">增加附件</button>
									</td>
								</tr>
							</thead>
							<tbody></tbody>
						</table>
						<div id="renwudanFenpei"></div>
						<!-- <table class="table table-bordered table-condensed" id="xieban" hidden="hidden">
			                    <thead>
			                      <tr>
			                      	   <th style="text-align:left;"><button type="button" class="btn btn-primary" onclick="countMoney()">计算年度金额</button></th>
			                           <th colspan="2" style="text-align:right;"><button type="button" class="btn btn-primary" onclick="addBumen()">添加协办部门</button></th>
			                      </tr>
			                  </thead>
			                  <tbody>
			                      <tr>
			                          <td style="width:13%;">主办部门</td>
			                          <td style="width:32%;">
			                              <form class="form-inline">
			                                  <select class="form-control" style="width:150px;" id="zhuban">
			                                      
			                                  </select>
			                                  <input type="text" class="form-control" style="width:150px;" placeholder="金额" id="zhubanjine">
			                              </form>
			                          </td>
			                          <td></td>
			                      </tr>
			                      
			                  </tbody>
		              </table> -->
					</form>
					<!--endprint-->
					<div class="modal-footer">
						<!-- <button type="button" class="btn btn-success" onclick="day()">打印页面</button> -->
						<button type="button" class="btn btn-default" onclick="quxiaoa()">取消</button>
						<button type="button" class="btn btn-success" onclick="new_save()">保存</button>
						<button type="button" class="btn btn-success"
							onclick="new_submit()">提交</button>
					</div>
				</div>
				<!-- 修改 -->
				<div role="tabpanel" class="tab-pane" id="messages">
					<form class="form-inline" method="post" id="edit_form"
						enctype="multipart/form-data">
						<table class="table table-bordered table-condensed">
							<thead>
								<tr>
									<th colspan="10">项目基本信息</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td style="width: 20%;">任务单号:</td>
									<td style="width: 30%;"><input type="text"
										style="width: 70%;" class="form-control" id="edit_work_no"
										disabled>
										<button type="button" class="btn btn-primary"
											onclick="chooseNo(1)">选择任务单号</button></td>
									<td style="width: 20%;">项目名称: <i
										class="iconfont icon-xingxing-copy" style="color: red;"></i></td>
									<td style="width: 30%;"><input type="text"
										style="width: 70%;" class="form-control" id="edit_prj_name"
										disabled>
										<button type="button" class="btn btn-primary"
											onclick="chooseName(1)">选择项目名称</button></td>
								</tr>
								<tr>
									<td class="jingyongkk">项目类型:</td>
									<td><input type="text" style="width: 70%;"
										class="form-control" id="edit_prj_type" disabled></td>
									<td class="jingyongkk">经营模式:</td>
									<td><input type="text" style="width: 70%;"
										class="form-control" id="edit_prj_jyms" disabled></td>
								</tr>
							</tbody>
						</table>
						<table class="table table-bordered table-condensed">
							<thead>
								<tr>
									<th colspan="10">承接合同信息</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td style="width: 20%;">承接合同名称: <i
										class="iconfont icon-xingxing-copy" style="color: red;"></i></td>
									<td style="width: 30%;"><input type="text"
										class="form-control" id="edit_contract_name"
										style="width: 80%;"></td>
									<td style="width: 20%;" class="jingyongkk">承接合同编号: <i
										class="iconfont icon-xingxing-copy" style="color: red;"></i></td>
									<td style="width: 30%;"><input type="text"
										class="form-control" id="edit_contract_no" disabled
										style="width: 80%;"></td>
								</tr>
								<tr>
									<td>合同甲方名称: <i class="iconfont icon-xingxing-copy"
										style="color: red;"></i></td>
									<td colspan="3"><select class="selectpicker form-control"
										id="edit_jiafangName" style="width: 80%;" multiple
										data-max-options="2" data-live-search="true">
									</select></td>

								</tr>
								<tr>
									<td>合同乙方名称: <i class="iconfont icon-xingxing-copy"
										style="color: red;"></i></td>
									<td><select class="form-control" style="width: 80%;"
										id="edit_yifangName">
											<option value="华通">华通</option>
											<option value="华汇">华汇</option>
											<option value="宿迁分公司">宿迁分公司</option>
									</select></td>
									<td>承接部门:</td>
									<td><select class="form-control" style="width: 80%;"
										id="edit_yifang_department">
									</select></td>
								</tr>
								<tr>
									<td>合同起讫日期:</td>
									<td><input class="form-control" id="edit_year"
										style="width: 35%;"></input>&nbsp; -- &nbsp; <input
										class="form-control" id="edit_year2" style="width: 35%;"></input>
									</td>
									<td class="shuziyanse">合同工期(天):</td>
									<td><input class="form-control" id="edit_work_date"
										style="width: 80%;"></td>
									<!-- <td>合同金额(元):</td>
				                      <td class="form-inline">
				                            <input class="form-control" id="edit_contract_money" style="width:50%;">
                               				<button type="button" class="btn btn-primary" onclick="splitContractMoney(1)">拆分合同额</button>
				                      </td> -->
								</tr>
								<tr>
									<td class="jinqianyanse">合同金额(元):</td>
									<td><input class="form-control" placeholder="不含暂定金"
										id="edit_contract_money" onchange="edit_changeRWD(this)"
										style="width: 80%;"></td>
									<td class="jinqianyanse">暂定金(元):</td>
									<td><input class="form-control" id="edit_temporary_money"
										style="width: 80%;"></td>
								</tr>
								<tr>
									<td>合同签订时间:</td>
									<td><input class="form-control" id="edit_year3"
										style="width: 80%;"></td>
									<td></td>
									<td></td>
								</tr>
								<tr>
									<td>收款条件:</td>
									<td colspan="3"><textarea class="form-control" rows="4"
											style="width: 100%;" id="edit_receieve_money_condition"></textarea>
									</td>
								</tr>
								<tr>
									<td>主要概况及工作内容:</td>
									<td colspan="3"><textarea class="form-control" rows="4"
											style="width: 100%;" id="edit_work_info"></textarea></td>
								</tr>
							</tbody>
						</table>

						<!-- <table class="table table-bordered table-condensed" id="">
	                  			<thead>
		                  			<tr>
		                  				<th colspan="6">拆分合同(跨年度合同)</th>
		                  			</tr>
	                  			</thead>
	                  			<tbody>
	                  				
	                  			</tbody>
	                  </table> -->
						<!--  <table class="table table-bordered table-condensed" id="edit_split_table">
							<thead>
								<tr>
		                        	<td style="width:20%;">年份</td>
		                       		<td>金额(元)</td>
		                      	</tr>
							</thead>
							<tbody></tbody>
					    </table> -->

						<table class="table table-bordered table-condensed"
							id="edit_accessory">
							<thead>
								<tr>
									<td style="width: 20%;">合同文本附件: <i
										class="iconfont icon-xingxing-copy" style="color: red;"></i></td>
									<td colspan="2">
										<button type="button" class="btn btn-primary"
											onclick="edit_accessory()">增加附件</button>
									</td>
								</tr>
							</thead>
							<tbody></tbody>
							<tfoot></tfoot>
						</table>
						<table class="table table-bordered table-condensed"
							id="edit_accessory2">
							<thead>
								<tr>
									<td style="width: 20%;">法律顾问签字:</td>
									<td colspan="2">
										<button type="button" class="btn btn-primary"
											onclick="edit_accessory2()">增加附件</button>
									</td>
								</tr>
							</thead>
							<tbody></tbody>
							<tfoot></tfoot>
						</table>
						<div id="edit_renwudanFenpei"></div>
						<!-- <table class="table table-bordered table-condensed" id="xgxieban">
		                   <thead>
		                       <tr>
		                       		<th><button type="button" class="btn btn-primary" onclick="xgcountMoney()">计算年度金额</button></th>
		                            <th colspan="2" style="text-align:right;"><button type="button" class="btn btn-primary" onclick="xgaddBumen()">添加协办部门</button></th>
		                        </tr>
		                   </thead>
		                   <tbody>
		                       <tr>
		                           <td style="width:13%;">主办部门</td>
		                           <td style="width:32%;">
		                               <form class="form-inline">
		                                    <select class="form-control" style="width:160px;" id="xgzhuban">
		                                        
		                                    </select>
		                                    <input type="text" class="form-control" style="width:160px;" placeholder="金额" id="xgzhubanjine">
		                                </form>
		                           </td>
		                           <td></td>
		                       </tr>
		                   </tbody>
		               </table> -->
					</form>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" onclick="quxiaob()">取消</button>
						<button type="button" class="btn btn-success"
							onclick="save_tijiao_view()">保存</button>
						<button type="button" class="btn btn-success"
							onclick="xg_tijiao_view()">提交</button>
					</div>
				</div>

				<div role="tabpanel" class="tab-pane" id="settings">
					<table class="table table-bordered table-condensed">
						<thead>
							<tr>
								<th colspan="10">项目基本信息</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td style="width: 20%;">项目名称:</td>
								<td id="look_prj_name" style="width: 30%;"></td>
								<td style="width: 20%;">任务单号:</td>
								<td id="look_work_no" style="width: 30%;"></td>
							</tr>
							<tr>
								<td>项目类型:</td>
								<td id="look_prj_type"></td>
								<td>经营模式:</td>
								<td id="look_prj_jyms"></td>
							</tr>
						</tbody>
					</table>
					<table class="table table-bordered">
						<thead>
							<tr>
								<th colspan="10">承接合同信息</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td style="width: 20%;">承接合同名称:</td>
								<td id="look_contract_name" style="width: 30%;"></td>
								<td style="width: 20%;">承接合同编号:</td>
								<td id="look_contract_no" style="width: 30%;"></td>
							</tr>
							<tr>
								<td>合同甲方名称:</td>
								<td id="look_jiafangName" colspan="3"></td>
							</tr>
							<tr>
								<td>合同乙方名称:</td>
								<td id="look_yifangName"></td>
								<td>承接部门:</td>
								<td id="look_yifang_department"></td>
							</tr>
							<tr>
								<td>合同起讫日期:</td>
								<td>
									<div class="yihang">
										<div id="look_year"></div>
										--
										<div id="look_year2"></div>
									</div>
								</td>
								<td class="shuziyanse">合同工期(天):</td>
								<td id="look_work_date"></td>
							</tr>
							<tr>
								<td class="jinqianyanse">合同金额(元):</td>
								<td id="look_contract_money"></td>
								<td class="jinqianyanse">暂定金(元):</td>
								<td id="look_temporary_money"></td>
							</tr>
							<tr>
								<td>合同签订时间:</td>
								<td id="look_year3"></td>
								<td></td>
								<td></td>
							</tr>
							<tr>
								<td>收款条件:</td>
								<td colspan="3" id="look_receieve_money_condition"></td>
							</tr>
							<tr>
								<td>主要概况及工作内容:</td>
								<td colspan="3" id="look_work_info"></td>
							</tr>
						</tbody>

					</table>
					<table class="table table-bordered table-condensed"
						id="look_accessory">
						<thead>
							<tr>
								<td style="width: 20%;">合同文本附件 <i
									class="iconfont icon-xingxing-copy" style="color: red;"></i></td>
								<td colspan="3"></td>
							</tr>
						</thead>
						<tbody></tbody>
					</table>
					<table class="table table-bordered table-condensed"
						id="look_accessory2">
						<thead>
							<tr>
								<td style="width: 20%;">法律顾问签字</td>
								<td colspan="3"></td>
							</tr>
						</thead>
						<tbody></tbody>
					</table>
					<table class="table table-bordered table-condensed"
						id="look_saomainHT">
						<thead>
							<tr>
								<td style="width: 20%;">合同扫描件</td>
								<td colspan="3"></td>
							</tr>
						</thead>
						<tbody></tbody>
					</table>
					<div id="look_renwudanFenpei"></div>


					<!-- <table class="table table-bordered table-condensed" id="look_xieban">
	                        <thead>
	                            <tr>
	                                <th colspan="2"  style="width:20%;">部门</th>
	                                <th colspan="2">金额</th>
	                            </tr>
	                        </thead>
	                        <tbody>
	                        </tbody>
	                    </table> -->

					<br />
					<h2 style="color: red; margin-left: 8px;">历史信息</h2>
					<table class="table table-bordered table-condensed"
						id="history_table" style="width: 100%;">
						<thead>
							<tr>
								<th>任务单号</th>
								<th>承接合同名称</th>
								<th>操作</th>
							</tr>
						</thead>
						<tbody>
						</tbody>
					</table>

					<br />
					<h2 style="color: red;">审批详情</h2>
					<table class="table table-bordered table-condensed" id="d_table">
						<thead>
							<tr>
								<th style="width: 30%;">业务名称</th>
								<th style="width: 12%;">操作人</th>
								<th style="width: 23%;">意见</th>
								<th style="width: 12%;">操作类型</th>
								<th style="width: 23%;">操作时间</th>
							</tr>
						</thead>
						<tbody></tbody>
					</table>
					<!-- 分包合同信息 -->
					<br />
					<table class="table table-bordered table-condensed"
						id="look_fbcontract">
						<thead>
						</thead>
						<tbody></tbody>
					</table>

					<div class="modal-footer">
						<a href="" class="btn btn-default" target="view_window"
							style="color: blue;" id="dyyl">打印预览</a>
						<button type="button" class="btn btn-default" onclick="quxiao3()">取消</button>
					</div>

				</div>
			</div>

		</div>

	</div>


	<!-- 提交 modal -->
	<div class="modal fade" tabindex="-1" role="dialog"
		aria-labelledby="myLargeModalLabel" id="tijiaogei">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title" id="gridSystemModalLabel">提交给</h4>
				</div>
				<div class="modal-body">
					<table class="table table-bordered table-condensed" id="tijiaoren">
						<thead>
							<tr>
								<th></th>
								<th>部门</th>
								<th>职务</th>
								<th>审批人</th>
							</tr>
						</thead>
						<tbody>

						</tbody>
					</table>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
					<button type="button" class="btn btn-success" data-dismiss="modal"
						onclick="submitPerson()">提交</button>
				</div>
			</div>
		</div>
	</div>
	<!-- 提交 modal结束 -->

	<!-- Modal2 -->
	<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog"
		aria-labelledby="myLargeModalLabel" id="myModal2">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title" id="myModalLabel">
						<b>取消承接合同</b>
					</h4>
				</div>
				<div class="modal-body">
					<div>
						<form class="form-inline">
							<table class="table table-bordered table-condensed">
								<tr>
									<td>承接合同取消原因</td>
									<td colspan="3"><textarea id="cancel_reason" cols="50"
											rows="5"></textarea></td>
								</tr>
							</table>
						</form>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
					<button type="button" class="btn btn-success"
						onclick="submitCjCancel()">提交</button>
				</div>
			</div>
		</div>
	</div>
	<!-- model2结束 -->
	<!-- Modal3 -->
	<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog"
		aria-labelledby="myLargeModalLabel" id="myModal3">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title" id="myModalLabel">
						<b>承接合同重新启用申请表</b>
					</h4>
				</div>
				<div class="modal-body">
					<div>
						<form class="form-inline">
							<table class="table table-bordered table-condensed">
								<tr>
									<td style="width: 30%;">承接合同取消原因</td>
									<td colspan="3"><textarea id="look_cancel_reason"
											cols="50" rows="5" disabled></textarea></td>
								</tr>
							</table>
							<table class="table table-bordered table-condensed">
								<tr>
									<td style="width: 30%;">承接合同重新启用原因</td>
									<td colspan="3"><textarea id="restart_reason" cols="50"
											rows="5"></textarea></td>
								</tr>
							</table>
						</form>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
					<button type="button" class="btn btn-success"
						onclick="submitCjRestart()">提交</button>
				</div>
			</div>
		</div>
	</div>
	<!-- model3结束 -->
	<!-- 查看取消原因modal -->
	<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog"
		aria-labelledby="myLargeModalLabel" id="look_cancel">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title" id="myModalLabel">
						<b>承接合同取消原因</b>
					</h4>
				</div>
				<div class="modal-body">
					<div>
						<form class="form-inline">
							<table class="table table-bordered table-condensed">
								<thead>
									<tr>
										<th style="width: 8%;">序号</th>
										<th style="width: 70%;">取消原因</th>
										<th style="width: 22%;">取消时间</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<td></td>
										<td></td>
										<td></td>
									</tr>
								</tbody>
							</table>
						</form>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
				</div>
			</div>
		</div>
	</div>
	<!-- model结束 -->
	<!-- Modal4 -->
	<!-- <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="myModal4">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>合同变更</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline">
                        <table class="table table-bordered">
                            <tr>
                                <td>合同名称:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                    <div class="form-group">
                                        <select class="form-control" style="width:180px;"  id="editable-select4">
                                            <option>1</option>
                                            <option>2</option>
                                            <option>3</option>
                                            <option>4</option>
                                            <option>5</option>
                                        </select>
                                    </div>
                                </td>
                                <td style="width:100px;">任务单号:</td>
                                <td>
                                    <div class="form-group">
                                        <select class="form-control" style="width:180px;" id="renwuDanhao4">
                                            <option>1</option>
                                            <option>2</option>
                                            <option>3</option>
                                            <option>4</option>
                                            <option>5</option>
                                        </select><br>
                                        <div id="rwdh"></div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>项目名称:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                    <input type="text" class="form-control" disabled>
                                </td>
                                <td>项目类型:</td>
                                <td><input type="text" class="form-control" disabled></td>
                            </tr>
                            <tr>
                                <td>合同甲方名称:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                    <select class="form-control" style="width:180px;">
                                        <option>1</option>
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5</option>
                                    </select>
                                </td>
                                <td>合同乙方名称:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                    <select class="form-control" style="width:180px;">
                                        <option>江苏华通工程检测有限公司</option>
                                        <option>江苏华汇工程检测有限公司</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>合同起日期:</td>
                                <td>
                                    <div class="form-group">
                                        <input class="form-control" id="yearx4">
                                        </input>
                                    </div>
                                </td>
                                <td>合同讫日期:</td>
                                <td> 
                                    <div class="form-group">
                                        <input class="form-control" id="year2x4">
                                        </input>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>承接部门:</td>
                                <td>
                                    <select class="form-control" style="width:180px;">
                                        <option>1</option>
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5</option>
                                    </select>
                                </td>
                                <td>合同工期:</td>
                                <td>
                                    <input class="form-control">
                                </td>
                            </tr>
                            <tr>
                                <td>收款条件:</td>
                                <td>
                                    <input class="form-control">
                                </td>
                                <td>合同原金额（不含暂定金）:</td>
                                <td><input class="form-control"></td>
                            </tr>
                            <tr>
                                <td>原暂定金:</td>
                                <td><input class="form-control"></td>
                                <td>合同签订时间:</td>
                                <td><input class="form-control"></td>
                            </tr>
                            <tr>
                                <td>变更后合同金额</td>
                                <td><input class="form-control"></td>
                                <td>变更后暂定金</td>
                                <td><input class="form-control"></td>
                            </tr>
                            
                            <tr>
                                <td>合同文本:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td><input type="file" class="form-control"></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>变更附件:</td>
                                <td><input type="file" class="form-control"></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>主要概况及工作内容:</td>
                                <td colspan="3">
                                    <div class="form-group">
                                        <textarea class="form-control" rows="4" cols="50"></textarea>
                                    </div> 
                                </td>
                            </tr>
                        </table>

                        <table class="table table-bordered table-condensed" id="bgxieban">
                            <thead>
                                <tr>
                                    <th colspan="2">添加的协办部门</th>
                                </tr>
                                <tr>
                                 	<th colspan="2" style="text-align:right;"><button type="button" class="btn btn-primary" onclick="bgaddBumen()">添加协办部门</button></th>
                             	</tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>主办金额</td>
                                    <td>
                                        <form class="form-inline">
                                          <select class="form-control" style="width:150px;" id="bgzhubanbumen">
                                              
                                          </select>
                                          <input type="text" class="form-control" style="width:150px;" placeholder="金额" id="bgzhubanjine">
                                      </form>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-default">保存</button>
            <button type="button" class="btn btn-success">提交</button>
        </div>
        </div>
    </div>
</div> -->
	<!-- model4结束 -->
	<!-- Modal -->
	<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog"
		aria-labelledby="myLargeModalLabel" id="chooseNo">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title" id="myModalLabel">
						<b>选择任务单号</b>
					</h4>
				</div>
				<div class="modal-body">
					<div>
						<form class="form-inline" method="post" id="new_form"
							enctype="multipart/form-data">
							<table class="table table-bordered table-condensed">
								<tr>
									<td style="width: 20%;">任务单号：</td>
									<td><select class="selectpicker show-tick form-control"
										style="width: 100%;" id="selectpicker_no" multiple
										data-live-search="true">
									</select></td>
								</tr>
							</table>
						</form>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" onclick="quxiao2()">取消</button>
					<button type="button" class="btn btn-success" onclick="saveNo()">保存</button>
				</div>
			</div>
		</div>
	</div>
	<!-- model结束 -->

	<!-- Modal -->
	<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog"
		aria-labelledby="myLargeModalLabel" id="chooseName">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title" id="myModalLabel">
						<b>选择项目名称</b>
					</h4>
				</div>
				<div class="modal-body">
					<div>
						<form class="form-inline" method="post" id="new_form"
							enctype="multipart/form-data">
							<table class="table table-bordered table-condensed">
								<tr>
									<td style="width: 20%;">项目名称：</td>
									<td><select class="selectpicker show-tick form-control"
										style="width: 100%;" id="selectpicker_name" multiple
										data-live-search="true">
									</select></td>
								</tr>
							</table>
						</form>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" onclick="quxiao()">取消</button>
					<button type="button" class="btn btn-success" onclick="saveName()">保存</button>
				</div>
			</div>
		</div>
	</div>
	<!-- model结束 -->

	<!-- allMsg2 -->
	<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog"
		aria-labelledby="myLargeModalLabel" id="allMsg2">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title" id="myModalLabel">
						<b>所有信息</b>
					</h4>
				</div>
				<div class="modal-body">
					<div>
						<form class="form-inline">
							<table class="table table-bordered table-condensed">
								<thead>
									<tr>
										<th colspan="10">项目基本信息</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<td>任务单号:</td>
										<td id="look_work_no2"></td>
										<td style>项目名称:</td>
										<td id="look_prj_name2"></td>
									</tr>
									<tr>
										<td>项目类型:</td>
										<td id="look_prj_type2"></td>
										<td></td>
										<td></td>
									</tr>
								</tbody>
							</table>
							<table class="table table-bordered">
								<thead>
									<tr>
										<th colspan="10">项目基本信息</th>
									</tr>
								</thead>
								<tbody>

								</tbody>
								<tr>
									<td>承接合同名称:</td>
									<td id="look_contract_name2"></td>
									<td>承接合同编号:</td>
									<td id="look_contract_no2"></td>
								</tr>
								<tr>
									<td>合同甲方名称:</td>
									<td id="look_jiafangName2" colspan="3"></td>
								</tr>
								<tr>
									<td>合同乙方名称:</td>
									<td id="look_yifangName2"></td>
									<td>承接部门:</td>
									<td id="look_yifang_department2"></td>
								</tr>
								<tr>
									<td>合同起讫日期:</td>
									<td>
										<div id="look_year_2"></div>
										<div id="look_year2_2"></div>
									</td>
									<td>合同工期(天):</td>
									<td id="look_work_date2"></td>
								</tr>
								<tr>
									<td class="jinqianyanse">合同金额(元):</td>
									<td id="look_contract_money2"></td>
									<td class="jinqianyanse">暂定金(元):</td>
									<td id="look_temporary_money2"></td>
								</tr>
								<tr>
									<td>合同签订时间:</td>
									<td id="look_year3_2"></td>
									<td></td>
									<td></td>
								</tr>
								<tr>
									<td>收款条件:</td>
									<td id="look_receieve_money_condition2" colspan="3"></td>
								</tr>
								<tr>
									<td>主要概况及工作内容:</td>
									<td colspan="3" id="look_work_info2"></td>
								</tr>
							</table>
							<table class="table table-bordered table-condensed"
								id="look_split_table2">
								<thead>
									<tr>
										<td>年份</td>
										<td class="jinqianyanse">金额(元)</td>
									</tr>
								</thead>
								<tbody></tbody>
							</table>
							<table class="table table-bordered table-condensed"
								id="look_accessory3">
								<thead>
									<tr>
										<td style="width: 15%;">合同文本附件 <i
											class="iconfont icon-xingxing-copy" style="color: red;"></i></td>
										<td colspan="3"></td>
									</tr>
								</thead>
								<tbody></tbody>
							</table>
							<table class="table table-bordered table-condensed"
								id="look_accessory4">
								<thead>
									<tr>
										<td style="width: 15%;">法律顾问签字</td>
										<td colspan="3"></td>
									</tr>
								</thead>
								<tbody></tbody>
							</table>


							<table class="table table-bordered table-condensed"
								id="look_xieban2">
								<thead>
									<tr>
										<th colspan="2">部门</th>
										<th colspan="2">金额</th>
									</tr>
								</thead>
								<tbody>
								</tbody>
							</table>
						</form>
					</div>
				</div>

				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
				</div>
			</div>
		</div>
	</div>
	<!-- allMsg结束 -->
	<div class="modal fade" tabindex="-1" role="dialog"
		aria-labelledby="myLargeModalLabel" id="split">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title" id="myModalLabel" style='width: 60%;'>
						<b>拆分合同额</b>
					</h4>
				</div>
				<div class="modal-body">
					<div>
						<form class="form-inline">
							<table class="table table-bordered table-condensed"
								id="split_table">
								<thead>
									<tr>
										<td>年份</td>
										<td class="jinqianyanse">金额(元)</td>
									</tr>
								</thead>
								<tbody>
								</tbody>
							</table>
						</form>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default"
						onclick="quxiaoSplit()">取消</button>
					<button type="button" class="btn btn-success"
						onclick="saveSplitMoney()">保存</button>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade" tabindex="-1" role="dialog"
		aria-labelledby="myLargeModalLabel" id="xgsplit">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title" id="myModalLabel" style='width: 60%;'>
						<b>拆分合同额</b>
					</h4>
				</div>
				<div class="modal-body">
					<div>
						<form class="form-inline">
							<table class="table table-bordered table-condensed"
								id="xgsplit_table">
								<thead>
									<tr>
										<td>年份</td>
										<td class="jinqianyanse">金额(元)</td>
									</tr>
								</thead>
								<tbody>
								</tbody>
							</table>
						</form>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default"
						onclick="checkquxiaoSplit()">取消</button>
					<button type="button" class="btn btn-success"
						onclick="checkSaveSplitMoney()">保存</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Modal 计算工期-->
	<div class="modal fade" id="jisuangongqi" tabindex="-1" role="dialog"
		aria-labelledby="myModalLabel">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title" id="myModalLabel">计算工期</h4>
				</div>
				<div class="modal-body">
					<table class="table table-bordered table-condensed">
						<tr>
							<td>开始时间</td>
							<td><input type="text" class="form-control" id="jisuangqks"></td>
							<td>结束时间</td>
							<td><input type="text" class="form-control" id="jisuangqjs"></td>
						</tr>
					</table>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
					<button type="button" class="btn btn-primary" data-dismiss="modal">保存</button>
				</div>
			</div>
		</div>
	</div>
	<!-- Modal 计算工期结束-->
	<!-- Modal 计算工期-->
	<div class="modal fade" id="xgjisuangongqi" tabindex="-1" role="dialog"
		aria-labelledby="myModalLabel">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title" id="myModalLabel">计算工期</h4>
				</div>
				<div class="modal-body">
					<table class="table table-bordered table-condensed">
						<tr>
							<td>开始时间</td>
							<td><input type="text" class="form-control"
								id="xgjisuangqks"></td>
							<td>结束时间</td>
							<td><input type="text" class="form-control"
								id="xgjisuangqjs"></td>
						</tr>
					</table>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
					<button type="button" class="btn btn-primary" data-dismiss="modal">保存</button>
				</div>
			</div>
		</div>
	</div>
	<!-- Modal 计算工期结束-->
	<!-- Modal合同扫描件开始 -->
	<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog"
		aria-labelledby="myLargeModalLabel" id="addSaoMiaohtModel">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title" id="myModalLabel">
						<b>合同扫描件</b>
					</h4>
				</div>
				<div class="modal-body">
					<div>
						<form id="new_form" class="form-inline" method="post"
							enctype="multipart/form-data">
							<table class="table table-bordered table-condensed">
								<tr>
									<td style="width: 15%;">合同扫描件文件名</td>
									<td style="width: 35%;"><input type="file"
										id="saomiaofileUrl" name="file" class="form-control"
										style="width: 75%;" multiple="multiple"> <!--<button type="button" style="margin-left: 5px;" class="btn btn-primary" id="chosexm">选择文件</button>-->
									</td>

								</tr>
							</table>
						</form>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
					<button type="button" class="btn btn-primary"
						onclick="savesaomiaohetongjian(this)">上传文件</button>
				</div>
			</div>
		</div>
	</div>
	<!-- model结束 合同扫描件 -->
	
	<!-- 提交 modal -->
	<div class="modal fade" tabindex="-1" role="dialog"
		aria-labelledby="myLargeModalLabel" id="baocun_view_modal">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title">请填写变更意见</h4>
				</div>
				<div class="modal-body">
					<textarea class="form-control emptyC" rows="3" style="width: 100%;"
						id="baocun_views"></textarea>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
					<button type="button" class="btn btn-success"
						onclick="edit_save()">保存</button>
				</div>
			</div>
		</div>
	</div>
	<!-- 提交 modal结束 -->
	
	<!-- 提交 modal -->
	<div class="modal fade" tabindex="-1" role="dialog"
		aria-labelledby="myLargeModalLabel" id="tijiao_view_modal">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title">请填写变更意见</h4>
				</div>
				<div class="modal-body">
					<textarea class="form-control emptyC" rows="3" style="width: 100%;"
						id="tijiao_views"></textarea>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
					<button type="button" class="btn btn-success"
						onclick="edit_submit()">提交</button>
				</div>
			</div>
		</div>
	</div>
	<!-- 提交 modal结束 -->
</body>
<script src="../../js/jquery.js"></script>
<script src="../../js/common-scripts.js"></script>
<script src="../../js/bootstrap.min.js"></script>
<!-- <script src="../../js/jquery-editable-select.js"></script> -->
<script src="../../js/laydate/laydate.js"></script>
<script src="../../toastr/toastr.js"></script>
<script src="../../js/jquery-form.min.js"></script>
<script src="../../js/bootstrap-select.js"></script>
<script src="../../js/quanxian.js"></script>
<script src="../../js/SmartNotification.min.js"></script>
<script src="../../js/myTool.js"></script>
<script src="../../js/datatables/jquery.dataTables.min.js"></script>
<script src="../../js/datatables/dataTables.colVis.min.js"></script>
<script src="../../js/datatables/dataTables.tableTools.min.js"></script>
<!-- <script src="../../js/datatables/dataTables.bootstrap.min.js"></script> -->
<script src="../../js/datatables/datatables.responsive.min.js"></script>
<script src="../../js/datatables/dataTables.buttons.min.js"></script>
<script src="../../js/datatables/buttons.html5.min.js"></script>
<script src="../../js/datatables/buttons.flash.min.js"></script>
<script src="../../js/datatables/jszip.min.js"></script>
<!-- 固定表列引入js文件 -->
<script src="../../js/dataTables.fixedColumns.js"></script>
<script>
	$(document).ready(
			function() {
				laydate.render({
					elem : '#year' //指定元素
				});
				laydate
						.render({
							elem : '#year2' //指定元素
							,
							done : function(value, date, endDate) {
								if ($("#year").val() != ""
										|| $("#year").val() != null) {
									var t1 = $("#year").val();
									var d1 = t1.replace(/\-/g, "/");
									var date1 = new Date(d1);

									var t2 = $("#year2").val();
									var d2 = t2.replace(/\-/g, "/");
									var date2 = new Date(d2);

									var timeType = 1000 * 3600 * 24;
									var aa = parseInt((date2.getTime() - date1
											.getTime())
											/ parseInt(timeType));
									$("#work_date").val(aa + "天");
								}
							}
						});
				laydate.render({
					elem : '#year3' //指定元素
				});
				laydate.render({
					elem : '#edit_year' //指定元素
				});
				laydate.render({
					elem : '#edit_year2' //指定元素
					,
					done : function(value, date, endDate) {
						if ($("#edit_year").val() != ""
								|| $("#edit_year").val() != null) {
							var t1 = $("#edit_year").val();
							var d1 = t1.replace(/\-/g, "/");
							var date1 = new Date(d1);

							var t2 = $("#edit_year2").val();
							var d2 = t2.replace(/\-/g, "/");
							var date2 = new Date(d2);

							var timeType = 1000 * 3600 * 24;
							var aa = parseInt((date2.getTime() - date1
									.getTime())
									/ parseInt(timeType));
							$("#edit_work_date").val(aa + "天");
						}
					}
				});
				//合同工期
				laydate.render({
					elem : '#jisuangqks' //指定元素
				});
				laydate.render({
					elem : '#jisuangqjs' //指定元素
				});
				laydate.render({
					elem : '#xgjisuangqks' //指定元素
				});
				laydate.render({
					elem : '#xgjisuangqjs' //指定元素
				});

				laydate.render({
					elem : '#seach_start_time_min' //指定元素
				});
				laydate.render({
					elem : '#seach_start_time_max' //指定元素
				});
				laydate.render({
					elem : '#seach_end_time_min' //指定元素
				});
				laydate.render({
					elem : '#seach_end_time_max' //指定元素
				});
				laydate.render({
					elem : '#seach_lx_date_min' //指定元素
				});
				laydate.render({
					elem : '#seach_lx_date_max' //指定元素
				});

				laydate.render({
					elem : 'input[name=split_date]',
					type : 'year'
				});
				//$("#zhuangtai").trigger("change");
				initTable();
				initType()
				initbumen();
				initSelect();
				initCooperator();
				initFenGs();
				//initDetailContract();
				$("#sousuodiv").hide();//超级搜索折叠div

			});

	//超级搜索折叠div
	var zhediepanduan = true;
	$("#zhedieBtn").click(function() {
		if (zhediepanduan == true) {
			$("#sousuodiv").show(300);
			zhediepanduan = false;
		} else {
			$("#sousuodiv").hide(300);
			zhediepanduan = true;
		}
	})

	$("#diyi a").hide();
	$("#dier a").hide();
	$("#disan a").hide();
	$("#disi a").hide();
	$("#zenjia").click(function() {
		$("#diyi").removeClass("active");
		$("#dier").addClass("active");
		$("#diyi a").show();
		$("#dier a").show();
		$("#home").removeClass("active");
		$("#profile").addClass("active");
	})
	function quxiaoa() {
		$("#diyi").addClass("active");
		$("#dier").removeClass("active");
		$("#diyi a").hide();
		$("#dier a").hide();
		$("#home").addClass("active");
		$("#profile").removeClass("active");
		$("#profile input").val("");
		$("#receieve_money_condition").val("");
		$("#work_info").val("");
	}
	function quxiaob() {
		$("#diyi").addClass("active");
		$("#disan").removeClass("active");
		$("#diyi a").hide();
		$("#disan a").hide();
		$("#home").addClass("active");
		$("#messages").removeClass("active");
	}
	function quxiao3() {
		$("#diyi").addClass("active");
		$("#disi").removeClass("active");
		$("#diyi a").hide();
		$("#disi a").hide();
		$("#home").addClass("active");
		$("#settings").removeClass("active");
	}
	function quxiaoSplit() {
		$("#split").modal('hide')
	}
	function checkquxiaoSplit() {
		$("#xgsplit").modal('hide')
	}

	var table = $('#mainContent')
			.DataTable(
					{
						"deferRender" : true,
						"processing" : true,
						"bDestroy" : true,
						"iDisplayLength" : 10,
						"sDom" : "t"
								+ "<'dt-toolbar-footer'<'col-sm-6 col-xs-12 hidden-xs'i><'col-xs-12 col-sm-6'p>>",
						"searching" : true,
						"lengthChange" : false,
						"autoWidth" : true,
						"sScrollX" : true,
						"fixedColumns" : {
							"leftColumns" : 1,
						},
						"oLanguage" : {
							"sSearch" : '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
						},
						"columns" : [
								{
									"data" : "contractNo"
								},
								{
									"data" : "contractName"
								},
								{
									"data" : "ccName"
								},
								{
									"data" : null
								},
								{
									"data" : "contractNameYi"
								},
								{
									"data" : "contractMoney",
									render : $.fn.dataTable.render.number(',',
											'.', 2, '')
								},
								{
									"data" : "contractMoneyOld",
									render : $.fn.dataTable.render.number(',',
											'.', 2, '')
								}, {
									"data" : "contractSignTime"
								}, {
									"data" : "doDate"
								}, {
									"data" : null
								}, {
									"data" : "starterName"
								}, {
									"data" : "omName"
								}, {
									"data" : "status"
								}, {
									"data" : "status"
								}, ],
						"columnDefs" : [
								{
									"class" : "tcenter",
									"targets" : 9,
									"searchable" : true,
									"render" : function(data, type, full) {
										var htgongqi;
										if (full.contractStartTime != null
												&& full.contractStartTime != ''
												&& full.contractEndTime != null
												&& full.contractEndTime != '') {
											htgongqi = full.contractStartTime
													+ "~"
													+ full.contractEndTime
										} else {
											htgongqi = ""
										}
										return htgongqi
									}
								},
								{
									"class" : "tcenter",
									"targets" : 12,
									"searchable" : true,
									"render" : function(data, type, full) {
										if (data == '2') {
											return '<span class="label label-success state">已通过</span>';
										} else if (data == '1') {
											return '<span class="label label-info state">审批中</span>';
										} else if (data == '3') {
											return '<span class="label label-danger state">终止</span>';
										} else {
											return '';
										}
									}
								},
								{
									"class" : "tcenter",
									"targets" : 13,
									"searchable" : true,
									"render" : function(data, type, full) {
										var xiangqinghtml = '<i class="iconfont icon-icon-test Pecab" style="font-size:20px;cursor:pointer;display:none;" title="查看详细信息" id="'
												+ data.cjId
												+ '"  onclick="lookDetall(this)"></i>'
										var xiugaihtml = '<i class="iconfont icon-xiugai iconxiugai Pecac" style="font-size:20px;cursor:pointer;margin-left:3px;display:none;" title="合同变更" onclick="contractChange(this)"></i>';
										var chongqihtml = '<i class="iconfont icon-arrow chongqi Pecaf" style="font-size:20px;cursor:pointer;display:none;margin-left:3px;" title="承接合同启用" onclick="openModal3(this)"></i>';
										var quxiaohtml = '<i class="iconfont icon-tuichu iconquxiao Pecad" style="font-size:20px;cursor:pointer;margin-left:3px;display:none;" title="承接合同取消"  onclick="openModal2(this)"></i>';
										var buluhtml = '<i class="iconfont icon-kaibiao Pecab" style="font-size:18px;cursor:pointer;display:none;" title="补录扫描合同件"  onclick="addsaomiaohetongjian(this)"></i>';
										if (data == '2') {
											return xiangqinghtml + xiugaihtml
													+ quxiaohtml + buluhtml;
										} else if (data == '1') {
											return xiangqinghtml;
										} else if (data == '3') {
											return xiangqinghtml + chongqihtml;
										} else {
											return '';
										}
									}
								},
								{
									"class" : "tcenter",
									"targets" : 3,
									"searchable" : true,
									"render" : function(data, type, full) {
										if (data == "" || data == null
												|| data == undefined
												|| data == "null") {
											return '无';
										} else if (data.taskCode.indexOf(",") == -1) {
											return '<a href="../chankanxiangqing/taskDetails.html?prjNo='
													+ data.taskCode
													+ '" target="_blank" style="color:blue;">'
													+ data.taskCode + '</a>';
										} else {
											var dataArr = data.taskCode
													.split(",");
											var html;
											if (dataArr != null) {
												for (var i = 0; i < dataArr.length; i++) {
													if (i == 0) {
														html = '<a href="../chankanxiangqing/taskDetails.html?prjNo='
																+ dataArr[i]
																+ '" target="_blank" style="color:blue;">'
																+ dataArr[i]
																+ '</a>';
													} else {
														html += '<br/><a href="../chankanxiangqing/taskDetails.html?prjNo='
																+ dataArr[i]
																+ '" target="_blank" style="color:blue;">'
																+ dataArr[i]
																+ '</a>';
													}
												}

											}
											return html;
										}

									}
								} ],
						"fnDrawCallback" : function() {

							$.ajax({
								type : "post",
								url : getContextPath() + "/login/getUser",
								async : false,
								data : {},
								success : function(json) {

									if (json != null && json != "") {
										var arr = json.uPermissions.split(',');

										for (var i = 0; i < arr.length; i++) {
											var arr2 = arr[i].replace("+", "");
											//console.log(arr2);
											if (arr[i].indexOf("Pecab") >= 0) {
												$(".Pecab").show();
											}
											if (arr[i].indexOf("Pecac") >= 0) {
												$(".Pecac").show();
											}
											if (arr[i].indexOf("Pecad") >= 0) {
												$(".Pecad").show();
											}
										}

									}

								}
							});

						},
						//"order": [[0, 'desc']],
						"order" : [],
						"oLanguage" : { //国际化配置
							"sProcessing" : "正在获取数据，请稍后...",
							"sLengthMenu" : "显示 _MENU_ 条",
							"sZeroRecords" : "查询不到相关数据",
							"sInfo" : "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
							"sInfoEmpty" : "记录数为0",
							"sInfoFiltered" : "(全部记录数 _MAX_ 条)",
							"sInfoPostFix" : "",
							"sSearch" : "搜索",
							"sUrl" : "",
							"oPaginate" : {
								"sFirst" : "第一页",
								"sPrevious" : "上一页",
								"sNext" : "下一页",
								"sLast" : "最后一页"
							}
						},
						"buttons" : [ {
							extend : "excel",
							text : "导出excel",
							filename : '承接合同',
							exportOptions : {
								format : {
									header : function(data) {
										return data;
									},
									body : function(data, columnIdx, rowIdx,
											code) {
										if (rowIdx == 3) {
											//data=data.replace("</a>","")
											if (data != "无") {
												/* var start = data.indexOf(">");
												var end = data.lastIndexOf("<");
												data = data.substring(start+1,end);
												 */
												if (data.indexOf("<br/>") >= 0) {
													var a = data.split("<br/>")
													var val = "";
													for (var i = 0; i < a.length; i++) {
														val += $(a[i]).html()
																+ ","
													}
													var index = val
															.lastIndexOf(",")
													data = val.substring(0,
															index);
												} else {
													var start = data
															.indexOf(">");
													var end = data
															.lastIndexOf("<");
													data = data.substring(
															start + 1, end);
												}
											}
										}
										return data;
									}
								},
								columns : [ 0, 1, 2, 3, 4, 5, 6, 7, 8 ]
							}
						} ]
					});

	$('#mainContent').dataTable().fnClearTable();
	myTool.mask.show('查询中...');

	$(".hasinput").on(
			'change',
			function() {
				table.column($(this).parent().index() + ':visible').search(
						this.value).draw(false);
			});

	table.buttons().container().appendTo($('#tabBtn'));
	$('.buttons-excel').addClass('btn btn-primary');

	var table2 = $('#history_table')
			.dataTable(
					{
						"deferRender" : true,
						"processing" : true,
						"bDestroy" : true,
						"iDisplayLength" : 10,
						"searching" : true,
						"lengthChange" : false,
						"oLanguage" : {
							"sSearch" : '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
						},
						"columns" : [ {
							"data" : "taskCode"
						}, {
							"data" : "contractName"
						}, {
							"data" : null
						}, ],
						"columnDefs" : [ {
							"class" : "tcenter",
							"targets" : 2,
							"searchable" : true,
							"render" : function(data, type, full) {
								return '<i class="iconfont icon-icon-test" style="font-size:18px;cursor:pointer;" title="查看详细信息"  onclick="lookHistory(this)"></i>'
							}
						} ],
						"order" : [ [ 1, 'asc' ] ],
						"oLanguage" : { //国际化配置
							"sProcessing" : "正在获取数据，请稍后...",
							"sLengthMenu" : "显示 _MENU_ 条",
							"sZeroRecords" : "查询不到相关数据",
							"sInfo" : "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
							"sInfoEmpty" : "记录数为0",
							"sInfoFiltered" : "(全部记录数 _MAX_ 条)",
							"sInfoPostFix" : "",
							"sSearch" : "搜索",
							"sUrl" : "",
							"oPaginate" : {
								"sFirst" : "第一页",
								"sPrevious" : "上一页",
								"sNext" : "下一页",
								"sLast" : "最后一页"
							}
						},

					});

	function initTable() {
		//var zt=$("#zhuangtai").val();
		var startMin = $("#seach_start_time_min").val();
		var startMax = $("#seach_start_time_max").val();
		var endMin = $("#seach_end_time_min").val();
		var endMax = $("#seach_end_time_max").val();
		var mainDp = $("#seach_main_department").val();
		var xbDp = $("#seach_xb_department").val();
		var contractMoneyMin = $("#seach_contract_money_min").val();
		var contractMoneyMax = $("#seach_contract_money_max").val();
		var zdMoneyMin = $("#seach_zd_money_min").val();
		var zdMoneyMax = $("#seach_zd_money_max").val();
		var lxdateMin = $("#seach_lx_date_min").val();
		var lxdateMax = $("#seach_lx_date_max").val();
		var erjileixing = $("#search_erjileixing").val();
		$.ajax({
			type : 'POST',
			url : getContextPath() + '/cj/selectCjContractBySome',
			dataType : 'json',
			data : {
				//status:2,
				startMin : startMin,
				startMax : startMax,
				endMin : endMin,
				endMax : endMax,
				mainDp : mainDp,
				xbDp : xbDp,
				contractMoneyMin : contractMoneyMin,
				contractMoneyMax : contractMoneyMax,
				zdMoneyMin : zdMoneyMin,
				zdMoneyMax : zdMoneyMax,
				lxdateMin : lxdateMin,
				lxdateMax : lxdateMax,
				erjileixing : erjileixing,
			},
			success : function(json) {
				console.log(json)
				$('#mainContent').dataTable().fnClearTable();
				$('#mainContent').DataTable().rows.add(json).draw(false);
				$("[aria-label*='审批状态']").trigger("click");
				myTool.mask.hide();
				/* if(json.status==1)
				 {
				 $(".chongqi").hide();
				    $(".iconquxiao").hide();
				    $(".iconxiugai").hide();
				    $(".iconwanjie").hide();
				 }
				if(json.status==2)
				{
				 $(".chongqi").hide();
				    $(".iconquxiao").show();
				    $(".iconxiugai").show();
				    $(".iconwanjie").show();
				}
				if(json.status==3)
				{
				 $(".chongqi").show();
				    $(".iconquxiao").hide();
				    $(".iconxiugai").hide();
				    $(".iconwanjie").hide();
				}  */
			}
		});
	}

	function getCreat(bb) {
		var EnterpriseRating = $(bb).parent().prev().text();
		var Remarks = $(bb).parent().prev().prev().text();
		var ContactPhone1 = $(bb).parent().prev().prev().prev().text();
		var Contacts = $(bb).parent().prev().prev().prev().prev().text();
		var address = $(bb).parent().prev().prev().prev().prev().prev().text();
		var ProprietorUnit = $(bb).parent().prev().prev().prev().prev().prev()
				.prev().text();
		var Code = $(bb).parent().prev().prev().prev().prev().prev().prev()
				.prev().text();
		$("#CEnterprise-rating").val(EnterpriseRating);
		$("#CRemarks").val(Remarks);
		$("#CContact-phone1").val(ContactPhone1);
		$("#CContacts").val(Contacts);
		$("#Caddress").val(address);
		$("#CProprietor-unit").val(ProprietorUnit);
		$("#CCode").val(Code);
		rowIndex = bb.parentNode.parentNode.rowIndex;
	}

	function seachAll() {
		//$("#zhuangtai").trigger("change");
		initTable();
	}

	/*  $("#zhuangtai").change(function(){
	     var zt=$("#zhuangtai").val();
	     var startMin=$("#seach_start_time_min").val();
	     var startMax=$("#seach_start_time_max").val();
	     var endMin=$("#seach_end_time_min").val();
	     var endMax=$("#seach_end_time_max").val();
	     var mainDp=$("#seach_main_department").val();
	     var xbDp=$("#seach_xb_department").val();
	     var contractMoneyMin=$("#seach_contract_money_min").val();
	     var contractMoneyMax=$("#seach_contract_money_max").val();
	     var zdMoneyMin=$("#seach_zd_money_min").val();
	     var zdMoneyMax=$("#seach_zd_money_max").val(); 
	     if(zt=="合同取消"){
	         $.ajax({
	             type: 'POST',
	             url: getContextPath()+'/cj/selectCjContractBySome',
	             dataType: 'json',
	             data: {
	             	status:3,
	             	startMin:startMin,
	             	startMax:startMax,
	             	endMin:endMin,
	             	endMax:endMax,
	             	mainDp:mainDp,
	             	xbDp:xbDp,
	             	contractMoneyMin:contractMoneyMin,
	             	contractMoneyMax:contractMoneyMax,
	             	zdMoneyMin:zdMoneyMin,
	             	zdMoneyMax:zdMoneyMax
	             },
	             success: function (json) {
	                 $('#mainContent').dataTable().fnClearTable();
	                 $('#mainContent').DataTable().rows.add(json).draw(false);
	                 $(".chongqi").show();
	                 $(".iconquxiao").hide();
	                 $(".iconxiugai").hide();
	                 $(".iconwanjie").hide();
	                 
	                 
	             }
	         });
	         
	     }else if(zt=="审批中"){
	     	$.ajax({
	             type: 'POST',
	             url: getContextPath()+'/cj/selectCjContractByStatus',
	             dataType: 'json',
	             data: {
	             	status:1,
	             	startMin:startMin,
	             	startMax:startMax,
	             	endMin:endMin,
	             	endMax:endMax,
	             	mainDp:mainDp,
	             	xbDp:xbDp,
	             	contractMoneyMin:contractMoneyMin,
	             	contractMoneyMax:contractMoneyMax,
	             	zdMoneyMin:zdMoneyMin,
	             	zdMoneyMax:zdMoneyMax
	             },
	             success: function (json) {
	                 $('#mainContent').dataTable().fnClearTable();
	                 $('#mainContent').DataTable().rows.add(json).draw(false);
	                 $(".chongqi").hide();
	                 $(".iconquxiao").hide();
	                 $(".iconxiugai").hide();
	                 $(".iconwanjie").hide();
	             }
	         });
	     }else if(zt=="审批结束"){
	     	 $.ajax({
	              type: 'POST',
	              url: getContextPath()+'/cj/selectCjContractByStatus',
	              dataType: 'json',
	              data: {
	              	status:2,
	              	startMin:startMin,
	             	startMax:startMax,
	             	endMin:endMin,
	             	endMax:endMax,
	             	mainDp:mainDp,
	             	xbDp:xbDp,
	             	contractMoneyMin:contractMoneyMin,
	             	contractMoneyMax:contractMoneyMax,
	             	zdMoneyMin:zdMoneyMin,
	             	zdMoneyMax:zdMoneyMax
	              },
	              success: function (json) {
	                  $('#mainContent').dataTable().fnClearTable();
	                  $('#mainContent').DataTable().rows.add(json).draw(false);
	                  $(".chongqi").hide();
	                  $(".iconquxiao").show();
	                  $(".iconxiugai").show();
	                  
	                  $(".iconwanjie").show();
	              }
	          });
	     }
	 }) */
	$('#mainContent').dataTable().fnClearTable();
	myTool.mask.show('查询中...');
	//增加部门
	function addBumen() {
		for ( var i in pageNameList) {
			var num = $("#xieban" + i + " tr").length - 1;
			if (($("#xieban" + i + " tr").length) <= 4) {
				$("#xieban" + i + " tbody")
						.append(
								"<tr><td>"
										+ "协办部门"
										+ num
										+ "</td><td>"
										+ '<form class="form-inline">'
										+ '<select class="form-control" id="xieban'+num+''+i+'" style="width:150px;">'
										+ '</select>'
										+ '<input type="text" id="xiebanMoney'+i+'" class="form-control" style="width:150px;" placeholder="金额">'
										+ "<button style='margin-left:15px;' type='button' class='btn btn-primary' onclick='removeXieBan(this)'>移除协办部门</button>"
										+ '</form>'
										+ "</td><td>"
										+ '<div class="yihang" ><div style="width:80px;">分摊比例:</div>'
										+ '<input type="text" id="xiebanMoney'+i+'" class="form-control" style="width:150px;" placeholder="金额"></div>'
										+ "</td></tr>");
				$
						.ajax({
							type : 'POST',
							url : getContextPath()
									+ '/organizationManagement/selectProductionDepartment',
							dataType : 'json',
							async : false,
							data : {

							},
							error : function(msg) {
								toastr.error("请求失败");
							},
							success : function(json) {
								$("#xieban" + num + "" + i + "").empty();
								for (var j = 0; j < json.length; j++) {
									$("#xieban" + num + "" + i + "").append(
											"<option value="+json[j].omId+">"
													+ json[j].omName
													+ "</option>");
								}
							}
						});
			} else {
				toastr.error("协办部门已达上限")
			}
		}
	}

	//增加部门
	function addBumenEdit(i, task) {
		if (task.assistDepartment1 != "" && task.assistDepartment1 != null) {
			$("#xieban" + i + " tbody")
					.append(
							"<tr><td>协办部门1</td><td>"
									+ '<form class="form-inline">'
									+ '<select class="form-control" id="xieban1'+task.prjNo+'" style="width:150px;">'
									+ '</select>'
									+ '<input type="text" id="xiebanMoney'+task.prjNo+'" value="'+task.assistDepartment1Money+'" class="form-control" style="width:150px;" placeholder="金额">'
									+ "<button style='margin-left:15px;' type='button' class='btn btn-primary' onclick='removeXieBan(this)'>移除协办部门</button>"
									+ '</form>'
									+ "</td><td>"
									+ '<div class="yihang" ><div style="width:80px;">分摊比例:</div>'
									+ '<input type="text" id="xiebanCost'+task.prjNo+'" value="'+task.assistDepartment1Cost+'" class="form-control" style="width:150px;" placeholder="金额"></div>'
									+ "</td></tr>");
			initXiebanSelect(task, 1);
			$("#xieban1" + task.prjNo + "").val(task.assistDepartment1);

		}
		if (task.assistDepartment2 != "" && task.assistDepartment2 != null) {
			$("#xieban" + i + " tbody")
					.append(
							"<tr><td>协办部门2</td><td>"
									+ '<form class="form-inline">'
									+ '<select class="form-control" id="xieban2'+task.prjNo+'" style="width:150px;">'
									+ '</select>'
									+ '<input type="text" id="xiebanMoney'+task.prjNo+'" value="'+task.assistDepartment2Money+'" class="form-control" style="width:150px;" placeholder="金额">'
									+ "<button style='margin-left:15px;' type='button' class='btn btn-primary' onclick='removeXieBan(this)'>移除协办部门</button>"
									+ '</form>'
									+ "</td><td>"
									+ '<div class="yihang" ><div style="width:80px;">分摊比例:</div>'
									+ '<input type="text" id="xiebanCost'+task.prjNo+'" value="'+task.assistDepartment2Cost+'" class="form-control" style="width:150px;" placeholder="金额"></div>'
									+ "</td></tr>");
			initXiebanSelect(task, 2);
			$("#xieban2" + task.prjNo + "").val(task.assistDepartment2);
		}
		if (task.assistDepartment3 != "" && task.assistDepartment3 != null) {
			$("#xieban" + i + " tbody")
					.append(
							"<tr><td>协办部门3</td><td>"
									+ '<form class="form-inline">'
									+ '<select class="form-control" id="xieban3'+task.prjNo+'" style="width:150px;">'
									+ '</select>'
									+ '<input type="text" id="xiebanMoney'+task.prjNo+'" value="'+task.assistDepartment3Money+'" class="form-control" style="width:150px;" placeholder="金额">'
									+ "<button style='margin-left:15px;' type='button' class='btn btn-primary' onclick='removeXieBan(this)'>移除协办部门</button>"
									+ '</form>'
									+ "</td><td>"
									+ '<div class="yihang" ><div style="width:80px;">分摊比例:</div>'
									+ '<input type="text" id="xiebanCost'+task.prjNo+'" value="'+task.assistDepartment3Cost+'" class="form-control" style="width:150px;" placeholder="金额"></div>'
									+ "</td></tr>");
			initXiebanSelect(task, 3);
			$("#xieban3" + task.prjNo + "").val(task.assistDepartment3);
		}

	}
	function addBumenLook(i, task) {
		if (task.assistDepartment1 != "" && task.assistDepartment1 != null) {
			$("#xieban" + i + " tbody")
					.append(
							"<tr><td>协办部门1</td><td>"
									+ '<form class="form-inline">'
									+ '<select class="form-control" disabled id="xieban1'+task.prjNo+'" style="width:150px;">'
									+ '</select>'
									+ '<input type="text" id="xiebanMoney'+task.prjNo+'" value="'+task.assistDepartment1Money+'" disabled class="form-control" style="width:150px;" placeholder="金额">'
									+ '</form>'
									+ "</td><td>"
									+ '<div class="yihang" ><div style="width:80px;">分摊比例:</div>'
									+ '<input type="text" id="xiebanCost'+task.prjNo+'" disabled value="'+task.assistDepartment1Cost+'" class="form-control" style="width:150px;" placeholder="金额"></div>'
									+ "</td></tr>");
			initXiebanSelect(task, 1);
			$("#xieban1" + task.prjNo + "").val(task.assistDepartment1);

		}
		if (task.assistDepartment2 != "" && task.assistDepartment2 != null) {
			$("#xieban" + i + " tbody")
					.append(
							"<tr><td>协办部门2</td><td>"
									+ '<form class="form-inline">'
									+ '<select class="form-control" disabled id="xieban2'+task.prjNo+'" style="width:150px;">'
									+ '</select>'
									+ '<input type="text" id="xiebanMoney'+task.prjNo+'" value="'+task.assistDepartment2Money+'" disabled class="form-control" style="width:150px;" placeholder="金额">'
									+ '</form>'
									+ "</td><td>"
									+ '<div class="yihang" ><div style="width:80px;">分摊比例:</div>'
									+ '<input type="text" id="xiebanCost'+task.prjNo+'" value="'+task.assistDepartment2Cost+'" disabled class="form-control" style="width:150px;" placeholder="金额"></div>'
									+ "</td></tr>");
			initXiebanSelect(task, 2);
			$("#xieban2" + task.prjNo + "").val(task.assistDepartment2);
		}
		if (task.assistDepartment3 != "" && task.assistDepartment3 != null) {
			$("#xieban" + i + " tbody")
					.append(
							"<tr><td>协办部门3</td><td>"
									+ '<form class="form-inline">'
									+ '<select class="form-control" disabled id="xieban3'+task.prjNo+'" style="width:150px;">'
									+ '</select>'
									+ '<input type="text" id="xiebanMoney'+task.prjNo+'" value="'+task.assistDepartment3Money+'" disabled class="form-control" style="width:150px;" placeholder="金额">'
									+ '</form>'
									+ "</td><td>"
									+ '<div class="yihang" ><div style="width:80px;">分摊比例:</div>'
									+ '<input type="text" id="xiebanCost'+task.prjNo+'" value="'+task.assistDepartment3Cost+'" disabled class="form-control" style="width:150px;" placeholder="金额"></div>'
									+ "</td></tr>");
			initXiebanSelect(task, 3);
			$("#xieban3" + task.prjNo + "").val(task.assistDepartment3);
		}

	}

	function addBumenLookNew(i, task) {
		if (task.assistDepartment1 != "" && task.assistDepartment1 != null) {
			$("#lookxieban" + i + " tbody")
					.append(
							"<tr><td>协办部门1</td><td>"
									+ '<form class="form-inline">'
									+ '<select class="form-control" disabled id="lookxieban1'+task.prjNo+'" style="width:150px;">'
									+ '</select>'
									+ '<input type="text" id="lookxiebanMoney'+task.prjNo+'" value="'+task.assistDepartment1Money+'" disabled class="form-control" style="width:150px;" placeholder="金额">'
									+ '</form>'
									+ "</td><td>"
									+ '<div class="yihang" ><div style="width:80px;">分摊比例:</div>'
									+ '<input type="text" id="lookxiebanCost'+task.prjNo+'" disabled value="'+task.assistDepartment1Cost+'" class="form-control" style="width:150px;" placeholder="金额"></div>'
									+ "</td></tr>");
			initXiebanSelectNew(task, 1);
			$("#lookxieban1" + task.prjNo + "").val(task.assistDepartment1);

		}
		if (task.assistDepartment2 != "" && task.assistDepartment2 != null) {
			$("#lookxieban" + i + " tbody")
					.append(
							"<tr><td>协办部门2</td><td>"
									+ '<form class="form-inline">'
									+ '<select class="form-control" disabled id="lookxieban2'+task.prjNo+'" style="width:150px;">'
									+ '</select>'
									+ '<input type="text" id="lookxiebanMoney'+task.prjNo+'" value="'+task.assistDepartment2Money+'" disabled class="form-control" style="width:150px;" placeholder="金额">'
									+ '</form>'
									+ "</td><td>"
									+ '<div class="yihang" ><div style="width:80px;">分摊比例:</div>'
									+ '<input type="text" id="lookxiebanCost'+task.prjNo+'" value="'+task.assistDepartment2Cost+'" disabled class="form-control" style="width:150px;" placeholder="金额"></div>'
									+ "</td></tr>");
			initXiebanSelectNew(task, 2);
			$("#lookxieban2" + task.prjNo + "").val(task.assistDepartment2);
		}
		if (task.assistDepartment3 != "" && task.assistDepartment3 != null) {
			$("#lookxieban" + i + " tbody")
					.append(
							"<tr><td>协办部门3</td><td>"
									+ '<form class="form-inline">'
									+ '<select class="form-control" disabled id="lookxieban3'+task.prjNo+'" style="width:150px;">'
									+ '</select>'
									+ '<input type="text" id="lookxiebanMoney'+task.prjNo+'" value="'+task.assistDepartment3Money+'" disabled class="form-control" style="width:150px;" placeholder="金额">'
									+ '</form>'
									+ "</td><td>"
									+ '<div class="yihang" ><div style="width:80px;">分摊比例:</div>'
									+ '<input type="text" id="lookxiebanCost'+task.prjNo+'" value="'+task.assistDepartment3Cost+'" disabled class="form-control" style="width:150px;" placeholder="金额"></div>'
									+ "</td></tr>");
			initXiebanSelectNew(task, 3);
			$("#lookxieban3" + task.prjNo + "").val(task.assistDepartment3);
		}

	}

	function initXiebanSelect(task, k) {
		$.ajax({
			type : 'POST',
			url : getContextPath()
					+ '/organizationManagement/selectProductionDepartment',
			dataType : 'json',
			async : false,
			data : {},
			error : function(msg) {
				toastr.error("请求失败");
			},
			success : function(json) {
				$("#xieban" + k + "" + task.prjNo + "").empty();
				for (var j = 0; j < json.length; j++) {
					$("#xieban" + k + "" + task.prjNo + "").append(
							"<option value="+json[j].omId+">" + json[j].omName
									+ "</option>");
				}
			}
		});
	}
	function initXiebanSelectNew(task, k) {
		$.ajax({
			type : 'POST',
			url : getContextPath()
					+ '/organizationManagement/selectProductionDepartment',
			dataType : 'json',
			async : false,
			data : {},
			error : function(msg) {
				toastr.error("请求失败");
			},
			success : function(json) {
				$("#lookxieban" + k + "" + task.prjNo + "").empty();
				for (var j = 0; j < json.length; j++) {
					$("#lookxieban" + k + "" + task.prjNo + "").append(
							"<option value="+json[j].omId+">" + json[j].omName
									+ "</option>");
				}
			}
		});
	}
	function xgaddBumen() {
		if (($("#xgxieban tr").length) <= 4) {
			var num = $("#xgxieban tr").length - 1;
			$("#xgxieban tbody")
					.append(
							"<tr class='xieban'><td>"
									+ "协办部门"
									+ num
									+ "</td><td>"
									+ '<form class="form-inline">'
									+ '<select class="form-control" id="xgxieban'+num+'" style="width:160px;">'
									+ '</select>'
									+ '<input type="text" id="xgxiebanMoney'+num+'" class="form-control" style="width:160px;margin-left:5px;" placeholder="金额">'
									+ "<button style='margin-left:15px;' type='button' class='btn btn-primary' onclick='removeXieBan(this)'>移除协办部门</button>"
									+ '</form>' + "</td><td></td></tr>");
			$.ajax({
				type : 'POST',
				url : getContextPath()
						+ '/organizationManagement/selectProductionDepartment',
				dataType : 'json',
				data : {

				},
				error : function(msg) {
					toastr.error("请求失败");
				},
				success : function(json) {
					$("#xgxieban" + num).empty();
					for (var i = 0; i < json.length; i++) {
						$("#xgxieban" + num).append(
								"<option value="+json[i].omId+">"
										+ json[i].omName + "</option>");
					}
				}
			});
		} else {
			toastr.error("协办部门已达上限")
		}
	}
	function bgaddBumen() {

		if (($("#bgxieban tr").length) <= 4) {
			$("#bgxieban")
					.append(
							"<tr><td>"
									+ "协办部门"
									+ ($("#bgxieban tr").length - 1)
									+ "</td><td>"
									+ '<form class="form-inline">'
									+ '<select class="form-control" id="bgxieban'
									+ ($("#bgxieban tr").length - 1)
									+ '" style="width:150px;">'
									+ '</select>'
									+ '  <input type="text" id="bgxiebanjine'
									+ ($("#bgxieban tr").length - 1)
									+ '" class="form-control" style="width:150px;" placeholder="金额">'
									+ "<button style='margin-left:15px;' type='button' class='btn btn-primary' onclick='removeXieBan(this)'>移除协办部门</button>"
									+ '</form>' + "</td></tr>");
			$.ajax({
				type : 'POST',
				url : getContextPath()
						+ '/organizationManagement/selectProductionDepartment',
				dataType : 'json',
				data : {

				},
				error : function(msg) {
					toastr.error("请求失败");
				},
				success : function(json) {
					$("#bgxieban1").empty();
					$("#bgxieban2").empty();
					$("#bgxieban3").empty();
					for (var i = 0; i < json.length; i++) {
						$("#bgxieban1").append(
								"<option value="+json[i].omId+">"
										+ json[i].omName + "</option>");
						$("#bgxieban2").append(
								"<option value="+json[i].omId+">"
										+ json[i].omName + "</option>");
						$("#bgxieban3").append(
								"<option value="+json[i].omId+">"
										+ json[i].omName + "</option>");
					}
				}
			});
		} else {
			toastr.error("协办部门已达上限")
		}
	}
	//回显协办部门
	function xiebanhuixian(obj, num) {
		$.ajax({
			type : 'POST',
			url : getContextPath()
					+ '/organizationManagement/selectProductionDepartment',
			dataType : 'json',
			async : false,
			data : {

			},
			error : function(msg) {
				toastr.error("请求失败");
			},
			success : function(json) {
				$("#xgxieban" + num).empty();
				for (var i = 0; i < json.length; i++) {
					$("#xgxieban" + num).append(
							"<option value="+json[i].omId+">" + json[i].omName
									+ "</option>");
				}
				$("#xgxieban" + num).val(obj);
			}
		});
	}
	//初始化提交部门
	function initbumen() {
		$.ajax({
			type : 'POST',
			url : getContextPath()
					+ '/organizationManagement/selectProductionDepartment',
			dataType : 'json',
			data : {

			},
			error : function(msg) {
				toastr.error("请求失败");
			},
			success : function(json) {
				$("#seach_main_department").append(
						"<option value='%'>全部</option>")
				$("#seach_xb_department").append(
						"<option value='%'>全部</option>")
				for (var i = 0; i < json.length; i++) {
					/* $("#yifang_department").append("<option value="+json[i].omId+">"+json[i].omName+"</option>"); */
					$("select[name='zhuban']").append(
							"<option value="+json[i].omId+">" + json[i].omName
									+ "</option>");
					$("#xgzhuban").append(
							"<option value="+json[i].omId+">" + json[i].omName
									+ "</option>");
					/* $("#edit_yifang_department").append("<option value="+json[i].omId+">"+json[i].omName+"</option>"); */
					$("#seach_main_department").append(
							"<option value="+json[i].omId+">" + json[i].omName
									+ "</option>");
					$("#seach_xb_department").append(
							"<option value="+json[i].omId+">" + json[i].omName
									+ "</option>");
				}
			}
		});
	}

	function initbumenByClass(k) {
		$.ajax({
			type : 'POST',
			url : getContextPath()
					+ '/organizationManagement/selectProductionDepartment',
			dataType : 'json',
			async : false,
			data : {

			},
			error : function(msg) {
				toastr.error("请求失败");
			},
			success : function(json) {
				for (var i = 0; i < json.length; i++) {
					$(".zhuban" + k + "").append(
							"<option value="+json[i].omId+">" + json[i].omName
									+ "</option>");
				}
			}
		});
	}

	function initSelect() {
		$.ajax({
			type : 'POST',
			url : getContextPath() + '/task/selectTaskByCj',
			dataType : 'json',
			data : {},
			error : function(msg) {
				toastr.error("请求失败");
			},
			success : function(json) {
				$("#selectpicker_no").html('');
				$("#selectpicker_name").html('');
				for (var i = 0; i < json.length; i++) {
					$("#selectpicker_name").append(
							"<option  value="+json[i].prjName+">"
									+ json[i].prjName + "</option>");
					$("#selectpicker_no").append(
							"<option  value="+json[i].prjNo+">" + json[i].prjNo
									+ "</option>");
				}
				$('#selectpicker_no').selectpicker('refresh');
				$('#selectpicker_name').selectpicker('refresh');
			}
		});
	}

	function refreshSelectEdit(tasks) {
		for ( var i in tasks) {
			$("#selectpicker_name").append(
					"<option  value="+tasks[i].prjName+">" + tasks[i].prjName
							+ "</option>");
			$("#selectpicker_no").append(
					"<option  value="+tasks[i].prjNo+">" + tasks[i].prjNo
							+ "</option>");
		}
		$('#selectpicker_no').selectpicker('refresh');
		$('#selectpicker_name').selectpicker('refresh');
	}

	var noType;
	function chooseNo(obj) {
		noType = obj;
		$('.selectp icker').selectpicker('deselectAll');
		$("#chooseNo").modal("show");
		if (obj == 1) {
			var prjNoArray = $("#edit_work_no").val().split(",");
			$("#selectpicker_no").val(prjNoArray);
			$("#selectpicker_no").selectpicker("refresh");
		}
	}

	var nameType;
	function chooseName(obj) {
		nameType = obj;
		$('.selectpicker').selectpicker('deselectAll');
		$("#chooseName").modal("show");
		if (obj == 1) {
			var prjNameArray = $("#edit_prj_name").val().split(",");
			$("#selectpicker_name").val(prjNameArray);
			$("#selectpicker_name").selectpicker("refresh");
		}
	}

	function quxiao() {
		$('#chooseNo').on('hidden.bs.modal', function() {//解决模态框页面滚动问题
			if ($('.modal.in').size() >= 1) {
				$('body').addClass('modal-open')
			}
		})
		$('#chooseName').modal("hide");
	}

	function quxiao2() {
		$('#chooseNo').on('hidden.bs.modal', function() {//解决模态框页面滚动问题
			if ($('.modal.in').size() >= 1) {
				$('body').addClass('modal-open')
			}
		})
		$('#chooseNo').modal("hide");
	}

	function saveNo() {
		$('#chooseNo').on('hidden.bs.modal', function() {//解决模态框页面滚动问题
			if ($('.modal.in').size() >= 1) {
				$('body').addClass('modal-open')
			}
		})

		var no_list = $("#selectpicker_no").val();
		if (no_list != null) {
			$.ajax({
				type : 'POST',
				url : getContextPath() + '/task/selectTaskPrjName',
				dataType : 'json',
				async : false,
				data : {
					prjNo : no_list.toString()
				},
				success : function(json) {
					var deptArray = new Array();
					for (var ii = 0; ii < json.length; ii++) {
						var mainDept = json[ii].mainDepartment;
						var omName = json[ii].omName;
						var xbDept = json[ii].assist_department1;
						var xbname = json[ii].name1;
						var xbDept2 = json[ii].assist_department2;
						var xbname2 = json[ii].name2;
						var xbDept3 = json[ii].assist_department3;
						var xbname3 = json[ii].name3;
						if (mainDept != null && mainDept != '') {
							var dept = {
								id : undefined,
								name : undefined
							}
							dept.id = mainDept;
							dept.name = omName;
							if (deptArray.length > 0) {
								var count = 0;
								for (var d = 0; d < deptArray.length; d++) {
									if (deptArray[d].id == mainDept) {
										count = 1;
									}
								}
								if (count != 1) {
									deptArray.push(dept);
								}
							} else {
								deptArray.push(dept);
							}
						}

						if (xbDept != null && xbDept != '') {
							var dept2 = {
								id : undefined,
								name : undefined
							}
							dept2.id = xbDept;
							dept2.name = xbname;
							if (deptArray.length > 0) {
								var count = 0;
								for (var d = 0; d < deptArray.length; d++) {
									if (deptArray[d].id == xbDept) {
										count = 1;
									}
								}
								if (count != 1) {
									deptArray.push(dept2);
								}
							} else {
								deptArray.push(dept2);
							}
						}

						if (xbDept2 != null && xbDept2 != '') {
							var dept3 = {
								id : undefined,
								name : undefined
							}
							dept3.id = xbDept2;
							dept3.name = xbname2;
							if (deptArray.length > 0) {
								var count = 0;
								for (var d = 0; d < deptArray.length; d++) {
									if (deptArray[d].id == xbDept2) {
										count = 1;
									}
								}
								if (count != 1) {
									deptArray.push(dept3);
								}
							} else {
								deptArray.push(dept3);
							}
						}
						if (xbDept3 != null && xbDept3 != '') {
							var dept4 = {
								id : undefined,
								name : undefined
							}
							dept4.id = xbDept3;
							dept4.name = xbname3;
							if (deptArray.length > 0) {
								var count = 0;
								for (var d = 0; d < deptArray.length; d++) {
									if (deptArray[d].id == xbDept3) {
										count = 1;
									}
								}
								if (count != 1) {
									deptArray.push(dept4);
								}
							} else {
								deptArray.push(dept4);
							}
						}

					}
					$("#yifang_department").html('');
					for (var c = 0; c < deptArray.length; c++) {
						$("#yifang_department").append(
								"<option value="+deptArray[c].id+">"
										+ deptArray[c].name + "</option>")
					}
					var array = new Array();
					var array2 = new Array();
					for (var i = 0; i < json.length; i++) {
						array.push(json[i].prjName)
						var type = json[i].prjType2;
						if ($.inArray(type, array2) == -1) {
							array2.push(type)
						}
					}
					if (noType == 0) {
						$('#work_no').val(no_list)
						$('#prj_name').val(array.toString())
						$('#prj_type').val(array2.toString())
						var tasks = getTaskBytaskCode(no_list.toString());
						pinjieRenwudanChaifen(array, no_list, tasks);
						var jyms = getJYMS(tasks);
						$('#prj_jyms').val(jyms);
						$("#chooseNo").modal("hide");
					} else if (noType == 1) {
						$('#edit_work_no').val(no_list)
						$('#edit_prj_name').val(array.toString())
						$('#edit_prj_type').val(array2.toString())
						var tasks = getTaskBytaskCode(no_list.toString());

						pinjieRenwudanChaifen(array, no_list, tasks);
						$("#chooseNo").modal("hide");
					}

				}
			});
		} else {
			toastr.error("任务单号为空");
		}
	}

	function saveName() {

		$('#chooseName').on('hidden.bs.modal', function() {//解决模态框页面滚动问题
			if ($('.modal.in').size() >= 1) {
				$('body').addClass('modal-open')
			}
		})
		var name_list = $("#selectpicker_name").val();

		if (name_list != null) {
			$.ajax({
				type : 'POST',
				url : getContextPath() + '/task/selectTaskPrjNo',
				dataType : 'json',
				async : false,
				data : {
					prjName : name_list.toString()
				},
				success : function(json) {
					var deptArray = new Array();
					for (var ii = 0; ii < json.length; ii++) {
						var mainDept = json[ii].mainDepartment;
						var omName = json[ii].omName;
						var xbDept = json[ii].assist_department1;
						var xbname = json[ii].name1;
						var xbDept2 = json[ii].assist_department2;
						var xbname2 = json[ii].name2;
						var xbDept3 = json[ii].assist_department3;
						var xbname3 = json[ii].name3;
						if (mainDept != null && mainDept != '') {
							var dept = {
								id : undefined,
								name : undefined
							}
							dept.id = mainDept;
							dept.name = omName;
							if (deptArray.length > 0) {
								var count = 0;
								for (var d = 0; d < deptArray.length; d++) {
									if (deptArray[d].id == mainDept) {
										count = 1;
									}
								}
								if (count != 1) {
									deptArray.push(dept);
								}
							} else {
								deptArray.push(dept);
							}
						}

						if (xbDept != null && xbDept != '') {
							var dept2 = {
								id : undefined,
								name : undefined
							}
							dept2.id = xbDept;
							dept2.name = xbname;
							if (deptArray.length > 0) {
								var count = 0;
								for (var d = 0; d < deptArray.length; d++) {
									if (deptArray[d].id == xbDept) {
										count = 1;
									}
								}
								if (count != 1) {
									deptArray.push(dept2);
								}
							} else {
								deptArray.push(dept2);
							}
						}

						if (xbDept2 != null && xbDept2 != '') {
							var dept3 = {
								id : undefined,
								name : undefined
							}
							dept3.id = xbDept2;
							dept3.name = xbname2;
							if (deptArray.length > 0) {
								var count = 0;
								for (var d = 0; d < deptArray.length; d++) {
									if (deptArray[d].id == xbDept2) {
										count = 1;
									}
								}
								if (count != 1) {
									deptArray.push(dept3);
								}
							} else {
								deptArray.push(dept3);
							}
						}
						if (xbDept3 != null && xbDept3 != '') {
							var dept4 = {
								id : undefined,
								name : undefined
							}
							dept4.id = xbDept3;
							dept4.name = xbname3;
							if (deptArray.length > 0) {
								var count = 0;
								for (var d = 0; d < deptArray.length; d++) {
									if (deptArray[d].id == xbDept3) {
										count = 1;
									}
								}
								if (count != 1) {
									deptArray.push(dept4);
								}
							} else {
								deptArray.push(dept4);
							}
						}

					}
					$("#yifang_department").html('');
					for (var c = 0; c < deptArray.length; c++) {
						$("#yifang_department").append(
								"<option value="+deptArray[c].id+">"
										+ deptArray[c].name + "</option>")
					}

					var array = new Array();
					var array2 = new Array();
					for (var i = 0; i < json.length; i++) {
						array.push(json[i].prjNo)
						var type = json[i].prjType2;
						if ($.inArray(type, array2) == -1) {
							array2.push(type)
						}
					}
					if (nameType == 0) {
						$('#prj_name').val(name_list)
						$('#work_no').val(array.toString())
						var tasks = getTaskBytaskCode(array.toString());
						pinjieRenwudanChaifen(name_list, array, tasks);
						var jyms = getJYMS(tasks);
						$('#prj_jyms').val(jyms);
						$('#prj_type').val(array2.toString());
						$("#chooseName").modal("hide");
					} else if (nameType == 1) {
						$('#edit_prj_name').val(name_list)
						$('#edit_work_no').val(array.toString())
						$('#edit_prj_type').val(array2.toString())
						/* editpinjieRenwudanChaifen(name_list,array) */
						$("#chooseName").modal("hide");
					}

				}
			});
		} else {
			toastr.error("项目名称为空");
		}
	}
	function getJYMS(tasks) {
		var ms;
		if (tasks.length == 1) {
			ms = tasks[0].prjManagementModel;
		} else {
			ms = "自营";
			for ( var i in tasks) {
				if (tasks[i].prjManagementModel == "联营") {
					ms = "联营";
				}
			}
		}
		return ms;
	}
	function initCooperator() {
		$.ajax({
			type : 'POST',
			url : getContextPath() + '/cooperator/selectCooperatorIdAndName',
			dataType : 'json',
			data : {

			},
			success : function(json) {
				$("#jiafangName").html('');
				$("#edit_jiafangName").html('');
				for (var i = 0; i < json.length; i++) {
					$("#jiafangName").append(
							"<option value='" + json[i].ccId + "'>"
									+ json[i].ccName + "</option>")
					$("#edit_jiafangName").append(
							"<option value='" + json[i].ccId + "'>"
									+ json[i].ccName + "</option>")
				}
				$(".selectpicker").selectpicker({
					noneSelectedText : '请选择',

				});
			}
		});
	}

	function showImg(dom) {
		var file = dom.files[0];//获取文件信息
		var dom = $(dom);
		if (window.FileReader) {
			var reader = new FileReader();
			reader.readAsDataURL(file);
			//监听文件读取结束后事件    
			reader.onloadend = function(e) {

				var url = encodeURI(e.target.result);

				$(dom).next().attr("href", e.target.result);
				//$(".img").attr("src",e.target.result);
			};
		}
	}

	function new_accessory() {
		$("#new_accessory tbody")
				.append(
						"<tr><td>新附件</td><td><input type='file' onchange='showImg(this)'  name='file' class='form-control'><a target='_blank' style='color:blue;overflow:hidden;' download='下载预览'>预览</a></td><td style='width:150px;'><button type='button' class='btn btn-primary' onclick='removeFile(this)'>移除附件</button></td></tr>")
	}
	function new_accessory2() {
		$("#new_accessory2 tbody")
				.append(
						"<tr><td>新附件</td><td><input type='file' onchange='showImg(this)' name='file2' class='form-control'><a target='_blank' style='color:blue'>预览</a></td><td style='width:150px;'><button type='button' class='btn btn-primary' onclick='removeFile(this)'>移除附件</button></td></tr>")
	}

	function edit_accessory() {
		$("#edit_accessory tbody")
				.append(
						"<tr><td>新附件</td><td><input type='file' name='file' style='width:60%;' class='form-control'></td><td style='width:150px;'><button type='button' class='btn btn-primary' onclick='removeFile(this)'>移除附件</button></td></tr>")
	}
	function edit_accessory2() {
		$("#edit_accessory2 tbody")
				.append(
						"<tr><td>新附件</td><td><input type='file' name='file2' style='width:60%;' class='form-control'></td><td style='width:150px;'><button type='button' class='btn btn-primary' onclick='removeFile(this)'>移除附件</button></td></tr>")
	}

	function removeFile(obj) {
		var tr = $(obj).parents("tr");
		$(tr).remove();
	}

	function removeXieBan(obj) {
		var tr = $(obj).parent().parent().parent();
		$(tr).remove();
	}

	function new_save() {
		var deptSplitArray = new Array();
		var chaiFenXinXiArray = new Array();
		chaiFenXinXiArray = getChaifenXinXiArray("contract_money");
		var moneyFlag = judgeInputMoney("contract_money");
		if (!moneyFlag) {
			toastr.error("金额分配有误!请检查!");
			return false;
		}
		var fentanFlag = judgeFentanbili();
		if (fentanFlag == 1) {
			toastr.error("分摊比例未填!请检查!");
			return false;
		}
		var contract_name = $("#contract_name").val();
		if (contract_name == '') {
			toastr.error("合同名称为空");
			return false;
		}
		var work_no = $("#work_no").val();
		var prj_name = $("#prj_name").val();
		var prj_type = $("#prj_type").val();
		var jfId = $("#jiafangName").val();
		if (jfId != null) {
			jfId = jfId.toString()
		} else {
			jfId = '';
		}
		var ccName = $("#jiafangName").parent("td").find("button")
				.attr("title");
		var yifangName = $("#yifangName").val();
		var year = $("#year").val();
		var year2 = $("#year2").val();
		var yifang_department = $("#yifang_department").val();
		var work_date = $("#work_date").val();
		var receieve_money_condition = $("#receieve_money_condition").val();
		var contract_money = $("#contract_money").val();
		var temporary_money = $("#temporary_money").val();
		var year3 = $("#year3").val();
		var work_info = $("#work_info").val();
		var zhuban = $("#zhuban").val();
		var zhubanjine = $("#zhubanjine").val();
		var xieban1 = $("#xieban1").find("option:selected").val();
		var xieban1jine = $("#xiebanMoney1").val();
		var xieban2 = $("#xieban2").find("option:selected").val();
		var xieban2jine = $("#xiebanMoney2").val();
		var xieban3 = $("#xieban3").find("option:selected").val();
		var xieban3jine = $("#xiebanMoney3").val();
		var split_state = 0;
		if ($("#new_split_table tbody").find('tr').length > 0) {
			split_state = 1;
		}
		var jyms = $("#prj_jyms").val();
		var cjContract = {
			cjId : null,
			taskCode : undefined,
			contractName : undefined,
			contractNo : undefined,
			prjName : undefined,
			prjType : undefined,
			contractNameJia : undefined,
			ccName : undefined,
			contractNameYi : undefined,
			contractStartTime : undefined,
			contractEndTime : undefined,
			yiCjDepartment : undefined,
			contractLongTime : undefined,
			receieveMoneyCondition : undefined,
			contractMoney : undefined,
			temporaryMoney : undefined,
			contractSignTime : undefined,
			workInfo : undefined,
			mainDepartment : undefined,
			mainDepartmentMoney : undefined,
			assistDepartment1 : undefined,
			assistDepartment1Money : undefined,
			assistDepartment2 : undefined,
			assistDepartment2Money : undefined,
			assistDepartment3 : undefined,
			assistDepartment3Money : undefined,
			splitState : undefined,
			cjSplitMoney : undefined,
			cjDeptSplitMoney : undefined
		}
		cjContract.cjId = null;
		cjContract.taskCode = work_no;
		cjContract.contractName = contract_name;
		cjContract.contractNo = null;
		cjContract.prjName = prj_name;
		cjContract.prjType = prj_type;
		cjContract.contractNameJia = jfId;
		cjContract.ccName = ccName;
		cjContract.contractNameYi = yifangName;
		cjContract.contractStartTime = year;
		cjContract.contractEndTime = year2;
		cjContract.yiCjDepartment = yifang_department;
		cjContract.contractLongTime = work_date;
		cjContract.receieveMoneyCondition = receieve_money_condition;
		cjContract.contractMoney = contract_money;
		cjContract.temporaryMoney = temporary_money;
		cjContract.contractSignTime = year3;
		cjContract.workInfo = work_info;
		cjContract.mainDepartment = zhuban;
		cjContract.mainDepartmentMoney = zhubanjine;
		cjContract.assistDepartment1 = xieban1;
		cjContract.assistDepartment1Money = xieban1jine;
		cjContract.assistDepartment2 = xieban2;
		cjContract.assistDepartment2Money = xieban2jine;
		cjContract.assistDepartment3 = xieban3;
		cjContract.assistDepartment3Money = xieban3jine;
		cjContract.splitState = split_state;
		cjContract.jyms = jyms;
		cjContract.cjDeptSplitMoney = deptSplitArray;
		cjContract.chaiFenXinXiArray = chaiFenXinXiArray;
		var formData = new FormData();
		formData.append("cjContract", JSON.stringify(cjContract));

		$("#new_accessory tbody").find("tr").each(function() {
			formData.append("file", $(this).find("input")[0].files[0]);
		})
		$("#new_accessory2 tbody").find("tr").each(function() {
			formData.append("file2", $(this).find("input")[0].files[0]);
		})

		$.ajax({
			type : 'POST',
			url : getContextPath() + '/cj/addCjContractBySave',
			data : formData,
			cache : false,
			processData : false,
			contentType : false,
			async : false,
			dataType : 'json',
			success : function(json) {
				if (json > 0) {
					toastr.success("保存成功");
					quxiaoa();
				} else {
					toastr.error("保存失败");
				}
			}
		})
	}

	var lianjie;
	function new_submit() {
		var deptSplitArray = new Array();
		var chaiFenXinXiArray = new Array();
		chaiFenXinXiArray = getChaifenXinXiArray("contract_money");
		var moneyFlag = judgeInputMoney("contract_money");
		var fentanFlag = judgeFentanbili();
		if (!moneyFlag) {
			toastr.error("金额分配有误!请检查!");
			return;
		}
		if (fentanFlag == 1) {
			toastr.error("分摊比例未填!请检查!");
			return;
		}
		var contract_name = $("#contract_name").val();
		if (contract_name == '') {
			toastr.error("合同名称为空");
			return;
		}
		var work_no = $("#work_no").val();
		var prj_name = $("#prj_name").val();
		if (prj_name == '') {
			toastr.error("项目为空");
			return;
		}
		var prj_type = $("#prj_type").val();
		var jfId = $("#jiafangName").val();
		if (jfId == null) {
			toastr.error("甲方名称为空");
			return;
		} else {
			jfId = jfId.toString();
		}
		var ccName = $("#jiafangName").parent("td").find("button")
				.attr("title");
		var yifangName = $("#yifangName").val();
		var year = $("#year").val();
		var year2 = $("#year2").val();
		var yifang_department = $("#yifang_department").val();
		if (yifang_department == '') {
			toastr.error("承接部门为空");
			return;
		}
		var work_date = $("#work_date").val();
		var receieve_money_condition = $("#receieve_money_condition").val();
		var contract_money = $("#contract_money").val();
		if (contract_money == '') {
			toastr.error("合同金额为空");
			return;
		}
		var temporary_money = $("#temporary_money").val();
		if (temporary_money == '') {
			toastr.error("暂定金为空");
			return;
		}
		var year3 = $("#year3").val();
		var work_info = $("#work_info").val();
		var zhuban = $("#zhuban").val();
		var zhubanjine = $("#zhubanjine").val();
		var xieban1 = $("#xieban1").find("option:selected").val();
		var xieban1jine = $("#xiebanMoney1").val();
		var xieban2 = $("#xieban2").find("option:selected").val();
		var xieban2jine = $("#xiebanMoney2").val();
		var xieban3 = $("#xieban3").find("option:selected").val();
		var xieban3jine = $("#xiebanMoney3").val();
		var split_state = 0;
		if ($("#new_split_table tbody").find('tr').length > 0) {
			split_state = 1;
		}
		var jyms = $("#prj_jyms").val();
		var cjContract = {
			cjId : null,
			taskCode : undefined,
			contractName : undefined,
			contractNo : undefined,
			prjName : undefined,
			prjType : undefined,
			contractNameJia : undefined,
			ccName : undefined,
			contractNameYi : undefined,
			contractStartTime : undefined,
			contractEndTime : undefined,
			yiCjDepartment : undefined,
			contractLongTime : undefined,
			receieveMoneyCondition : undefined,
			contractMoney : undefined,
			temporaryMoney : undefined,
			contractSignTime : undefined,
			workInfo : undefined,
			mainDepartment : undefined,
			mainDepartmentMoney : undefined,
			assistDepartment1 : undefined,
			assistDepartment1Money : undefined,
			assistDepartment2 : undefined,
			assistDepartment2Money : undefined,
			assistDepartment3 : undefined,
			assistDepartment3Money : undefined,
			splitState : undefined,
			cjSplitMoney : undefined,
			cjDeptSplitMoney : undefined
		}
		cjContract.cjId = null;
		cjContract.taskCode = work_no;
		cjContract.contractName = contract_name;
		cjContract.contractNo = null;
		cjContract.prjName = prj_name;
		cjContract.prjType = prj_type;
		cjContract.contractNameJia = jfId;
		cjContract.ccName = ccName;
		cjContract.contractNameYi = yifangName;
		cjContract.contractStartTime = year;
		cjContract.contractEndTime = year2;
		cjContract.yiCjDepartment = yifang_department;
		cjContract.contractLongTime = work_date;
		cjContract.receieveMoneyCondition = receieve_money_condition;
		cjContract.contractMoney = contract_money;
		cjContract.temporaryMoney = temporary_money;
		cjContract.contractSignTime = year3;
		cjContract.workInfo = work_info;
		cjContract.mainDepartment = zhuban;
		cjContract.mainDepartmentMoney = zhubanjine;
		cjContract.assistDepartment1 = xieban1;
		cjContract.assistDepartment1Money = xieban1jine;
		cjContract.assistDepartment2 = xieban2;
		cjContract.assistDepartment2Money = xieban2jine;
		cjContract.assistDepartment3 = xieban3;
		cjContract.assistDepartment3Money = xieban3jine;
		cjContract.splitState = split_state;
		cjContract.jyms = jyms;
		cjContract.cjDeptSplitMoney = deptSplitArray;
		cjContract.chaiFenXinXiArray = chaiFenXinXiArray;

		if ($("#new_accessory tbody").find('tr').length < 1
				|| $("#new_accessory tbody").find("tr").eq(0).find("input")
						.val() == '') {
			toastr.error("请上传合同文本")
			return;
		}

		var formData = new FormData();
		formData.append("cjContract", JSON.stringify(cjContract));

		$("#new_accessory tbody").find("tr").each(function() {
			formData.append("file", $(this).find("input")[0].files[0]);
		})
		$("#new_accessory2 tbody").find("tr").each(function() {
			formData.append("file2", $(this).find("input")[0].files[0]);
		})

		$
				.ajax({
					type : 'POST',
					url : getContextPath() + '/cj/addCjContractBySubmit',
					data : formData,
					cache : false,
					processData : false,
					contentType : false,
					async : false,
					dataType : 'json',
					success : function(json) {
						if (json == '0') {
							toastr.error("保存失败");
						} else {
							quxiaoa();
							lianjie = json.url;
							if (json.receiver != null
									&& json.receiver.length >= 1) {
								$("#tijiaogei").modal('show');
								$("#tijiaoren tbody").empty("");
								for (var i = 0; i < json.receiver.length; i++) {
									$("#tijiaoren tbody")
											.append(
													'<tr><td>'
															+ '<input type="radio" style="width:20px;height:20px;" name="tijiaorenming" data-id="'+json.receiver[i].userId+'" data-id2="'+json.receiver[i].omId+'" data-id3="'+json.receiver[i].dutyId+'">'
															+ '</td><td>'
															+ json.receiver[i].omName
															+ '</td><td>'
															+ json.receiver[i].dutyName
															+ '</td><td>'
															+ json.receiver[i].uName
															+ '</td></tr>');
								}
							} else if (json.receiver.length == 1) {
								$.ajax({
									type : 'POST',
									url : getContextPath() + '/task/addTask4',
									dataType : 'json',
									data : {
										url : json.url,
										userId : json.receiver.userId,
										uName : json.receiver.uName,
										omName : json.receiver.omName,
										dutyName : json.receiver.dutyName,
										omId : json.receiver.omId,
										dutyId : json.receiver.dutyId
									},
									success : function(json) {
										toastr.success('提交成功');
									}
								});
							}
						}

						/* if(json>0){
							//$("#myModal").modal("hide");
							toastr.success("保存成功");
							quxiaoa();
						}else{
							toastr.error("保存失败");
						} */
					}
				})
	}

	var modal2Tr;
	function openModal2(obj) {
		modal2Tr = $(obj).parents("tr");
		$("#myModal2").modal("show");
	}

	function submitCjCancel() {
		var stopReason = $("#cancel_reason").val();
		var data = $("#mainContent").DataTable().row(modal2Tr).data();
		var cjName = data.contractName;
		var department = data.omName;
		var id = data.cjId;
		$
				.ajax({
					type : 'POST',
					url : getContextPath() + '/cj/submitCjCancel',
					dataType : 'json',
					data : {
						stopReason : stopReason,
						id : id,
						cjName : cjName,
						department : department
					},
					success : function(json) {
						if (json == '0') {
							toastr.error("保存失败");
						} else {
							$("#myModal2").modal("hide");
							lianjie = json.url;
							if (json.receiver != null
									&& json.receiver.length >= 1) {
								$("#tijiaogei").modal('show');
								$("#tijiaoren tbody").empty("");
								for (var i = 0; i < json.receiver.length; i++) {
									$("#tijiaoren tbody")
											.append(
													'<tr><td>'
															+ '<input type="radio" style="width:20px;height:20px;" name="tijiaorenming" data-id="'+json.receiver[i].userId+'" data-id2="'+json.receiver[i].omId+'" data-id3="'+json.receiver[i].dutyId+'">'
															+ '</td><td>'
															+ json.receiver[i].omName
															+ '</td><td>'
															+ json.receiver[i].dutyName
															+ '</td><td>'
															+ json.receiver[i].uName
															+ '</td></tr>');
								}
							} else if (json.receiver.length == 1) {
								$.ajax({
									type : 'POST',
									url : getContextPath() + '/task/addTask4',
									dataType : 'json',
									data : {
										url : json.url,
										userId : json.receiver.userId,
										uName : json.receiver.uName,
										omName : json.receiver.omName,
										dutyName : json.receiver.dutyName,
										omId : json.receiver.omId,
										dutyId : json.receiver.dutyId
									},
									success : function(json) {
										toastr.success('提交成功');
									}
								});
							}
						}
					}
				})
	}

	var modal3Tr;
	function openModal3(obj) {
		modal3Tr = $(obj).parents("tr");
		var data = $("#mainContent").DataTable().row(modal3Tr).data();
		$
				.ajax({
					type : 'POST',
					url : getContextPath()
							+ '/ContractReason/selectContractReasonById',
					dataType : 'json',
					data : {
						id : data.cjId
					},
					success : function(json) {
						$("#look_cancel_reason").val(json.stopReason);
						$("#myModal3").modal("show");
					}
				});

	}

	function submitCjRestart() {
		var restartReason = $("#restart_reason").val();
		var data = $("#mainContent").DataTable().row(modal3Tr).data();
		var cjName = data.contractName;
		var department = data.mainDepartment;
		var id = data.cjId;
		$
				.ajax({
					type : 'POST',
					url : getContextPath() + '/cj/submitCjRestart',
					dataType : 'json',
					data : {
						restartReason : restartReason,
						id : id,
						cjName : cjName,
						department : department
					},
					success : function(json) {
						if (json == '0') {
							toastr.error("保存失败");
						} else {
							$("#myModal3").modal("hide");
							lianjie = json.url;
							if (json.receiver != null
									&& json.receiver.length >= 1) {
								$("#tijiaogei").modal('show');
								$("#tijiaoren tbody").empty("");
								for (var i = 0; i < json.receiver.length; i++) {
									$("#tijiaoren tbody")
											.append(
													'<tr><td>'
															+ '<input type="radio" style="width:20px;height:20px;" name="tijiaorenming" data-id="'+json.receiver[i].userId+'" data-id2="'+json.receiver[i].omId+'" data-id3="'+json.receiver[i].dutyId+'">'
															+ '</td><td>'
															+ json.receiver[i].omName
															+ '</td><td>'
															+ json.receiver[i].dutyName
															+ '</td><td>'
															+ json.receiver[i].uName
															+ '</td></tr>');
								}
							} else if (json.receiver.length == 1) {
								$.ajax({
									type : 'POST',
									url : getContextPath() + '/task/addTask4',
									dataType : 'json',
									data : {
										url : json.url,
										userId : json.receiver.userId,
										uName : json.receiver.uName,
										omName : json.receiver.omName,
										dutyName : json.receiver.dutyName,
										omId : json.receiver.omId,
										dutyId : json.receiver.dutyId
									},
									success : function(json) {
										toastr.success('提交成功');
									}
								});
							}
						}
					}
				})
	}

	function submitPerson() {
		var uid = $("input[name='tijiaorenming']:checked").attr("data-id");
		var omid = $("input[name='tijiaorenming']:checked").attr("data-id2");
		var dutyid = $("input[name='tijiaorenming']:checked").attr("data-id3");
		var bmmc = $("input[name='tijiaorenming']:checked").parent().next()
				.text();
		var zw = $("input[name='tijiaorenming']:checked").parent().next()
				.next().text();
		var uname = $("input[name='tijiaorenming']:checked").parent().next()
				.next().next().text();
		//var uname=$("input[name='tijiaorenming']:checked").val();
		$.ajax({
			type : 'POST',
			url : getContextPath() + '/task/addTask4',
			dataType : 'json',
			data : {
				url : lianjie,
				userId : uid,
				uName : uname,
				omName : bmmc,
				dutyName : zw,
				omId : omid,
				dutyId : dutyid
			},
			success : function(json) {
				toastr.success('提交成功');
			}
		});
	}

	function lookDetall(obj) {
		var tr = $(obj).parents("tr");
		var data = $("#mainContent").DataTable().row(tr).data();
		$("#dyyl").prop(
				"href",
				"../contractyulan/ContractManagementLook.html?prjId="
						+ data.cjId)
		$("#look_contract_name").text(data.contractName);
		$("#look_contract_no").text(data.contractNo);
		$("#look_work_no").text(data.taskCode);

		$("#look_prj_name").html("");
		if (data.taskCode == "" || data.taskCode == null) {
			$("#look_prj_name").text(data.prjName);
		} else {
			var taskprjNoClick = '<a href="../chankanxiangqing/taskDetails.html?prjNo='
					+ data.taskCode
					+ '" target="_blank" style="color:blue;">'
					+ data.prjName + '</a>';
			$("#look_prj_name").append(taskprjNoClick);
		}

		//$("#look_prj_name").text(data.prjName);

		var prjNameArray = data.prjName.split(",");
		var taskCodeArray = data.taskCode.split(",");
		var tasks = getTaskBytaskCode(data.taskCode);
		lookpinjieRenwudanChaifen(prjNameArray, taskCodeArray, tasks);
		$("#look_prj_type").text(data.prjType);
		$("#look_prj_jyms").text(data.jyms);
		$("#look_jiafangName").text(data.ccName);
		$("#look_yifangName").text(data.contractNameYi);
		$("#look_year").text(data.contractStartTime);
		$("#look_year2").text(data.contractEndTime);
		$("#look_yifang_department").text(data.omName);
		$("#look_work_date").text(data.contractLongTime);
		$("#look_receieve_money_condition").text(data.receieveMoneyCondition);
		$("#look_contract_money").text(data.contractMoney);
		$("#look_temporary_money").text(data.temporaryMoney);
		$("#look_year3").text(data.contractSignTime);
		$("#look_work_info").text(data.workInfo);
		var cs = data.cjSplitMoney;
		$("#look_split_table tbody").empty();
		for (var i = 0; i < cs.length; i++) {
			$("#look_split_table tbody").append(
					"<tr><td>" + "" + cs[i].year + "" + "</td><td>" + ""
							+ cs[i].money + "" + "</td></tr>")
		}

		/* 		$("#look_xieban tbody").html('');
				$("#look_xieban tbody").append("<tr><td style='width:10%;'>主办部门</td><td style='width:15%;'>"+data.name+"</td><td style='width:10%;'>"+data.mainDepartmentMoney+"</td><td id="+data.mainDepartment+"></td></tr>")
				selectCjDeptSplitMoney(data.cjId,data.mainDepartment);
				if(data.assistDepartment1!=null&&data.assistDepartment1!=""){
					$("#look_xieban tbody").append("<tr><td>协办部门</td><td>"+data.name2+"</td><td>"+data.assistDepartment1Money+"</td><td id="+data.assistDepartment1+"></td></tr>")
					selectCjDeptSplitMoney(data.cjId,data.assistDepartment1);
		  	}
		  	if(data.assistDepartment2!=null&&data.assistDepartment2!=""){
		  		$("#look_xieban tbody").append("<tr><td>协办部门</td><td>"+data.name3+"</td><td>"+data.assistDepartment2Money+"</td><td id="+data.assistDepartment2+"></td></tr>")
		  		selectCjDeptSplitMoney(data.cjId,data.assistDepartment2);
		  	}
		  	if(data.assistDepartment3!=null&&data.assistDepartment3!=""){
		  		$("#look_xieban tbody").append("<tr><td>协办部门</td><td>"+data.name4+"</td><td>"+data.assistDepartment3Money+"</td><td id="+data.assistDepartment3+"></td></tr>")
		  		selectCjDeptSplitMoney(data.cjId,data.assistDepartment3);
		  	} */

		$
				.ajax({
					type : 'POST',
					url : getContextPath()
							+ '/announcement/selectAccessoryById',
					dataType : 'json',
					data : {
						id : data.cjId
					},
					success : function(json) {
						$("#look_accessory tbody").html('');
						$("#look_accessory2 tbody").html('');
						$("#look_saomainHT tbody").html('');
						for (var i = 0; i < json.length; i++) {
							if (json[i].aType == "承接合同文本") {
								$("#look_accessory tbody")
										.append(
												"<tr>"
														+ "<td>附件</td>"
														+ "<td colspan='2'><a href='"
														+ getLocalPath()
														+ "/oa_file/"
														+ json[i].acUrl
														+ "' target='view_window' style='color:blue;'>"
														+ json[i].acName
														+ "</a></td>" +
														/* "<td ><input type='text' class='form-control' style='width:70%;' value='"+json[i].acName+"' disabled></td>"+
														"<td style='width:150px;'><button type='button' class='btn btn-primary' data='"+json[i].acUrl+"' data2='"+json[i].acName+"' onclick='downloadFile(this)'>下载附件</button></td>"+ */
														"</tr>");
							}
							if (json[i].aType == "法律顾问签字") {
								$("#look_accessory2 tbody")
										.append(
												"<tr>"
														+ "<td>附件</td>"
														+ "<td colspan='2'><a href='"
														+ getLocalPath()
														+ "/oa_file/"
														+ json[i].acUrl
														+ "' target='view_window' style='color:blue;'>"
														+ json[i].acName
														+ "</a></td>" +
														/* "<td ><input type='text' class='form-control' style='width:70%;' value='"+json[i].acName+"' disabled></td>"+
														"<td style='width:150px;'><button type='button' class='btn btn-primary' data='"+json[i].acUrl+"' data2='"+json[i].acName+"' onclick='downloadFile(this)'>下载附件</button></td>"+ */
														"</tr>");
							}
							if (json[i].aType == "合同扫描件") {
								$("#look_saomainHT tbody")
										.append(
												"<tr>"
														+ "<td style='width:20%;'>附件</td>"
														+ "<td colspan='3'><a href='"
														+ getLocalPath()
														+ "/oa_file/"
														+ json[i].acUrl
														+ "' target='view_window' style='color:blue'>"
														+ json[i].acName
														+ "</a></td>" + "</tr>");
							}
						}
					}
				});

		$
				.ajax({
					type : 'POST',
					url : getContextPath() + '/subcontract/getFBNoBycjNo',
					dataType : 'json',
					data : {
						no : data.contractNo
					},
					success : function(json) {
						$("#look_fbcontract tbody").html('');
						if (json == "" || typeof (json[0].fbNo) == "undefined"
								|| json[0].fbNo == null || json[0].fbNo == "") {
							return;
						}
						var fbcontractahtml = "<a href='../chankanxiangqing/fbContractDetails.html?fbNo="
								+ json[0].fbNo
								+ "' target='view_window' style='color:blue;'>"
								+ json[0].fbNo + "</a>";
						for (var i = 1; i < json.length; i++) {
							fbcontractahtml += "，<a href='../chankanxiangqing/fbContractDetails.html?fbNo="
									+ json[i].fbNo
									+ "' target='view_window' style='color:blue;'>"
									+ json[i].fbNo + "</a>";
						}
						if (fbcontractahtml != "") {
							$("#look_fbcontract tbody")
									.append(
											"<tr>"
													+ "<td style='width:20%;font-weight:bolder;'>分包合同信息</td>"
													+ "<td colspan='3'>"
													+ fbcontractahtml + "</td>"
													+ "</tr>");
						}
					}

				});

		$.ajax({
			type : 'POST',
			url : getContextPath() + '/cj/selectCjHistory',
			dataType : 'json',
			data : {
				no : data.contractNo
			},
			success : function(json) {
				$('#history_table').dataTable().fnClearTable();
				$('#history_table').DataTable().rows.add(json).draw(false);
			}
		});

		$.ajax({
			type : 'POST',
			url : getContextPath()
					+ '/flowHistory/getHistoryNowAndLastByModeId',
			data : {
				id : data.cjId
			},
			success : function(json) {
				$("#d_table tbody").html('');
				for (var i = 0; i < json.length; i++) {
					var operatorType = json[i].operateType;
					operatorType = getCnByOt(operatorType);
					var date = json[i].doDate;
					var title = json[i].title;
					var name = json[i].actorname;
					var view = json[i].view;
					if (date == null) {
						date = "";
						if (json[i].operateType == 8) {
							title = "<lable style='color:red'>" + json[i].title
									+ "</lable>";
							name = "<lable style='color:red'>"
									+ json[i].actorname + "</lable>";
							operatorType = "<lable style='color:red'>"
									+ operatorType + "</lable>";
							view = "<lable style='color:red'>" + json[i].view
									+ "</lable>";
						} else {
							title = json[i].title;
							name = json[i].actorname;
						}

					}
					$("#d_table tbody").append(
							"<tr><td>" + title + "</td><td>" + name
									+ "</td><td>" + view + "</td><td>"
									+ operatorType + "</td><td>" + date
									+ "</td></tr>");
				}
			}
		});

		//$("#allMsg1").modal("show");
		$("#diyi").removeClass("active");
		$("#disi").addClass("active");
		$("#diyi a").show();
		$("#disi a").show();
		$("#home").removeClass("active");
		$("#settings").addClass("active");
	}

	function getCnByOt(s) {
		if (s == 1) {
			return "提交";
		} else if (s == 2) {
			return "退回";
		} else if (s == 3) {
			return "撤销";
		} else if (s == 0) {
			return "驳回";
		} else if (s == 8) {
			return "待审批";
		}
	}

	function selectCjDeptSplitMoney(id, dept) {
		$.ajax({
			type : 'POST',
			url : getContextPath() + '/cj/selectCjDeptSplitMoney',
			dataType : 'json',
			data : {
				id : id,
				dept : dept
			},
			success : function(json) {
				$("#" + dept + "").html('');
				for (var i = 0; i < json.length; i++) {
					$("#" + dept + "").append(
							'<lable style="margin-left:25px;">' + json[i].year
									+ '：' + json[i].money + '</lable>')
				}
			}
		});
	}

	function downloadFile(obj) {
		var filePath = $(obj).attr("data");
		var fileName = $(obj).attr("data2");
		window.location.href = encodeURI(getContextPath()
				+ "/FileDownLoad?fileName=" + fileName + "&filePath="
				+ filePath);
	}
	function getTaskBytaskCode(taskNos) {
		var array;
		$.ajax({
			type : 'POST',
			url : getContextPath() + '/task/selectTaskPrjName',
			dataType : 'json',
			async : false,
			data : {
				prjNo : taskNos
			},
			success : function(json) {
				array = json;
			}
		})
		return array;
	}
	var edit_id;
	function contractChange(obj) {
		var tr = $(obj).parents("tr");
		var data = $("#mainContent").DataTable().row(tr).data();
		edit_id = data.cjId;

		$("#edit_contract_name").val(data.contractName);
		$("#edit_contract_no").val(data.contractNo);
		$("#edit_work_no").val(data.taskCode);
		$("#edit_prj_name").val(data.prjName);
		var prjNameArray = data.prjName.split(",");
		var taskCodeArray = data.taskCode.split(",");
		var tasks = getTaskBytaskCode(data.taskCode);
		editpinjieRenwudanChaifen(prjNameArray, taskCodeArray, tasks);
		//重新初始化任务单号与任务单名称选择框,加上本次变更已关联任务单
		refreshSelectEdit(tasks)
		$("#edit_prj_type").val(data.prjType);
		if (data.contractNameJia != null) {
			var contractNameJiaArray = data.contractNameJia.split(",");
			$("#edit_jiafangName").val(contractNameJiaArray);
			$("#edit_jiafangName").selectpicker("refresh");
		}

		$("#edit_yifangName").val(data.contractNameYi);
		$("#edit_year").val(data.contractStartTime);
		$("#edit_year2").val(data.contractEndTime);
		$("#edit_prj_jyms").val(data.jyms);

		$.ajax({
			type : 'POST',
			url : getContextPath() + '/task/selectTaskPrjName',
			dataType : 'json',
			data : {
				prjNo : data.taskCode
			},
			success : function(json) {
				var deptArray = new Array();
				for (var ii = 0; ii < json.length; ii++) {
					var mainDept = json[ii].mainDepartment;
					var omName = json[ii].omName;
					var xbDept = json[ii].assist_department1;
					var xbname = json[ii].name1;
					var xbDept2 = json[ii].assist_department2;
					var xbname2 = json[ii].name2;
					var xbDept3 = json[ii].assist_department3;
					var xbname3 = json[ii].name3;
					if (mainDept != null && mainDept != '') {
						var dept = {
							id : undefined,
							name : undefined
						}
						dept.id = mainDept;
						dept.name = omName;
						if (deptArray.length > 0) {
							var count = 0;
							for (var d = 0; d < deptArray.length; d++) {
								if (deptArray[d].id == mainDept) {
									count = 1;
								}
							}
							if (count != 1) {
								deptArray.push(dept);
							}
						} else {
							deptArray.push(dept);
						}
					}

					if (xbDept != null && xbDept != '') {
						var dept2 = {
							id : undefined,
							name : undefined
						}
						dept2.id = xbDept;
						dept2.name = xbname;
						if (deptArray.length > 0) {
							var count = 0;
							for (var d = 0; d < deptArray.length; d++) {
								if (deptArray[d].id == xbDept) {
									count = 1;
								}
							}
							if (count != 1) {
								deptArray.push(dept2);
							}
						} else {
							deptArray.push(dept2);
						}
					}

					if (xbDept2 != null && xbDept2 != '') {
						var dept3 = {
							id : undefined,
							name : undefined
						}
						dept3.id = xbDept2;
						dept3.name = xbname2;
						if (deptArray.length > 0) {
							var count = 0;
							for (var d = 0; d < deptArray.length; d++) {
								if (deptArray[d].id == xbDept2) {
									count = 1;
								}
							}
							if (count != 1) {
								deptArray.push(dept3);
							}
						} else {
							deptArray.push(dept3);
						}
					}
					if (xbDept3 != null && xbDept3 != '') {
						var dept4 = {
							id : undefined,
							name : undefined
						}
						dept4.id = xbDept3;
						dept4.name = xbname3;
						if (deptArray.length > 0) {
							var count = 0;
							for (var d = 0; d < deptArray.length; d++) {
								if (deptArray[d].id == xbDept3) {
									count = 1;
								}
							}
							if (count != 1) {
								deptArray.push(dept4);
							}
						} else {
							deptArray.push(dept4);
						}
					}

				}
				$("#edit_yifang_department").html('');
				for (var c = 0; c < deptArray.length; c++) {
					$("#edit_yifang_department").append(
							"<option value="+deptArray[c].id+">"
									+ deptArray[c].name + "</option>")
				}
				$("#edit_yifang_department").val(data.yiCjDepartment);
			}
		});

		$("#edit_work_date").val(data.contractLongTime);
		$("#edit_receieve_money_condition").val(data.receieveMoneyCondition);
		$("#edit_contract_money").val(data.contractMoney);
		$("#edit_temporary_money").val(data.temporaryMoney);
		$("#edit_year3").val(data.contractSignTime);
		$("#edit_work_info").val(data.workInfo);
		$("#xgzhuban").val(data.mainDepartment);
		$("#xgzhubanjine").val(data.mainDepartmentMoney);

		var cs = data.cjSplitMoney;
		$("#edit_split_table tbody").empty();
		for (var i = 0; i < cs.length; i++) {
			$("#edit_split_table tbody").append(
					"<tr><td>" + "" + cs[i].year + "" + "</td><td>" + ""
							+ cs[i].money + "" + "</td></tr>")
		}

		$("#xgxieban .xieban").empty();
		if (data.assistDepartment1 != null && data.assistDepartment1 != "") {
			$("#xgxieban tbody")
					.append(
							"<tr class='xieban'><td>"
									+ "协办部门1"
									+ "</td><td>"
									+ '<form class="form-inline">'
									+ '<select class="form-control" id="xgxieban1" style="width:160px;">'
									+ '</select>'
									+ '<input type="text" id="xgxiebanMoney1" class="form-control" style="width:160px;margin-left:5px;" placeholder="金额">'
									+ "<button type='button' style='margin-left:15px;' class='btn btn-primary' onclick='deleteXieBan(this)'>移除协办单位</button>"
									+ '</form>' + "</td><td></td></tr>");
			xiebanhuixian(data.assistDepartment1, 1);
			$("#xgxiebanMoney1").val(data.assistDepartment1Money);
		}
		if (data.assistDepartment2 != null && data.assistDepartment2 != "") {
			$("#xgxieban tbody")
					.append(
							"<tr class='xieban'><td>"
									+ "协办部门2"
									+ "</td><td>"
									+ '<form class="form-inline">'
									+ '<select class="form-control" id="xgxieban2" style="width:160px;">'
									+ '</select>'
									+ '<input type="text" id="xgxiebanMoney2" class="form-control" style="width:160px;margin-left:5px;" placeholder="金额">'
									+ "<button type='button' style='margin-left:15px;' class='btn btn-primary' onclick='deleteXieBan(this)'>移除协办单位</button>"
									+ '</form>' + "</td><td></td></tr>");
			xiebanhuixian(data.assistDepartment2, 2);
			$("#xgxiebanMoney2").val(data.assistDepartment2Money);
		}
		if (data.assistDepartment3 != null && data.assistDepartment3 != "") {
			$("#xgxieban tbody")
					.append(
							"<tr class='xieban'><td>协办部门3</td><td>"
									+ '<form class="form-inline">'
									+ '<select class="form-control" id="xgxieban3" style="width:160px;">'
									+ '</select>'
									+ '<input type="text" id="xgxiebanMoney3" class="form-control" style="width:160px;margin-left:5px;" placeholder="金额">'
									+ "<button type='button' style='margin-left:15px;' class='btn btn-primary' onclick='deleteXieBan(this)'>移除协办单位</button>"
									+ '</form>' + "</td><td></td></tr>");
			xiebanhuixian(data.assistDepartment3, 3);
			$("#xgxiebanMoney3").val(data.assistDepartment3Money);
		}
		$
				.ajax({
					type : 'POST',
					url : getContextPath()
							+ '/announcement/selectAccessoryById',
					dataType : 'json',
					data : {
						id : edit_id
					},
					success : function(json) {
						//console.log(json)
						$("#edit_accessory tfoot").html('');
						$("#edit_accessory2 tfoot").html('');
						for (var i = 0; i < json.length; i++) {
							if (json[i].aType == "承接合同文本") {
								$("#edit_accessory tfoot")
										.append(
												"<tr>"
														+ "<td>附件</td>"
														+ "<td colspan='1'><a href='"
														+ getLocalPath()
														+ "/oa_file/"
														+ json[i].acUrl
														+ "' target='view_window' style='color:blue;'>"
														+ json[i].acName
														+ "</a></td>"
														+ "<td style='width:150px;'><button type='button' class='btn btn-primary'data-id="
														+ edit_id
														+ " data='"
														+ json[i].acUrl
														+ "' data2='"
														+ json[i].acName
														+ "' onclick='delteFile(this)'>删除附件</button></td>"
														+
														/* "<td ><input type='text' class='form-control' style='width:70%;' value='"+json[i].acName+"' disabled></td>"+
														"<td style='width:150px;'><button type='button' class='btn btn-primary' data='"+json[i].acUrl+"' data2='"+json[i].acName+"' onclick='downloadFile(this)'>下载附件</button></td>"+ */
														"</tr>");
							}
							if (json[i].aType == "法律顾问签字") {
								$("#edit_accessory2 tfoot")
										.append(
												"<tr>"
														+ "<td>附件</td>"
														+ "<td colspan='2'><a href='"
														+ getLocalPath()
														+ "/oa_file/"
														+ json[i].acUrl
														+ "' target='view_window' style='color:blue;'>"
														+ json[i].acName
														+ "</a></td>"
														+ "<td style='width:150px;'><button type='button' class='btn btn-primary'data-id="
														+ edit_id
														+ " data='"
														+ json[i].acUrl
														+ "' data2='"
														+ json[i].acName
														+ "' onclick='delteFile(this)'>删除附件</button></td>"
														+
														/* "<td ><input type='text' class='form-control' style='width:70%;' value='"+json[i].acName+"' disabled></td>"+
														"<td style='width:150px;'><button type='button' class='btn btn-primary' data='"+json[i].acUrl+"' data2='"+json[i].acName+"' onclick='downloadFile(this)'>下载附件</button></td>"+ */
														"</tr>");
							}
						}
					}
				});
		//$("#change").modal("show");
		$("#diyi").removeClass("active");
		$("#disan").addClass("active");
		$("#diyi a").show();
		$("#disan a").show();
		$("#home").removeClass("active");
		$("#messages").addClass("active");
	}

	function delteFile(obj) {
		var id = $(obj).attr("data-id");
		var name = $(obj).attr("data2");
		var statu = confirm("确认删除吗?");
		if (!statu) {
			return false;
		}
		$.ajax({
			type : 'POST',
			url : getContextPath() + '/accessory/deleteAccessoryByIdAndName',
			dataType : 'json',
			data : {
				aId : id,
				acName : name
			},
			success : function(json) {
				if (json > 0) {
					$(obj).parent().parent().remove();
					toastr.success("删除成功");
				} else {
					toastr.error("删除失败");
				}
			}
		});
	}

	function edit_save() {
		var splitArray = new Array();
		/* $("#edit_split_table tbody").find("tr").each(function(){
			var years=$(this).find("td").eq(0).text();
			var moneys=$(this).find("td").eq(1).text();
			var arr={
					cjId:null,
					year:undefined,
					money:undefined
			}
			arr.cjId=null;
			arr.year=years;
			arr.money=moneys;
			splitArray.push(arr)
		}) */
		
		var deptSplitArray = new Array();
		var chaiFenXinXiArray = new Array();
		chaiFenXinXiArray = getChaifenXinXiArray("edit_contract_money");
		var moneyFlag = judgeInputMoney("edit_contract_money");
		/* if(!moneyFlag){
			toastr.error("金额分配有误!请检查!");
			return false;
		} */
		var fentanFlag = judgeFentanbili();
		/* if(fentanFlag==1){
			toastr.error("分摊比例未填!请检查!");
			return false;
		} */
		var contract_name = $("#edit_contract_name").val();
		var contract_no = $("#edit_contract_no").val();
		var work_no = $("#edit_work_no").val();
		var prj_name = $("#edit_prj_name").val();
		var jyms_type = $("#edit_prj_jyms").val();
		var prj_type = $("#edit_prj_type").val();
		var jfId = $("#edit_jiafangName").val().toString();
		var yifangName = $("#edit_yifangName").val();
		var ccName = $("#edit_jiafangName").parent("td").find("button").attr(
				"title");
		var year = $("#edit_year").val();
		var year2 = $("#edit_year2").val();
		var yifang_department = $("#edit_yifang_department").val();
		var work_date = $("#edit_work_date").val();
		var receieve_money_condition = $("#edit_receieve_money_condition")
				.val();
		var contract_money = $("#edit_contract_money").val();
		var temporary_money = $("#edit_temporary_money").val();
		var year3 = $("#edit_year3").val();
		var work_info = $("#edit_work_info").val();
		var zhuban = $("#xgzhuban").val();
		var zhubanjine = $("#xgzhubanjine").val();
		var xieban1 = $("#xgxieban1").find("option:selected").val();
		var xieban1jine = $("#xgxiebanMoney1").val();
		var xieban2 = $("#xgxieban2").find("option:selected").val();
		var xieban2jine = $("#xgxiebanMoney2").val();
		var xieban3 = $("#xgxieban3").find("option:selected").val();
		var xieban3jine = $("#xgxiebanMoney3").val();
		var split_state = 0;
		if ($("#edit_split_table tbody").find('tr').length > 0) {
			split_state = 1;
		}
		var baocun_views = $("#baocun_views").val();
		var cjContract = {
			cjId : null,
			taskCode : undefined,
			contractName : undefined,
			contractNo : undefined,
			prjName : undefined,
			prjType : undefined,
			contractNameJia : undefined,
			ccName : undefined,
			contractNameYi : undefined,
			contractStartTime : undefined,
			contractEndTime : undefined,
			yiCjDepartment : undefined,
			contractLongTime : undefined,
			receieveMoneyCondition : undefined,
			contractMoney : undefined,
			temporaryMoney : undefined,
			contractSignTime : undefined,
			workInfo : undefined,
			mainDepartment : undefined,
			mainDepartmentMoney : undefined,
			assistDepartment1 : undefined,
			assistDepartment1Money : undefined,
			assistDepartment2 : undefined,
			assistDepartment2Money : undefined,
			assistDepartment3 : undefined,
			assistDepartment3Money : undefined,
			splitState : undefined,
			cjSplitMoney : undefined,
			jyms : undefined,
			oldCjId : null,
		}
		cjContract.cjId = edit_id;
		cjContract.taskCode = work_no;
		cjContract.contractName = contract_name;
		cjContract.contractNo = contract_no;
		cjContract.prjName = prj_name;
		cjContract.prjType = prj_type;
		cjContract.contractNameJia = jfId;
		cjContract.ccName = ccName;
		cjContract.contractNameYi = yifangName;
		cjContract.contractStartTime = year;
		cjContract.contractEndTime = year2;
		cjContract.yiCjDepartment = yifang_department;
		cjContract.contractLongTime = work_date;
		cjContract.receieveMoneyCondition = receieve_money_condition;
		cjContract.contractMoney = contract_money;
		cjContract.temporaryMoney = temporary_money;
		cjContract.contractSignTime = year3;
		cjContract.workInfo = work_info;
		cjContract.mainDepartment = zhuban;
		cjContract.mainDepartmentMoney = zhubanjine;
		cjContract.assistDepartment1 = xieban1;
		cjContract.assistDepartment1Money = xieban1jine;
		cjContract.assistDepartment2 = xieban2;
		cjContract.assistDepartment2Money = xieban2jine;
		cjContract.assistDepartment3 = xieban3;
		cjContract.assistDepartment3Money = xieban3jine;
		cjContract.splitState = 0;
		cjContract.cjSplitMoney = splitArray;
		cjContract.chaiFenXinXiArray = chaiFenXinXiArray;
		cjContract.jyms = jyms_type;
		cjContract.oldCjId = edit_id;
		cjContract.tijiaoViews = baocun_views;

		var formData = new FormData();
		formData.append("cjContract", JSON.stringify(cjContract));

		$("#edit_accessory tbody").find("tr").each(function() {
			formData.append("file", $(this).find("input")[0].files[0]);
		})
		$("#edit_accessory2 tbody").find("tr").each(function() {
			formData.append("file2", $(this).find("input")[0].files[0]);
		})

		$.ajax({
			type : 'POST',
			url : getContextPath() + '/cj/updateCjContractBySave',
			data : formData,
			cache : false,
			processData : false,
			contentType : false,
			async : false,
			success : function(json) {
				$("#baocun_view_modal").modal("hide");
				if (json > 0) {
					//$("#myModal").modal("hide");
					toastr.success("保存成功");
					quxiaob();
				} else {
					toastr.error("保存失败");
				}
			}
		})
	}
	
	function save_tijiao_view() {
		$("#baocun_view_modal").modal("show");
	}
	
	function xg_tijiao_view() {
		$("#tijiao_view_modal").modal("show");
	}

	function edit_submit() {
		
		var splitArray = new Array();
		var deptSplitArray = new Array();
		var chaiFenXinXiArray = new Array();
		chaiFenXinXiArray = getChaifenXinXiArray("edit_contract_money");
		var moneyFlag = judgeInputMoney("edit_contract_money");
		if (!moneyFlag) {
			toastr.error("金额分配有误!请检查!");
			return false;
		}
		var fentanFlag = judgeFentanbili();
		if (fentanFlag == 1) {
			toastr.error("分摊比例未填!请检查!");
			return false;
		}
		myTool.mask.show('拉取审批负责人中...');
		var contract_name = $("#edit_contract_name").val();
		var contract_no = $("#edit_contract_no").val();
		var work_no = $("#edit_work_no").val();
		var prj_name = $("#edit_prj_name").val();
		var prj_type = $("#edit_prj_type").val();
		var jiafangName = $("#edit_jiafangName").val();
		var yifangName = $("#yifangName").val();
		var jfId = $("#edit_jiafangName").val().toString();
		var ccName = $("#edit_jiafangName").parent("td").find("button").attr(
				"title");
		var year = $("#edit_year").val();
		var year2 = $("#edit_year2").val();
		var yifang_department = $("#edit_yifang_department").val();
		var work_date = $("#edit_work_date").val();
		var receieve_money_condition = $("#edit_receieve_money_condition")
				.val();
		var contract_money = $("#edit_contract_money").val();
		var temporary_money = $("#edit_temporary_money").val();
		var year3 = $("#edit_year3").val();
		var work_info = $("#edit_work_info").val();
		var zhuban = $("#xgzhuban").val();
		var zhubanjine = $("#xgzhubanjine").val();
		var xieban1 = $("#xgxieban1").find("option:selected").val();
		var xieban1jine = $("#xgxiebanMoney1").val();
		var xieban2 = $("#xgxieban2").find("option:selected").val();
		var xieban2jine = $("#xgxiebanMoney2").val();
		var xieban3 = $("#xgxieban3").find("option:selected").val();
		var xieban3jine = $("#xgxiebanMoney3").val();
		var split_state = 0;
		var edit_prj_jyms = $("#edit_prj_jyms").val();
		if ($("#edit_split_table tbody").find('tr').length > 0) {
			split_state = 1;
		}
		var cjContract = {
			cjId : null,
			taskCode : undefined,
			contractName : undefined,
			contractNo : undefined,
			prjName : undefined,
			prjType : undefined,
			contractNameJia : undefined,
			ccName : undefined,
			contractNameYi : undefined,
			contractStartTime : undefined,
			contractEndTime : undefined,
			yiCjDepartment : undefined,
			contractLongTime : undefined,
			receieveMoneyCondition : undefined,
			contractMoney : undefined,
			temporaryMoney : undefined,
			contractSignTime : undefined,
			workInfo : undefined,
			mainDepartment : undefined,
			mainDepartmentMoney : undefined,
			assistDepartment1 : undefined,
			assistDepartment1Money : undefined,
			assistDepartment2 : undefined,
			assistDepartment2Money : undefined,
			assistDepartment3 : undefined,
			assistDepartment3Money : undefined,
			splitState : undefined,
			cjSplitMoney : undefined,
			jyms : undefined,
			oldCjId : null,
		}
		cjContract.cjId = edit_id;
		cjContract.taskCode = work_no;
		cjContract.contractName = contract_name;
		cjContract.contractNo = contract_no;
		cjContract.prjName = prj_name;
		cjContract.prjType = prj_type;
		cjContract.contractNameJia = jfId;
		cjContract.ccName = ccName;
		cjContract.contractNameYi = yifangName;
		cjContract.contractStartTime = year;
		cjContract.contractEndTime = year2;
		cjContract.yiCjDepartment = yifang_department;
		cjContract.contractLongTime = work_date;
		cjContract.receieveMoneyCondition = receieve_money_condition;
		cjContract.contractMoney = contract_money;
		cjContract.temporaryMoney = temporary_money;
		cjContract.contractSignTime = year3;
		cjContract.workInfo = work_info;
		cjContract.mainDepartment = zhuban;
		cjContract.mainDepartmentMoney = zhubanjine;
		cjContract.assistDepartment1 = xieban1;
		cjContract.assistDepartment1Money = xieban1jine;
		cjContract.assistDepartment2 = xieban2;
		cjContract.assistDepartment2Money = xieban2jine;
		cjContract.assistDepartment3 = xieban3;
		cjContract.assistDepartment3Money = xieban3jine;
		cjContract.splitState = split_state;
		cjContract.cjSplitMoney = splitArray;
		cjContract.chaiFenXinXiArray = chaiFenXinXiArray;
		cjContract.jyms = edit_prj_jyms;
		cjContract.oldCjId = edit_id;
		var baocun_views = $("#tijiao_views").val();
		
		cjContract.tijiaoViews = baocun_views;

		var formData = new FormData();
		formData.append("cjContract", JSON.stringify(cjContract));

		$("#edit_accessory tbody").find("tr").each(function() {
			formData.append("file", $(this).find("input")[0].files[0]);
		})
		$("#edit_accessory2 tbody").find("tr").each(function() {
			formData.append("file2", $(this).find("input")[0].files[0]);
		})

		$
				.ajax({
					type : 'POST',
					url : getContextPath() + '/cj/updateCjContractBySubmit',
					data : formData,
					cache : false,
					processData : false,
					contentType : false,
					dataType : 'json',
					async : false,
					success : function(json) {
						$("#tijiao_view_modal").modal("hide");
						myTool.mask.hide();
						if (json == '0') {
							toastr.error("保存失败");
						} else {
							quxiaob();
							lianjie = json.url;
							if (json.receiver != null
									&& json.receiver.length >= 1) {
								$("#tijiaogei").modal('show');
								$("#tijiaoren tbody").empty("");
								for (var i = 0; i < json.receiver.length; i++) {
									$("#tijiaoren tbody")
											.append(
													'<tr><td>'
															+ '<input type="radio" style="width:20px;height:20px;" name="tijiaorenming" data-id="'+json.receiver[i].userId+'" data-id2="'+json.receiver[i].omId+'" data-id3="'+json.receiver[i].dutyId+'">'
															+ '</td><td>'
															+ json.receiver[i].omName
															+ '</td><td>'
															+ json.receiver[i].dutyName
															+ '</td><td>'
															+ json.receiver[i].uName
															+ '</td></tr>');
								}
							} else if (json.receiver.length == 1) {
								$.ajax({
									type : 'POST',
									url : getContextPath() + '/task/addTask4',
									dataType : 'json',
									data : {
										url : json.url,
										userId : json.receiver.userId,
										uName : json.receiver.uName,
										omName : json.receiver.omName,
										dutyName : json.receiver.dutyName,
										omId : json.receiver.omId,
										dutyId : json.receiver.dutyId
									},
									success : function(json) {
										toastr.success('提交成功');
									}
								});
							}
						}
						/* if(json>0){
							//$("#myModal").modal("hide");
							toastr.success("保存成功");
							quxiaob();
						}else{
							toastr.error("保存失败");
						} */
					}
				})
	}

	/* function lookCancel(obj){
		$("#look_cancel").modal("show");
	} */

	function lookHistory(obj) {
		var tr = $(obj).parents("tr");
		var data = $("#history_table").DataTable().row(tr).data();

		$("#look_contract_name2").text(data.contractName);
		$("#look_contract_no2").text(data.contractNo);
		$("#look_work_no2").text(data.taskCode);
		$("#look_prj_name2").text(data.prjName);
		$("#look_prj_type2").text(data.prjType);
		$("#look_jiafangName2").text(data.ccName);
		$("#look_yifangName2").text(data.contractNameYi);
		$("#look_year_2").text(data.contractStartTime);
		$("#look_year2_2").text(data.contractEndTime);
		$("#look_yifang_department2").text(data.omName);
		$("#look_work_date2").text(data.contractLongTime);
		$("#look_receieve_money_condition2").text(data.receieveMoneyCondition);
		$("#look_contract_money2").text(data.contractMoney);
		$("#look_temporary_money2").text(data.temporaryMoney);
		$("#look_year3_2").text(data.contractSignTime);
		$("#look_work_info2").text(data.workInfo);
		var cs = data.cjSplitMoney;
		$("#look_split_table2 tbody").empty();
		for (var i = 0; i < cs.length; i++) {
			$("#look_split_table2 tbody").append(
					"<tr><td>" + "" + cs[i].year + "" + "</td><td>" + ""
							+ cs[i].money + "" + "</td></tr>")
		}

		$("#look_xieban2 tbody").html('');
		$("#look_xieban2 tbody").append(
				"<tr><td>主办部门</td><td>" + data.name + "</td><td>金额</td><td>"
						+ data.mainDepartmentMoney + "</td></tr>")
		if (data.assistDepartment1 != null && data.assistDepartment1 != "") {
			$("#look_xieban2 tbody").append(
					"<tr><td>协办部门</td><td>" + data.name2
							+ "</td><td>金额</td><td>"
							+ data.assistDepartment1Money + "</td></tr>")
		}
		if (data.assistDepartment2 != null && data.assistDepartment2 != "") {
			$("#look_xieban2 tbody").append(
					"<tr><td>协办部门</td><td>" + data.name3
							+ "</td><td>金额</td><td>"
							+ data.assistDepartment2Money + "</td></tr>")
		}
		if (data.assistDepartment3 != null && data.assistDepartment3 != "") {
			$("#look_xieban2 tbody").append(
					"<tr><td>协办部门</td><td>" + data.name4
							+ "</td><td>金额</td><td>"
							+ data.assistDepartment3Money + "</td></tr>")
		}
		$
				.ajax({
					type : 'POST',
					url : getContextPath()
							+ '/announcement/selectAccessoryById',
					dataType : 'json',
					data : {
						id : data.cjId
					},
					success : function(json) {
						$("#look_accessory3 tbody").html('');
						$("#look_accessory4 tbody").html('');
						for (var i = 0; i < json.length; i++) {
							if (json[i].aType == "承接合同文本") {
								$("#look_accessory3 tbody")
										.append(
												"<tr>"
														+ "<td>附件</td>"
														+ "<td colspan='2'><a href='"
														+ getLocalPath()
														+ "/oa_file/"
														+ json[i].acUrl
														+ "' target='view_window' style='color:blue;'>"
														+ json[i].acName
														+ "</a></td>" +
														/* "<td ><input type='text' class='form-control' style='width:70%;' value='"+json[i].acName+"' disabled></td>"+
														"<td style='width:150px;'><button type='button' class='btn btn-primary' data='"+json[i].acUrl+"' data2='"+json[i].acName+"' onclick='downloadFile(this)'>下载附件</button></td>"+ */
														"</tr>");
							}
							if (json[i].aType == "法律顾问签字") {
								$("#look_accessory4 tbody")
										.append(
												"<tr>"
														+ "<td>附件</td>"
														+ "<td colspan='2'><a href='"
														+ getLocalPath()
														+ "/oa_file/"
														+ json[i].acUrl
														+ "' target='view_window' style='color:blue;'>"
														+ json[i].acName
														+ "</a></td>" +
														/* "<td ><input type='text' class='form-control' style='width:70%;' value='"+json[i].acName+"' disabled></td>"+
														"<td style='width:150px;'><button type='button' class='btn btn-primary' data='"+json[i].acUrl+"' data2='"+json[i].acName+"' onclick='downloadFile(this)'>下载附件</button></td>"+ */
														"</tr>");
							}

						}
					}
				});
		$("#allMsg2").modal("show");
	}

	//拆分合同额
	function splitContractMoney(obj) {
		if (obj == 0) {//添加
			var startTime = $("#year").val();
			var endTime = $("#year2").val();
			var contractMoney = $("#contract_money").val()
			if (startTime == '' || startTime == null) {
				toastr.error("合同起日期不能为空");
				return;
			}
			if (endTime == '' || endTime == null) {
				toastr.error("合同讫日期不能为空");
				return;
			}
			if (contractMoney == "" || contractMoney == null) {
				toastr.error("合同金额不能为空")
				return;
			}
			var time1 = Date.parse(new Date(startTime));
			var time2 = Date.parse(new Date(endTime));
			if (parseInt(time1) > parseInt(time2)) {
				toastr.error("合同起日期不能大于合同讫日期");
				return;
			}
			var t1 = startTime.substring(0, 4);
			var t2 = endTime.substring(0, 4);
			var y = t2 - t1;
			if (y > 0) {
				$("#split").modal("show")
				$("#split_table tbody").empty();
				for (var i = 0; i <= y; i++) {
					$("#split_table tbody")
							.append(
									"<tr><td>"
											+ "<input type='text' style='width:100%;'  name='split_date' value="
											+ (parseInt(t1) + i)
											+ " class='form-control' disabled></td><td>"
											+ "<input type='text' style='width:100%;' class='form-control'></td>"
											+ "</tr>")
					/* lay('input[name=split_date]').each(function() {	
								laydate.render({
									elem: this,
									type: 'year'
								});
					}); */
				}
			} else {
				toastr.error("合同起讫日期不足1年")
			}

		} else if (obj == 1) {
			var startTime = $("#edit_year").val();
			var endTime = $("#edit_year2").val();
			var contractMoney = $("#edit_contract_money").val()
			if (startTime == '' || startTime == null) {
				toastr.error("合同起日期不能为空");
				return;
			}
			if (endTime == '' || endTime == null) {
				toastr.error("合同讫日期不能为空");
				return;
			}
			if (contractMoney == "" || contractMoney == null) {
				toastr.error("合同金额不能为空")
				return;
			}
			var time1 = Date.parse(new Date(startTime));
			var time2 = Date.parse(new Date(endTime));
			if (parseInt(time1) > parseInt(time2)) {
				toastr.error("合同起日期不能大于合同讫日期");
				return;
			}
			var t1 = startTime.substring(0, 4);
			var t2 = endTime.substring(0, 4);
			var y = t2 - t1;
			if (y > 0) {
				$("#xgsplit").modal("show")
				$("#xgsplit_table tbody").empty();
				for (var i = 0; i <= y; i++) {
					$("#xgsplit_table tbody")
							.append(
									"<tr><td>"
											+ "<input type='text' style='width:100%;'  name='split_date' value="
											+ (parseInt(t1) + i)
											+ " class='form-control' disabled></td><td>"
											+ "<input type='text' style='width:100%;' class='form-control'></td>"
											+ "</tr>")
					/* lay('input[name=split_date]').each(function() {	
								laydate.render({
									elem: this,
									type: 'year'
								});
					}); */
				}
			} else {
				toastr.error("合同起讫日期不足1年")
			}
		}
	}

	//保存拆分合同额
	function saveSplitMoney() {
		var allMoney = 0;
		var yearArr = [];
		var moneyArr = [];
		var contractMoney = $("#contract_money").val()
		$("#split_table tbody").find("tr").each(function() {
			var year = $(this).find("td").eq(0).find("input").val();
			var money = $(this).find("td").eq(1).find("input").val();
			if (year == '' || year == null) {
				toastr.error("年份不能为空");
				return;
			}
			if (money == '' || money == null) {
				toastr.error("金额不能为空");
				return;
			}
			yearArr.push(year)
			moneyArr.push(money)
			allMoney += Number(money)
		})
		if (allMoney == contractMoney) {
			$("#new_split_table tbody").empty();
			for (var i = 0; i < yearArr.length; i++) {
				for (var i = 0; i < moneyArr.length; i++) {
					$("#new_split_table tbody").append(
							"<tr><td>" + "" + yearArr[i] + "" + "</td><td>"
									+ "" + moneyArr[i] + "" + "</td></tr>")
				}
			}

			$("#split").modal("hide")
		} else {
			toastr.error("拆分总金额必须等于合同金额")
			return;
		}
	}

	//修改保存合同拆分额
	function checkSaveSplitMoney() {
		var allMoney = 0;
		var yearArr = [];
		var moneyArr = [];
		var contractMoney = $("#edit_contract_money").val()
		$("#xgsplit_table tbody").find("tr").each(function() {
			var year = $(this).find("td").eq(0).find("input").val();
			var money = $(this).find("td").eq(1).find("input").val();
			if (year == '' || year == null) {
				toastr.error("年份不能为空");
				return;
			}
			if (money == '' || money == null) {
				toastr.error("金额不能为空");
				return;
			}
			yearArr.push(year)
			moneyArr.push(money)
			allMoney += Number(money)
		})
		if (allMoney == contractMoney) {
			$("#edit_split_table tbody").empty();
			for (var i = 0; i < yearArr.length; i++) {
				for (var i = 0; i < moneyArr.length; i++) {
					$("#edit_split_table tbody")
							.append(
									"<tr><td>"
											+ ""
											+ yearArr[i]
											+ ""
											+ "</td><td>"
											+ ""
											+ moneyArr[i]
											+ ""
											+ "</td><td>"
											+ "<button type='button' class='btn btn-primary' onclick='deleteSplitMoney(this)'>移除</button>"
											+ "</td></tr>")
				}
			}

			$("#xgsplit").modal("hide")
		} else {
			toastr.error("拆分总金额必须等于合同金额")
			return;
		}
	}

	function deleteSplitMoney(obj) {
		var tr = $(obj).parents("tr");
		$(tr).remove();
	}

	/* function initDetailContract(){
	   // 调用方法
	   cjId=GetQueryString("cjId");
	   if(cjId!=null&&""!=cjId&&cjId!=undefined){
	   $("#"+cjId).trigger("click");
	   }
	}
	function GetQueryString(name){
	  var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
	  var r = window.location.search.substr(1).match(reg);
	  if(r!=null)return  unescape(r[2]); return null;
	} */

	function countMoney() {
		var length = $("#new_split_table tbody").find("tr").length;
		if (length == 0) {
			toastr.error("合同金额未拆分")
			return;
		}
		var contractMoney = $("#contract_money").val();
		var splitList = new Array();
		$("#new_split_table tbody").find("tr").each(function() {
			var splitMoney = {
				year : undefined,
				money : undefined,
				zb : undefined
			}
			var year = $(this).find("td").eq(0).text();
			var money = $(this).find("td").eq(1).text();
			var zb = money / contractMoney;
			splitMoney.year = year;
			splitMoney.money = money;
			splitMoney.zb = zb;
			splitList.push(splitMoney);
		})
		for ( var i in pageNameList) {
			$("#xieban" + i + " tbody")
					.find("tr")
					.each(
							function() {
								$(this).find("td").eq(2).html('');
								var department = $(this).find("td").eq(1).find(
										"select").eq(0).val();
								var deptAllMoney = $(this).find("td").eq(1)
										.find("input").eq(0).val();
								for (var i = 0; i < splitList.length; i++) {
									var deptMoney = splitList[i].zb
											* deptAllMoney;
									$(this)
											.find("td")
											.eq(2)
											.append(
													"<lable>"
															+ splitList[i].year
															+ "：</lable><input class='form-control' data="+splitList[i].year+" data2="+department+" style='width:150px;' value="+deptMoney+" disabled> ")
								}
							})
		}

	}

	function xgcountMoney() {
		var length = $("#edit_split_table tbody").find("tr").length;
		if (length == 0) {
			toastr.error("合同金额未拆分")
			return;
		}
		var contractMoney = $("#edit_contract_money").val();
		var splitList = new Array();
		$("#edit_split_table tbody").find("tr").each(function() {
			var splitMoney = {
				year : undefined,
				money : undefined,
				zb : undefined
			}
			var year = $(this).find("td").eq(0).text();
			var money = $(this).find("td").eq(1).text();
			var zb = money / contractMoney;
			splitMoney.year = year;
			splitMoney.money = money;
			splitMoney.zb = zb;
			splitList.push(splitMoney);
		})
		$("#xgxieban tbody")
				.find("tr")
				.each(
						function() {
							$(this).find("td").eq(2).html('');
							var department = $(this).find("td").eq(1).find(
									"select").eq(0).val();
							var deptAllMoney = $(this).find("td").eq(1).find(
									"input").eq(0).val();
							for (var i = 0; i < splitList.length; i++) {
								var deptMoney = splitList[i].zb * deptAllMoney;
								$(this)
										.find("td")
										.eq(2)
										.append(
												"<lable>"
														+ splitList[i].year
														+ "：</lable><input class='form-control' data="+splitList[i].year+" data2="+department+" style='width:150px;' value="+deptMoney+" disabled> ")
							}
						})

	}

	$("#contract_money").on("change", function() {
		$("#new_split_table tbody").html('');
	})

	$("#edit_contract_money").on("change", function() {
		$("#edit_split_table tbody").html('');
	})
	var pageNameList;
	var pageTaskNoArray;
	function pinjieRenwudanChaifen(namelist, array, tasks) {
		var namestr = namelist;
		pageNameList = namelist;
		pageTaskNoArray = array;
		var selecter;
		if (noType == 1) {
			selecter = "#edit_renwudanFenpei";
		} else {
			selecter = "#renwudanFenpei";
		}

		$(selecter).empty();
		if (namelist.length != array.length) {
			toastr.error("任务单编号信息有误");
			return false;
		}
		for ( var i in namestr) {
			$(selecter)
					.append(
							'<table class="table table-bordered table-condensed" id="xieban'+i+'">'
									+ '<thead>'
									+ '<tr>'
									+ '<th style="text-align:left;"><div style="width:300px">任务单:'
									+ namestr[i]
									+ '</div><div hidden="hidden">'
									+ array[i]
									+ '</div></th>'
									+ '<th colspan="2" >'
									+ '<div class="yihang2"><div>&nbsp;任务单金额分配:&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" onchange="renwudanMoneyChange()" class="renwudanMoney'
									+ i
									+ ' form-control" style="width:150px;" placeholder="任务单金额" id=renwudanMoney></input></div>'
									+ '<div><button type="button" class="btn btn-primary"  onclick="addBumen()">添加协办部门</button></div></div></th>'
									+ '</tr>'
									+ '</thead>'
									+ '<tbody>'
									+ '<tr>'
									+ '<td style="width:13%;">主办部门</td>'
									+ '<td style="width:32%;">'
									+ '<form class="form-inline">'
									+ '<select class="zhuban'+i+' form-control" style="width:150px;" name="zhuban" id="zhuban">'

									+ '</select>'
									+ '<input type="text" class="zhubanjine'+i+' form-control" style="width:150px;" placeholder="金额" id="zhubanjine">'
									+ '</form>'
									+ '</td>'
									+ "<td>"
									+ '<div class="yihang" ><div style="width:80px;">分摊比例:</div>'
									+ '<input type="text" id="zhubanFentan" class="zhubanFentan'+i+' form-control" style="width:150px;" placeholder="比例"></div>'
									+ '</td>'
									+ '</tr>'
									+ '</tbody>'
									+ '</table>');
			initbumenByClass(i);
			if (tasks[i] != null && tasks[i] != undefined) {
				$(".zhuban" + i + "").val(tasks[i].mainDepartment);
			}
			if (tasks[i] != null && tasks[i] != undefined) {
				$(".zhubanFentan" + i + "").val(tasks[i].mainDepartmentCost);
			}
			if (tasks[i] != null && tasks[i] != undefined) {
				$(".zhubanjine" + i + "").val(tasks[i].mainDepartmentMoney);
			}
			if (tasks[i] != null && tasks[i] != undefined) {
				$(".renwudanMoney" + i + "").val(tasks[i].prjEstimateMoney);
			}
			if (tasks[i] != null && tasks[i] != undefined) {
				addBumenEdit(i, tasks[i]);
			}
		}

	}

	function renwudanMoneyChange() {
		var len;
		if (noType == 1) {
			len = $("#edit_renwudanFenpei>table").length;
		} else {
			len = $("#renwudanFenpei>table").length;
		}
		for (var i = 0; i < len; i++) {
			var trLength = $("#xieban" + i + ">tbody>tr").length
			if (trLength == 1) {
				$(".zhubanjine" + i + "").val(
						$(".renwudanMoney" + i + "").val())
			}
		}
	}

	function editpinjieRenwudanChaifen(namelist, array, tasks) {
		var namestr = namelist;
		pageNameList = namelist;
		pageTaskNoArray = array;
		$("#edit_renwudanFenpei").empty();
		if (namelist.length != array.length) {
			toastr.error("任务单编号信息有误");
			return false;
		}
		for ( var i in namestr) {
			$("#edit_renwudanFenpei")
					.append(
							'<table class="table table-bordered table-condensed" id="xieban'+i+'">'
									+ '<thead>'
									+ '<tr>'
									+ '<th style="text-align:left;"><div style="width:300px">任务单:'
									+ namestr[i]
									+ '</div><div hidden="hidden">'
									+ array[i]
									+ '</div></th>'
									+ '<th colspan="2" >'
									+ '<div class="yihang2"><div>&nbsp;任务单金额分配:&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" onchange="edit_renwudanMoneyChange()" class="renwudanMoney'
									+ i
									+ ' form-control" style="width:150px;" placeholder="任务单金额" value="" id=renwudanMoney></input></div>'
									+ '<div><button type="button" class="btn btn-primary"  onclick="addBumen()">添加协办部门</button></div></div></th>'
									+ '</tr>'
									+ '</thead>'
									+ '<tbody>'
									+ '<tr>'
									+ '<td style="width:13%;">主办部门</td>'
									+ '<td style="width:32%;">'
									+ '<form class="form-inline">'
									+ '<select class="zhuban'+i+' form-control" style="width:150px;" name="zhuban" id="zhuban">'
									+ '</select>'
									+ '<input type="text" class="zhubanjine'+i+' form-control" style="width:150px;" value="" placeholder="金额" id="zhubanjine">'
									+ '</form>'
									+ '</td>'
									+ "<td>"
									+ '<div class="yihang" ><div style="width:80px;">分摊比例:</div>'
									+ '<input type="text" id="zhubanFentan" class="zhubanFentan'+i+' form-control" style="width:150px;" value="" placeholder="比例"></div>'
									+ '</td>'
									+ '</tr>'
									+ '</tbody>'
									+ '</table>');
			initbumenByClass(i);
			if (tasks[i] != null && tasks[i] != undefined) {
				$(".zhuban" + i + "").val(tasks[i].mainDepartment);
			}
			if (tasks[i] != null && tasks[i] != undefined) {
				$(".zhubanFentan" + i + "").val(tasks[i].mainDepartmentCost);
			}
			if (tasks[i] != null && tasks[i] != undefined) {
				$(".zhubanjine" + i + "").val(tasks[i].mainDepartmentMoney);
			}
			if (tasks[i] != null && tasks[i] != undefined) {
				$(".renwudanMoney" + i + "").val(tasks[i].prjEstimateMoney);
			}
			if (tasks[i] != null && tasks[i] != undefined) {
				addBumenEdit(i, tasks[i]);
			}
		}
	}

	function edit_renwudanMoneyChange() {
		var len = $("#edit_renwudanFenpei>table").length;
		for (var i = 0; i < len; i++) {
			var trLength = $("#xieban" + i + ">tbody>tr").length
			if (trLength == 1) {
				$(".zhubanjine" + i + "").val(
						$(".renwudanMoney" + i + "").val())
			}
		}
	}

	function lookpinjieRenwudanChaifen(namelist, array, tasks) {
		var namestr = namelist;
		pageNameList = namelist;
		pageTaskNoArray = array;
		$("#look_renwudanFenpei").empty();
		if (namelist.length != array.length) {
			toastr.error("任务单编号信息有误");
			return false;
		}
		for ( var i in namestr) {
			$("#look_renwudanFenpei")
					.append(
							'<table class="table table-bordered table-condensed" id="lookxieban'+i+'">'
									+ '<thead>'
									+ '<tr>'
									+ '<th style="text-align:left;"><div style="width:300px">任务单:'
									+ namestr[i]
									+ '</div><div hidden="hidden">'
									+ array[i]
									+ '</div></th>'
									+ '<th colspan="2" >'
									+ '<div class="yihang"><div class="yihang">&nbsp;任务单金额分配:&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" disabled class="renwudanMoney'+i+' form-control" style="width:150px;" placeholder="任务单金额" value="" id=renwudanMoney></input></div>'
									+ '<div></div></th>'
									+ '</tr>'
									+ '</thead>'
									+ '<tbody>'
									+ '<tr>'
									+ '<td style="width:13%;">主办部门</td>'
									+ '<td style="width:32%;">'
									+ '<form class="form-inline">'
									+ '<select class="zhuban'+i+' form-control" disabled style="width:150px;" name="zhuban" id="zhuban">'
									+ '</select>'
									+ '<input type="text" class="zhubanjine'+i+' form-control" disabled style="width:150px;" value="" placeholder="金额" id="zhubanjine">'
									+ '</form>'
									+ '</td>'
									+ "<td>"
									+ '<div class="yihang" ><div style="width:80px;">分摊比例:</div>'
									+ '<input type="text" id="zhubanFentan" disabled class="zhubanFentan'+i+' form-control" style="width:150px;" value="" placeholder="比例"></div>'
									+ '</td>'
									+ '</tr>'
									+ '</tbody>'
									+ '</table>');
			initbumenByClass(i);
			if (tasks[i] != null && tasks[i] != undefined) {
				$(".zhuban" + i + "").val(tasks[i].mainDepartment);
			}
			if (tasks[i] != null && tasks[i] != undefined) {
				$(".zhubanFentan" + i + "").val(tasks[i].mainDepartmentCost);
			}
			if (tasks[i] != null && tasks[i] != undefined) {
				$(".zhubanjine" + i + "").val(tasks[i].mainDepartmentMoney);
			}
			if (tasks[i] != null && tasks[i] != undefined) {
				$(".renwudanMoney" + i + "").val(tasks[i].prjEstimateMoney);
			}
			if (tasks[i] != null && tasks[i] != undefined) {
				addBumenLookNew(i, tasks[i]);
			}
		}
	}
	var page_money;
	function getChaifenXinXiArray(idName) {
		var array = new Array();

		for ( var i in pageTaskNoArray) {
			var chaiFenXinXi = {
				prjNo : undefined,
				mainDepartment : undefined,
				mainDepartmentMoney : undefined,
				mainDepartmentCost : undefined,
				assistDepartment1 : undefined,
				assistDepartment1Money : undefined,
				assistDepartment1Cost : undefined,
				assistDepartment2 : undefined,
				assistDepartment2Money : undefined,
				assistDepartment2Cost : undefined,
				assistDepartment3 : undefined,
				assistDepartment3Money : undefined,
				assistDepartment3Cost : undefined,
			}
			chaiFenXinXi.prjNo = $("#xieban" + i + " thead").find("th").eq(0)
					.find("div").eq(1).text();
			$("#xieban" + i + " tbody").find("tr").each(
					function(index, element) {
						if (index == 0) {
							chaiFenXinXi.mainDepartment = $(this)
									.find("select").eq(0).val();

							chaiFenXinXi.mainDepartmentMoney = parseFloat($(
									this).find("input").eq(0).val());
							chaiFenXinXi.mainDepartmentCost = $(this).find(
									"input").eq(1).val();
						} else if (index == 1) {
							chaiFenXinXi.assistDepartment1 = $(this).find(
									"select").eq(0).val();
							chaiFenXinXi.assistDepartment1Money = parseFloat($(
									this).find("input").eq(0).val());
							chaiFenXinXi.assistDepartment1Cost = $(this).find(
									"input").eq(1).val();
						} else if (index == 2) {
							chaiFenXinXi.assistDepartment2 = $(this).find(
									"select").eq(0).val();
							chaiFenXinXi.assistDepartment2Money = parseFloat($(
									this).find("input").eq(0).val());
							chaiFenXinXi.assistDepartment2Cost = $(this).find(
									"input").eq(1).val();
						} else if (index == 3) {
							chaiFenXinXi.assistDepartment3 = $(this).find(
									"select").eq(0).val();
							chaiFenXinXi.assistDepartment3Money = parseFloat($(
									this).find("input").eq(0).val());
							chaiFenXinXi.assistDepartment3Cost = $(this).find(
									"input").eq(1).val();
						}
						page_money += $(this).find("input").eq(0).val();
					})
			var renwuMoney = $("#xieban" + i + " thead").find("input").eq(0)
					.val();
			var frenwuMoney = parseFloat(renwuMoney);
			chaiFenXinXi.prjEstimateMoney = frenwuMoney;
			chaiFenXinXi.contractMoney = parseFloat($("#" + idName + "").val());
			array.push(chaiFenXinXi);
		}
		return array;
	}
	function judgeInputMoney(idName) {
		var allRenwuMoney;
		for ( var i in pageTaskNoArray) {
			var money = undefined;
			$("#xieban" + i + " tbody").find("tr").each(
					function(index, element) {
						if (i != undefined && i != null) {
							var mainDepartmentMoney = $(this).find("input").eq(
									0).val();
							var mainMoney = parseFloat(mainDepartmentMoney);
							if (money == undefined) {
								money = mainMoney;
							} else {
								money = money + mainMoney;
							}
						}
					})
			var renwuMoney = $("#xieban" + i + " thead").find("input").eq(0)
					.val();
			var frenwuMoney = parseFloat(renwuMoney);
			if (allRenwuMoney == undefined) {
				allRenwuMoney = frenwuMoney;
			} else {
				allRenwuMoney += frenwuMoney;
			}
			if (money != frenwuMoney) {
				return false;
			}
		}
		var hetongMoney = $("#" + idName + "").val();
		var fhetongMoney = parseFloat(hetongMoney);
		if (allRenwuMoney != hetongMoney) {
			return false;
		}
		return true;
	}
	function judgeFentanbili() {
		var a = undefined
		for ( var i in pageTaskNoArray) {
			$("#xieban" + i + " tbody").find("tr").each(
					function(index, element) {
						var bili = $(this).find("input").eq(1).val();
						if (bili == "" || bili == undefined || bili == null) {
							a = 1;
						}
					})
		}
		return a;
	}

	function changeRWD(obj) {
		var money = $(obj).val();
		var length = $("#renwudanFenpei").find("table").length;
		if (length == 1) {
			$("#xieban0 thead").find("input").eq(0).val(money);
			var trlength = $("#xieban0 tbody").find("tr").length;
			if (trlength == 1) {
				$("#zhubanjine").val(money)
			}
		}
	}
	function edit_changeRWD(obj) {
		var money = $(obj).val();
		var length = $("#edit_renwudanFenpei").find("table").length;
		if (length == 1) {
			$("#xieban0 thead").find("input").eq(0).val(money);
			var trlength = $("#xieban0 tbody").find("tr").length;
			if (trlength == 1) {
				$("#zhubanjine").val(money)
			}
		}
	}

	//超级链接
	function GetQueryString(name) {
		var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
		var r = window.location.search.substr(1).match(reg);
		if (r != null)
			return unescape(r[2]);
		return null;
	}
	// 调用方法
	ids = GetQueryString("cjId");//传入自定义参数
	//console.log(ids)
	if (ids != null) {
		$("#diyi").removeClass("active");
		$("#disi").addClass("active");
		$("#diyi a").show();
		$("#disi a").show();
		$("#home").removeClass("active");
		$("#settings").addClass("active");

		$
				.ajax({
					type : 'POST',
					url : getContextPath() + '/cj/selectCjContractById',
					dataType : 'json',
					data : {
						id : ids
					},
					success : function(json) {
						var data = json;
						//console.log(data)
						$("#look_contract_name").text(data.contractName);
						$("#look_contract_no").text(data.contractNo);
						$("#look_work_no").text(data.taskCode);
						$("#look_prj_name").text(data.prjName);
						var prjNameArray = data.prjName.split(",");
						var taskCodeArray = data.taskCode.split(",");
						var tasks = getTaskBytaskCode(data.taskCode);
						lookpinjieRenwudanChaifen(prjNameArray, taskCodeArray,
								tasks);
						$("#look_prj_type").text(data.prjType);
						$("#look_prj_jyms").text(data.jyms);
						$("#look_jiafangName").text(data.ccName);
						$("#look_yifangName").text(data.contractNameYi);
						$("#look_year").text(data.contractStartTime);
						$("#look_year2").text(data.contractEndTime);
						$("#look_yifang_department").text(data.omName);
						$("#look_work_date").text(data.contractLongTime);
						$("#look_receieve_money_condition").text(
								data.receieveMoneyCondition);
						$("#look_contract_money").text(data.contractMoney);
						$("#look_temporary_money").text(data.temporaryMoney);
						$("#look_year3").text(data.contractSignTime);
						$("#look_work_info").text(data.workInfo);
						var cs = data.cjSplitMoney;
						if (cs != null) {
							$("#look_split_table tbody").empty();
							for (var i = 0; i < cs.length; i++) {
								$("#look_split_table tbody").append(
										"<tr><td>" + "" + cs[i].year + ""
												+ "</td><td>" + ""
												+ cs[i].money + ""
												+ "</td></tr>")
							}
						}

						$
								.ajax({
									type : 'POST',
									url : getContextPath()
											+ '/announcement/selectAccessoryById',
									dataType : 'json',
									data : {
										id : ids
									},
									success : function(json) {
										//console.log(json)
										$("#look_accessory tbody").html('');
										$("#look_accessory2 tbody").html('');
										for (var i = 0; i < json.length; i++) {
											if (json[i].aType == "承接合同文本") {
												$("#look_accessory tbody")
														.append(
																"<tr>"
																		+ "<td>附件</td>"
																		+ "<td colspan='2'><a href='"
																		+ getLocalPath()
																		+ "/oa_file/"
																		+ json[i].acUrl
																		+ "' target='view_window' style='color:blue;'>"
																		+ json[i].acName
																		+ "</a></td>"
																		+
																		/* "<td ><input type='text' class='form-control' style='width:70%;' value='"+json[i].acName+"' disabled></td>"+
																		"<td style='width:150px;'><button type='button' class='btn btn-primary' data='"+json[i].acUrl+"' data2='"+json[i].acName+"' onclick='downloadFile(this)'>下载附件</button></td>"+ */
																		"</tr>");
											}
											if (json[i].aType == "法律顾问签字") {
												$("#look_accessory2 tbody")
														.append(
																"<tr>"
																		+ "<td>附件</td>"
																		+ "<td colspan='2'><a href='"
																		+ getLocalPath()
																		+ "/oa_file/"
																		+ json[i].acUrl
																		+ "' target='view_window' style='color:blue;'>"
																		+ json[i].acName
																		+ "</a></td>"
																		+
																		/* "<td ><input type='text' class='form-control' style='width:70%;' value='"+json[i].acName+"' disabled></td>"+
																		"<td style='width:150px;'><button type='button' class='btn btn-primary' data='"+json[i].acUrl+"' data2='"+json[i].acName+"' onclick='downloadFile(this)'>下载附件</button></td>"+ */
																		"</tr>");
											}

										}
									}
								});

					}
				});

		$.ajax({
			type : 'POST',
			url : getContextPath() + '/cj/selectCjHistory',
			dataType : 'json',
			data : {
				no : data.contractNo
			},
			success : function(json) {
				$('#history_table').dataTable().fnClearTable();
				$('#history_table').DataTable().rows.add(json).draw(false);
			}
		});

	}

	function getLocalPath() {
		var pathArray = window.location.pathname.split('/');
		var secondLevelLocation = pathArray[1];
		var loginUrl = window.location.protocol + "//" + window.location.host;
		return loginUrl;
	}

	function day() {
		// 获取当前页的html代码

		var yshtml = window.document.body.innerHTML;
		var bdhtml = window.document.body.innerHTML;
		//设置打印开始区域
		var startStr = '<!--startprint-->';
		// 设置打印结束区域
		var endStr = '<!--endprint-->';
		//从标记里获取需要打印的页面
		var printHtml = bdhtml.substring(bdhtml.indexOf(startStr)
				+ startStr.length, bdhtml.indexOf(endStr));
		//隐藏不必要的按钮和样式

		// 通过id获取需要打印的页面

		window.document.body.innerHTML = printHtml;
		if (!!window.ActiveXObject || "ActiveXObject" in window) { //是否ie
			remove_ie_header_and_footer();
		}
		remove_ie_header_and_footer();
		window.print();
		// 还原界面
		window.document.body.innerHTML = yshtml;
		//window.location.reload();
	}

	//去掉页眉、页脚
	function remove_ie_header_and_footer() {
		var hkey_path;
		hkey_path = "HKEY_CURRENT_USER\\Software\\Microsoft\\Internet Explorer\\PageSetup\\";
		try {
			var RegWsh = new ActiveXObject("WScript.Shell");
			RegWsh.RegWrite(hkey_path + "header", "");
			RegWsh.RegWrite(hkey_path + "footer", "");
		} catch (e) {
		}

	}

	function initFenGs() {
		$.ajax({
			type : 'POST',
			url : getContextPath() + '/job/selectAllJobLv',
			dataType : 'json',
			data : {},
			success : function(json) {
				$("#yifangName").html("");
				$("#edit_yifangName").html("");
				for (var i = 0; i < json.length; i++) {
					$("#yifangName").append(
							"<option value='"+json[i].jobLvName+"'>"
									+ json[i].jobLvName + "</option>")
					$("#edit_yifangName").append(
							"<option value='"+json[i].jobLvName+"'>"
									+ json[i].jobLvName + "</option>")
				}
			}
		});
	}

	//扫描合同件
	var smht_cjcId;
	function addsaomiaohetongjian(obj) {
		tr_smht = $(obj).parents("tr");
		var datasaomiao = $("#mainContent").DataTable().row(tr_smht).data();
		//console.log(data_bl)
		smht_id = datasaomiao.cjId;
		$("#addSaoMiaohtModel").modal("show");

	}

	function savesaomiaohetongjian() {
		var saomiaoUrl = $("#saomiaofileUrl").val();
		if (saomiaoUrl == '') {
			toastr.error("请选择上传文件");
			return;
		}
		var formData = new FormData();
		formData.append("id", smht_id);
		formData.append("file", $("#saomiaofileUrl")[0].files[0]);
		$.ajax({
			type : 'POST',
			url : getContextPath() + '/cj/addSaoMiaoHeTong',
			data : formData,
			cache : false,
			processData : false,
			contentType : false,
			async : false,
			success : function(json) {
				var result = json.result;
				if (result > 0) {
					toastr.success('保存成功');
					//$('#mainContent').DataTable().row.add(OtherFile).draw(false);
					$("#addSaoMiaohtModel").modal("hide");
					$("#saomiaofileUrl").val("");
				} else if (result == -2) {
					toastr.error('请先刷新页面后登陆');
				} else {
					toastr.error('保存失败');
				}
			}
		});
	}
	$("#searchData").on("input", function(e) {
		var d = $("#searchData").val();
		$("#mainContent").DataTable().search(d).draw(true);
	});

	function initType() {
		$.ajax({
			type : 'POST',
			url : getContextPath() + '/projectType/selectAllSecond',
			dataType : 'json',
			data : {},
			success : function(json) {
				$("#search_erjileixing").html("");
				$("#search_erjileixing")
						.append("<option value='%'>全部</option>")
				for (var i = 0; i < json.length; i++) {
					if (json[i] != null) {
						$("#search_erjileixing").append(
								"<option value='"+json[i].nameSecond+"'>"
										+ json[i].nameSecond + "</option>")
					}
				}
			}
		});
	}
</script>
</html>