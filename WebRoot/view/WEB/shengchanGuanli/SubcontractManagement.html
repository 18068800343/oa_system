<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="../../font2/iconfont.css">
    <link rel="stylesheet" href="../../font3/iconfont.css">
	<link href="../../style/bootstrap.min.css" rel="stylesheet">
    <link href="../../style/style.css" rel="stylesheet">
    <link href="../../toastr/toastr.css" rel="stylesheet">
    <link rel="stylesheet" href="../../style/jquery.dataTables.min.css">
    <link rel="stylesheet" href="../../style/jquery-editable-select.css">
    <style lang="">
        
        .UpperPart{
            display: flex;
            justify-content:space-between;
            border-bottom: 1px solid #ccc;
            padding-bottom: 12px;
        }
        .UpperPartL{
            font-size: 16px;
        }
        .selected{
            background: rgba(247, 161, 3,0.2);
        }
        #mainContent th{
            cursor: pointer;
            font-size: 14px;
        }
        @media screen and (max-width: 1920px) {
		    #myModal4{
		        margin-bottom:120px !important;
		    }
		}
    </style>
</head>
<body>
    
    <!-- 面包屑 -->
    <div class="mianbao">
    	<ul class="breadcrumb">
    		<li><i class="iconfont icon-knowledgebase"></i></li>
			<li>生产管理</li>
			<li>合同管理</li>
			<li class="active">分包合同管理</li>
		</ul>
    </div>

    <div class="zhuti-content">
        <div class="UpperPart">
            <div class="UpperPartL" style="font-size:18px;">
                <form class="form-inline">
                    <label>状态筛选:</label>
                    <select class="zhuangtai">
                        <option>正常进行</option>
                        <option>合同终止</option>
                        <option>合同履约完结</option>
                    </select>
                </form>
            </div>
            <div class="UpperPartR">
                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">填报分包单</button>
                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal4">分包合同变更</button>
            </div>
<!-- Modal -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="myModal">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>填报分包单</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form id="new_form" class="form-inline" method="post" enctype="multipart/form-data">
                        <table class="table table-bordered" id="new_table">
                            <tr>
                                <td>分包合同名称:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                	<input type="text" class="form-control" id="hetongName">
                                    <!--<div class="form-group">
                                        <select class="form-control" style="width:180px;" id="hetongName">
                                             <option>合同1</option>
                                            <option>合同2</option>
                                            <option>合同3</option>
                                            <option>合同4</option>
                                            <option>合同5</option> 
                                        </select>
                                    </div>-->
                                </td>
                                <td>类型:</td>
                                <td>
                                    <div class="form-group">
                                        <select class="form-control" style="width:180px;" id="type">
                                            <option>自购材料</option>
                                            <option>代购材料</option>
                                            <option>劳务</option>
                                            <option>机械租赁</option>
                                        </select>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>合同甲方名称:</td>
                                <td>
                                    <select class="form-control" style="width:180px;" id="jiafang">
                                        <option>江苏华通工程检测有限公司</option>
                                        <option>江苏华汇工程检测有限公司</option>
                                    </select>
                                </td>
                                <td>乙方:</td>
                                <td>
                                    <select class="form-control" style="width:180px;" id="yifang">
                                        
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>项目名称:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                    <select class="form-control" style="width:180px;" id="prjName">
                                            
                                        </select>
                                </td>
                                <td>任务单号:</td>
                                <td><input type="text" class="form-control" id="task_no" disabled></td>
                            </tr>
                            <tr>
                                <td>承接合同名称:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td> 
                                    <div class="form-group">
                                        <select class="form-control" style="width:180px;" id="chengjiehetongName">
                                        
                                        </select>
                                    </div>
                                </td>
                                <td>承接合同号:</td>
                                <td><input type="text" class="form-control" id="chengjiehetonghao" disabled></td>
                            </tr>
                            <tr>
                                <td>主合同金额:</td>
                                <td><input type="text" class="form-control" id="zhuhetongMoney"></td>
                                <td>已累计分包金额:</td>
                                <td><input type="text" class="form-control" id="leijifenbaoMoney"></td>
                            </tr>
                            <tr>
                                <td>合同起日期:</td>
                                <td><input type="text" class="form-control" id="year"></td>
                                <td>合同讫日期:</td>
                                <td><input type="text" class="form-control" id="year2"></td>
                            </tr>
                            <tr>
                                <td>甲方管理部门:</td>
                                <td>
                                    <select class="form-control" id="jiafangbumen" style="width:180px;">
                                        
                                    </select>
                                </td>
                                <td>合同工期:</td>
                                <td><input type="text" class="form-control" id="hetonggongqi"></td>
                            </tr>
                            <tr>
                                <td>付款方式:</td>
                                <td>
                                	<input type="text" class="form-control" id="fukuanfangshi">
                                    <!-- <select class="form-control" id="fukuanfangshi" style="width:180px;">
                                        <option>1</option>
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5</option>
                                    </select> -->
                                </td>
                                <td>合同金额:</td>
                                <td><input type="text" class="form-control" id="hetongMoney"></td>
                            </tr>
                            <tr>
                                <td>暂定金:</td>
                                <td><input type="text" class="form-control" id="zandingMoney"></td>
                                <td>已收履约保证金</td>
                                <td><input type="text" class="form-control" id="baozhengMoney"></td>
                            </tr>
                            <tr>
                                <td>主要概况及工作内容:</td>
                                <td colspan="3">
                                    <div class="form-group">
                                        <textarea class="form-control" id="gaikuang" rows="3"></textarea>
                                    </div> 
                                </td>
                            </tr>
                            <tr>
                                <td>合同文本:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td colspan="3">
                                	<!-- <input type="file" name="file" class="form-control"> -->
                                	<button type="button" class="btn btn-primary weui-uploader__input" id="uploaderBox">添加附件</button>
                                </td>
                                
                            </tr>
                        </table> 
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-default" onclick="saveSubContract()">保存</button>
            <button type="button" class="btn btn-success" onclick="submitSubContract()" data-dismiss="modal" data-toggle="modal" data-target="#tijiaogei">提交</button>
        </div>
        </div>
    </div>
</div>
<!-- model结束 -->
<!-- 提交 modal -->
<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="tijiaogei">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="gridSystemModalLabel">提交给</h4>
            </div>
            <div class="modal-body">
                <form class="form-inline">
                    <div class="form-group">
                        <div>
                            <span>提交给:</span>
                            <select style="width:180px;" class="form-control" id="editable-selectT">
                                <option value="">123123</option>
                                <option value="">456456</option>
                            </select>
                        </div>
                        <div style="display:flex;margin-top:5px;">
                            <div style="margin-top:5px;">
                                <textarea cols="70" rows="5" class="form-control" placeholder="请输入内容"></textarea>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-success" data-dismiss="modal">提交</button>
            </div>
        </div>
    </div>
</div>
<!-- 提交 modal结束 -->
<!-- 修改Modal -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="change">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>修改分包单</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form id="edit_form" class="form-inline" method="post" enctype="multipart/form-data">
                        <table id="edit_table" class="table table-bordered">
                            <tr>
                                <td>分包合同名称:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                	<input type="text" class="form-control" id="xghetongName">
                                    <!-- <div class="form-group">
                                        <select class="form-control" style="width:180px;" id="xghetongName">
                                            <option>合同1</option>
                                            <option>合同2</option>
                                            <option>合同3</option>
                                            <option>合同4</option>
                                            <option>合同5</option>
                                        </select>
                                    </div> -->
                                </td>
                                <td>类型:</td>
                                <td>
                                    <div class="form-group">
                                        <select class="form-control" style="width:180px;" id="xgType">
                                            <option>自购材料</option>
                                            <option>代购材料</option>
                                            <option>劳务</option>
                                            <option>机械租赁</option>
                                        </select>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>合同甲方名称:</td>
                                <td>
                                    <select class="form-control" style="width:180px;" id="xgjiafang">
                                        <option>江苏华通工程检测有限公司</option>
                                        <option>江苏华汇工程检测有限公司</option>
                                    </select>
                                </td>
                                <td>乙方:</td>
                                <td>
                                    <select class="form-control" style="width:180px;" id="xgyifang">
                                        
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>项目名称:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                    <select class="form-control" style="width:180px;" id="xgprjName">
                                            
                                        </select>
                                </td>
                                <td>任务单号:</td>
                                <td><input type="text" class="form-control" id="xgtask_no" disabled></td>
                            </tr>
                            <tr>
                                <td>承接合同名称:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td> 
                                    <div class="form-group">
                                        <select class="form-control" style="width:180px;" id="xgchengjiehetongName">
                                            
                                        </select>
                                    </div>
                                </td>
                                <td>承接合同号:</td>
                                <td><input type="text" class="form-control" id="xgchengjiehetonghao" disabled></td>
                            </tr>
                            <tr>
                                <td>主合同金额:</td>
                                <td><input type="text" class="form-control" id="xgzhuhetongMoney"></td>
                                <td>已累计分包金额:</td>
                                <td><input type="text" class="form-control" id="xgleijifenbaoMoney"></td>
                            </tr>
                            <tr>
                                <td>合同起日期:</td>
                                <td><input type="text" class="form-control" id="xgyear"></td>
                                <td>合同讫日期:</td>
                                <td><input type="text" class="form-control" id="xgyear2"></td>
                            </tr>
                            <tr>
                                <td>甲方管理部门:</td>
                                <td>
                                    <select class="form-control" id="xgjiafangbumen" style="width:180px;">
                                        
                                    </select>
                                </td>
                                <td>合同工期:</td>
                                <td><input type="text" class="form-control" id="xghetonggongqi"></td>
                            </tr>
                            <tr>
                                <td>付款方式:</td>
                                <td>
                                	<input type="text" class="form-control" id="xgfukuanfangshi">
                                    <!-- <select class="form-control" id="xgfukuanfangshi" style="width:180px;">
                                        <option>1</option>
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5</option>
                                    </select> -->
                                </td>
                                <td>合同金额:</td>
                                <td><input type="text" class="form-control" id="xghetongMoney"></td>
                            </tr>
                            <tr>
                                <td>暂定金:</td>
                                <td><input type="text" class="form-control" id="xgzandingMoney"></td>
                                <td>已收履约保证金</td>
                                <td><input type="text" class="form-control" id="xglvyuebaozhengMoney"></td>
                            </tr>
                            <tr>
                                <td>主要概况及工作内容:</td>
                                <td colspan="3">
                                    <div class="form-group">
                                        <textarea class="form-control" rows="3" id="xggaikuang"></textarea>
                                    </div> 
                                </td>
                            </tr>
                            <tr>
                                <td>合同文本:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td colspan="3">
                                	<!-- <input type="file" name="file" class="form-control"> -->
                                	<button type="button" class="btn btn-primary weui-uploader__input" id="uploaderBox2">添加附件</button>
                                </td>
                            </tr>
                        </table> 
                        <table class="table table-bordered table-condensed"  id="edit_huixian_table">
                        
                        </table>
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-default" onclick="checksave()">保存</button>
            <button type="button" class="btn btn-success" onclick="checksubmit()">提交</button>
        </div>
        </div>
    </div>
</div>
<!-- 修改model结束 -->
<!-- Modal2 -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="myModal2">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>分包合同取消申请表</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline">
                        <table class="table table-bordered table-condensed">
                            <tr>
                                <td>分包合同取消原因</td>
                                <td colspan="3"><textarea name="" id="" cols="50" rows="5"></textarea></td>
                            </tr>
                        </table>
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-default">保存</button>
            <button type="button" class="btn btn-success">提交</button>
        </div>
        </div>
    </div>
</div>
<!-- model2结束 -->
<!-- Modal3 -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="myModal3">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>分包合同启用申请表</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form class="form-inline">
                        <table class="table table-bordered table-condensed">
                            <tr>
                                <td>合同重新启用原因</td>
                                <td colspan="3"><textarea name="" id="" cols="50" rows="5"></textarea></td>
                            </tr>
                        </table>
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-default">保存</button>
            <button type="button" class="btn btn-success">提交</button>
        </div>
        </div>
    </div>
</div>
<!-- model3结束 -->
<!-- Modal4 -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="myModal4">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>分包合同变更审签单</b></h4>
        </div>
        <div class="modal-body">
                <div>     
                    <form id="change_form" class="form-inline" method="post" enctype="multipart/form-data">
                        <table class="table table-bordered">
                            <tr>
                                <td>分包合同名称:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                	<input type="text" id="changehetongName" class="form-control" disabled>
                                    <!-- <div class="form-group">
                                        <select class="form-control" style="width:180px;"  id="changehetongName">
                                            <option>1</option>
                                            <option>2</option>
                                            <option>3</option>
                                            <option>4</option>
                                            <option>5</option>
                                        </select>
                                    </div> -->
                                </td>
                                <td>类型:</td>
                                <td>
                                    <select class="form-control" style="width:180px;" id="changeType">
                                        <option>自购材料</option>
                                        <option>代购材料</option>
                                        <option>劳务</option>
                                        <option>机械租赁</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>项目名称:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                    <select class="form-control" style="width:180px;" id="changeprjName">
                                        <!-- <option>1</option>
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5</option> -->
                                    </select>
                                </td>
                                <td style="width:100px;">任务单号:</td>
                                <td><input type="text" id="changetask_no" class="form-control" disabled></td>
                            </tr>
                            <tr>
                                <td>合同甲方名称:</td>
                                <td>
                                    <select class="form-control" id="changejiafang" style="width:180px;">
                                        <option>江苏华通工程检测有限公司</option>
                                        <option>江苏华汇工程检测有限公司</option>
                                    </select>
                                </td>
                                <td>合同乙方名称:</td>
                                <td>
                                    <select class="form-control" id="changeyifang" style="width:180px;">
                                    
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>承接合同名称  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td>
                                    <select class="form-control" style="width:180px;" id="changechengjiehetongName">
                                        
                                    </select>
                                </td>
                                <td>承接合同号</td>
                                <td><input type="text" class="form-control" id="changechengjiehetonghao" disabled></td>
                            </tr>
                            <tr>
                                <td>主合同金额</td>
                                <td><input type="text" id="changezhuhetongMoney" class="form-control"></td>
                                <td>已累计分包金额</td>
                                <td><input type="text" id="changeleijifenbaoMoney" class="form-control"  disabled></td>
                            </tr>
                            <tr>
                                <td>合同起日期:</td>
                                <td>
                                    <div class="form-group">
                                        <input class="form-control" id="changeyear" />
                                    </div>
                                </td>
                                <td>合同讫日期:</td>
                                <td> 
                                    <div class="form-group">
                                        <input class="form-control" id="changeyear2" />
                                        
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>甲方管理部门:</td>
                                <td>
                                    <select class="form-control" id="changejiafangbumen" style="width:180px;">
                                    
                                    </select>
                                </td>
                                <td>合同工期:</td>
                                <td>
                                    <input class="form-control" id="changehetonggongqi">
                                </td>
                            </tr>
                            <tr>
                                <td>付款方式:</td>
                                <td>
                                    <input class="form-control" id="changefukuanfangshi">
                                </td>
                                <td>原合同金额:</td>
                                <td><input class="form-control" id="changehetongMoney"></td>
                            </tr>
                            <tr>
                                <td>变更后合同金额:</td>
                                <td><input class="form-control" id="changehetongMoney2"></td>
                                <td>原暂定金:</td>
                                <td><input class="form-control" id="changezandingMoney"></td>
                            </tr>
                            <tr>
                                <td>变更后暂定金</td>
                                <td><input class="form-control" id="changezandingMoney2"></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>主要概况及工作内容:</td>
                                <td colspan="3">
                                    <div class="form-group">
                                        <textarea class="form-control" id="changegaikuang" rows="4" cols="50"></textarea>
                                    </div> 
                                </td>
                            </tr>
                             <tr>
                                <td>原合同文本:</td>
                                <td><input type="file" name="file" class="form-control"></td>
                                <td></td>
                                <td></td>
                            </tr> 
                            <!-- <table class="table table-bordered table-condensed"  id="change_huixian_table">
                        		<thead>
                        			<tr>
	                                	<th colspan="4">原合同文本:</th>
	                                	<td><input type="file" name="file" class="form-control"></td>
	                                	<td></td>
	                                	<td></td>
                            		</tr>
                        		</thead>
                        		<tbody>
                        			<tr>
	                                	<td></td>
	                                	<td><input type="file" name="file" class="form-control"></td>
	                                	<td></td>
	                                	<td></td>
                            		</tr>
                        		</tbody>
                       		 </table> -->
                            <tr>
                                <td>变更附件:  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
                                <td><input type="file" name="file" class="form-control"></td>
                                <td></td>
                                <td></td>
                            </tr>
                            
                        </table>
                    </form>  
                </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-default">保存</button>
            <button type="button" class="btn btn-success">提交</button>
        </div>
        </div>
    </div>
</div>
<!-- model4结束 -->

        </div>
        <div class="LowerPart" style="margin-top:3px;">
            <table class="table table-bordered table-condensed" id="mainContent">
                <thead>
                    <tr>
                        <th>分包合同编号</th>
                        <th>分包合同名称</th>
                        <th>甲方</th>
                        <th>乙方</th>
                        <th>项目名称</th>
                        <th>承接合同名称</th>
                        <th>主合同金额</th>
                        <th>分包合同金额</th>
                        <!--<th>暂定金</th>
                        <th>甲方管理部门</th>
                         <th>合同结算额</th>
                        <th>累计付款</th>
                        <th>累计未付款金额</th> -->
                        <th style="width:100px;">操作</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- <tr>
                        <td>3</td>
                        <td>二河大桥维修</td>
                        <td>华通</td>
                        <td>小小公司</td>
                        <td>大马桥建造</td>
                        <td>大马桥建造</td>
                        <td>100</td>
                        <td>10</td>
                        <td>10</td>
                        <td>工程一部</td>
                        <td>10</td>
                        <td>10</td>
                        <td>10</td>
                        <td>
                            <i class="iconfont icon-icon-test" style="font-size:20px;cursor:pointer;" title="查看详细信息"  data-toggle="modal" data-target="#allMsg1"></i>
                            <i class="iconfont icon-xiugai" style="font-size:18px;cursor:pointer;" title="修改" data-toggle='modal' data-target='#change'></i>
                            <i class="iconfont icon-shanchu" style="font-size:18px;cursor:pointer;" title="删除"></i>
                            <i class="iconfont icon-xiazai" style="font-size:20px;cursor:pointer;" title="下载附件"></i>
                            <i class="iconfont icon-quxiao quxiao" style="font-size:18px;cursor:pointer;" title="取消" data-toggle='modal' data-target='#myModal2'></i>
                            <i class="iconfont icon-arrow chongqi" style="font-size:18px;cursor:pointer;display:none;" title="重启" data-toggle="modal" data-target="#myModal3"></i>
                        </td>
                    </tr> -->
                </tbody>   
            </table>
        </div>
    </div>
<!-- allMsg -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="allMsg1">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>所有信息</b></h4>
        </div>
        <div class="modal-body">
            <div>     
                <form class="form-inline">
                    <table class="table table-bordered">
                        <tr>
                            <td>分包合同名称:</td>
                            <td id="lookhetongName"></td>
                            <td>类型:</td>
                            <td id="lookType"></td>
                        </tr>
                        <tr>
                            <td>合同甲方名称:</td>
                            <td id="lookjiafang"></td>
                            <td>乙方:</td>
                            <td id="lookyifang"></td>
                        </tr>
                        <tr>
                            <td>项目名称:</td>
                            <td id="lookprjName"></td>
                            <td>任务单号:</td>
                            <td id="looktask_no"></td>
                        </tr>
                        <tr>
                            <td>承接合同名称:</td>
                            <td id="lookchengjiehetongName"></td>
                            <td>承接合同号:</td>
                            <td id="lookchengjiehetonghao"></td>
                        </tr>
                        <tr>
                            <td>主合同金额:</td>
                            <td id="lookzhuhetongMoney"></td>
                            <td>已累计分包金额:</td>
                            <td id="lookleijifenbaoMoney"></td>
                        </tr>
                        <tr>
                            <td>合同起日期:</td>
                            <td id="lookyear"></td>
                            <td>合同讫日期:</td>
                            <td id="lookyear2"></td>
                        </tr>
                        <tr>
                            <td>甲方管理部门:</td>
                            <td id="lookjiafangbumen"></td>
                            <td>合同工期:</td>
                            <td id="lookhetonggongqi"></td>
                        </tr>
                        <tr>
                            <td>付款方式:</td>
                            <td id="lookfukuanfangshi"></td>
                            <td>合同金额:</td>
                            <td id="lookhetongMoney"></td>
                        </tr>
                        <tr>
                            <td>暂定金:</td>
                            <td id="lookzandingMoney"></td>
                            <td>已收履约保证金</td>
                            <td id="looklvyuebaozhengMoney"></td>
                        </tr>
                        <tr>
                            <td>主要概况及工作内容:</td>
                            <td colspan="3" id="lookgaikuang"></td>
                        </tr>
                        <!-- <tr>
                            <td>合同文本:</td>
                            <td colspan="3"></td>
                        </tr> -->
                    </table> 
                    <table class="table table-bordered table-condensed"  id="look_all_table">
				                        		
				    </table>
                </form>  
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        </div>
        </div>
    </div>
</div>
<!-- allMsg结束 -->
</body>
<script src="../../js/jquery.js"></script>
<script src="../../js/common-scripts.js"></script>
<script src="../../js/jquery.dataTables.min.js"></script>
<script src="../../js/bootstrap.min.js"></script>
<script src="../../js/jquery-editable-select.js"></script>
<script src="../../js/laydate/laydate.js"></script>
<script src="../../js/jquery-form.min.js"></script>
<script src="../../toastr/toastr.js"></script>
<script>
    $(document).ready( function () {
    	initTable();
    	initbumen();
    	inityifang();
    	xiangmuSelect();
    	cjhetongNameSelect();
        laydate.render({
            elem: '#year' //指定元素
        });
        laydate.render({
            elem: '#year2' //指定元素
        });
        laydate.render({
            elem: '#xgyear' //指定元素
        });
        laydate.render({
            elem: '#xgyear2' //指定元素
        });
    	/* $('#hetongName').editableSelect({ 
            effects: 'slide' 
        });
        $('#xghetongName').editableSelect({ 
            effects: 'slide' 
        }); */
        $('#editable-selectT').editableSelect({ 
            effects: 'slide' 
        });
	});
    var table=$('#mainContent').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 10,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
            { "data": "fbId"}, 
            { "data": "contractName"},
            { "data": "contractNameJia"}, 
            { "data": "ccName"}, 
            { "data": "prjName"}, 
            { "data": "cjcontractName2"}, 
            { "data": "mainContractMoney"}, 
            { "data": "nowFbAllMoney"}, 
        ],
        "columnDefs": [
						{	
								 "class": "tcenter",
								    "targets": 8,
								    "searchable": true,
								    "render": function(data, type, full) {
								  	  		return '<i class="iconfont icon-icon-test" style="font-size:20px;cursor:pointer;" title="查看详细信息" onclick="lookSubcontract(this)" data-toggle="modal" data-target="#allMsg1"   id="lookDetall"></i><i class="iconfont icon-xiugai iconxiugai" style="font-size:18px;cursor:pointer;" title="修改" onclick="checkSubcontract(this)" data-toggle="modal" data-target="#change"  id="Changedanwei"></i><i class="iconfont icon-arrow chongqi" style="font-size:18px;cursor:pointer;display:none;" title="重启" data-toggle="modal" data-target="#myModal3"></i><i class="iconfont icon-tuichu iconzhongzhi" style="font-size:18px;cursor:pointer;" title="项目中止"  data-toggle="modal" data-target="#myModal4"></i><i class="iconfont icon-yibanshixiang iconlywj" style="font-size:18px;cursor:pointer;" title="项目履约完结"  data-toggle="modal" data-target="#myModal5"></i>'
								        }
								  }
						],
        "order": [[0, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
        
	});
	function initTable(){
        $.ajax({
            type: 'POST',
            url: getContextPath()+'/subcontract/selectSubContract',
            dataType: 'json',
            data: {
            	status:2
            },
            success: function (json) {
            	console.log(json)
                $('#mainContent').dataTable().fnClearTable();
                $('#mainContent').DataTable().rows.add(json).draw(false);
            }
        });
    }
	
	//初始化
    $(".zhuangtai").change(function(){
        var zt=$(".zhuangtai").val();
        if(zt=="正常进行"){
        	$.ajax({
                type: 'POST',
                url: getContextPath()+'/subcontract/selectSubContract',
                dataType: 'json',
                data: {
                	status:2,
                },
                success: function (json) {
                    $('#mainContent').dataTable().fnClearTable();
                    $('#mainContent').DataTable().rows.add(json).draw(false);
                    $(".chongqi").hide();
                    $(".iconxiugai").show();
                    $(".iconzhongzhi").show();
                    $(".iconlywj").show();
                }
            });
            
        }else if(zt=="合同终止"){
        	$.ajax({
                type: 'POST',
                url: getContextPath()+'/subcontract/selectSubContract',
                dataType: 'json',
                data: {
                	status:3,
                },
                success: function (json) {
                    $('#mainContent').dataTable().fnClearTable();
                    $('#mainContent').DataTable().rows.add(json).draw(false);
                    $(".chongqi").show();
                    $(".iconxiugai").hide();
                    $(".iconzhongzhi").hide();
                    $(".iconlywj").hide();
                }
            });
            
        }else if(zt=="合同履约完结"){
        	$.ajax({
                type: 'POST',
                url: getContextPath()+'/subcontract/selectSubContract',
                dataType: 'json',
                data: {
                	status:4,
                },
                success: function (json) {
                    $('#mainContent').dataTable().fnClearTable();
                    $('#mainContent').DataTable().rows.add(json).draw(false);
                    $(".chongqi").hide();
                	$(".iconxiugai").hide();
                	$(".iconzhongzhi").hide();
                    $(".iconlywj").hide();
                }
            });
        	
        }
    })
	
	
	
	
	
	
	
	
	//初始化乙方
    function inityifang(){
	    $.ajax({
	        type: 'POST',
	        url: getContextPath()+'/cooperator/selectCooperatorIdAndName',
	        dataType: 'json',
	        data: {
	        },
	        success: function (json) {
	        	$("#yifang").html('');
	        	$("#xgyifang").html('');
	        	$("#changeyifang").html('');
	        	 for(var i=0;i<json.length;i++){
	        		$("#yifang").append( "<option value='" + json[i].ccId + "'>"
		                    + json[i].ccName + "</option>")
		            $("#xgyifang").append( "<option value='" + json[i].ccId + "'>"
		                    + json[i].ccName + "</option>")
		            $("#changeyifang").append( "<option value='" + json[i].ccId + "'>"
		                    + json[i].ccName + "</option>")
	        	}
	        }
	    });
	}
	
	
  //初始化项目
	function xiangmuSelect(){
	    $.ajax({
	        type: 'POST',
	        url: getContextPath()+'/task/selectTaskByStatus',
	        dataType: 'json',
	        data: {
	        	status:2
	        },
	        success: function (json) {
	        	//console.log(json)
	        	 for(var i=0;i<json.length;i++){
	        		$("#prjName").append( "<option value='" + json[i].prjId + "'>"
		                    + json[i].prjName + "</option>");
	        		$("#xgprjName").append( "<option value='" + json[i].prjId + "'>"
		                    + json[i].prjName + "</option>"); 
                    $("#changeprjName").append( "<option value='" + json[i].prjId + "'>"
		                    + json[i].prjName + "</option>");
	        	} 
	        	$("#prjName").trigger('change')
	        	$("#xgprjName").trigger('change')
	        	$("#changeprjName").trigger('change')
	        }
	    });
	}
	$("#prjName").change(function(){
		var id=$("#prjName").val();
		$.ajax({
			type:"POST",
			url:getContextPath()+"/task/selectTaskById",
			dataType:"json",
			async:false,
			data:{ 
				id:id 
				},
			success:function(json){
				$("#task_no").empty();
				$("#task_no").val(json.prjNo)
				/* for(var i=0;i<json.length;i++){
					$("#task_no").append("<option value='" + json[i].userId + "'>"
		                    + json[i].uName + "</option>")
				} */
			}
		})
	})
	$("#xgprjName").change(function(){
		var id=$("#xgprjName").val();
		$.ajax({
			type:"POST",
			url:getContextPath()+"/task/selectTaskById",
			dataType:"json",
			async:false,
			data:{ 
				id:id 
				},
			success:function(json){
				$("#xgtask_no").empty();
				$("#xgtask_no").val(json.prjNo)
				/* for(var i=0;i<json.length;i++){
					$("#xgtask_no").append("<option value='" + json[i].userId + "'>"
		                    + json[i].uName + "</option>")
				} */
			}
		})
	})
	$("#changeprjName").change(function(){
		var id=$("#changeprjName").val();
		$.ajax({
			type:"POST",
			url:getContextPath()+"/task/selectTaskById",
			dataType:"json",
			async:false,
			data:{ 
				id:id 
				},
			success:function(json){
				$("#changetask_no").empty();
				$("#changetask_no").val(json.prjNo)
				/* for(var i=0;i<json.length;i++){
					$("#xgtask_no").append("<option value='" + json[i].userId + "'>"
		                    + json[i].uName + "</option>")
				} */
			}
		})
	})
	
	
	//初始化承接合同名称
	function cjhetongNameSelect(){
	    $.ajax({
	        type: 'POST',
	        url: getContextPath()+'/cj/selectIdAndName',
	        dataType: 'json',
	        data: {
	        },
	        success: function (json) {
	        	console.log(json)
	        	 for(var i=0;i<json.length;i++){
	        		$("#chengjiehetongName").append( "<option value='" + json[i].cjId + "'>"
		                    + json[i].contractName + "</option>");
	        		$("#xgchengjiehetongName").append( "<option value='" + json[i].cjId + "'>"
		                    + json[i].contractName + "</option>");
	        		$("#changechengjiehetongName").append( "<option value='" + json[i].cjId + "'>"
		                    + json[i].contractName + "</option>");
	        	} 
	        	$("#chengjiehetongName").trigger('change')
	        	$("#xgchengjiehetongName").trigger('change')
	        	$("#changechengjiehetongName").trigger('change')
	        }
	    });
	}
	
	
	
	
  
	//初始化部门
	function initbumen(){
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/organizationManagement/getOrgIdAndName',
            dataType: 'json',
            data: {
            },
            success: function (json) {
            	//console.log(json);
            	for(var i=0;i<json.length;i++){
	            	$("#jiafangbumen").append("<option value='"+json[i].omId+"'>" + json[i].omName+ "</option>");
	            	$("#xgjiafangbumen").append("<option value='"+json[i].omId+"'>" + json[i].omName+ "</option>");
	            	$("#changejiafangbumen").append("<option value='"+json[i].omId+"'>" + json[i].omName+ "</option>");
            	}
            }
        });
	}
	
	
	
	
	
	
	//填报分包单保存
	function saveSubContract(){
		var hetongName=$("#hetongName").val();
		var type=$("#type").val();
		var jiafang=$("#jiafang").val();
		var yifang=$("#yifang").val();
		var prjName=$("#prjName").val();
		var task_no=$("#task_no").val();
		var chengjiehetongName=$("#chengjiehetongName").val();
		var chengjiehetonghao=$("#chengjiehetonghao").val();
		var zhuhetongMoney=$("#zhuhetongMoney").val();
		var leijifenbaoMoney=$("#leijifenbaoMoney").val();
		var year=$("#year").val();
		var year2=$("#year2").val();
		var jiafangbumen=$("#jiafangbumen").val();
		var hetonggongqi=$("#hetonggongqi").val();
		var fukuanfangshi=$("#fukuanfangshi").val();
		var hetongMoney=$("#hetongMoney").val();
		var zandingMoney=$("#zandingMoney").val();
		var baozhengMoney=$("#baozhengMoney").val();
		var gaikuang=$("#gaikuang").val();
		
		if(hetongName==''){
			toastr.error("分包合同名称为空");
			return;
		}
		
		if($("#new_table").find('tr').length<=11 || $("#file").val().length==0){
			toastr.error("合同文本为空")
			return;
		}
		
		var options={
            type: 'POST',
            url: getContextPath()+'/subcontract/saveSubContract',
            dataType: 'json',
            data: { 
            		contractName:hetongName,
            		fbcType:type,
            		contractNameJia:jiafang,
            		contractNameYi:yifang,
            		workNo:task_no,
            		prjId:prjName,
            		cjContractCode:chengjiehetonghao,
            		cjContractName:chengjiehetongName,
            		mainContractMoney:zhuhetongMoney,
            		nowFbAllMoney:leijifenbaoMoney,
            		contractStartTime:year,
            		contractEndTime:year2,
            		mainManageDepartment:jiafangbumen,
            		contractLongTime:hetonggongqi,
            		payMode:fukuanfangshi,
            		contractMoney:hetongMoney,
            		temporaryMoney:zandingMoney,
            		performanceBond:baozhengMoney,
            		workContent:gaikuang,
            },
            success: function (json) {
            	console.log(json);
            	if(json.result==0){
					toastr.error("添加失败")
				}else if(json.result>0){
					//location.reload([true]);
					toastr.success("添加成功")
					$("#myModal").modal("hide")
					initTable();
				}
            }
        };
		$("#new_form").ajaxSubmit(options);
	}
	
	//填报分包单提交
	function submitSubContract(){
		var hetongName=$("#hetongName").val();
		var type=$("#type").val();
		var jiafang=$("#jiafang").val();
		var yifang=$("#yifang").val();
		var prjName=$("#prjName").val();
		var task_no=$("#task_no").val();
		var chengjiehetongName=$("#chengjiehetongName").val();
		var chengjiehetonghao=$("#chengjiehetonghao").val();
		var zhuhetongMoney=$("#zhuhetongMoney").val();
		var leijifenbaoMoney=$("#leijifenbaoMoney").val();
		var year=$("#year").val();
		var year2=$("#year2").val();
		var jiafangbumen=$("#jiafangbumen").val();
		var hetonggongqi=$("#hetonggongqi").val();
		var fukuanfangshi=$("#fukuanfangshi").val();
		var hetongMoney=$("#hetongMoney").val();
		var zandingMoney=$("#zandingMoney").val();
		var baozhengMoney=$("#baozhengMoney").val();
		var gaikuang=$("#gaikuang").val();
		
		if(hetongName==''){
			toastr.error("分包合同名称为空");
			return;
		}
		
		if($("#new_table").find('tr').length<=11 || $("#file").val().length==0){
			toastr.error("合同文本为空")
			return;
		}
		
		var options={
            type: 'POST',
            url: getContextPath()+'/subcontract/submitSubContract',
            dataType: 'json',
            data: { 
            		contractName:hetongName,
            		fbcType:type,
            		contractNameJia:jiafang,
            		contractNameYi:yifang,
            		workNo:task_no,
            		prjId:prjName,
            		cjContractCode:chengjiehetonghao,
            		cjContractName:chengjiehetongName,
            		mainContractMoney:zhuhetongMoney,
            		nowFbAllMoney:leijifenbaoMoney,
            		contractStartTime:year,
            		contractEndTime:year2,
            		mainManageDepartment:jiafangbumen,
            		contractLongTime:hetonggongqi,
            		payMode:fukuanfangshi,
            		contractMoney:hetongMoney,
            		temporaryMoney:zandingMoney,
            		performanceBond:baozhengMoney,
            		workContent:gaikuang,
            },
            success: function (json) {
            	console.log(json);
            	if(json.result==0){
					toastr.error("提交失败")
				}else if(json.result>0){
					//location.reload([true]);
					toastr.success("提交成功")
					$("#myModal").modal("hide")
					initTable();
				}
            }
        };
		$("#new_form").ajaxSubmit(options);
	}
	
	
	//修改回显
	var xiugaiId;
	function checkSubcontract(obj){
		dom=$(obj).parents("tr");
		var data=$('#mainContent').DataTable().row(dom).data();
		console.log(data)
		xiugaiId=data.fbId;
		
		$("#xghetongName").val(data.contractName)
		$("#xgType").val(data.fbcType)
		$("#xgjiafang").val(data.contractNameJia)
		$("#xgyifang").val(data.contractNameYi)
		$("#xgprjName").val(data.prjId)
		$("#xgtask_no").val(data.workNo)
		$("#xgchengjiehetongName").val(data.cjContractName)
		$("#xgchengjiehetonghao").val(data.cjContractCode)
		$("#xgzhuhetongMoney").val(data.mainContractMoney)
		$('#xgleijifenbaoMoney').val(data.nowFbAllMoney)
		$("#xgyear").val(data.contractStartTime)
		$("#xgyear2").val(data.contractEndTime)
		$("#xgjiafangbumen").val(data.mainManageDepartment)
		$("#xghetonggongqi").val(data.contractLongTime)
		$("#xgfukuanfangshi").val(data.payMode)
		$("#xghetongMoney").val(data.contractMoney)
		$("#xgzandingMoney").val(data.temporaryMoney)
		$("#xglvyuebaozhengMoney").val(data.performanceBond)
		$("#xggaikuang").val(data.workContent)
		
		
		$.ajax({
			type:"post",
			url:getContextPath()+"/subcontract/selectAccessoryById",
			dataType:"json",
			async:false,
			data:{
				id:xiugaiId,
			},
			success:function(json){
				console.log(json);
				$("#edit_huixian_table").empty();
	               for(var i=0;i<json.length;i++){
	            	   $("#edit_huixian_table").append("<tr>"+
	            	   														"<td>合同文本"+(i+1)+"</td>"+
													            	    	"<td colspan='2'><input type='text' class='form-control' style='width:100%;' value='"+json[i].acName+"' disabled></td>"+
													            	    	"<td><button type='button' class='btn btn-primary' data1='"+json[i].aId+"' data2='"+json[i].acUrl+"' onclick='deletefile(this)'>删除附件</button></td>"+
													            	    "</tr>");
	               }
			}
		})
	}
	
	//删除附件
	function deletefile(obj){
		var id=$(obj).attr("data1");
		var name=$(obj).parents("tr").find("td").eq(1).find("input").val();
		var url=$(obj).attr("data2");
		
		$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/subcontract/deleteAccessory',
	        dataType: 'json',
	        data: {
	        	aId:id,
	        	acName:name,
	        	acUrl:url
	        },
	        success: function (json) {
	        	if(json==0){
	        		toastr.error("删除失败");
	        	}else{
	        		toastr.success("删除成功");
	        		$('#change').modal('hide');
	        	}
	        }
		});
	}
	
	//保存修改
	function checksave(){
		var xghetongName=$("#xghetongName").val()
		var xgType=$("#xgType").val()
		var xgjiafang=$("#xgjiafang").val()
		var xgyifang=$("#xgyifang").val()
		var xgprjName=$("#xgprjName").val()
		var xgtask_no=$("#xgtask_no").val()
		var xgchengjiehetongName=$("#xgchengjiehetongName").val()
		var xgchengjiehetonghao=$("#xgchengjiehetonghao").val()
		var xgzhuhetongMoney=$("#xgzhuhetongMoney").val()
		var xgleijifenbaoMoney=$('#xgleijifenbaoMoney').val()
		var xgyear=$("#xgyear").val()
		var xgyear2=$("#xgyear2").val()
		var xgjiafangbumen=$("#xgjiafangbumen").val()
		var xghetonggongqi=$("#xghetonggongqi").val()
		var xgfukuanfangshi=$("#xgfukuanfangshi").val()
		var xghetongMoney=$("#xghetongMoney").val()
		var xgzandingMoney=$("#xgzandingMoney").val()
		var xglvyuebaozhengMoney=$("#xglvyuebaozhengMoney").val()
		var xggaikuang=$("#xggaikuang").val()
		
		if(xghetongName==''){
			toastr.error("分包合同名称为空");
			return;
		}
		
		if($("#edit_huixian_table").find('tr').length<1){
			toastr.error("合同文本为空")
			return;
		} 
		
		var options={
            type: 'POST',
            url: getContextPath()+'/subcontract/updateSubContractsave',
            dataType: 'json',
            data: { 
            		fbId:xiugaiId,
            		contractName:xghetongName,
            		fbcType:xgType,
            		contractNameJia:xgjiafang,
            		contractNameYi:xgyifang,
            		workNo:xgtask_no,
            		prjId:xgprjName,
            		cjContractCode:xgchengjiehetonghao,
            		cjContractName:xgchengjiehetongName,
            		mainContractMoney:xgzhuhetongMoney,
            		nowFbAllMoney:xgleijifenbaoMoney,
            		contractStartTime:xgyear,
            		contractEndTime:xgyear2,
            		mainManageDepartment:xgjiafangbumen,
            		contractLongTime:xghetonggongqi,
            		payMode:xgfukuanfangshi,
            		contractMoney:xghetongMoney,
            		temporaryMoney:xgzandingMoney,
            		performanceBond:xglvyuebaozhengMoney,
            		workContent:xggaikuang,
            },
            success: function (json) {
            	console.log(json);
            	if(json.result==0){
					toastr.error("修改失败")
				}else if(json.result>0){
					//location.reload([true]);
					toastr.success("修改成功")
					$("#change").modal("hide")
					initTable();
				}
            }
        };
		$("#edit_form").ajaxSubmit(options);
	}
	
	//提交修改
	function checksubmit(){
		var xghetongName=$("#xghetongName").val()
		var xgType=$("#xgType").val()
		var xgjiafang=$("#xgjiafang").val()
		var xgyifang=$("#xgyifang").val()
		var xgprjName=$("#xgprjName").val()
		var xgtask_no=$("#xgtask_no").val()
		var xgchengjiehetongName=$("#xgchengjiehetongName").val()
		var xgchengjiehetonghao=$("#xgchengjiehetonghao").val()
		var xgzhuhetongMoney=$("#xgzhuhetongMoney").val()
		var xgleijifenbaoMoney=$('#xgleijifenbaoMoney').val()
		var xgyear=$("#xgyear").val()
		var xgyear2=$("#xgyear2").val()
		var xgjiafangbumen=$("#xgjiafangbumen").val()
		var xghetonggongqi=$("#xghetonggongqi").val()
		var xgfukuanfangshi=$("#xgfukuanfangshi").val()
		var xghetongMoney=$("#xghetongMoney").val()
		var xgzandingMoney=$("#xgzandingMoney").val()
		var xglvyuebaozhengMoney=$("#xglvyuebaozhengMoney").val()
		var xggaikuang=$("#xggaikuang").val()
		
		if(xghetongName==''){
			toastr.error("分包合同名称为空");
			return;
		}
		
		if($("#edit_huixian_table").find('tr').length<1){
			toastr.error("合同文本为空")
			return;
		}
		
		var options={
            type: 'POST',
            url: getContextPath()+'/subcontract/updateSubContractsave',
            dataType: 'json',
            data: { 
            		fbId:xiugaiId,
            		contractName:xghetongName,
            		fbcType:xgType,
            		contractNameJia:xgjiafang,
            		contractNameYi:xgyifang,
            		workNo:xgtask_no,
            		prjId:xgprjName,
            		cjContractCode:xgchengjiehetonghao,
            		cjContractName:xgchengjiehetongName,
            		mainContractMoney:xgzhuhetongMoney,
            		nowFbAllMoney:xgleijifenbaoMoney,
            		contractStartTime:xgyear,
            		contractEndTime:xgyear2,
            		mainManageDepartment:xgjiafangbumen,
            		contractLongTime:xghetonggongqi,
            		payMode:xgfukuanfangshi,
            		contractMoney:xghetongMoney,
            		temporaryMoney:xgzandingMoney,
            		performanceBond:xglvyuebaozhengMoney,
            		workContent:xggaikuang,
            },
            success: function (json) {
            	console.log(json);
            	if(json.result==0){
					toastr.error("提交失败")
				}else if(json.result>0){
					//location.reload([true]);
					toastr.success("提交成功")
					$("#change").modal("hide")
					initTable();
				}
            }
        };
		$("#edit_form").ajaxSubmit(options);
	}
	
	
	
	//查看详细信息
	function lookSubcontract(obj){
		dom=$(obj).parents("tr");
		var data=$('#mainContent').DataTable().row(dom).data();
		console.log(data)
		lookId=data.fbId;
		
		$("#lookhetongName").text(data.contractName)
		$("#lookType").text(data.fbcType)
		$("#lookjiafang").text(data.contractNameJia)
		$("#lookyifang").text(data.ccName)
		$("#lookprjName").text(data.prjName)
		$("#looktask_no").text(data.workNo)
		$("#lookchengjiehetongName").text(data.cjcontractName2)
		$("#lookchengjiehetonghao").text(data.cjContractCode)
		$("#lookzhuhetongMoney").text(data.mainContractMoney)
		$('#lookleijifenbaoMoney').text(data.nowFbAllMoney)
		$("#lookyear").text(data.contractStartTime)
		$("#lookyear2").text(data.contractEndTime)
		$("#lookjiafangbumen").text(data.omName)
		$("#lookhetonggongqi").text(data.contractLongTime)
		$("#lookfukuanfangshi").text(data.payMode)
		$("#lookhetongMoney").text(data.contractMoney)
		$("#lookzandingMoney").text(data.temporaryMoney)
		$("#looklvyuebaozhengMoney").text(data.performanceBond)
		$("#lookgaikuang").text(data.workContent)
		
		$.ajax({
			type:"post",
			url:getContextPath()+"/subcontract/selectAccessoryById",
			dataType:"json",
			async:false,
			data:{
				id:lookId,
			},
			success:function(json){
				console.log(json);
				$("#look_all_table").empty();
	               for(var i=0;i<json.length;i++){
	            	   $("#look_all_table").append("<tr>"+
	            	   														"<td>合同文本"+(i+1)+"</td>"+
													            	    	"<td colspan='2'><input type='text' class='form-control' style='width:100%;' value='"+json[i].acName+"' disabled></td>"+
													            	    	"<td><button type='button' class='btn btn-primary' data1='"+json[i].acUrl+"' onclick='download_all(this)'>下载附件</button></td>"+
													            	    "</tr>");
	               }
			}
		})
	}
	function download_all(obj){
		var url=$(obj).attr("data1");
		var name=$(obj).parents("tr").find("td").eq(1).find("input").val();
		
		window.location.href=encodeURI(getContextPath()+"/FileDownLoad?fileName="+name+"&filePath="+url);
	}
	
	
	
	
	
	//添加附件
	$("#uploaderBox").on("click", function(e) {
        $("#new_table").append("<tr>"+
										"<td> </td>"+
										"<td colspan='3'><input name='file' type='file' id='file' /></td>"+
							      "</tr>");
        
    });
	//修改
	$("#uploaderBox2").on("click", function(e) {
        $("#edit_huixian_table").append("<tr>"+
										"<td>新附件 </td>"+
										"<td colspan='3'><input name='file' type='file' id='xgfile' /></td>"+
							      "</tr>");
        
    });
	

    function getCreat(bb){
        var EnterpriseRating= $(bb).parent().prev().text();
        var Remarks= $(bb).parent().prev().prev().text();
        var ContactPhone1= $(bb).parent().prev().prev().prev().text();
        var Contacts= $(bb).parent().prev().prev().prev().prev().text();
        var address= $(bb).parent().prev().prev().prev().prev().prev().text();
        var ProprietorUnit= $(bb).parent().prev().prev().prev().prev().prev().prev().text();
        var Code= $(bb).parent().prev().prev().prev().prev().prev().prev().prev().text();
        $("#CEnterprise-rating").val(EnterpriseRating);
        $("#CRemarks").val(Remarks);
        $("#CContact-phone1").val(ContactPhone1);
        $("#CContacts").val(Contacts);
        $("#Caddress").val(address);
        $("#CProprietor-unit").val(ProprietorUnit);
        $("#CCode").val(Code);
        rowIndex = bb.parentNode.parentNode.rowIndex; 
    }

    // $("#mainContent tbody tr").click(function (){
    //     $(this).addClass('selected')
    //     .siblings().removeClass('selected')
    //     .end();
    // })

    $(".zhuangtai").change(function(){
        var zt=$(".zhuangtai").val();
        if(zt=="合同终止"){
            $(".quxiao").hide();
            $(".chongqi").show()
        }else{
            $(".quxiao").show();
            $(".chongqi").hide();
        }
    })

</script>
</html>