<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="../../font2/iconfont.css">
    <link rel="stylesheet" href="../../font3/iconfont.css">
	<link href="../../style/bootstrap.min.css" rel="stylesheet">
    <link href="../../style/style.css" rel="stylesheet">
    <link href="../../toastr/toastr.css" rel="stylesheet">
    <link rel="stylesheet" href="../../style/jquery.dataTables.min.css">
    <link rel="stylesheet" href="../../style/jquery-editable-select.css">
        <!-- SmartAdmin Styles : Caution! DO NOT change the order -->
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/smartadmin-production-plugins.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/smartadmin-production.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/smartadmin-skins.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/font.css">
    <!-- SmartAdmin RTL Support  -->
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/smartadmin-rtl.min.css">
    
   	<!-- 固定表头引入的css文件 -->
    <link type="text/css" href="../../css/fixedHeader.bootstrap.min.css"  />
    <link type="text/css" href="../../css/fixedHeader.dataTables.min.css"  />
    <!-- 固定表列引入css文件 -->
    <link href="../../css/fixedColumns.dataTables.css">
    
    <style lang="">
        .UpperPart{
            display: flex;
            justify-content:space-between;
        }
        .selected{
            background: rgba(247, 161, 3,0.2);
        }
        #mainContent th{
            cursor: pointer;
        }
        .table-bordered{
         margin-top: -0.5px !IMPORTANT;
        }
    </style>
</head>
<body>
    
    <!-- 面包屑 -->
    <div class="mianbao">
    	<ul class="breadcrumb">
    		<li><i class="iconfont icon-knowledgebase"></i></li>
            <li>生产管理</li>
			<li class="active">进度管理</li>
		</ul>
    </div>

    <div class="zhuti-content">
    	<!-- Nav tabs -->
            <ul class="nav nav-tabs" role="tablist">
                <li role="presentation" class="active"><a href="#home" aria-controls="home" role="tab" data-toggle="tab">项目进度</a></li>
                <li role="presentation" ><a href="#profile" aria-controls="profile" role="tab" data-toggle="tab">合同进度</a></li>
                <li role="presentation" ><a href="#yuefenjingdu" aria-controls="yuefenjingdu" role="tab" data-toggle="tab">项目月份进度</a></li>
            </ul>
    
    		<div class="tab-content">
    			<div role="tabpanel" class="tab-pane active" id="home">
    				<div class="UpperPart">
			            <div class="UpperPartL">
			                	<div class="yihang" style='margin:5px;'>
			                	<button type="button" class="btn btn-primary Peea"  onclick="showNow()">显示最新</button>&nbsp;&nbsp;
			           			<button type="button" class="btn btn-primary Peea" style="display:none" id="tianbao" data-toggle="modal" data-target="#myModal">填报进度</button>
				                <div id="tabBtn" style="margin-left: 10px;"></div>
				            </div>
			            </div>
			            <div class="UpperPartR">
			            	<div class='yihang' style='margin:5px;'>
                				<input class="form-control" id="searchData" value="" placeholder="搜索" type="text">
                			</div>
			            </div>
			         </div>
			<!-- Modal -->
			<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="myModal">
			    <div class="modal-dialog modal-lg" role="document" style="width:75%;">
			        <div class="modal-content">
			        <div class="modal-header">
			            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			            <h4 class="modal-title" id="myModalLabel"><b>填报进度</b></h4>
			        </div>
			        <div class="modal-body">
			                <div>     
			                    <form class="form-inline" id="myform">
			                        <table class="table table-bordered table-condensed">
			                        	 <thead>
			                                <tr>
			                                    <th colspan="4" >项目基本信息</th>
			                                </tr>
			                            </thead>
			                            <tbody>
				                            <tr>
				                                <td style="width:18%;">项目名称  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
				                                <td style="width:34%;">
				                                    <!-- <select class="form-control" style="width:60%;" id="prjName">
				                                    </select> -->
				                                    <input type="text" class="form-control" id="prjName" disabled  style="width:60%;">
				                               		<button type="button" style="margin-left: 5px;" class="btn btn-primary"  id="chosexm">选择项目</button>
				                                </td>
				                                <td style="width:18%;">任务单号</td>
				                                <td style="width:30%;">
				                                    <input type="text" class="form-control" id="task_no" style="width:70%;">
				                                </td>
				                            </tr>
				                            <tr>
				                                <td class="jingyongkk">项目类型</td>
				                                <td><input type="text" class="form-control" disabled id="prjType2" style="width:60%;"></td>
				                                <td class="jingyongkk">项目负责人</td>
				                                <td>
				                                    <input type="text" class="form-control" id="prj_leader" style="width:70%;" disabled>
				                                    <!-- <button type="button" class="btn btn-default" data-toggle="modal" data-target="#addGuanliren">选择负责人</button> -->
				                                </td>
				                            </tr>
				                            <tr>
				                            	<td class="jingyongkk">合同名称</td>
				                            	<td>
				                            		<input type="text" class="form-control" id="contract_name" style="width:60%;" disabled>
				                            	</td>
				                            	<td class="jingyongkk">合同编号</td>
				                            	<td>
				                            		<input type="text" class="form-control" id="contract_no" style="width:70%;" disabled>
				                            	</td>
				                            </tr>
				                            <tr>
				                                <td class="jinqianyanse">合同金额(元)</td>
				                                <td><input type="text" class="form-control" disabled id="contractMoney" style="width:60%;"></td>
				                                <td class="jinqianyanse">任务金额(元)</td>
				                                <td><input type="text" class="form-control" disabled id="prjMoney" style="width:70%;"></td>
				                            </tr>
				                            <tr>
				                                 <td class="jinqianyanse">暂定金(元)</td>
				                                <td><input type="text" class="form-control" style="width:60%;" id="provisional_sum" disabled></td>
				                                <td class="jingyongkk">项目开始时间</td>
				                                <td><input type="text" class="form-control" id="prj_start_time" style="width:70%;" disabled></td>
				                            </tr>
				                            <tr>
				                                <td class="jingyongkk">项目预计结束时间</td>
				                                <td><input type="text" class="form-control" id="prj_end_time" style="width:60%;" disabled></td>
				                                <td class="jinqianyanse">预算总费用(元)</td>
				                                <td><input type="text" class="form-control" style="width:70%;" id="budget_money_all" disabled></td>
				                            </tr>
				                            <tr>
				                            	<td>当期时间  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
				                                <td><input type="text" class="form-control" id="this_time" style="width:60%;" disabled></td>
				                                <td class="jingyongkk">项目经营模式</td>
				                                <td><input type="text" class="form-control" id="prj_mode" style="width:70%;" disabled></td>
				                            </tr>
				                            <tr>
				                            	<td>本月完成主要内容</td>
                                  				<td colspan="3"><textarea class="form-control" id="thismonth_completecontent"  cols="80" rows="4"></textarea></td>
				                            </tr>
				                            <tr>
				                            	<td>下月计划</td>
                                  				<td colspan="3"><textarea class="form-control" id="nextmoney_plan"  cols="80" rows="4"></textarea></td>
				                            </tr>
				                         </tbody>
			                        </table>
			                        
			                        <table class="table table-bordered table-condensed">
										<thead>
			                                <tr>
			                                    <th colspan="4" >项目收入信息</th>
			                                </tr>
			                            </thead>
			                            <tbody>
			                            	<tr id="errorPrompt" style="display:none">
			                            		<td colspan="4">
						                            <div>
							                    		<label style="color:red;">本次填报进度小于上次填报的进度,所以自动同步为上次的累计效果</label>
							                    	</div>
			                            		</td>
			                            	</tr>
			                                <tr>
				                                <td class="jinqianyanse">累计收入（%）  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
				                                <td>
				                                		<input type="text" class="form-control" disabled id="all_money" style="width:60%;">
				                                		<button type="button" class="btn btn-default"  id="jindua">选择进度</button>
				                                </td>
				                                <td class="jinqianyanse">本期收入（元）  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
				                                <td><input type="text" class="form-control" style="width:70%;" id="this_time_money_yuan" disabled></td>
				                            </tr>
				                            <tr>
				                            	<td class="jinqianyanse">累计收入（元）  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
				                                <td>
				                                		<input type="text" class="form-control" disabled id="all_money_yuan" style="width:60%;">
				                                </td>
				                                <td class="shuziyanse">合同进度（%）  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
				                                <td>
				                                	<input type="text" class="form-control" style="width:70%;" id="contract_income" disabled>
				                                </td>
				                            	<!-- <td>本期收入（%）  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
				                                <td><input type="text" class="form-control" style="width:60%;" id="this_time_money" disabled></td> -->
				                            </tr>
				                            <tr>
					                            <td class="shuziyanse">税率(%)</td>
					                            <td>
					                            	<input type="text" class="form-control" style="width:60%;" id="new_rate"  placeholder='请填整数' onchange="getRateMoney(this)">
					                            </td>
					                            <td style="width:20%;" class="jinqianyanse">税金</td>
					                            <td style="width:30%;">
					                            	<input type="text" class="form-control" style="width:70%;" id="new_rate_money" disabled>
					                            </td>
					                        </tr>
			                            </tbody>                     
			                        </table>
			                        
			                         <table class="table table-bordered table-condensed" id="new_accessory">
			                    		<thead>
			                    			<tr>
			                    				<th colspan="2">
			                    					进度附件上传 <i class="iconfont icon-xingxing-copy" style="color:red;"></i>
			                    				</th>
			                    				 <th>
			                                		<button type="button" class="btn btn-primary" id="uploaderBox">添加附件</button>
			                            		</th>
			                    			</tr>
			                    		</thead>
			                    		<tbody>
			                    			<tr>
			                    				<td>附件</td>
			                    				<td><input type="file" name="file" class="form-control"></td>
			                    				<td></td>
			                    			</tr>
			                    		</tbody>
			                    	</table>  
			
			                        <table class="table table-bordered table-condensed" id="xieban1">
			                            <thead>
			                                <tr>
			                                    <th colspan="8" >收入拆分  <i class="iconfont icon-xingxing-copy" style="color:red;"></i>(本期收入(%)为协办部门与主办部门各自占比，总共100%)</th>
			                                </tr>
			                            </thead>
			                            <tbody>
			                                
			                            </tbody>
			                        </table>
			                        <!-- <table class="table table-bordered table-condensed" id="xieban2">
			                            <thead>
			                                <tr>
			                                    <th colspan="6" >本期收入</th>
			                                </tr>
			                            </thead>
			                            <tbody>
			                                
			                            </tbody>
			                        </table> -->
			                        <!-- <table class="table table-bordered table-condensed" id="xieban3">
			                            <thead>
			                                <tr>
			                                    <th colspan="4" >本期收款</th>
			                                </tr>
			                            </thead>
			                            <tbody>
			                                
			                            </tbody>
			                        </table>
			                        <table class="table table-bordered table-condensed" id="xieban4">
			                            <thead>
			                                <tr>
			                                    <th colspan="4" >累计收款</th>
			                                </tr>
			                            </thead>
			                            <tbody>
			                                
			                            </tbody>
			                        </table>
			                        <table class="table table-bordered table-condensed" id="xieban5">
			                            <thead>
			                                <tr>
			                                    <th colspan="4" >本期成本</th>
			                                </tr>
			                            </thead>
			                            <tbody>
			                                
			                            </tbody>
			                        </table>
			                        <table class="table table-bordered table-condensed" id="xieban6">
			                            <thead>
			                                <tr>
			                                    <th colspan="4" >累计成本</th>
			                                </tr>
			                            </thead>
			                            <tbody>
			                                
			                            </tbody>
			                        </table> -->
			                        <!-- 进度分包合同表 -->
			                        <table class="table table-bordered table-condensed" id="fb_table">
			                            <thead>
			                                <tr>
			                                    <th colspan="9">分包收入</th>
			                                </tr>
			                                <tr>
			                                    <th style="width:15%;">分包合同名称</th>
			                                    <th style="width:10%;">管理部门</th>
			                                    <th style="width:12%;">分包合同金额(元)</th>
			                                    <th style="width:15%;">分包方名称</th>
			                                    <th style="width:9%;">累计收入(%)</th>
			                                    <th style="width:11%;">累计收入(元)</th>
			                                    <th style="width:11%;">本期收入(元)</th>
			                                    <th style="width:9%;">税率(%)</th>
			                                    <th style="width:8%;">税金(元)</th>
			                                </tr>
			                            </thead>
			                            <tbody>
			                            </tbody>
			                        </table>
			                        <table class="table table-bordered table-condensed" id="fb_ys_table" style="display:none;">
			                            <thead>
			                                <tr>
			                                    <th colspan="2">预算分包收入</th>
			                                </tr>
			                            </thead>
			                            <tbody></tbody>
			                        </table>
			                        
			                        <!-- 进度承接合同表 -->
			                        <!-- <table class="table table-bordered table-condensed" id="cj_table">
			                            <thead>
			                                <tr>
			                                    <th colspan="6">承接合同表</th>
			                                </tr>
			                                <tr>
			                                    <th style="width:30%;">合同名称</th>
			                                    <th style="width:15%;">合同金额(元)</th>
			                                    <th style="width:15%;">暂定金(元)</th>
			                                    <th style="width:20%;">合同本期收入</th>
			                                    <th style="width:20%;">总累计收入</th>
			                                </tr>
			                            </thead>
			                            <tbody>
			                            </tbody>
			                        </table> -->
			                    </form>  
			                </div>
			        </div>
			        <div class="modal-footer">
			            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
			            <button type="button" class="btn btn-success" onclick="save()">保存</button>
			            <button type="button" class="btn btn-success" onclick="submit()">提交</button>
			        </div>
			        </div>
			    </div>
			</div>
			<!-- model结束 -->
			<!-- Modal项目 -->
			<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="xiangmumd">
			    <div class="modal-dialog modal-lg" role="document">
			        <div class="modal-content">
			        <div class="modal-header">
			            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			            <h4 class="modal-title" id="myModalLabel"><b>选择项目</b></h4>
			        </div>
			        <div class="modal-body">
			                <div>     
			                    <form class="form-inline">
			                        <table class="table table-bordered table-condensed" id="xiangmubiao" style="width:100%;">
			                            <thead>
			                            	<tr>
			                            		<th style="width:5%;"></th>
			                            		<th style="width:15%;">编号</th>
			                                    <th style="width:30%;">项目名称</th>
			                                    <th style="width:15%;">项目所属公司</th>
			                                    <th style="width:15%;">项目类型</th>
			                                    <th style="width:20%;">甲方单位</th>
			                            	</tr>
			                            </thead>
			                            <tbody>
			                                
			                            </tbody>
			                        </table> 
			                    </form>  
			                </div>
			        </div>
			        <div class="modal-footer">
			            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
			            <button type="button" class="btn btn-success" id="quedingxm">保存</button>
			        </div>
			        </div>
			    </div>
			</div>
			<!-- model项目结束 -->
			<!--选人 modal -->
			<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="addGuanliren">
			    <div class="modal-dialog" role="document">
			        <div class="modal-content">
			            <div class="modal-header">
			                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			                <h4 class="modal-title" id="gridSystemModalLabel">选择收货人</h4>
			            </div>
			            <div class="modal-body">
			                <form class="form-inline">
			                    <div class="form-group">
			                        <div>
			                            <span>部门:</span>
			                            <select style="width:180px;" id="bumen" class="form-control" >
			                                
			                            </select>
			                            <span>人员:</span>
			                            <select style="width:180px;" id="guanliren" class="form-control" >
			                                
			                            </select>
			                        </div>
			                    </div>
			                </form>
			                <div>
			                     <table class="table table-bordered table-condensed"  id="bmmingzibiao" >
			                     	<thead>
					   					<tr>
					   						<th></th>
					   						<th>姓名</th>
					   						<th>工号</th>
					   						<th>出生日期</th>
					   						<th>性别</th>
					   						<th>职务</th>
					   					</tr>
					   				</thead>
					   				<tbody></tbody>
			                     </table>
			              </div>
			            </div>
			            <div class="modal-footer">
			                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
			                <button type="button" class="btn btn-primary" onclick="saveGuanliren()" data-dismiss="modal">确定</button>
			            </div>
			        </div>
			    </div>
			</div>
			
			<!--进度 modal -->
			<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="jindu">
			    <div class="modal-dialog" role="document">
			        <div class="modal-content">
			            <div class="modal-header">
			                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			                <h4 class="modal-title" id="gridSystemModalLabel">选择进度</h4>
			            </div>
			            <div class="modal-body">
			            	<div id="B1jieduan">
			            		<form class="form-inline">
		                        	<table class="table table-bordered table-condensed">
		                        		<tr>
		                        			<td><span>施工图设计：</span>&nbsp;&nbsp;<span id="b1_span1"></span></td>
		                        			<td>
		                        				<select style="width:180px;" id="b1_shigongsheji" class="form-control" >
					                            	<option value="0">无</option>
					                                <option value="55">成果内部审查</option>
					                                <option value="80">施设文件交付</option>
					                                <option value="85">外部审查会议纪要</option>
					                                <option value="100">交工验收报告</option>
					                            </select>
		                        			</td>
		                        			<td style="width:20%;">
		                        				<input type="text" class="form-control" style="width:80%;" id="b1_span1_1" value="0" onchange="checkZs(this)">%
		                        			</td>
		                        		</tr>
		                        	</table>
				                </form>
			            	</div>
			            	<div id="B2jieduan">
			            		<form class="form-inline">
		                        	<table class="table table-bordered table-condensed">
		                        		<tr>
		                        			<td style="width:35%;"><span>初步设计：</span>&nbsp;&nbsp;<span id="b2_span1"></span></td>
		                        			<td style="width:45%;">
		                        				<select style="width:180px;" id="firstsheji" class="form-control" >
					                            	<option value="0">无</option>
					                                <option value="55">成果内部审查</option>
					                                <option value="80">初设文件交付</option>
					                                <option value="90">外部审查会议纪要</option>
					                                <option value="100">初设文件批复</option>
					                            </select>
		                        			</td>
		                        			<td style="width:20%;">
		                        				<input type="text" class="form-control" style="width:80%;" id="b2_span1_1" value="0" onchange="checkZs(this)">%
		                        			</td>
		                        		</tr>
		                        		<tr>
		                        			<td><span>施工图设计：</span>&nbsp;&nbsp;<span id="b2_span2"></span></td>
		                        			<td>
		                        				<select style="width:180px;" id="shigongsheji" class="form-control" >
					                            	<option value="0">无</option>
					                                <option value="55">成果内部审查</option>
					                                <option value="80">施设文件交付</option>
					                                <option value="85">外部审查会议纪要</option>
					                                <option value="100">交工验收报告</option>
					                            </select>
		                        			</td>
		                        			<td style="width:20%;">
		                        				<input type="text" class="form-control" style="width:80%;" id="b2_span2_1" value="0" onchange="checkZs(this)">%
		                        			</td>
		                        		</tr>
		                        	</table>
				                </form>
			            	</div>
			                
			                <div id="B3jieduan">
			                	<form class="form-inline" >
			                		<table class="table table-bordered table-condensed">
		                				<tr>
		                					<td style="width:35%;"><span>预工可：</span>&nbsp;&nbsp;<span id="b3_span1"></span></td>
		                					<td style="width:45%;">
		                						<select style="width:180px;" id="b3_yugong_sheji" class="form-control" >
					                            	<option value="0">无</option>
					                                <option value="50">成果内部审查</option>
					                                <option value="75">送审稿报告交付</option>
					                                <option value="80">外部审查会议纪要</option>
					                                <option value="100">工可文件批复</option>
					                            </select>
		                					</td>
		                					<td style="width:20%;">
		                						<input type="text" class="form-control" style="width:80%;" id="b3_span1_1" value="0" onchange="checkZs(this)">%
		                        			</td>
		                				</tr>
		                        		<tr>
		                        			<td><span>初步设计：</span>&nbsp;&nbsp;<span id="b3_span2"></span></td>
		                        			<td>
		                        				<select style="width:180px;" id="b3_firstsheji" class="form-control" >
					                            	<option value="0">无</option>
					                                <option value="55">成果内部审查</option>
					                                <option value="80">初设文件交付</option>
					                                <option value="90">外部审查会议纪要</option>
					                                <option value="100">初设文件批复</option>
					                            </select>
		                        			</td>
		                        			<td style="width:20%;">
		                        				<input type="text" class="form-control" style="width:80%;" id="b3_span2_1" value="0" onchange="checkZs(this)">%
		                        			</td>
		                        		</tr>
		                        		<tr>
		                        			<td><span>施工图设计：</span>&nbsp;&nbsp;<span id="b3_span3"></span></td>
		                        			<td>
		                        				<select style="width:180px;" id="b3_shigongsheji" class="form-control" >
					                            	<option value="0">无</option>
					                                <option value="55">成果内部审查</option>
					                                <option value="80">施设文件交付</option>
					                                <option value="85">外部审查会议纪要</option>
					                                <option value="100">交工验收报告</option>
					                            </select>
		                        			</td>
		                        			<td style="width:20%;">
		                        				<input type="text" class="form-control" style="width:80%;" id="b3_span3_1" value="0" onchange="checkZs(this)">%
		                        			</td>
		                        		</tr>
		                        	</table>
				                </form>
			                </div>
			                
			                <div id="B4jieduan">
			                	<form class="form-inline">
				                    <table class="table table-bordered table-condensed">
		                				<tr>
		                					<td style="width:35%;"><span>预工可：</span>&nbsp;&nbsp;<span id="b4_span1"></span></td>
		                					<td style="width:45%;">
		                						<select style="width:180px;" id="b4_yugong_sheji" class="form-control" >
					                            	<option value="0">无</option>
					                                <option value="50">成果内部审查</option>
					                                <option value="75">送审稿报告交付</option>
					                                <option value="80">外部审查会议纪要</option>
					                                <option value="100">工可文件批复</option>
					                            </select>
		                					</td>
		                					<td style="width:20%;">
		                						<input type="text" class="form-control" style="width:80%;" id="b4_span1_1" value="0" onchange="checkZs(this)">%
		                        			</td>
		                				</tr>
		                        		<tr>
		                        			<td><span>施工图设计：</span>&nbsp;&nbsp;<span id="b4_span2"></span></td>
		                        			<td>
		                        				<select style="width:180px;" id="b4_shigongsheji" class="form-control" >
					                            	<option value="0">无</option>
					                                <option value="55">成果内部审查</option>
					                                <option value="80">施设文件交付</option>
					                                <option value="85">外部审查会议纪要</option>
					                                <option value="100">交工验收报告</option>
					                            </select>
		                        			</td>
		                        			<td style="width:20%;">
		                        				<input type="text" class="form-control" style="width:80%;" id="b4_span2_1" value="0" onchange="checkZs(this)">%
		                        			</td>
		                        		</tr>
		                        	</table>
				                </form>
			                </div>
			                
			                <div id="AB1jieduan">
			                	<select style="width:280px;" id="AB1jieduanjindu" class="form-control" >
			                        <option value="10">10%</option>
			                        <option value="20">20%</option>
			                        <option value="30">30%</option>
			                        <option value="40">40%</option>
			                        <option value="50">50%</option>
			                        <option value="60">60%</option>
			                        <option value="70">70%</option>
			                        <option value="75">75%</option>
			                        <option value="80">80%</option>
			                        <option value="85">85%</option>
			                        <option value="90">90%</option>
			                        <option value="100">100%</option>
			                    </select>
			                </div>
			                <div id="C1jieduan">
			                	<input style="width:200px;" id="C1jieduanjindu" class="form-control" >
			                </div>
			                <div id="C2jieduan">
			                	<input style="width:200px;" id="C2jieduanjindu" class="form-control" >
			                </div>
			                <div id="qita">
			                	<input type="text" class="form-control" style="width:200px;" id="qitajindu">
			                </div>
			                
			            </div>
			            <div class="modal-footer">
			                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
			                <button type="button" class="btn btn-primary" data-dismiss="modal" id="quedingjindu">确定</button>
			            </div>
			        </div>
			    </div>
			</div>
			<!-- 进度 modal结束 -->
			<!-- 修改Modal -->
			<div class="modal fade bs-example-modal-lg" id="change" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			    <div class="modal-dialog modal-lg" role="document">
			        <div class="modal-content">
			        <div class="modal-header">
			            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			            <h4 class="modal-title" id="myModalLabel"><b>修改进度</b></h4>
			        </div>
			        <div class="modal-body">
			                <div>     
			                    <form class="form-inline">
			                        <table class="table table-bordered table-condensed">
			                            <tr>
			                                <td>项目名称  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
			                                <td>
			                                    <select class="form-control" style="width:180px;" id="xgprjName">
			                                        
			                                    </select>
			                                </td>
			                                <td style="width:100px;">任务单号</td>
			                                <td>
			                                    <input type="text" class="form-control" id="xgtask_no">
			                                </td>
			                            </tr>
			                            <tr>
			                                <td>项目类型</td>
			                                <td><input type="text" class="form-control" disabled id="xgprjType2"></td>
			                                <td style="width:100px;">合同金额</td>
			                                <td><input type="text" class="form-control" disabled></td>
			                            </tr>
			                            <tr>
			                                <td>项目负责人  <i class="iconfont icon-xingxing-copy" style="color:red;"></i></td>
			                                <td>
			                                    <select class="form-control" style="width:180px;">
			                                        <option>1</option>
			                                        <option>2</option>
			                                    </select>
			                                </td>
			                                <td>暂定金</td>
			                                <td><input type="text" class="form-control"></td>
			                            </tr>
			                            <tr>
			                                <td>项目开始时间</td>
			                                <td><input type="text" class="form-control" id="year"></td>
			                                <td>项目预计结束时间</td>
			                                <td><input type="text" class="form-control" id="year2"></td>
			                            </tr>
			                            <tr>
			                                <td>预算总费用</td>
			                                <td><input type="text" class="form-control"></td>
			                                <td>当期时间</td>
			                                <td><input type="text" class="form-control"></td>
			                            </tr>
			                            <tr>
			                                <td>总累计收入</td>
			                                <td><input type="text" class="form-control"></td>
			                                <td>总实际成本</td>
			                                <td><input type="text" class="form-control"></td>
			                            </tr>
			                            <tr>
			                                <td>项目本期收入</td>
			                                <td><input type="text" class="form-control"></td>
			                                <td></td>
			                                <td></td>
			                            </tr>
			                            <tr>
			                                <td>进度附件</td>
			                                <td colspan="3"><input type="file" class="form-control"></td>
			                            </tr>
			                        </table>
			
			                        <table class="table table-bordered table-condensed" id="edit_xieban">
			                            <thead>
			                                <tr>
			                                    <th colspan="2" >累计收入</th>
			                                </tr>
			                            </thead>
			                            <tbody>
			                                
			                            </tbody>
			                        </table>
			                        <table class="table table-bordered table-condensed" id="edit_xieban2">
			                            <thead>
			                                <tr>
			                                    <th colspan="2" >本期收入</th>
			                                </tr>
			                            </thead>
			                            <tbody>
			                                
			                            </tbody>
			                        </table>
			                        <table class="table table-bordered table-condensed" id="edit_xieban3">
			                            <thead>
			                                <tr>
			                                    <th colspan="2" >本期收款</th>
			                                </tr>
			                            </thead>
			                            <tbody>
			                                
			                            </tbody>
			                        </table>
			                        <table class="table table-bordered table-condensed" id="edit_xieban4">
			                            <thead>
			                                <tr>
			                                    <th colspan="2" >累计收款</th>
			                                </tr>
			                            </thead>
			                            <tbody>
			                                
			                            </tbody>
			                        </table>
			                        <table class="table table-bordered table-condensed" id="edit_xieban5">
			                            <thead>
			                                <tr>
			                                    <th colspan="2" >本期成本</th>
			                                </tr>
			                            </thead>
			                            <tbody>
			                                
			                            </tbody>
			                        </table>
			                        <table class="table table-bordered table-condensed" id="edit_xieban6">
			                            <thead>
			                                <tr>
			                                    <th colspan="2" >累计成本</th>
			                                </tr>
			                            </thead>
			                            <tbody>
			                                
			                            </tbody>
			                        </table>
			                    </form>  
			                </div>
			        </div>
			        <div class="modal-footer">
			            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
			            <button type="button" class="btn btn-success">保存</button>
			        </div>
			        </div>
			    </div>
			</div>
			<!-- 修改model结束 -->
			
			<!-- 修改拆分修改表Modal -->
			<div class="modal fade bs-example-modal-lg" id="changecfb" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			    <div class="modal-dialog modal-lg" role="document" style="width:1200px;">
			        <div class="modal-content">
			        <div class="modal-header">
			            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			            <h4 class="modal-title" id="myModalLabel"><b>修改拆分表</b></h4>
			        </div>
			        <div class="modal-body">
			            <div>     
			                <form class="form-inline">
			                    <table class="table table-bordered table-condensed">
			                        <tr>
			                            <td>合同名称</td>
			                            <td>合同金额(元)</td>
			                            <td>暂定金(元)</td>
			                            <td>合同本期收入</td>
			                            <td>总累计收入</td>
			                        </tr>
			                        <tr>
			                            <td>
			                                <select class="form-control" style="width:180px;">
			                                    <option>1</option>
			                                    <option>2</option>
			                                </select>
			                            </td>
			                            <td><input type="text" class="form-control"></td>
			                            <td><input type="text" class="form-control"></td>
			                            <td><input type="text" class="form-control"></td>
			                            <td><input type="text" class="form-control"></td>
			                        </tr>
			                    </table>
			                </form>  
			            </div>
			        </div>
			        <div class="modal-footer">
			            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
			            <button type="button" class="btn btn-primary">保存</button>
			        </div>
			        </div>
			    </div>
			</div>
			<!-- 修改拆分表model结束 -->
			<!-- 提交 modal -->
			<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="tijiaogei">
			    <div class="modal-dialog" role="document">
			        <div class="modal-content">
			            <div class="modal-header">
			                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			                <h4 class="modal-title" id="gridSystemModalLabel">提交给</h4>
			            </div>
			            <div class="modal-body">
			                <table class="table table-bordered table-condensed" id="tijiaoren">
			                        	<thead>
			                        			<tr>
					                            	<th></th>
					                                <th>部门</th>
					                                <th>职务</th>
					                                <th>审批人</th>
					                            </tr>
			                        	</thead>
			                            <tbody>
			                            	
			                            </tbody>
			                        </table>
			            </div>
			            <div class="modal-footer">
			                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
			                <button type="button" class="btn btn-success" data-dismiss="modal" onclick="submitPerson()">提交</button>
			            </div>
			        </div>
			    </div>
			</div>
			
			<div class="LowerPart"  style="margin-top:3px;width:100%;">
	            <table class="table table-bordered table-condensed" id="mainContent">
	                <thead>
	                    <tr>
	                        <th style="width:100px;">任务单号</th>
	                        <th style="width:420px;">项目名称</th>
	                        <th style="width:180px;">项目类型</th>
	                        <th style="width:80px;">任务金额(元)</th>
	                        <th style="width:80px;">动态金额(元)</th>
	                        <th style="width:80px;">合同金额(元)</th>
	                        <th style="width:80px;">结算金额</th>
	                        <th style="width:80px;">项目负责人</th>
	                        <th style="width:80px;">当期时间</th>
	                        <th style="width:80px;">项目开始时间</th>
	                        <th style="width:80px;">项目结束时间</th>
	                        <th style="width:80px;">项目进度</th>
	                        <th style="width:80px;">项目收入</th>
	                        <th style="width:80px;">收回状态</th>
	                        <th style="width:80px;">截止上年度的收入金额</th>
	                        <th style="width:80px;">本年度收入金额</th>
	                        <th style="width:60px;">状态</th>
	                        <th style="width:60px;">操作</th>
	                    </tr>
	                </thead>
	                <tbody>
	                </tbody>   
	            </table>
	        </div>
			<!-- 提交 modal结束 -->
			</div>
			
			<div role="tabpanel" class="tab-pane" id="profile">
                    <div class="UpperPart">
                        <div class="UpperPartL">                       		
	                        </div>
                        <div class="UpperPartR">
                        </div>
                      </div>
                      <div class="LowerPart" style="margin-top:3px;">
			            <table class="table table-bordered table-condensed" id="mainContent2" style="width:100%;">
			                <thead>
			                    <tr>
			                        <th style="width:15%;">合同编号</th>
			                        <th style="width:25%;">合同名称</th>
			                        <th style="width:15%;">合同金额(元)</th>
			                        <th style="width:15%;">承接部门</th>
			                        <th style="width:15%;">当期时间</th>
			                        <th style="width:15%;">合同进度</th>
			                    </tr>
			                </thead>
			                <tbody>
			                </tbody>   
			            </table>
			        </div>
             </div>         
    		<div role="tabpanel" class="tab-pane " id="yuefenjingdu">
    		<br/>
    				<div class="UpperPart">
			            <div class="UpperPartL" style="font-size:18px;">
	                            	<div class="yihang">
		                       			<form class="form-inline">
			                                <label>月份筛选:</label>
			                                <input type="text" class="form-control" id="yuefenshaixuan2">
		                            	</form>
						                <div id="tabBtnyfjd" style="margin-left: 10px;"></div>
						            </div>
	                        </div>
			            <div class="UpperPartR">
			            	<div class='yihang'>
			                    <input class="form-control" id="searchData3" value="" placeholder="搜索" type="text">
			                </div>
			            </div>
			         </div>

		
			<div class="LowerPart" style="margin-top:3px;">        	
	            <table class="table table-bordered table-condensed" id="mainContentyfjd" style="width:100%;">
	                <thead>
	                    <tr>
	                        <th style="width:12%;">任务单号</th>
	                        <th style="width:17%;">项目名称</th>
	                        <th style="width:12%;">项目类型</th>
	                        <th style="width:10%;">任务金额(元)</th>
	                        <th style="width:10%;">合同金额(元)</th>
	                        <th style="width:8%;">项目负责人</th>
	                        <th style="width:8%;">当期时间</th>
	                        <th style="width:10%;">累计金额</th>
	                        <th style="width:8%;">累计项目进度</th>
	                        <th style="width:5%;">操作</th>
	                    </tr>
	                </thead>
	                <tbody>
	                </tbody>   
	            </table>
			</div>
			</div>
			
    	</div>
        
    </div>
<!-- allMsg -->
<div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="allMsg1">
    <div class="modal-dialog modal-lg" role="document" style="width:75%;">
        <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel"><b>所有信息</b></h4>
        </div>
        <div class="modal-body">
            <div>     
                <form class="form-inline">
                    <table class="table table-bordered table-condensed">
                    	<thead>
                    		<tr>
                    			<th colspan="4">项目基本信息</th>
                    		</tr>
                    	</thead>
                    	<tbody>
                    		<tr>
                            <td  style="width:18%;">项目名称</td>
                            <td id="look_prj_name" style="width:37%;"></td>
                            <td  style="width:18%;">任务单号</td>
                            <td id="look_task_no" style="width:27%;"></td>
                        </tr>
                        <tr>
                            <td>合同名称</td>
                            <td id="look_contract_name"></td>
                            <td>合同编号</td>
                            <td id="look_contract_no"></td>
                        </tr>
                        <tr>
                            <td>项目类型</td>
                            <td id="look_prj_type"></td>
                            <td>项目负责人</td>
                            <td id="look_prj_leader"></td>
                        </tr>
                        <tr>
                        	<td class="jinqianyanse">合同金额</td>
                            <td id="look_contract_money"></td>
                            <td class="jinqianyanse">任务金额(元)</td>
                            <td id="look_prj_money"></td>
                        </tr>
                        <tr>
                        	<td class="jinqianyanse">暂定金(元)</td>
                            <td id="look_provisional_sum"></td>
                            <td>项目开始时间</td>
                            <td id="look_prj_start_time"></td>
                        </tr>
                        <tr>
                        	<td>项目预计结束时间</td>
                            <td id="look_prj_end_time"></td>
                            <td class="jinqianyanse">预算总费用(元)</td>
                            <td id="look_budget_money_all"></td>
                        </tr>
                        <tr>
                        	<td>当期时间</td>
                            <td id="look_this_time"></td>
                            <td>项目经营模式</td>
                            <td id="look_prj_mode"></td>
                        </tr>
                        <tr>
                           	<td>本月完成主要内容</td>
                            <td colspan="3" id="look_thismonth_completecontent"> </td>
                        </tr>
                        <tr>
                           	<td>下月计划</td>
                            <td colspan="3" id="look_nextmoney_plan"></td>
                        </tr>
                    	</tbody>
                    </table>
                    <table class="table table-bordered table-condensed">
                    	<thead>
                    		<tr>
                    			<th colspan="4">项目收入信息</th>
                    		</tr>
                    	</thead>
                    	<tbody>
                    		<tr>
	                        	<td style="width:20%;" class="jinqianyanse">累计收入（%）</td>
	                            <td style="width:30%;">
	                            	<div class="yihang2">
	                            		<div>
	                            			<span id="look_all_money"></span>
	                            		</div>
	                            		<div>
	                            			<span id="span_button" ></span>
	                            		</div>
	                            	</div>
	                            </td>
	                            <td class="jinqianyanse">本期收入（元）</td>
	                            <td id="look_in_come_yuan"></td>
	                        </tr>
	                        <tr>
	                            <td class="jinqianyanse">累计收入（元）</td>
	                            <td id="look_all_money_yuan"></td>
	                            <td style="width:20%;" class="shuziyanse">合同进度（%）</td>
	                            <td style="width:30%;" id="look_contract_income"></td>
	                        </tr>
	                        <tr>
	                            <td class="jinqianyanse">税率(%)</td>
	                            <td id="look_rate"></td>
	                            <td style="width:20%;" class="shuziyanse">税金</td>
	                            <td style="width:30%;" id="look_rate_money"></td>
	                        </tr>
                    	</tbody>
                    </table>
                    
                    <table class="table table-bordered table-condensed" id="look_accessory">
                    	<thead>
                    		<tr>
                    			<th colspan='3'>进度附件</th>
                    		</tr>
                    	</thead>
                    	<tbody></tbody>
                    </table>

                    <table class="table table-bordered table-condensed" id="look_xieban">
                        <thead>
                            <tr>
                                <th colspan="8">收入拆分 (本期收入(%)为本期收入(元)的占比,总共100%)</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <!-- <table class="table table-bordered table-condensed" id="look_xieban2">
                        <thead>
                            <tr>
                                <th colspan="4">本期收入</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <table class="table table-bordered table-condensed" id="look_xieban3">
                        <thead>
                            <tr>
                                <th colspan="4">本期收款</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <table class="table table-bordered table-condensed" id="look_xieban4">
                        <thead>
                            <tr>
                                <th colspan="4">累计收款</th>
                            </tr>
                        </thead>
                        <tbody> </tbody>
                    </table>
                    <table class="table table-bordered table-condensed" id="look_xieban5"> 
                        <thead>
                            <tr>
                                <th colspan="4">本期成本</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <table class="table table-bordered table-condensed" id="look_xieban6">
                        <thead>
                            <tr>
                                <th colspan="4">累计成本</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table> -->
                    <table class="table table-bordered table-condensed" id="look_fb" style="display:none;">
                    	<thead>
                                <tr>
                                    <th colspan="9">分包收入</th>
                                </tr>
                                <tr>
                                    <th style="width:15%;">分包合同名称</th>
                                    <th style="width:10%;">管理部门</th>
                                    <th style="width:12%;">分包合同金额(元)</th>
                                    <th style="width:15%;">分包方名称</th>
                                    <th style="width:9%;">累计收入(%)</th>
                                    <th style="width:11%;">累计收入(元)</th>
                                    <th style="width:11%;">本期收入(元)</th>
                                    <th style="width:9%;">税率(%)</th>
                                    <th style="width:8%;">税金(元)</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                    </table>
                     <table class="table table-bordered table-condensed" id="look_fb_ys" style="display:none;">
                           <thead>
                               <tr>
                                   <th colspan="2">预算分包收入</th>
                               </tr>
                           </thead>
                           <tbody></tbody>
                       </table>
                    <!-- <table class="table table-bordered table-condensed" id="look_cj">
                    	<thead>
                                <tr>
                                    <th colspan="5">承接合同表</th>
                                </tr>
                                <tr>
                                    <th style="width:32%;">合同名称</th>
                                    <th style="width:14%;">合同金额(元)</th>
                                    <th style="width:14%;">暂定金(元)</th>
                                    <th style="width:15%;">合同本期收入</th>
                                    <th style="width:15%;">总累计收入</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                    </table> -->
                    <br/>
					<h2 style="color:red;">审批详情</h2>
					<table class="table table-bordered table-condensed" id="d_table">
                    		<thead>
                    			<tr>
                    				<th style="width:30%;">业务名称</th>
                    				<th style="width:12%;">操作人</th>
                    				<th style="width:23%;">意见</th>
                    				<th style="width:12%;">操作类型</th>
                    				<th style="width:23%;">操作时间</th>
                    			</tr>
                    		</thead>
                    		<tbody></tbody>
                    	</table>
                </form>  
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        </div>
        </div>
    </div>
</div>
<!-- allMsg结束 -->

<!--  查看阶段 modal -->
			<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="look_design">
			    <div class="modal-dialog" role="document" style="width:40%;">
			        <div class="modal-content">
			            <div class="modal-header">
			                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			                <h4 class="modal-title" id="gridSystemModalLabel">查看阶段</h4>
			            </div>
			            <div class="modal-body">
			                <form class="form-inline">
			                        <table class="table table-bordered table-condensed">
			                        	<tr id="yugongke_tr" style="display:none;">
			                        		<td style="width:40%;">预工可：</td>
			                        		<td style="width:60%;" id="yugongke_td"></td>
			                        	</tr>
			                        	<tr id="chubu_tr" style="display:none;">
			                        		<td>初步设计：</td>
			                        		<td id="chubu_td"></td>
			                        	</tr>
			                        	<tr id="shigongtu_tr" style="display:none;">
			                        		<td>施工图设计：</td>
			                        		<td id="shigongtu_td"></td>
			                        	</tr>
			                        </table>
			                </form>
			            </div>
			            <div class="modal-footer">
			                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
			            </div>
			        </div>
			    </div>
			</div>

</body>
<script src="../../js/jquery.js"></script>
<script src="../../js/common-scripts.js"></script>
<script src="../../js/bootstrap.min.js"></script>
<script src="../../js/laydate/laydate.js"></script>
<script src="../../js/jquery-editable-select.js"></script>
<script src="../../toastr/toastr.js"></script>
<script src="../../js/myTool.js"></script>
<script src="../../js/quanxian.js"></script>
<script src="../../js/SmartNotification.min.js"></script>

<script src="../../js/datatables/jquery.dataTables.min.js"></script>
<script src="../../js/datatables/dataTables.colVis.min.js"></script>
<script src="../../js/datatables/dataTables.tableTools.min.js"></script>
<!-- <script src="../../js/datatables/dataTables.bootstrap.min.js"></script> -->
<script src="../../js/datatables/datatables.responsive.min.js"></script>
<script src="../../js/datatables/dataTables.buttons.min.js" ></script>
<script src="../../js/datatables/buttons.html5.min.js" ></script>
<script src="../../js/datatables/buttons.flash.min.js" ></script>
<script src="../../js/datatables/jszip.min.js"></script>

<!-- 固定表头引入js文件 -->
<script src="../../js/datatables/dataTables.fixedHeader.min.js"></script>
 <!-- 固定表列引入js文件 -->
<script src="../../js/dataTables.fixedColumns.js"></script>
<script>
	
	var yugong=0;
	var chushe=0;
	var shishe=0;
    $(document).ready( function () {
        laydate.render({
            elem: '#this_time', //指定元素
            type:'month',
            value: new Date(), // 指定值
        });
        initSelect();
        initDepartment();
        initTable();
        initTableyfjd();
        initTable2();
        
        var mydate = new Date();
        /* var str = "" + mydate.getFullYear() + "年";
        str += (mydate.getMonth()+1) + "月"; */
        var str = mydate.getDate();
        var arr=[1,2,3,4,5,6,7,8,9,10];
        if(arr.indexOf(str)!=-1){
        	$("#tianbao").hide();
        }else{
        	$("#tianbao").show();
        }
	});
    
    $.fn.dataTable.Buttons.swfPath = '../../js/datatables/swf/flashExport.swf';
    var table=$('#mainContent').DataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 10,
        "sDom": 
			"t"+
			"<'dt-toolbar-footer'<'col-sm-6 col-xs-12 hidden-xs'i><'col-xs-12 col-sm-6'p>>",
        "searching": true,
        "lengthChange": false,
        "autoWidth": true,
        "sScrollX": true,
        "fixedColumns": {
	        "leftColumns": 1,
	    },
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
		            { "data": "taskNo"}, 
		            { "data": null}, 
		            { "data": "prjType"}, 
		            { "data": "prjMoney", render: $.fn.dataTable.render.number( ',', '.', 2, '' )}, 
		            { "data": "prjEstimateMoney", render: $.fn.dataTable.render.number( ',', '.', 2, '' )}, 
		            { "data": "contractMoney", render: $.fn.dataTable.render.number( ',', '.', 2, '' )}, 
		            { "data": "endMoney", render: $.fn.dataTable.render.number( ',', '.', 2, '' )},
		            { "data": "prjLeader"}, 
		            { "data": "thisTime"}, 
		            { "data": "prjStartTime"}, 
		            { "data": "prjEndTime"},
		            { "data": "allMoney"},
		            { "data": null},
		            { "data": null},
		            { "data": "jzqnMoney"},
		            { "data": "jnMoney"},
		            { "data": "modeStatus"},
		            { "data": null},
		        ],
		        "columnDefs": [
								{	
									 "class": "tcenter",
									  "targets": 1,
									  "searchable": true,
									  "render": function(data, type, full) {
											//return '<a onclick="gotoPrj(this)" style="color:#4876FF;cursor: pointer;">'+data.prjName+'</a>'
										  return '<a href="../chankanxiangqing/taskDetails.html?prjNo='
							    			+data.taskNo
							    			+'" target="_blank" style="color:blue;">'+data.prjName+'</a>';
								 	 }
								},
								{"targets":6,"visible":false},
								{"targets":14,"visible":false},
								{"targets":15,"visible":false},
								{	
									 "class": "tcenter",
									    "targets": 13,
									    "searchable": true,
									    "render": function(data, type, full) {
										    	if(full.backState=='1'){
										    		return '<span class="label label-success state">已收回</span>';
										    	}else{
										    		return '';
										    	}
									        }
									  },
								{	
										 "class": "tcenter",
										    "targets": 17,
										    "searchable": true,
										    "render": function(data, type, full) {
										    	return '<i class="iconfont icon-icon-test Peeb" style="font-size:20px;cursor:pointer;display:none;" title="查看详细信息" onclick="look(this)"></i>  <i class="glyphicon glyphicon-remove Peec" style="font-size:20px;cursor:pointer;display:none;" title="收回" onclick="shouhui(this)"></i>';
										        }
										  }
									  ,
								{	
										 "class": "tcenter",
										    "targets": 16,
										    "searchable": true,
										    "render": function(data, type, full) {
										    	    if(data=='2'){
											    		return '<span class="label label-success state">已通过</span>';
											    	}else if(data=='1'){
											    		return '<span class="label label-info state">审批中</span>';
											    	}else if(data=='0'){
											    		return '<span class="label label-danger state">终止</span>';
											    	}else{
											    		return '';
											    	}
										        }
										  },
									  {	
											 "class": "tcenter",
											    "targets": 12,
											    "searchable": true,
											    "render": function(data, type, full) {
												    	var shoru=0;
												    	var str=full.allMoney.replace("%","");
									    		        str= str/100;
											    		shoru=str*full.prjMoney;
												    	shoru=Math.round(shoru*100)/100
												    	return shoru.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
											        }
											  },
								],
								"fnDrawCallback" : function() {
									$.ajax({
				                		type:"post",
				                		url:getContextPath()+"/login/getUser",
				                		async:false,
				                		data:{
				                		},
				                		success:function(json){
				                			
				                			if(json!=null &&json!=""){
				                				var arr = json.uPermissions.split(',');
				                				
				                				for(var i=0;i<arr.length;i++){
				                					var arr2 = arr[i].replace("+","");
				                					//console.log(arr2);
				                					if(arr[i].indexOf("Peeb") >= 0 ){
				                						$(".Peeb").show();
				                					}
				                					if(arr[i].indexOf("Peec") >= 0 ){
				                						$(".Peec").show();
				                					}
				                				}
				                				
				                			}
				                			
				                		}
				                	});
									
								},
        "order": [[0, 'asc']],
        "oLanguage": { //国际化配置
            "sProcessing": "正在获取数据，请稍后...",
            "sLengthMenu": "显示 _MENU_ 条",
            "sZeroRecords": "查询不到相关数据",
            "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
            "sInfoEmpty": "记录数为0",
            "sInfoFiltered": "(全部记录数 _MAX_ 条)",
            "sInfoPostFix": "",
            "sSearch": "搜索",
            "sUrl": "",
            "oPaginate": {
                "sFirst": "第一页",
                "sPrevious": "上一页",
                "sNext": "下一页",
                "sLast": "最后一页"
            }},
        "buttons": [
		        	{
		                extend: "excel",
		                text: "导出excel",
		                filename: '项目进度',
		                exportOptions: {
		                	format: {
		                        header: function ( data) {
		                            return data;
		                        },
		                        body: function ( data, columnIdx, rowIdx, code ) {
		                        	 if(rowIdx==1){
		                        		//data=$(code).find("a").eq(0).text();
		                        		 if(data!="无"){
			                        		var start = data.indexOf(">");
			                        		var end = data.lastIndexOf("<");
			                        		data = data.substring(start+1,end);
			                        	}
		                        	} 
		                        	 /* if(rowIdx==5){
		                        		var time=$(code).text();
		                        		var year=time.split("-")[0];
		                        		var month=time.split("-")[1];
		                        		data=year+"."+month;
		                        	}  */
					                return data;
					            }
		                    },
		                    columns:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]
		                }
		            }
		        ]
	});
    table.buttons().container().appendTo( $('#tabBtn') );
    $('.buttons-excel').addClass('btn btn-primary');
    

    
    var tableyfjd=$('#mainContentyfjd').DataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 10,
        "sDom": 
			"t"+
			"<'dt-toolbar-footer'<'col-sm-6 col-xs-12 hidden-xs'i><'col-xs-12 col-sm-6'p>>",
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
		            { "data": "taskNo"}, 
		            { "data": "prjName"}, 
		            { "data": "prjType"}, 
		            { "data": "prjMoney", render: $.fn.dataTable.render.number( ',', '.', 2, '' )}, 
		            { "data": "contractMoney", render: $.fn.dataTable.render.number( ',', '.', 2, '' )}, 
		            { "data": "prjLeader"}, 
		            { "data": "thisTime"}, 
		            { "data": "allMoneyYuan"},
		            { "data": "allMoney"},
		            { "data": null}
		        ],
		        "columnDefs": [
								/* {	
									 "class": "tcenter",
									  "targets": 1,
									  "searchable": true,
									  "render": function(data, type, full) {
											//return '<a onclick="gotoPrj(this)" style="color:#4876FF;cursor: pointer;">'+data.prjName+'</a>'
										  return '<a href="../chankanxiangqing/taskDetails.html?prjNo='
							    			+data.taskNo
							    			+'" target="_blank" style="color:blue;">'+data.prjName+'</a>';
								 	 }
								}, */
	
								{	
										 "class": "tcenter",
										    "targets": 9,
										    "searchable": false,
										    "render": function(data, type, full) {
										    	return '<i class="iconfont icon-icon-test Peeb" style="font-size:20px;cursor:pointer;display:none;" title="查看详细信息" onclick="look(this)"></i>';
										        }
										  }
								],
								"fnDrawCallback" : function() {
									$.ajax({
				                		type:"post",
				                		url:getContextPath()+"/login/getUser",
				                		async:false,
				                		data:{
				                		},
				                		success:function(json){
				                			
				                			if(json!=null &&json!=""){
				                				var arr = json.uPermissions.split(',');
				                				
				                				for(var i=0;i<arr.length;i++){
				                					var arr2 = arr[i].replace("+","");
				                					//console.log(arr2);
				                					if(arr[i].indexOf("Peeb") >= 0 ){
				                						$(".Peeb").show();
				                					}
				                				}
				                				
				                			}
				                			
				                		}
				                	});
									
								},
        "order": [[0, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }},
        "buttons": [
		        	{
		                extend: "excel",
		                text: "导出excel",
		                filename: '项目进度',
		                exportOptions: {
		                	format: {
		                        header: function ( data) {
		                            return data;
		                        },
		                        body: function ( data, columnIdx, rowIdx, code ) {
		                        /* 	if(rowIdx==1){
		                        		data=$(code).find("a").eq(0).text();
		                        	}
		                        	if(rowIdx==5){
		                        		var time=$(code).text();
		                        		var year=time.split("-")[0];
		                        		var month=time.split("-")[1];
		                        		data=year+"."+month;
		                        	} */
					                return data;
					            }
		                    },
		                    columns:[0,1,2,3,4,5,6,7,8]
		                }
		            }
		        ]
	});
    tableyfjd.buttons().container().appendTo( $('#tabBtnyfjd') );
    $('.buttons-excel').addClass('btn btn-primary');
    
    
    var table2=$('#mainContent2').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 10,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
					{ "data": "contractNo"},
		            { "data": "contractName"},
		            { "data": "contractMoney"},
		            { "data": "omName"},
		            { "data": "contractSignTime"},
		            { "data": "workInfo"}
		        ],
        "order": [[0, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }}
	});
    
    var table3=$('#xiangmubiao').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 10,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
					{ "data": null},
		            { "data": "prjNo"},
		            { "data": "prjName"},
		            { "data": "prjCompany"},
		            { "data": "prjType2"},
		            { "data": "ccName"},
		            
		        ],
		        "columnDefs": [
								{
										 "class": "tcenter",
										    "targets": 0,
										    "searchable": true,
										    "render": function(data, type, full) {
										  	  		return '<input type="radio" name="xiangmuName" style="width:16px;height:16px;">'
										        }
										  }
								],
        "order": [[1, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }}
        
	});
  //选部门选人
    var bmtableren=$('#bmmingzibiao').dataTable({
        "deferRender": true,
        "processing": true,
        "bDestroy": true,
        "iDisplayLength": 10,
        "searching": true,
        "lengthChange": false,
        "oLanguage": {
		    "sSearch": '<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>'
		},
		"columns": [
					{ "data": null}, 
		            { "data": "uName"}, 
		            { "data": "workId"},
		            { "data": "birthday"}, 
		            { "data": "sex"}, 
		            { "data": "dutyName"}, 
		        ],
		        "columnDefs": [
								{	
										 "class": "tcenter",
										    "targets": 0,
										    "searchable": true,
										    "render": function(data, type, full) {
										  	  		return '<input type="radio" name="mingzi2" style="width:16px;height:16px;">'
										        }
										  }
								],
        "order": [[2, 'asc']],
        "oLanguage": { //国际化配置
        "sProcessing": "正在获取数据，请稍后...",
        "sLengthMenu": "显示 _MENU_ 条",
        "sZeroRecords": "查询不到相关数据",
        "sInfo": "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
        "sInfoEmpty": "记录数为0",
        "sInfoFiltered": "(全部记录数 _MAX_ 条)",
        "sInfoPostFix": "",
        "sSearch": "搜索",
        "sUrl": "",
        "oPaginate": {
            "sFirst": "第一页",
            "sPrevious": "上一页",
            "sNext": "下一页",
            "sLast": "最后一页"
        }}
        
	});
  
    $("#searchData").on("input", function(e){
		var d = $("#searchData").val();
		$("#mainContent").DataTable().search(d).draw(true);
	});
    
    $("#searchData3").on("input", function(e){
		var d = $("#searchData3").val();
		$("#mainContentyfjd").DataTable().search(d).draw(true);
	});
    
	function initTable(){
        $.ajax({
            type: 'POST',
            url: getContextPath()+'/ppf/selectPrjProgressFill',
            dataType: 'json',
            data: {
            	status:2
            },
            success: function (json) {
                $('#mainContent').dataTable().fnClearTable();
                $('#mainContent').DataTable().rows.add(json).draw(false);
                //$("#mainContent_wrapper").find("table [role='grid']").eq(0).prop("style","margin-top: -0.5px !IMPORTANT;");
                $(".DTFC_Cloned").prop("style","margin-top: -0.5px !IMPORTANT;");
                $("[aria-label*='状态']").trigger("click");
            }
        });
    }
	
	function initTableyfjd(){
        $.ajax({
            type: 'POST',
            url: getContextPath()+'/ppf/selectPrjProgressFill',
            dataType: 'json',
            data: {
            	status:2
            },
            success: function (json) {
                $('#mainContentyfjd').dataTable().fnClearTable();
                $('#mainContentyfjd').DataTable().rows.add(json).draw(false);
                $('input[aria-controls="mainContentyfjd"]').attr("id","serchThisTime");
                laydate.render({
                    elem: '#yuefenshaixuan2' //指定元素
                   ,type: 'month'
               	   ,done: function(value, date, endDate){
        	       		 var d = value;
        	     		$("#mainContentyfjd").DataTable().search(d).draw(true);
               		  }
                }); 
            }
        });
    }
	$('input[aria-controls="mainContentyfjd"]').change()
	
	function initTable2(){
        $.ajax({
            type: 'POST',
            url: getContextPath()+'/ppf/initTable2',
            dataType: 'json',
            data: {
            },
            success: function (json) {
                $('#mainContent2').dataTable().fnClearTable();
                $('#mainContent2').DataTable().rows.add(json).draw(false);
            }
        });
    }
	
	//初始化收货人部门及人员
	function initDepartment(){
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/organizationManagement/getOrgIdAndName',
            dataType: 'json',
            data: {
            },
            success: function (json) {
            	for(var i=0;i<json.length;i++){
	            	$("#bumen").append("<option value='"+json[i].omId+"'>" + json[i].omName+ "</option>");
	            	$("#xgbumen").append("<option value='"+json[i].omId+"'>" + json[i].omName+ "</option>");
            	}
            	$("#bumen").trigger('change');
	        	$("#xgbumen").trigger('change');
            }
        });
	}
	$("#bumen").change(function(){
		var bumen=$("#bumen").val();
		$('#addGuanliren').on('hidden.bs.modal', function () {//解决模态框页面滚动问题
            if ($('.modal.in').size() >= 1) {
                $('body').addClass('modal-open')
            }
        })
		$.ajax({
			type:"POST",
			url:getContextPath()+"/user/selectUserByomId",
			dataType:"json",
			async:false,
			data:{ 
				omId:bumen 
				},
			success:function(json){
				$('#bmmingzibiao').dataTable().fnClearTable();
                $('#bmmingzibiao').DataTable().rows.add(json).draw(false);
			}
		})
	})
	//保存添加保管人
	function saveGuanliren(){
		var tr=$("input[name='mingzi2']:checked").parents("tr");
		var data=$("#bmmingzibiao").DataTable().row(tr).data();
		
		//console.log(data)
		$("#prj_leader").val(data.uName);
		//$("#addGuanliren").modal("hide");
	}

	
	//选择项目
	$("#chosexm").click(function(){
		$("#xiangmumd").modal("show");
		 $.ajax({
	            type: 'POST',
	            url: getContextPath()+'/task/selectPrjNameAndWorkNo',
	            dataType: 'json',
	            async:false,
	            data: {
	            },
	            success: function (json) {
	            	//console.log(json)
	                $('#xiangmubiao').dataTable().fnClearTable();
	                $('#xiangmubiao').DataTable().rows.add(json).draw(false);
	            }
	        });
		 $('#xiangmumd').on('hidden.bs.modal', function () {//解决模态框关闭页面滚动问题
	            if ($('.modal.in').size() >= 1) {
	                $('body').addClass('modal-open')
	            }
	        })
		 
	})
	$("#quedingxm").click(function(){
		var tr=$('input[name="xiangmuName"]:checked').parents("tr");
		var data=$('#xiangmubiao').DataTable().row(tr).data();
		$("#prjName").val(data.prjName);
		$("#task_no").val(data.prjNo);
		$("#prjType2").val(data.prjType2);
		$("#prj_mode").val(data.prjManagementModel);
		yugong=data.yugongkebili;
		chushe=data.chushebili;
		shishe=data.shishebili;
		$("#xiangmumd").modal("hide");
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/subcontract/selectFbContractByTaskNo',
            dataType: 'json',
            data: {
            	no:data.prjNo
            },
            success: function (json) {
            	$("#fb_table tbody").html('');
            	for(var i=0;i<json.length;i++){
            		$("#fb_table tbody").append("<tr>"
		            													+"<td>"+json[i].contractName+"</td>"
		            													+"<td>"+json[i].omName+"</td>"
		            													+"<td>"+json[i].contractMoney+"</td>"
		            													+"<td>"+json[i].ccName+"</td>"
		            													+"<td><input type='text' data="+json[i].fbNo+" class='form-control' onchange='getFbBq(this)' placeholder='请填整数' style='width:100%;'></td>"
		            													+"<td><input type='text' data="+json[i].fbNo+" class='form-control' style='width:100%;' disabled></td>"
		            													+"<td><input type='text' class='form-control' style='width:100%;' disabled></td>"
		            													+"<td><input type='text' class='form-control' onchange='getRate(this)' style='width:100%;' placeholder='请填整数'></td>"
		            													+"<td><input type='text' class='form-control' style='width:100%;' disabled></td>"
		            												+"</tr>")
            	}
            }
		})
		
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/ppf/selectAllByName',
            dataType: 'json',
            data: {
            	name:$('#prjName').val()
            },
            success: function (json) {
            	var task=json.task;
            	var bf=json.bf;
            	var cj=json.cj;
            	if(cj!=null){
            		$("#contract_name").val(cj.contractName)
                	$("#contract_no").val(cj.contractNo)
            	}else{
            		$("#contract_name").val("")
                	$("#contract_no").val("")
            	}
            	    $('#prjMoney').val(task.prjEstimateMoney)
                	$('#contractMoney').val(task.contractMoney);
                	$('#provisional_sum').val(task.provisionalSum);
                	$('#prj_start_time').val(task.prjStartTime);
                	$('#prj_end_time').val(task.prjEndTime);
                	$('#prj_leader').val(task.mainPrjLeaderName);
                	if(bf!=""&&bf!=null){
                		$('#budget_money_all').val(bf.allCost);
                	}else{
                		$('#budget_money_all').val(0);
                	}
                	
                	$("#all_money").val('');
                	$("#all_money_yuan").val('');
                	$("#this_time_money_yuan").val('');
                	$("#xieban1 tbody").empty();
                	
                	$("#xieban1 tbody").append("<tr><td style='width:10%;'>"
            				+"主办部门"
            				+"</td><td style='width:15%;'>"
                			+task.omName
                			+"</td><td style='width:10%;'>"
                			+"本期收入(%)"
                			+"</td><td style='width:15%;'>"
                			+"<input type='text' data='1' class='form-control' style='width:80%;' onchange='getYuan(this)'>"
                			+"</td><td style='width:10%;'>"
                			+"本期收入(元)"
                			+"</td><td style='width:15%;'>"
                			+"<input type='text' data='1' class='form-control' style='width:80%;' disabled>"
                			+"</td><td style='width:10%;'>"
                			+"累计收入(元)"
                			+"</td><td style='width:15%;'>"
                			+"<input type='text' data='1' class='form-control' style='width:80%;' disabled>"
                			+"</td></tr>")
                	
                			
                	if(task.name1!=null){
                		$("#xieban1 tbody").append("<tr><td>"
                				+"协办部门"
                				+"</td><td>"
                    			+task.name1
                    			+"</td><td>"
                    			+"本期收入(%)"
                    			+"</td><td>"
                    			+"<input type='text' data='0'  class='form-control' style='width:80%;' onchange='getYuan(this)'>"
                    			+"</td><td>"
                    			+"本期收入(元)"
                    			+"</td><td>"
                    			+"<input type='text' data='0'  class='form-control' style='width:80%;' disabled>"
                    			+"</td><td>"
                    			+"累计收入(元)"
                    			+"</td><td>"
                    			+"<input type='text' data='0'  class='form-control' style='width:80%;' disabled>"
                    			+"</td></tr>")
                	}
                	
					if(task.name2!=null){
						$("#xieban1 tbody").append("<tr><td>"
                				+"协办部门"
                				+"</td><td>"
                    			+task.name2
                    			+"</td><td>"
                    			+"本期收入(%)"
                    			+"</td><td>"
                    			+"<input type='text' data='0' class='form-control' style='width:80%;' onchange='getYuan(this)'>"
                    			+"</td><td>"
                    			+"本期收入(元)"
                    			+"</td><td>"
                    			+"<input type='text' data='0' class='form-control' style='width:80%;' disabled>"
                    			+"</td><td>"
                    			+"本期收入(元)"
                    			+"</td><td>"
                    			+"<input type='text' data='0' class='form-control' style='width:80%;' disabled>"
                    			+"</td></tr>")
                	}
					
					if(task.name3!=null){
						$("#xieban1 tbody").append("<tr><td>"
                				+"协办部门"
                				+"</td><td>"
                    			+task.name3
                    			+"</td><td>"
                    			+"本期收入(%)"
                    			+"</td><td>"
                    			+"<input type='text' data='0' class='form-control' style='width:80%;' onchange='getYuan(this)'>"
                    			+"</td><td>"
                    			+"本期收入(元)"
                    			+"</td><td>"
                    			+"<input type='text' data='0' class='form-control' style='width:80%;' disabled>"
                    			+"</td><td>"
                    			+"本期收入(元)"
                    			+"</td><td>"
                    			+"<input type='text' data='0' class='form-control' style='width:80%;' disabled>"
                    			+"</td></tr>")
                	}
            }
  		});
		
	})
	
	function getFbBq(obj){
		var all=$(obj).val();
		var reg=/^([1-9]\d?|100)$/;
    	if(!reg.test(all)){
    		toastr.error('请填写1-100');
    		$(obj).val('');
    		return;
    	}
    	var fbMoney=$(obj).parents("tr").find("td").eq(2).text();
    	var allMoney=(fbMoney*all/100).toFixed(2);
		var fbId=$(obj).attr("data");
		$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/ppf/selectPrjProgressFillFbByFbId',
	        dataType: 'json',
	        data: {
	        	id:fbId
	        },
	        success: function (json) {
	        	var last=0;
	        	if(json!=null&&json!=''){
	        		last=json;
	        	}
	        	$(obj).parents("tr").find("input").eq(1).val(allMoney);
	        	$(obj).parents("tr").find("input").eq(2).val(allMoney-last);
	        }
		});
	}
	
	function getYuan(obj){
		$(obj).val($(obj).val().replace("%","")+"%");
		var contractMoney=$("#contractMoney").val();
		var this_time_money_yuan=$("#this_time_money_yuan").val();
		if(this_time_money_yuan==''){
			toastr.error("请选择累计收入（%）");
			$(obj).val('');
			return;
		}
		
		var plan=$(obj).val().replace("%","");
		console.log(plan)
		$(obj).parents("tr").find("input").eq(1).val(plan*this_time_money_yuan/100);//当期累计收入(元)赋值
		//getTotalMoney($(obj).parents("tr"),$("#task_no").val(),$(obj).parents("tr").find("td").eq(1).text(),plan*this_time_money_yuan/100);
		var all_money_yuan=$("#all_money_yuan").val();//累计收入(元)(项目收入信息)
		getLeijishouru($(obj).parents("tr"),all_money_yuan,plan/100);
		
		var length=$(obj).parents("tr").index();
		var trLength=$("#xieban1 tbody").find("tr").length;
		if(trLength-length==2){
			var allPlan=0;
			$("#xieban1 tbody").find("tr").each(function(){
				var plan2=$(this).find("input").eq(0).val().replace("%","");
				if(plan2==''){
					return;
				}
				allPlan=allPlan+parseInt(plan2);
			})
			if(allPlan>100){
				toastr.error("拆分比例超过100%");
				return;
			}
			var endPlan=100-allPlan;
			var endMoney=endPlan*this_time_money_yuan/100;
			$(obj).parents("tr").next("tr").find("input").eq(0).val(endPlan+"%")
			$(obj).parents("tr").next("tr").find("input").eq(1).val(endMoney)
			//getTotalMoney($(obj).parents("tr").next("tr"),$("#task_no").val(),$(obj).parents("tr").next("tr").find("td").eq(1).text(),endMoney);
			getLeijishouru($(obj).parents("tr").next("tr"),all_money_yuan,endPlan/100);
		}
	}
	
	/* obj:操作对象   obj2:任务单号 obj3:部门名称 obj4:本期收入(元) */
	/* function getTotalMoney(obj,obj2,obj3,obj4){
		$.ajax({
	        type: 'POST',
	        url: getContextPath()+'/ppf/selectPrjProgressFillInfoTotalByTaskAndDept',
	        dataType: 'json',
	        data: {
	        	no:obj2,
	        	dept:obj3
	        },
	        success: function (json) {
	        	$(obj).find("input").eq(2).val(parseFloat(json)+parseFloat(obj4));
	        }
		})
	} */
	//obj:操作对象   obj2:累计收入(元)(项目收入信息);obj3:部门本期收入百分比
	function getLeijishouru(obj,obj2,obj3){
		$(obj).find("input").eq(2).val(parseFloat(obj2*obj3))
	}
	
	//初始化项目名称
	function initSelect(){
		$.ajax({
        type: 'POST',
        url: getContextPath()+'/task/selectPrjNameAndWorkNo',
        dataType: 'json',
        data: {
        },
        error: function (msg) {
        	toastr.error("请求失败");
        },
        success: function (json) {
        	$("#prjName").html('');
        	$("#task_no").html('');
        	$("#xgprjName").html('');
        	$("#xgtask_no").html('');
        	for(var i=0;i<json.length;i++){
        		//$("#prjName").append("<option value="+json[i].prjName+">"+json[i].prjName+"</option>");
        		$("#task_no").append("<option value="+json[i].prjNo+">"+json[i].prjNo+"</option>");
        		//$("#xgprjName").append("<option value="+json[i].prjName+">"+json[i].prjName+"</option>");
        		$("#xgtask_no").append("<option value="+json[i].prjNo+">"+json[i].prjNo+"</option>");
        	}
        	/* $('#prjName').editableSelect().on('select.editable-select', function (e, dom) {
        		$.ajax({
                    type: 'POST',
                    url: getContextPath()+'/ppf/selectAllByName',
                    dataType: 'json',
                    data: {
                    	name:$('#prjName').val()
                    },
                    success: function (json) {
                    	var task=json.task;
                    	var bf=json.bf;
                    	var cj=json.cj;
	                    	$('#task_no').val(task.prjNo);
                    	    $('#prjType2').val(task.prjType2);
	                    	$('#contractMoney').val(task.contractMoney);
	                    	$('#provisional_sum').val(task.provisionalSum);
	                    	$('#prj_start_time').val(task.prjStartTime);
	                    	$('#prj_end_time').val(task.prjEndTime);
	                    	$('#budget_money_all').val(bf.allCost);
	                    	
	                    	$("#xieban1 tbody").empty();
	                    	$("#xieban2 tbody").empty();
	                    	$("#xieban3 tbody").empty();
	                    	$("#xieban4 tbody").empty();
	                    	$("#xieban5 tbody").empty();
	                    	$("#xieban6 tbody").empty();
	                    	
	                    	$("#xieban1 tbody").append("<tr><td style='width:20%;'>"
                    				+"主办部门"
                    				+"</td><td style='width:20%;'>"
	                    			+task.omName
	                    			+"</td><td style='width:10%;'>"
	                    			+"金额"
	                    			+"</td><td style='width:50%;'>"
	                    			+"<input type='text' data='1' class='form-control'> &nbsp&nbsp<button type='button' onclick='getBq(this)' class='btn btn-default'>计算本期</button>"
	                    			+"</td></tr>")
	                    	$("#xieban2 tbody").append("<tr><td style='width:20%;'>"
	                    			+"主办部门"
                    				+"</td><td style='width:20%;'>"
	                    			+task.omName
	                    			+"</td><td style='width:10%;'>"
	                    			+"金额"
	                    			+"</td><td style='width:50%;'>"
	                    			+"<input type='text' data='1'  id='zb2' class='form-control' disabled>"
	                    			+"</td></tr>")
	                    	$("#xieban3 tbody").append("<tr><td style='width:20%;'>"
	                    			+"主办部门"
                    				+"</td><td style='width:20%;'>"
	                    			+task.omName
	                    			+"</td><td style='width:10%;'>"
	                    			+"金额"
	                    			+"</td><td style='width:50%;'>"
	                    			+"<input type='text' data='1' class='form-control'>"
	                    			+"</td></tr>")
	                    	$("#xieban4 tbody").append("<tr><td style='width:20%;'>"
	                    			+"主办部门"
                    				+"</td><td style='width:20%;'>"
	                    			+task.omName
	                    			+"</td><td style='width:10%;'>"
	                    			+"金额"
	                    			+"</td><td style='width:50%;'>"
	                    			+"<input type='text' data='1' class='form-control'>"
	                    			+"</td></tr>")
	                    	$("#xieban5 tbody").append("<tr><td style='width:20%;'>"
	                    			+"主办部门"
                    				+"</td><td style='width:20%;'>"
	                    			+task.omName
	                    			+"</td><td style='width:10%;'>"
	                    			+"金额"
	                    			+"</td><td style='width:50%;'>"
	                    			+"<input type='text' data='1' class='form-control'>"
	                    			+"</td></tr>")
	                    	$("#xieban6 tbody").append("<tr><td style='width:20%;'>"
	                    			+"主办部门"
                    				+"</td><td style='width:20%;'>"
	                    			+task.omName
	                    			+"</td><td style='width:10%;'>"
	                    			+"金额"
	                    			+"</td><td style='width:50%;'>"
	                    			+"<input type='text' data='1' class='form-control'>"
	                    			+"</td></tr>")
	                    	
	                    	if(task.name1!=null){
	                    		$("#xieban1 tbody").append("<tr><td>"
	                    				+"协办部门"
	                    				+"</td><td>"
		                    			+task.name1
		                    			+"</td><td>"
		                    			+"金额"
		                    			+"</td><td>"
		                    			+"<input type='text' data='0'  class='form-control'> &nbsp&nbsp<button type='button' onclick='getBq1(this)' class='btn btn-default'>计算本期</button>"
		                    			+"</td></tr>")
		                    	$("#xieban2 tbody").append("<tr><td>"
		                    			+"协办部门"
	                    				+"</td><td>"
		                    			+task.name1
		                    			+"</td><td>"
		                    			+"金额"
		                    			+"</td><td>"
		                    			+"<input type='text' data='0' id='xb1_1' class='form-control' disabled>"
		                    			+"</td></tr>")
		                    	$("#xieban3 tbody").append("<tr><td>"
		                    			+"协办部门"
	                    				+"</td><td>"
		                    			+task.name1
		                    			+"</td><td>"
		                    			+"金额"
		                    			+"</td><td>"
		                    			+"<input type='text' data='0' class='form-control'>"
		                    			+"</td></tr>")
		                    	$("#xieban4 tbody").append("<tr><td>"
		                    			+"协办部门"
	                    				+"</td><td>"
		                    			+task.name1
		                    			+"</td><td>"
		                    			+"金额"
		                    			+"</td><td>"
		                    			+"<input type='text' data='0' class='form-control'>"
		                    			+"</td></tr>")
		                    	$("#xieban5 tbody").append("<tr><td>"
		                    			+"协办部门"
	                    				+"</td><td>"
		                    			+task.name1
		                    			+"</td><td>"
		                    			+"金额"
		                    			+"</td><td>"
		                    			+"<input type='text' data='0' class='form-control'>"
		                    			+"</td></tr>")
		                    	$("#xieban6 tbody").append("<tr><td>"
		                    			+"协办部门"
	                    				+"</td><td>"
		                    			+task.name1
		                    			+"</td><td>"
		                    			+"金额"
		                    			+"</td><td>"
		                    			+"<input type='text' data='0' class='form-control'>"
		                    			+"</td></tr>")
	                    	}
	                    	
							if(task.name2!=null){
								$("#xieban1 tbody").append("<tr><td>"
	                    				+"协办部门"
	                    				+"</td><td>"
		                    			+task.name2
		                    			+"</td><td>"
		                    			+"金额"
		                    			+"</td><td>"
		                    			+"<input type='text' data='0' class='form-control'> &nbsp&nbsp<button type='button' onclick='getBq2(this)' class='btn btn-default'>计算本期</button>"
		                    			+"</td></tr>")
		                    	$("#xieban2 tbody").append("<tr><td>"
		                    			+"协办部门"
	                    				+"</td><td>"
		                    			+task.name2
		                    			+"</td><td>"
		                    			+"金额"
		                    			+"</td><td>"
		                    			+"<input type='text' data='0' id='xb2_2' class='form-control' disabled>"
		                    			+"</td></tr>")
		                    	$("#xieban3 tbody").append("<tr><td>"
		                    			+"协办部门"
	                    				+"</td><td>"
		                    			+task.name2
		                    			+"</td><td>"
		                    			+"金额"
		                    			+"</td><td>"
		                    			+"<input type='text' data='0' class='form-control'>"
		                    			+"</td></tr>")
		                    	$("#xieban4 tbody").append("<tr><td>"
		                    			+"协办部门"
	                    				+"</td><td>"
		                    			+task.name2
		                    			+"</td><td>"
		                    			+"金额"
		                    			+"</td><td>"
		                    			+"<input type='text' data='0' class='form-control'>"
		                    			+"</td></tr>")
		                    	$("#xieban5 tbody").append("<tr><td>"
		                    			+"协办部门"
	                    				+"</td><td>"
		                    			+task.name2
		                    			+"</td><td>"
		                    			+"金额"
		                    			+"</td><td>"
		                    			+"<input type='text' data='0' class='form-control'>"
		                    			+"</td></tr>")
		                    	$("#xieban6 tbody").append("<tr><td>"
		                    			+"协办部门"
	                    				+"</td><td>"
		                    			+task.name2
		                    			+"</td><td>"
		                    			+"金额"
		                    			+"</td><td>"
		                    			+"<input type='text' data='0' class='form-control'>"
		                    			+"</td></tr>")
	                    	}
							
							if(task.name3!=null){
								$("#xieban1 tbody").append("<tr><td>"
	                    				+"协办部门"
	                    				+"</td><td>"
		                    			+task.name3
		                    			+"</td><td>"
		                    			+"金额"
		                    			+"</td><td>"
		                    			+"<input type='text' data='0' class='form-control'> &nbsp&nbsp<button type='button' onclick='getBq3(this)' class='btn btn-default'>计算本期</button>"
		                    			+"</td></tr>")
		                    	$("#xieban2 tbody").append("<tr><td>"
		                    			+"协办部门"
	                    				+"</td><td>"
		                    			+task.name3
		                    			+"</td><td>"
		                    			+"金额"
		                    			+"</td><td>"
		                    			+"<input type='text' data='0' id='xb3_3' class='form-control' disabled>"
		                    			+"</td></tr>")
		                    	$("#xieban3 tbody").append("<tr><td>"
		                    			+"协办部门"
	                    				+"</td><td>"
		                    			+task.name3
		                    			+"</td><td>"
		                    			+"金额"
		                    			+"</td><td>"
		                    			+"<input type='text' data='0' class='form-control'>"
		                    			+"</td></tr>")
		                    	$("#xieban4 tbody").append("<tr><td>"
		                    			+"协办部门"
	                    				+"</td><td>"
		                    			+task.name3
		                    			+"</td><td>"
		                    			+"金额"
		                    			+"</td><td>"
		                    			+"<input type='text' data='0' class='form-control'>"
		                    			+"</td></tr>")
		                    	$("#xieban5 tbody").append("<tr><td>"
		                    			+"协办部门"
	                    				+"</td><td>"
		                    			+task.name3
		                    			+"</td><td>"
		                    			+"金额"
		                    			+"</td><td>"
		                    			+"<input type='text' data='0' class='form-control'>"
		                    			+"</td></tr>")
		                    	$("#xieban6 tbody").append("<tr><td>"
		                    			+"协办部门"
	                    				+"</td><td>"
		                    			+task.name3
		                    			+"</td><td>"
		                    			+"金额"
		                    			+"</td><td>"
		                    			+"<input type='text' data='0' class='form-control'>"
		                    			+"</td></tr>")
	                    	}
	                    	
							$("#cj_table tbody").html('');
							for(var i=0;i<cj.length;i++){
								$("#cj_table tbody").append("<tr>"+
																					"<td>"+cj[i].contractName+"</td>"+
																					"<td>"+cj[i].contractMoney+"</td>"+
																					"<td>"+cj[i].temporaryMoney+"</td>"+
																					"<td><input style='width:90%;' type='text' class='form-control' disabled></td>"+
																					"<td><input data="+cj[i].cjId+"  style='width:90%;' type='text' class='form-control'></td>"+
																					"<td><button type='button' onclick='cjBq(this)' class='btn btn-default'>计算合同本期</button></td>"+
																				"</tr>")
							}
							
                    }
          		});
          	}) */
          	$('#task_no').editableSelect().on('select.editable-select', function (e, dom) {
          		$.ajax({
                    type: 'POST',
                    url: getContextPath()+'/ppf/selectAllByNo',
                    dataType: 'json',
                    data: {
                    	no:$('#task_no').val()
                    },
                    success: function (json) {
                    	$.ajax({
                            type: 'POST',
                            url: getContextPath()+'/subcontract/selectFbContractByTaskNo',
                            dataType: 'json',
                            data: {
                            	no:$('#task_no').val()
                            },
                            success: function (json) {
                            	$("#fb_table tbody").html('');
                            	for(var i=0;i<json.length;i++){
                            		$("#fb_table tbody").append("<tr>"
											+"<td>"+json[i].contractName+"</td>"
											+"<td>"+json[i].omName+"</td>"
											+"<td>"+json[i].contractMoney+"</td>"
											+"<td>"+json[i].ccName+"</td>"
											+"<td><input type='text' data="+json[i].fbNo+" class='form-control' onchange='getFbBq(this)' placeholder='请填整数' style='width:80%;'></td>"
											+"<td><input type='text' data="+json[i].fbNo+" class='form-control' style='width:80%;' disabled></td>"
											+"<td><input type='text' class='form-control' style='width:80%;' disabled></td>"
											+"<td><input type='text' class='form-control' onchange='getRate(this)' style='width:100%;' placeholder='请填整数'></td>"
											+"<td><input type='text' class='form-control' style='width:100%;' disabled></td>"
										+"</tr>")
                            	}
                            }
                		})
                    	
                    	var task=json.task;
                    	var bf=json.bf;
                    	var cj=json.cj;
                    	yugong=task.yugongkebili;
                		chushe=task.chushebili;
                		shishe=task.shishebili;
                		if(cj!=null){
                			$("#contract_name").val(cj.contractName)
                    		$("#contract_no").val(cj.contractNo)
                		}else{
                			$("#contract_name").val("")
                    		$("#contract_no").val("")
                		}
                    	$('#prjName').val(task.prjName);
                    	$('#prjType2').val(task.prjType2);
                    	$('#prjMoney').val(task.prjEstimateMoney);
                    	$('#contractMoney').val(task.contractMoney);
                    	$('#provisional_sum').val(task.provisionalSum);
                    	$('#prj_start_time').val(task.prjStartTime);
                    	$('#prj_end_time').val(task.prjEndTime);
                    	$('#prj_leader').val(task.mainPrjLeaderName);
                    	$("#prj_mode").val(task.prjManagementModel);
                    	if(bf!=null&&bf!=''){
                    		$('#budget_money_all').val(bf.allCost);
                    	}else{
                    		$('#budget_money_all').val(0);
                    	}
	                    	
	                    	$("#all_money").val('');
	                    	$("#xieban1 tbody").empty();
	                    	/* $("#xieban2 tbody").empty(); */
	                    	/* $("#xieban3 tbody").empty();
	                    	$("#xieban4 tbody").empty();
	                    	$("#xieban5 tbody").empty();
	                    	$("#xieban6 tbody").empty(); */
	                    	
	                    	
	                    	
	                    	$("#xieban1 tbody").append("<tr><td style='width:10%;'>"
	                				+"主办部门"
	                				+"</td><td style='width:15%;'>"
	                    			+task.omName
	                    			+"</td><td style='width:10%;'>"
	                    			+"本期收入(%)"
	                    			+"</td><td style='width:15%;'>"
	                    			+"<input type='text' data='1' class='form-control' style='width:80%;' onchange='getYuan(this)'>"
	                    			+"</td><td style='width:10%;'>"
	                    			+"本期收入(元)"
	                    			+"</td><td style='width:15%;'>"
	                    			+"<input type='text' data='1' class='form-control' style='width:80%;' disabled>"
	                    			+"</td><td style='width:10%;'>"
	                    			+"累计收入(元)"
	                    			+"</td><td style='width:15%;'>"
	                    			+"<input type='text' data='1' class='form-control' style='width:80%;' disabled>"
	                    			+"</td></tr>")
	                    	/* $("#xieban2 tbody").append("<tr><td style='width:15%;'>"
	                    			+"主办部门"
	                				+"</td><td style='width:20%;'>"
	                    			+task.omName
	                    			+"</td><td style='width:15%;'>"
	                    			+"本期收入(%)"
	                    			+"</td><td style='width:15%;'>"
	                    			+"<input type='text' data='1' class='form-control' style='width:80%;'>"
	                    			+"</td><td style='width:15%;'>"
	                    			+"本期收入(元)"
	                    			+"</td><td style='width:20%;'>"
	                    			+"<input type='text' data='1' class='form-control' style='width:80%;'>"
	                    			+"</td></tr>") */
	                    	/* $("#xieban3 tbody").append("<tr><td style='width:20%;'>"
	                    			+"主办部门"
	                				+"</td><td style='width:20%;'>"
	                    			+task.omName
	                    			+"</td><td style='width:10%;'>"
	                    			+"金额"
	                    			+"</td><td style='width:50%;'>"
	                    			+"<input type='text' data='1' class='form-control'>"
	                    			+"</td></tr>")
	                    	$("#xieban4 tbody").append("<tr><td style='width:20%;'>"
	                    			+"主办部门"
	                				+"</td><td style='width:20%;'>"
	                    			+task.omName
	                    			+"</td><td style='width:10%;'>"
	                    			+"金额"
	                    			+"</td><td style='width:50%;'>"
	                    			+"<input type='text' data='1' class='form-control'>"
	                    			+"</td></tr>")
	                    	$("#xieban5 tbody").append("<tr><td style='width:20%;'>"
	                    			+"主办部门"
	                				+"</td><td style='width:20%;'>"
	                    			+task.omName
	                    			+"</td><td style='width:10%;'>"
	                    			+"金额"
	                    			+"</td><td style='width:50%;'>"
	                    			+"<input type='text' data='1' class='form-control'>"
	                    			+"</td></tr>")
	                    	$("#xieban6 tbody").append("<tr><td style='width:20%;'>"
	                    			+"主办部门"
	                				+"</td><td style='width:20%;'>"
	                    			+task.omName
	                    			+"</td><td style='width:10%;'>"
	                    			+"金额"
	                    			+"</td><td style='width:50%;'>"
	                    			+"<input type='text' data='1' class='form-control'>"
	                    			+"</td></tr>") */
	                    	
	                    	if(task.name1!=null){
	                    		$("#xieban1 tbody").append("<tr><td>"
	                    				+"协办部门"
	                    				+"</td><td>"
	                        			+task.name1
	                        			+"</td><td>"
	                        			+"本期收入(%)"
	                        			+"</td><td>"
	                        			+"<input type='text' data='0'  class='form-control' style='width:80%;' onchange='getYuan(this)'>"
	                        			+"</td><td>"
	                        			+"本期收入(元)"
	                        			+"</td><td>"
	                        			+"<input type='text' data='0'  class='form-control' style='width:80%;' disabled>"
	                        			+"</td><td>"
	                        			+"累计收入(元)"
	                        			+"</td><td>"
	                        			+"<input type='text' data='0'  class='form-control' style='width:80%;' disabled>"
	                        			+"</td></tr>")
	                        	/* $("#xieban2 tbody").append("<tr><td>"
	                        			+"协办部门"
	                    				+"</td><td>"
	                        			+task.name1
	                        			+"</td><td>"
	                        			+"本期收入(%)"
	                        			+"</td><td>"
	                        			+"<input type='text' data='0'  class='form-control' style='width:80%;'>"
	                        			+"</td><td>"
	                        			+"本期收入(元)"
	                        			+"</td><td>"
	                        			+"<input type='text' data='0'  class='form-control' style='width:80%;'>"
	                        			+"</td></tr>") */
	                        	/* $("#xieban3 tbody").append("<tr><td>"
	                        			+"协办部门"
	                    				+"</td><td>"
	                        			+task.name1
	                        			+"</td><td>"
	                        			+"金额"
	                        			+"</td><td>"
	                        			+"<input type='text' data='0' class='form-control'>"
	                        			+"</td></tr>")
	                        	$("#xieban4 tbody").append("<tr><td>"
	                        			+"协办部门"
	                    				+"</td><td>"
	                        			+task.name1
	                        			+"</td><td>"
	                        			+"金额"
	                        			+"</td><td>"
	                        			+"<input type='text' data='0' class='form-control'>"
	                        			+"</td></tr>")
	                        	$("#xieban5 tbody").append("<tr><td>"
	                        			+"协办部门"
	                    				+"</td><td>"
	                        			+task.name1
	                        			+"</td><td>"
	                        			+"金额"
	                        			+"</td><td>"
	                        			+"<input type='text' data='0' class='form-control'>"
	                        			+"</td></tr>")
	                        	$("#xieban6 tbody").append("<tr><td>"
	                        			+"协办部门"
	                    				+"</td><td>"
	                        			+task.name1
	                        			+"</td><td>"
	                        			+"金额"
	                        			+"</td><td>"
	                        			+"<input type='text' data='0' class='form-control'>"
	                        			+"</td></tr>") */
	                    	}
	                    	
	    					if(task.name2!=null){
	    						$("#xieban1 tbody").append("<tr><td>"
	                    				+"协办部门"
	                    				+"</td><td>"
	                        			+task.name2
	                        			+"</td><td>"
	                        			+"本期收入(%)"
	                        			+"</td><td>"
	                        			+"<input type='text' data='0' class='form-control' style='width:80%;' onchange='getYuan(this)'>"
	                        			+"</td><td>"
	                        			+"本期收入(元)"
	                        			+"</td><td>"
	                        			+"<input type='text' data='0' class='form-control' style='width:80%;' disabled>"
	                        			+"</td><td>"
	                        			+"累计收入(元)"
	                        			+"</td><td>"
	                        			+"<input type='text' data='0' class='form-control' style='width:80%;' disabled>"
	                        			+"</td></tr>")
	                        	/* $("#xieban2 tbody").append("<tr><td>"
	                        			+"协办部门"
	                    				+"</td><td>"
	                        			+task.name2
	                        			+"</td><td>"
	                        			+"本期收入(%)"
	                        			+"</td><td>"
	                        			+"<input type='text' data='0' class='form-control' style='width:80%;'>"
	                        			+"</td><td>"
	                        			+"本期收入(元)"
	                        			+"</td><td>"
	                        			+"<input type='text' data='0' class='form-control' style='width:80%;'>"
	                        			+"</td></tr>") */
	                        	/* $("#xieban3 tbody").append("<tr><td>"
	                        			+"协办部门"
	                    				+"</td><td>"
	                        			+task.name2
	                        			+"</td><td>"
	                        			+"金额"
	                        			+"</td><td>"
	                        			+"<input type='text' data='0' class='form-control'>"
	                        			+"</td></tr>")
	                        	$("#xieban4 tbody").append("<tr><td>"
	                        			+"协办部门"
	                    				+"</td><td>"
	                        			+task.name2
	                        			+"</td><td>"
	                        			+"金额"
	                        			+"</td><td>"
	                        			+"<input type='text' data='0' class='form-control'>"
	                        			+"</td></tr>")
	                        	$("#xieban5 tbody").append("<tr><td>"
	                        			+"协办部门"
	                    				+"</td><td>"
	                        			+task.name2
	                        			+"</td><td>"
	                        			+"金额"
	                        			+"</td><td>"
	                        			+"<input type='text' data='0' class='form-control'>"
	                        			+"</td></tr>")
	                        	$("#xieban6 tbody").append("<tr><td>"
	                        			+"协办部门"
	                    				+"</td><td>"
	                        			+task.name2
	                        			+"</td><td>"
	                        			+"金额"
	                        			+"</td><td>"
	                        			+"<input type='text' data='0' class='form-control'>"
	                        			+"</td></tr>") */
	                    	}
	    					
	    					if(task.name3!=null){
	    						$("#xieban1 tbody").append("<tr><td>"
	                    				+"协办部门"
	                    				+"</td><td>"
	                        			+task.name3
	                        			+"</td><td>"
	                        			+"本期收入(%)"
	                        			+"</td><td>"
	                        			+"<input type='text' data='0' class='form-control' style='width:80%;' onchange='getYuan(this)'>"
	                        			+"</td><td>"
	                        			+"本期收入(元)"
	                        			+"</td><td>"
	                        			+"<input type='text' data='0' class='form-control' style='width:80%;' disabled>"
	                        			+"</td><td>"
	                        			+"累计收入(元)"
	                        			+"</td><td>"
	                        			+"<input type='text' data='0' class='form-control' style='width:80%;' disabled>"
	                        			+"</td></tr>")
	                        	/* $("#xieban2 tbody").append("<tr><td>"
	                        			+"协办部门"
	                    				+"</td><td>"
	                        			+task.name3
	                        			+"</td><td>"
	                        			+"本期收入(%)"
	                        			+"</td><td>"
	                        			+"<input type='text' data='0' class='form-control' style='width:80%;'>"
	                        			+"</td><td>"
	                        			+"本期收入(元)"
	                        			+"</td><td>"
	                        			+"<input type='text' data='0' class='form-control' style='width:80%;'>"
	                        			+"</td></tr>") */
	                        	/* $("#xieban3 tbody").append("<tr><td>"
	                        			+"协办部门"
	                    				+"</td><td>"
	                        			+task.name3
	                        			+"</td><td>"
	                        			+"金额"
	                        			+"</td><td>"
	                        			+"<input type='text' data='0' class='form-control'>"
	                        			+"</td></tr>")
	                        	$("#xieban4 tbody").append("<tr><td>"
	                        			+"协办部门"
	                    				+"</td><td>"
	                        			+task.name3
	                        			+"</td><td>"
	                        			+"金额"
	                        			+"</td><td>"
	                        			+"<input type='text' data='0' class='form-control'>"
	                        			+"</td></tr>")
	                        	$("#xieban5 tbody").append("<tr><td>"
	                        			+"协办部门"
	                    				+"</td><td>"
	                        			+task.name3
	                        			+"</td><td>"
	                        			+"金额"
	                        			+"</td><td>"
	                        			+"<input type='text' data='0' class='form-control'>"
	                        			+"</td></tr>")
	                        	$("#xieban6 tbody").append("<tr><td>"
	                        			+"协办部门"
	                    				+"</td><td>"
	                        			+task.name3
	                        			+"</td><td>"
	                        			+"金额"
	                        			+"</td><td>"
	                        			+"<input type='text' data='0' class='form-control'>"
	                        			+"</td></tr>") */
	                    	}
	                    	
	    					/* $("#cj_table tbody").html('');
    						$("#cj_table tbody").append("<tr>"+
    																			"<td>"+cj.contractName+"</td>"+
    																			"<td>"+cj.contractMoney+"</td>"+
    																			"<td>"+cj.temporaryMoney+"</td>"+
    																			"<td><input style='width:90%;' id='cj_bq' type='text' value='0' class='form-control' disabled></td>"+
    																			"<td><input data="+cj.cjId+"  id='cj_lj' value="+cj.mainDepartmentMoney+" style='width:90%;' type='text' class='form-control' disabled></td>"+
    																		"</tr>") */
	    					
                    }
          		});
		  	})
		  	
		  	
        }
		});
	}
	
	//判断进度
	$("#jindua").click(function(){
		var prjName=$("#prjName").val();
		if(prjName==''){
			toastr.error("请先选择项目");
			return;
		}
		$("#B1jieduan").hide();
		$("#B2jieduan").hide();
		$("#B3jieduan").hide();
		$("#B4jieduan").hide();
		$("#AB1jieduan").hide();
		$("#C1jieduan").hide();
		$("#C2jieduan").hide();
		$("#qita").hide();
		var str=$("#prjType2").val();
		if(str.indexOf("B2") != -1 ){
			$("#B2jieduan").show();
			$("#b2_span1").text(chushe+"%");
			$("#b2_span2").text(shishe+"%");
		}else if(str.indexOf("B1") != -1){
			$("#B1jieduan").show();
			$("#b1_span1").text("100%");
		}else if(str.indexOf("B3") != -1){
			$("#B3jieduan").show();
			$("#b3_span1").text(yugong+"%");
			$("#b3_span2").text(chushe+"%");
			$("#b3_span3").text(shishe+"%");
		}else if(str.indexOf("B4") != -1){
			$("#B4jieduan").show();
			$("#b4_span1").text(yugong+"%");
			$("#b4_span2").text(shishe+"%");
		}else if(str.indexOf("B1") != -1||str.indexOf("A") != -1){
			$("#AB1jieduan").show();
		}else if(str.indexOf("C1") != -1){
			$("#C1jieduan").show();
		}else if(str.indexOf("C2") != -1){
			$("#C2jieduan").show();
		}else{
			$("#qita").show();
		}
		$("#jindu").modal("show");
	})
	
	
	$("#this_time").on("change",function(){
		var prjName=$("#prjName").val();
		if(prjName==''){
			toastr.error("请先选择任务单");
			$("#this_time").val('');
			return;
		}
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/ppf/selectPrjProgressFillCjIncomeBq',
            dataType: 'json',
            data: {
            	id:$("#cj_lj").attr("data"),
            	bq:$("#this_time").val()
            },
            success: function (json) {
            	var cj_lj=$("#cj_lj").val();
            	var cj_bq=$("#cj_bq").val();
            	$("#cj_bq").val(parseInt(cj_bq)+parseInt(json))
            	$("#cj_lj").val(parseInt(json)+parseInt(cj_lj))
            }
		});
	})
	
	function getLatelyMonthFirstppf(){
		var LatelyMonthFirstppf;
		$.ajax({
  			type: 'POST',
            url: getContextPath()+'/ppf/getLatelyMonthFirstppf',
            dataType: 'json',
            async:false,
            data: {
            	taskNo:$("#task_no").val()
            },  
            success: function (json) {
            	console.log(json)
            	LatelyMonthFirstppf=json;
            }
  		})
         return LatelyMonthFirstppf;
	}
	
	var yugongke="";
	var chubu="";
	var shigongtu="";
	var reg = new RegExp("^[0-9]*$");
	$("#quedingjindu").click(function(){
		var LatelyMonthFirstppf=getLatelyMonthFirstppf();//最近一次月份填的信息
		var LatelyMonthallMoney
		if(LatelyMonthFirstppf==undefined||LatelyMonthFirstppf==null||LatelyMonthFirstppf==""){
			LatelyMonthallMoney=0
		}else{
			LatelyMonthallMoney=LatelyMonthFirstppf.allMoney.replace("%","");
		}
		
		if($('#B1jieduan').is(':hidden')){
		      //如果隐藏时。。。

		}else{
		      //如果显示时。。。
		    yugongke="";
		    chubu="";
		    shigongtu=$("#shigongsheji option:selected").text()+" "+$("#b1_span1_1").val()+"%";
		    var sum=1*parseInt($("#b1_span1_1").val());
		    
	  		if(sum.toFixed(2)<LatelyMonthallMoney){
	  				$("#all_money").val(LatelyMonthallMoney+"%")
	  				$("#errorPrompt").show();
	  			}else{
					$("#all_money").val(sum.toFixed(2)+"%");
					$("#errorPrompt").hide();
	  			}
		}
		
		if($('#B2jieduan').is(':hidden')){
		      //如果隐藏时。。。

		}else{
		      //如果显示时。。。
		    yugongke="";
		    chubu=$("#firstsheji option:selected").text()+" "+$("#b2_span1_1").val()+"%";
		    shigongtu=$("#shigongsheji option:selected").text()+" "+$("#b2_span2_1").val()+"%";
		    var sum=parseInt($("#b2_span1_1").val())*parseInt(chushe)/100+parseInt($("#b2_span2_1").val())*parseInt(shishe)/100;
			
	  		if(sum.toFixed(2)<LatelyMonthallMoney){
	  				$("#all_money").val(LatelyMonthallMoney+"%")
	  				$("#errorPrompt").show();
	  			}else{
	  				$("#all_money").val(sum.toFixed(2)+"%");
	  				$("#errorPrompt").hide();
	  			}
		}
		
		if($('#B3jieduan').is(':hidden')){
		      //如果隐藏时。。。

		}else{
		      //如果显示时。。。
		    yugongke=$("#b3_yugong_sheji option:selected").text()+" "+$("#b3_span1_1").val()+"%";
		    chubu=$("#b3_firstsheji option:selected").text()+" "+$("#b3_span2_1").val()+"%";
		    shigongtu=$("#b3_shigongsheji option:selected").text()+" "+$("#b3_span3_1").val()+"%";
		    var sum=parseInt($("#b3_span1_1").val())*parseInt(yugong)/100+parseInt($("#b3_span2_1").val())*parseInt(chushe)/100+parseInt($("#b3_span3_1").val())*parseInt(shishe)/100;
		    
	  		if(sum.toFixed(2)<LatelyMonthallMoney){
	  				$("#all_money").val(LatelyMonthallMoney+"%")
	  				$("#errorPrompt").show();
	  			}else{
				    $("#all_money").val(sum.toFixed(2)+"%");
				    $("#errorPrompt").hide();
	  			}
		}
		
		if($('#B4jieduan').is(':hidden')){
		      //如果隐藏时。。。

		}else{
		      //如果显示时。。。
		    yugongke=$("#b4_yugong_sheji option:selected").text()+" "+$("#b4_span1_1").val()+"%";
		    chubu="";
		    shigongtu=$("#b4_shigongsheji option:selected").text()+" "+$("#b4_span2_1").val()+"%";
		    var sum=parseInt($("#b4_span1_1").val())*parseInt(yugong)/100+parseInt($("#b4_span2_1").val())*parseInt(shishe)/100;
		    
	  		if(sum.toFixed(2)<LatelyMonthallMoney){
	  				$("#all_money").val(LatelyMonthallMoney+"%")
	  				$("#errorPrompt").show();
	  			}else{
					$("#all_money").val(sum.toFixed(2)+"%");
					$("#errorPrompt").hide();
	  			}
		}
		
		if($('#AB1jieduan').is(':hidden')){

		}else{
			
	  		if($("#AB1jieduanjindu").val()/1<LatelyMonthallMoney){
	  				$("#all_money").val(LatelyMonthallMoney+"%")
	  				$("#errorPrompt").show();
	  			}else{
					$("#all_money").val($("#AB1jieduanjindu").val()/1+"%")
					$("#errorPrompt").hide();
	  			}
		}
		if($('#C1jieduan').is(':hidden')){

		}else{
			var C1jieduanjindu=$("#C1jieduanjindu").val();
			 if(reg.test(C1jieduanjindu)&&C1jieduanjindu/1>=5&&C1jieduanjindu<=100){
				 	
			  		if($("#C1jieduanjindu").val()/1<LatelyMonthallMoney){
			  				$("#all_money").val(LatelyMonthallMoney+"%")
			  				$("#errorPrompt").show();
			  			}else{
							$("#all_money").val($("#C1jieduanjindu").val()/1+"%")
							$("#errorPrompt").hide();
			  			}
			    }else{
			    	toastr.error("数字范围必须在0-100之间！");
			    }
			
			
		}
		if($('#C2jieduan').is(':hidden')){
		      

		}else{
			var C1jieduanjindu=$("#C2jieduanjindu").val();
			 if(reg.test(C1jieduanjindu)&&C1jieduanjindu/1>=5&&C1jieduanjindu<=100){
				
		  		if($("#C2jieduanjindu").val()/1<LatelyMonthallMoney){
		  				$("#all_money").val(LatelyMonthallMoney+"%")
		  				$("#errorPrompt").show();
		  			}else{
		  				$("#all_money").val($("#C2jieduanjindu").val()/1+"%")
		  				$("#errorPrompt").hide();
		  			}
				 
			    }else{
			    	toastr.error("数字范围必须在0-100之间！");
			    }
			
		}
		if($('#qita').is(':hidden')){
		     

		}else{
			var C1jieduanjindu=$("#qitajindu").val();
			 if(reg.test(C1jieduanjindu)&&C1jieduanjindu/1>=5&&C1jieduanjindu<=100){
		  		if($("#qitajindu").val()/1<LatelyMonthallMoney){
		  				$("#all_money").val(LatelyMonthallMoney+"%")
		  				$("#errorPrompt").show();
		  			}else{
					 	$("#all_money").val($("#qitajindu").val()/1+"%")
					 	$("#errorPrompt").hide();
		  			} 
			    }else{
			    	toastr.error("数字范围必须在0-100之间！");
			    }
			
		}
		
		
		var fbNum=$("#fb_table tbody").find("tr").length;
		$.ajax({
            type: 'POST',
            url: getContextPath()+'/ppf/getPrjAllMoney',
            dataType: 'json',
            data: {
            	no:$("#task_no").val(),
            	fbNum:fbNum
            },
            success: function (json) {
               var present=json.present;
               var allMoney=json.allMoney;
               if(fbNum==0){
            	   var cb=json.cb;
            	   $("#fb_ys_table tbody").html('');
            	   for(var i=0;i<cb.length;i++){
            		   $("#fb_ys_table tbody").append("<tr>"+
            				   													"<td style='width:50%;'>"+cb[i].name2+"</td>"+
            				   													"<td style='width:50%;'>"+cb[i].costAmount+"</td>"+
            				   												  "</tr>")
            	   }
            	   $("#fb_table").hide();
            	   $("#fb_ys_table").show();
               }else{
            	   $("#fb_table").show();
            	   $("#fb_ys_table").hide();
               }
				var leijishourubi=$("#all_money").val().replace("%","");
               var prjMoney=$("#prjMoney").val();
               var income=$("#all_money").val().replace("%","")*prjMoney/100;
   			   
   			   
   			   var ttmy=accSub(income,present);
	   			
		  	   if(leijishourubi==LatelyMonthallMoney){
		  				$("#this_time_money_yuan").val(0);
		  				$("#all_money_yuan").val(LatelyMonthFirstppf.allMoneyYuan);
		  			}else{
		           	   $("#this_time_money_yuan").val(ttmy);
		           	   $("#all_money_yuan").val(income);
		  		}
           	   var contractMoney=$("#contractMoney").val();
               $("#contract_income").val(((allMoney+income-present)*100/contractMoney).toFixed(2)+"%")
               
               var infoNum=$("#xieban1 tbody").find("tr").length;
	       		if(infoNum==1){
	       			$("#xieban1 tbody").find("tr").eq(0).find("input").eq(0).val(100).trigger("change");
	       			$("#xieban1 tbody").find("tr").eq(0).find("input").eq(0).attr("disabled","true");
	       		}else if(infoNum==2){
	       			$("#xieban1 tbody").find("tr").eq(0).find("input").eq(0).val(100).trigger("change");
	       			$("#xieban1 tbody").find("tr").eq(1).find("input").eq(0).val(0).trigger("change");
	       		}else if(infoNum==3){
	       			$("#xieban1 tbody").find("tr").eq(0).find("input").eq(0).val(100).trigger("change");
	       			$("#xieban1 tbody").find("tr").eq(1).find("input").eq(0).val(0).trigger("change");
	       			$("#xieban1 tbody").find("tr").eq(2).find("input").eq(0).val(0).trigger("change");
	       		}else if(infoNum==4){
	       			$("#xieban1 tbody").find("tr").eq(0).find("input").eq(0).val(100).trigger("change");
	       			$("#xieban1 tbody").find("tr").eq(1).find("input").eq(0).val(0).trigger("change");
	       			$("#xieban1 tbody").find("tr").eq(2).find("input").eq(0).val(0).trigger("change");
	       			$("#xieban1 tbody").find("tr").eq(3).find("input").eq(0).val(0).trigger("change");
	       		}else if(infoNum!=1){
	       			$("#xieban1 tbody").find("tr").eq(0).find("input").eq(0).removeAttr("disabled");
	       		}
               
            }
        });
	})
	
	$('#jindu').on('hidden.bs.modal', function () {//解决模态框页面滚动问题
            if ($('.modal.in').size() >= 1) {
                $('body').addClass('modal-open')
            }
        })
	
    function getCreat(bb){
        var EnterpriseRating= $(bb).parent().prev().text();
        var Remarks= $(bb).parent().prev().prev().text();
        var ContactPhone1= $(bb).parent().prev().prev().prev().text();
        var Contacts= $(bb).parent().prev().prev().prev().prev().text();
        var address= $(bb).parent().prev().prev().prev().prev().prev().text();
        var ProprietorUnit= $(bb).parent().prev().prev().prev().prev().prev().prev().text();
        var Code= $(bb).parent().prev().prev().prev().prev().prev().prev().prev().text();
        $("#CEnterprise-rating").val(EnterpriseRating);
        $("#CRemarks").val(Remarks);
        $("#CContact-phone1").val(ContactPhone1);
        $("#CContacts").val(Contacts);
        $("#Caddress").val(address);
        $("#CProprietor-unit").val(ProprietorUnit);
        $("#CCode").val(Code);
        rowIndex = bb.parentNode.parentNode.rowIndex; 
    }

    $(".quxiao").click(function(){
        if(confirm("确定要撤销吗？")){
            return true;
        }
        else{
            return false;
        }
    })
    
     $("#uploaderBox").on("click", function(e) {
        var newFileInput = "<tr><td>附件</td><td><input  type='file' name='file' class='form-control' /></td><td><button type='button' class='btn btn-primary' onclick='removeFile(this)'>移除附件</button></td></tr>";
        $("#new_accessory").append($(newFileInput));
    });
    
    function removeFile(obj){
    	var tr=$(obj).parent().parent();
    	$(tr).remove();
    }
    
    //清空内容
    function clear(){
    	/* $("#prjName").val("");
    	$("#task_no").val("")
    	$("#prjType2").val("")
    	$("#prj_leader").val("")
    	$("#contract_name").val("");
    	$("#contract_no").val("")
    	$("#contractMoney").val("")
    	$("#prjMoney").val("")
    	$("#provisional_sum").val("")
    	$("#prj_start_time").val("")
    	$("#prj_end_time").val("")
    	$("#budget_money_all").val("");
    	$("#this_time").val("");
    	$("#prj_mode").val("");
    	$("#all_money").val("")
    	$("#this_time_money_yuan").val("");
    	$("#all_money_yuan").val("");
    	$("#contract_income").val("")
    	$("#new_rate").val("");
    	$("#new_rate_money").val(""); */
    	$("#myform").find("input,textarea").each(function(){
 		   this.value ="";
 		});
    	$("#xieban1 tbody").empty();
    	$("#fb_table tbody").empty();
    }
    
    
    function save(){
    	var prj_name=$("#prjName").val();
    	var task_no=$("#task_no").val();
    	var prjType2=$("#prjType2").val();
    	var contractMoney=$("#contractMoney").val();
    	var prjMoney=$("#prjMoney").val();
    	var prj_leader=$("#prj_leader").val();
    	var prj_mode=$("#prj_mode").val();
    	var provisional_sum=$("#provisional_sum").val();
    	var prj_start_time=$("#prj_start_time").val();
    	var prj_end_time=$("#prj_end_time").val();
    	var budget_money_all=$("#budget_money_all").val();
    	var this_time=$("#this_time").val();
    	var all_money=$("#all_money").val();
    	var all_money_yuan=$("#all_money_yuan").val();
    	var contract_income=$("#contract_income").val();
    	var this_time_money_yuan=$("#this_time_money_yuan").val();
    	var rate=$("#new_rate").val();
    	var rateMoney=$("#new_rate_money").val();
    	var thismonthCompletecontent=$("#thismonth_completecontent").val();
    	var nextmoneyPlan=$("#nextmoney_plan").val();
    	
    	var PrjProgressFill={
    			ppfId:undefined,
    			prjName:undefined,
    			taskNo:undefined,
    			prjType:undefined,
    			contractMoney:0,
    			PrjMoney:0,
    			prjLeader:undefined,
    			provisionalSum:0,
    			prjStartTime:undefined,
    			prjEndTime:undefined,
    			prjMode:undefined,
    			budgetMoneyAll:undefined,
    			thisTime:undefined,
    			allMoney:undefined,
    			contractIncome:undefined,
    			ygDesign:undefined,
    			fristDesign:undefined,
    			secondDesign:undefined,
    			allMoneyYuan:0,
    			prjThisIncomeYuan:0,
    			ppfi:undefined,
    			ppfb:undefined,
    			rate:0,
    			rateMoney:0,
    			thismonthCompletecontent:undefined,
    			nextmoneyPlan:undefined,
    	}
    	
    	PrjProgressFill.prjName=prj_name;
    	PrjProgressFill.taskNo=task_no;
    	PrjProgressFill.prjType=prjType2;
    	PrjProgressFill.contractMoney=contractMoney;
    	PrjProgressFill.prjMoney=prjMoney;
    	PrjProgressFill.prjLeader=prj_leader;
    	PrjProgressFill.provisionalSum=provisional_sum;
    	PrjProgressFill.prjStartTime=prj_start_time;
    	PrjProgressFill.prjEndTime=prj_end_time;
    	PrjProgressFill.prjMode=prj_mode;
    	PrjProgressFill.budgetMoneyAll=budget_money_all;
    	PrjProgressFill.thisTime=this_time;
    	PrjProgressFill.allMoney=all_money;
    	PrjProgressFill.contractIncome=contract_income;
    	PrjProgressFill.allMoneyYuan=all_money_yuan;
    	PrjProgressFill.prjThisIncomeYuan=this_time_money_yuan;
    	PrjProgressFill.ygDesign=yugongke;
    	PrjProgressFill.fristDesign=chubu;
    	PrjProgressFill.secondDesign=shigongtu;
    	PrjProgressFill.rate=rate;
    	PrjProgressFill.rateMoney=rateMoney;
    	PrjProgressFill.thismonthCompletecontent=thismonthCompletecontent;
    	PrjProgressFill.nextmoneyPlan=nextmoneyPlan;
    	
    	var ppfiArray=new Array();
    	var ppfbArray=new Array();
    	
    	$("#xieban1 tbody").find("tr").each(function(){
    		var ppfi={
    				ppfId:undefined,
    				taskNo:undefined,
    				department:undefined,
    				money:undefined,
    				moneyYuan:0,
    				allMoneyYuan:0,
    				type:1,
    				main:0
    		}
    		var department=$(this).find("td").eq(1).text();
    		var money=$(this).find("input").eq(0).val();
    		var moneyYuan=$(this).find("input").eq(1).val();
    		var main=$(this).find("input").eq(0).attr("data");
    		var allMoneyYuan=$(this).find("input").eq(2).val();
    		ppfi.department=department;
    		ppfi.money=money;
    		ppfi.taskNo=task_no;
    		ppfi.moneyYuan=moneyYuan;
    		ppfi.main=main;
    		ppfi.allMoneyYuan=allMoneyYuan;
    		ppfiArray.push(ppfi);
    	})
    	PrjProgressFill.ppfi=ppfiArray;
    	
    	$("#fb_table tbody").find("tr").each(function(){
    		var ppfb={
					ppfId:null,    				
    				fbId:undefined,
    				fbName:undefined,
    				department:undefined,
    				fbUnit:undefined,
    				fbMoney:undefined,
    				incomeBq:0,
    				incomeAll:0,
    				incomeAllBili:0,
    				bq:undefined,
    				rate:0,
    				rateMoney:0
    		}
    		var fbName=$(this).find("td").eq(0).text();
    		var fbId=$(this).find("input").eq(0).attr("data");
    		var department=$(this).find("td").eq(1).text();
    		var fbMoney=$(this).find("td").eq(2).text();
    		var fbUnit=$(this).find("td").eq(3).text();
    		var incomeAllBili=$(this).find("input").eq(0).val();
    		var incomeAll=$(this).find("input").eq(1).val();
    		var incomeBq=$(this).find("input").eq(2).val();
    		var fbRate=$(this).find("input").eq(3).val();
    		var fbRateMoney=$(this).find("input").eq(4).val();
    		
    		ppfb.fbName=fbName;
    		ppfb.department=department;
    		ppfb.incomeBq=incomeBq;
    		ppfb.incomeAll=incomeAll;
    		ppfb.incomeAllBili=incomeAllBili;
    		ppfb.fbId=fbId;
    		ppfb.bq=this_time;
    		ppfb.fbMoney=fbMoney;
    		ppfb.fbUnit=fbUnit;
    		ppfb.rate=fbRate;
    		ppfb.rateMoney=fbRateMoney;
    		ppfbArray.push(ppfb);
    	})
    	$("#fb_ys_table tbody").find("tr").each(function(){
    		var ppfb={
					ppfId:null,    				
    				fbId:undefined,
    				fbName:undefined,
    				fbUnit:undefined,
    				fbMoney:undefined,
    				incomeBq:0,
    				incomeAll:0,
    				incomeAllBili:0,
    				bq:undefined,
    				rate:0,
    				rateMoney:0
    		}
    		var department=$(this).find("td").eq(0).text();
    		var incomeBq=$(this).find("td").eq(1).text();
    		ppfb.fbName="";
    		ppfb.department=department;
    		ppfb.incomeBq=incomeBq;
    		ppfb.incomeAll="";
    		ppfb.fbId="";
    		ppfb.bq=this_time;
    		ppfb.fbMoney="";
    		ppfb.fbUnit="";
    		ppfbArray.push(ppfb);
    	})
    	PrjProgressFill.ppfb=ppfbArray;
    	
    	var formData = new FormData();
  		formData.append("ppf", JSON.stringify(PrjProgressFill));
  		
  		var flag=true;
  		$("#new_accessory tbody").find("tr").each(function(){
  			if($(this).find("input").eq(0).val()==null||$(this).find("input").eq(0).val()==''){
  				flag=false;
  				return;
  			}
	  		formData.append("file", $(this).find("input")[0].files[0]);
  		})
  		$.ajax({
  			type: 'POST',
            url: getContextPath()+'/ppf/addPrjProgressFillBySave',
            data: formData,  
            cache: false,
            processData: false,
            contentType: false,
            async: false,
            success: function (json) {
            	if(json>0){
            		$("#myModal").modal("hide");
            		toastr.success("保存成功")
            		clear();
            	}else{
            		toastr.error("保存失败")
            	}
            }
  		})
    	
    }
	
    function submit(){
    	var prj_name=$("#prjName").val();
    	var task_no=$("#task_no").val();
    	var prjType2=$("#prjType2").val();
    	var contractMoney=$("#contractMoney").val();
    	var prjMoney=$("#prjMoney").val();
    	var prj_leader=$("#prj_leader").val();
    	var prj_mode=$("#prj_mode").val();
    	var provisional_sum=$("#provisional_sum").val();
    	var prj_start_time=$("#prj_start_time").val();
    	var prj_end_time=$("#prj_end_time").val();
    	var budget_money_all=$("#budget_money_all").val();
    	var this_time=$("#this_time").val();
    	var all_money=$("#all_money").val();
    	var all_money_yuan=$("#all_money_yuan").val();
    	var contract_income=$("#contract_income").val();
    	/* var this_time_money=$("#this_time_money").val(); */
    	var this_time_money_yuan=$("#this_time_money_yuan").val();
    	var rate=$("#new_rate").val();
    	var rateMoney=$("#new_rate_money").val();
    	var thismonthCompletecontent=$("#thismonth_completecontent").val();
    	var nextmoneyPlan=$("#nextmoney_plan").val();
    	
    	var PrjProgressFill={
    			ppfId:undefined,
    			prjName:undefined,
    			taskNo:undefined,
    			prjType:undefined,
    			contractMoney:0,
    			PrjMoney:0,
    			prjLeader:undefined,
    			provisionalSum:0,
    			prjStartTime:undefined,
    			prjEndTime:undefined,
    			prjMode:undefined,
    			budgetMoneyAll:undefined,
    			thisTime:undefined,
    			allMoney:undefined,
    			contractIncome:undefined,
    			ygDesign:undefined,
    			fristDesign:undefined,
    			secondDesign:undefined,
    			/* prjThisIncome:undefined, */
    			allMoneyYuan:0,
    			prjThisIncomeYuan:0,
    			ppfi:undefined,
    			/* ppcj:undefined, */
    			ppfb:undefined,
    			rate:0,
    			rateMoney:0,
    			thismonthCompletecontent:undefined,
    			nextmoneyPlan:undefined,
    	}
    	
    	PrjProgressFill.prjName=prj_name;
    	PrjProgressFill.taskNo=task_no;
    	PrjProgressFill.prjType=prjType2;
    	PrjProgressFill.contractMoney=contractMoney;
    	PrjProgressFill.prjMoney=prjMoney;
    	PrjProgressFill.prjLeader=prj_leader;
    	PrjProgressFill.provisionalSum=provisional_sum;
    	PrjProgressFill.prjStartTime=prj_start_time;
    	PrjProgressFill.prjEndTime=prj_end_time;
    	PrjProgressFill.prjMode=prj_mode;
    	PrjProgressFill.budgetMoneyAll=budget_money_all;
    	PrjProgressFill.thisTime=this_time;
    	PrjProgressFill.allMoney=all_money;
    	PrjProgressFill.contractIncome=contract_income;
    	PrjProgressFill.allMoneyYuan=all_money_yuan;
    	PrjProgressFill.prjThisIncomeYuan=this_time_money_yuan;
    	PrjProgressFill.ygDesign=yugongke;
    	PrjProgressFill.fristDesign=chubu;
    	PrjProgressFill.secondDesign=shigongtu;
    	PrjProgressFill.rate=rate;
    	PrjProgressFill.rateMoney=rateMoney;
    	PrjProgressFill.thismonthCompletecontent=thismonthCompletecontent;
    	PrjProgressFill.nextmoneyPlan=nextmoneyPlan;
    	
    	var ppfiArray=new Array();
    	/* var ppfiArray2=new Array(); */
    	/* var ppfiArray3=new Array();
    	var ppfiArray4=new Array();
    	var ppfiArray5=new Array();
    	var ppfiArray6=new Array(); */
    	var ppfbArray=new Array();
    	/* var ppcjArray=new Array(); */
    	
    	$("#xieban1 tbody").find("tr").each(function(){
    		var ppfi={
    				ppfId:undefined,
    				taskNo:undefined,
    				department:undefined,
    				money:undefined,
    				moneyYuan:0,
    				allMoneyYuan:0,
    				type:1,
    				main:0
    		}
    		var department=$(this).find("td").eq(1).text();
    		var money=$(this).find("input").eq(0).val();
    		var moneyYuan=$(this).find("input").eq(1).val();
    		var main=$(this).find("input").eq(0).attr("data");
    		var allMoneyYuan=$(this).find("input").eq(2).val();
    		ppfi.department=department;
    		ppfi.money=money;
    		ppfi.taskNo=task_no;
    		ppfi.moneyYuan=moneyYuan;
    		ppfi.main=main;
    		ppfi.allMoneyYuan=allMoneyYuan;
    		ppfiArray.push(ppfi);
    	})
    	PrjProgressFill.ppfi=ppfiArray;
    	
    	/* $("#xieban2 tbody").find("tr").each(function(){
    		var ppfi2={
    				ppfId:undefined,
    				department:undefined,
    				money:0,
    				type:2,
    				main:0
    		}
    		var department=$(this).find("td").eq(1).text();
    		var money=$(this).find("input").eq(0).val();
    		var main=$(this).find("input").eq(0).attr("data");
    		ppfi2.department=department;
    		ppfi2.money=money;
    		ppfi2.main=main;
    		ppfiArray2.push(ppfi2);
    	})
    	PrjProgressFill.ppfi2=ppfiArray2; */
    	
    	/* $("#xieban3 tbody").find("tr").each(function(){
    		var ppfi3={
    				ppfId:undefined,
    				department:undefined,
    				money:0,
    				type:3,
    				main:0
    		}
    		var department=$(this).find("td").eq(1).text();
    		var money=$(this).find("input").eq(0).val();
    		var main=$(this).find("input").eq(0).attr("data");
    		ppfi3.department=department;
    		ppfi3.money=money;
    		ppfi3.main=main;
    		ppfiArray3.push(ppfi3);
    	})
    	PrjProgressFill.ppfi3=ppfiArray3;
    	
    	$("#xieban4 tbody").find("tr").each(function(){
    		var ppfi4={
    				ppfId:undefined,
    				department:undefined,
    				money:0,
    				type:4,
    				main:0
    		}
    		var department=$(this).find("td").eq(1).text();
    		var money=$(this).find("input").eq(0).val();
    		var main=$(this).find("input").eq(0).attr("data");
    		ppfi4.department=department;
    		ppfi4.money=money;
    		ppfi4.main=main;
    		ppfiArray4.push(ppfi4);
    	})
    	PrjProgressFill.ppfi4=ppfiArray4;
    	
    	$("#xieban5 tbody").find("tr").each(function(){
    		var ppfi5={
    				ppfId:undefined,
    				department:undefined,
    				money:0,
    				type:5,
    				main:0
    		}
    		var department=$(this).find("td").eq(1).text();
    		var money=$(this).find("input").eq(0).val();
    		var main=$(this).find("input").eq(0).attr("data");
    		ppfi5.department=department;
    		ppfi5.money=money;
    		ppfi5.main=main;
    		ppfiArray5.push(ppfi5);
    	})
    	PrjProgressFill.ppfi5=ppfiArray5;
    	
    	$("#xieban6 tbody").find("tr").each(function(){
    		var ppfi6={
    				ppfId:undefined,
    				department:undefined,
    				money:0,
    				type:6,
    				main:0
    		}
    		var department=$(this).find("td").eq(1).text();
    		var money=$(this).find("input").eq(0).val();
    		var main=$(this).find("input").eq(0).attr("data");
    		ppfi6.department=department;
    		ppfi6.money=money;
    		ppfi6.main=main;
    		ppfiArray6.push(ppfi6);
    	})
    	PrjProgressFill.ppfi6=ppfiArray6; */
    	
    	var qq=0;
    	$("#fb_table tbody").find("tr").each(function(){
    		var ppfb={
					ppfId:null,    				
    				fbId:undefined,
    				fbName:undefined,
    				department:undefined,
    				fbUnit:undefined,
    				fbMoney:undefined,
    				incomeBq:0,
    				incomeAll:0,
    				incomeAllBili:0,
    				bq:undefined,
    				rate:0,
    				rateMoney:0
    		}
    		var fbName=$(this).find("td").eq(0).text();
    		var fbId=$(this).find("input").eq(0).attr("data");
    		var department=$(this).find("td").eq(1).text();
    		var fbMoney=$(this).find("td").eq(2).text();
    		var fbUnit=$(this).find("td").eq(3).text();
    		var incomeAllBili=$(this).find("input").eq(0).val();
    		var incomeAll=$(this).find("input").eq(1).val();
    		var incomeBq=$(this).find("input").eq(2).val();
    		var fbRate=$(this).find("input").eq(3).val();
    		var fbRateMoney=$(this).find("input").eq(4).val();
    		if(incomeBq==''||incomeAll==''||fbRate==''||fbRateMoney==''){
    			qq=1;
    			return;
    		}
    		ppfb.fbName=fbName;
    		ppfb.department=department;
    		ppfb.incomeBq=incomeBq;
    		ppfb.incomeAll=incomeAll;
    		ppfb.incomeAllBili=incomeAllBili;
    		ppfb.fbId=fbId;
    		ppfb.bq=this_time;
    		ppfb.fbMoney=fbMoney;
    		ppfb.fbUnit=fbUnit;
    		ppfb.rate=fbRate;
    		ppfb.rateMoney=fbRateMoney;
    		ppfbArray.push(ppfb);
    	})
    	$("#fb_ys_table tbody").find("tr").each(function(){
    		var ppfb={
					ppfId:null,    				
    				fbId:undefined,
    				fbName:undefined,
    				fbUnit:undefined,
    				fbMoney:undefined,
    				incomeBq:0,
    				incomeAll:0,
    				incomeAllBili:0,
    				bq:undefined,
    				rate:0,
    				rateMoney:0
    		}
    		var department=$(this).find("td").eq(0).text();
    		var incomeBq=$(this).find("td").eq(1).text();
    		ppfb.fbName="";
    		ppfb.department=department;
    		ppfb.incomeBq=incomeBq;
    		ppfb.incomeAll="";
    		ppfb.fbId="";
    		ppfb.bq=this_time;
    		ppfb.fbMoney="";
    		ppfb.fbUnit="";
    		ppfbArray.push(ppfb);
    	})
    	if(qq!=0){
    		toastr.error("分包收入请填写完整");
  			return;
    	}
    	PrjProgressFill.ppfb=ppfbArray;
    	
    	/* $("#cj_table tbody").find("tr").each(function(){
    		var ppcj={
    				cjId:undefined,
    				cjName:undefined,
    				incomeBq:0,
    				incomeAll:0,
    				bq:undefined
    		}
    		var cjName=$(this).find("td").eq(0).text();
    		var incomeBq=$(this).find("input").eq(0).val();
    		var incomeAll=$(this).find("input").eq(1).val();
    		var cjId=$(this).find("input").eq(1).attr("data");
    		ppcj.cjName=cjName;
    		ppcj.incomeBq=incomeBq;
    		ppcj.incomeAll=incomeAll;
    		ppcj.cjId=cjId;
    		ppcj.bq=this_time;
    		ppcjArray.push(ppcj);
    	})
    	if(ppcjArray==null||ppcjArray==''){
    		if(all_money=='100%'){
    			toastr.error("暂无承接合同不可填报进度100%");
        		return;
    		}
    	}
    	PrjProgressFill.ppcj=ppcjArray; */
    	
    	if(this_time==''){
    		toastr.error("本期为空");
  			return;
    	}
    	if(rate==''){
    		toastr.error("税率为空");
  			return;
    	}
    	if(rateMoney==''){
    		toastr.error("税金为空");
  			return;
    	}
    	
    	var formData = new FormData();
  		formData.append("ppf", JSON.stringify(PrjProgressFill));
  		
  		var flag=true;
  		$("#new_accessory tbody").find("tr").each(function(){
  			if($(this).find("input").eq(0).val()==null||$(this).find("input").eq(0).val()==''){
  				flag=false;
  				return;
  			}
	  		formData.append("file", $(this).find("input")[0].files[0]);
  		})
  		if(flag==false){
  			toastr.error("文件不可以为空");
  			return;
  		}
  		$.ajax({
  			type: 'POST',
            url: getContextPath()+'/ppf/addPrjProgressFillBySubmit',
            data: formData,  
            cache: false,
            processData: false,
            contentType: false,
            async: false,
            dataType: 'json',
            success: function (json) {
            	if(json=='0'){
	        		toastr.error("保存失败");
	        	}else{
	        		clear();
	        		$("#myModal").modal("hide");
	        		lianjie=json.url;
	            	if(json.receiver!=null&&json.receiver.length>=1){
		        		  $("#tijiaogei").modal('show');
		        		  $("#tijiaoren tbody").empty("");
		        		  for(var i=0;i<json.receiver.length;i++){
		        			  $("#tijiaoren tbody").append('<tr><td>'
		        					  +'<input type="radio" style="width:22px;height:22px;" name="tijiaorenming" data-id="'+json.receiver[i].userId+'" data-id2="'+json.receiver[i].omId+'" data-id3="'+json.receiver[i].dutyId+'">'
		        					  +'</td><td>'
		        					  +json.receiver[i].omName
		        					  +'</td><td>'
		        					  +json.receiver[i].dutyName
		        					  +'</td><td>'
		        					  +json.receiver[i].uName
		        					  +'</td></tr>');
		        		  }
		        	  }else if(json.receiver.length==1){
		        		  $.ajax({
		        	          type: 'POST',
		        	          url: getContextPath()+'/task/addTask4',
		        	          dataType: 'json',
		        	          data:{
		        	        	  url:json.url,
		        	        	  userId:json.receiver.userId,
		        	        	  uName:json.receiver.uName,
		        	        	  omName:json.receiver.omName,
		        	        	  dutyName:json.receiver.dutyName,
		        	        	  omId:json.receiver.omId,
		        	        	  dutyId:json.receiver.dutyId
		        	          },
		        	          success: function (json) {
		        	        	  toastr.success('提交成功');
		        	          }
		        	      }); 
		        	  }
	        	}
            }
  		})
    	
    }
    
    function submitPerson(){
  		var uid=$("input[name='tijiaorenming']:checked").attr("data-id");
  	  var omid=$("input[name='tijiaorenming']:checked").attr("data-id2");
  	  var dutyid=$("input[name='tijiaorenming']:checked").attr("data-id3");
  	  var bmmc=$("input[name='tijiaorenming']:checked").parent().next().text();
  	  var zw=$("input[name='tijiaorenming']:checked").parent().next().next().text();
  	  var uname=$("input[name='tijiaorenming']:checked").parent().next().next().next().text();
  	  //var uname=$("input[name='tijiaorenming']:checked").val();
  	  $.ajax({
            type: 'POST',
            url: getContextPath()+'/task/addTask4',
            dataType: 'json',
            data:{
          	  url:lianjie,
          	  userId:uid,
          	  uName:uname,
          	  omName:bmmc,
          	  dutyName:zw,
          	  omId:omid,
          	  dutyId:dutyid
            },
            success: function (json) {
          	  toastr.success('提交成功');
            }
        });  
  	}
    
    function look(obj){
    	myTool.mask.show('查询中...');
    	var tr=$(obj).parent().parent();
    	var data=$("#mainContent").DataTable().row(tr).data();
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/ppf/selectPrjProgressFillInfo',
            dataType: 'json',
            data: {
            	id:data.ppfId
            },
            success: function (json) {
            	var ppfi=json.ppfi;
            	var ppfb=json.ppfb;
            	var cj=json.cj;
            	/* var ppfi2=json.ppfi2;
            	var ppfi3=json.ppfi3;
            	var ppfi4=json.ppfi4;
            	var ppfi5=json.ppfi5;
            	var ppfi6=json.ppfi6;
            	var ppcj=json.ppcj; */
            	var accessory=json.accessory;
            	
            	$("#look_prj_name").html("");
				if(json.taskNo==""||json.taskNo==null){
					$("#look_prj_name").text(json.prjName);
				}else{
					var taskprjNoClick = '<a href="../chankanxiangqing/taskDetails.html?prjNo='
		    			+json.taskNo
		    			+'" target="_blank" style="color:blue;">'+json.prjName+'</a>';		
					$("#look_prj_name").append(taskprjNoClick);
				}
            	
            	//$("#look_prj_name").text(json.prjName);
            	$("#look_task_no").text(json.taskNo);
            	$("#look_prj_money").text(json.prjMoney);
            	$("#look_prj_type").text(json.prjType);
            	
            	if(cj!=null){
            		if(cj.contractNo==""||cj.contractNo==null){
            			$("#look_contract_name").text("");
                		$("#look_contract_no").text("")
    				}else{
    					var cjContractClick = '<a href="../chankanxiangqing/cjContractDetails.html?cjCNo='
    						+cj.contractNo
    						+'" target="_blank" style="color:blue;">'+cj.contractName+'</a>';
    						$("#look_contract_name").append(cjContractClick);
    						$("#look_contract_no").text(cj.contractNo)
    				}
            	}else{
            		$("#look_contract_name").text("");
            		$("#look_contract_no").text("")
            	}
            	
            	$("#look_contract_money").text(json.contractMoney);
            	$("#look_prj_leader").text(json.prjLeader);
            	$("#look_provisional_sum").text(json.provisionalSum);
            	$("#look_prj_start_time").text(json.prjStartTime);
            	$("#look_prj_end_time").text(json.prjEndTime);
            	$("#look_budget_money_all").text(json.budgetMoneyAll);
            	$("#look_this_time").text(json.thisTime);
            	$("#look_prj_mode").text(json.prjMode);
            	$("#look_all_money").text(json.allMoney);
            	$("#look_rate").text(json.rate);
            	$("#look_rate_money").text(json.rateMoney);
            	$("#look_thismonth_completecontent").text(json.thismonthCompletecontent==null?"":json.thismonthCompletecontent);
            	$("#look_nextmoney_plan").text(json.nextmoneyPlan==null?"":json.nextmoneyPlan)
            	
            	var type=json.prjType;
            	$("#span_button").html('');
            	if(type.indexOf("B")!=-1){
            		if(type.indexOf("B1")!=-1){
            		}else{
            			$("#span_button").append('<button type="button" data="'+type+'" data2="'+json.ygDesign+'" data3="'+json.fristDesign+'" data4="'+json.secondDesign+'" class="btn btn-primary" onclick="lookDesign(this)">查看</button>')
            		}
            	}
            	$("#look_contract_income").text(json.contractIncome);
            	$("#look_all_money_yuan").text(json.allMoneyYuan);
            	$("#look_in_come_yuan").text(json.prjThisIncomeYuan);
            	$("#look_accessory tbody").html('');
            	for(var i=0;i<accessory.length;i++){
            		$("#look_accessory tbody").append("<tr>"+
            									"<td>附件"+(i+1)+"</td>"+
            									"<td colspan='2'><a href='"+getLocalPath()+"/oa_file/"+accessory[i].acUrl+"' target='view_window' style='color:blue;'>"+accessory[i].acName+"</a></td>"+
            								"</tr>")
            	}
            	
            	$("#look_xieban tbody").html('');
            	if(ppfi!=null){
            		for(var i=0;i<ppfi.length;i++){
                		if(ppfi[i].main==1){
                			$("#look_xieban tbody").append("<tr>"+
    								"<td style='width:10%;'>主办部门</td>"+
    								"<td style='width:15%;'>"+ppfi[i].department+"</td>"+
    								"<td style='width:10%;'>本期收入(%)</td>"+
    								"<td style='width:15%;'>"+ppfi[i].money+"</td>"+
    								"<td style='width:10%;'>本期收入(元)</td>"+
    								"<td style='width:15%;'>"+ppfi[i].moneyYuan+"</td>"+
    								"<td style='width:10%;'>累计收入(元)</td>"+
    								"<td style='width:15%;'>"+ppfi[i].allMoneyYuan+"</td>"+
    							"</tr>")
                		}else{
                			$("#look_xieban tbody").append("<tr>"+
    								"<td>协办部门</td>"+
    								"<td>"+ppfi[i].department+"</td>"+
    								"<td>本期收入(%)</td>"+
    								"<td>"+ppfi[i].money+"</td>"+
    								"<td>本期收入(元)</td>"+
    								"<td>"+ppfi[i].moneyYuan+"</td>"+
    								"<td>累计收入(元)</td>"+
    								"<td>"+ppfi[i].allMoneyYuan+"</td>"+
    							"</tr>")
                		}
                	}
            	}
            	
            	 $.ajax({
     	        	type: 'POST',
     	            url: getContextPath()+'/flowHistory/getHistoryNowAndLastByModeId',
     	            data:{
     	            	id:data.ppfId
     	            },
     	            success: function (json) {
     	            	$("#d_table tbody").html('');
     	            	for(var i=0;i<json.length;i++){
     	            		var operatorType = json[i].operateType;
     	            		operatorType = getCnByOt(operatorType);
     	            		var date = json[i].doDate;
     	            		var title = json[i].title;
     	            		var name = json[i].actorname;
     	            		if(json[i].view==""||json[i].view==null){
    	            			view="无";
    	            		}
     	            		if(date == null){
     	            			date="";
     	            			if(json[i].operateType==8){
     	            				title="<lable style='color:red'>"+json[i].title+"</lable>";
     	            				name="<lable style='color:red'>"+json[i].actorname+"</lable>";
     	            				operatorType="<lable style='color:red'>"+operatorType+"</lable>";
     	            			}else{
     	            				title = json[i].title;
     	            				name = json[i].actorname;
     	            			}
     	            		}
     	                	$("#d_table tbody").append("<tr><td>"+title+"</td><td>"+name+"</td><td>"+view+"</td><td>"+operatorType+"</td><td>"+date+"</td></tr>");
     	            	}
     	            }
     	        });
            	
            	/* $("#look_xieban2 tbody").html('');
            	if(ppfi2!=null){
            		for(var i=0;i<ppfi2.length;i++){
                		if(ppfi2[i].main==1){
                			$("#look_xieban2 tbody").append("<tr>"+
    								"<td style='width:25%;'>主办部门</td>"+
    								"<td style='width:25%;'>"+ppfi2[i].department+"</td>"+
    								"<td style='width:25%;'>金额</td>"+
    								"<td style='width:25%;'>"+ppfi2[i].money+"</td>"+
    							"</tr>")
                		}else{
                			$("#look_xieban2 tbody").append("<tr>"+
    								"<td>协办部门</td>"+
    								"<td>"+ppfi2[i].department+"</td>"+
    								"<td>金额</td>"+
    								"<td>"+ppfi2[i].money+"</td>"+
    							"</tr>")
                		}
                	}
            	}
            	
            	
            	$("#look_xieban3 tbody").html('');
            	if(ppfi3!=null){
            		for(var i=0;i<ppfi3.length;i++){
                		if(ppfi3[i].main==1){
                			$("#look_xieban3 tbody").append("<tr>"+
    								"<td style='width:25%;'>主办部门</td>"+
    								"<td style='width:25%;'>"+ppfi3[i].department+"</td>"+
    								"<td style='width:25%;'>金额</td>"+
    								"<td style='width:25%;'>"+ppfi3[i].money+"</td>"+
    							"</tr>")
                		}else{
                			$("#look_xieban3 tbody").append("<tr>"+
    								"<td>协办部门</td>"+
    								"<td>"+ppfi3[i].department+"</td>"+
    								"<td>金额</td>"+
    								"<td>"+ppfi3[i].money+"</td>"+
    							"</tr>")
                		}
                	}
            	}
            	
            	
            	$("#look_xieban4 tbody").html('');
            	if(ppfi4!=null){
            		for(var i=0;i<ppfi4.length;i++){
                		if(ppfi4[i].main==1){
                			$("#look_xieban4 tbody").append("<tr>"+
    								"<td style='width:25%;'>主办部门</td>"+
    								"<td style='width:25%;'>"+ppfi4[i].department+"</td>"+
    								"<td style='width:25%;'>金额</td>"+
    								"<td style='width:25%;'>"+ppfi4[i].money+"</td>"+
    							"</tr>")
                		}else{
                			$("#look_xieban4 tbody").append("<tr>"+
    								"<td>协办部门</td>"+
    								"<td>"+ppfi4[i].department+"</td>"+
    								"<td>金额</td>"+
    								"<td>"+ppfi4[i].money+"</td>"+
    							"</tr>")
                		}
                	}
            	}
            	
            	
            	$("#look_xieban5 tbody").html('');
            	if(ppfi5!=null){
            		for(var i=0;i<ppfi5.length;i++){
                		if(ppfi5[i].main==1){
                			$("#look_xieban5 tbody").append("<tr>"+
    								"<td style='width:25%;'>主办部门</td>"+
    								"<td style='width:25%;'>"+ppfi5[i].department+"</td>"+
    								"<td style='width:25%;'>金额</td>"+
    								"<td style='width:25%;'>"+ppfi5[i].money+"</td>"+
    							"</tr>")
                		}else{
                			$("#look_xieban5 tbody").append("<tr>"+
    								"<td>协办部门</td>"+
    								"<td>"+ppfi5[i].department+"</td>"+
    								"<td>金额</td>"+
    								"<td>"+ppfi5[i].money+"</td>"+
    							"</tr>")
                		}
                	}
            	}
            	
            	
            	$("#look_xieban6 tbody").html('');
            	if(ppfi6!=null){
            		for(var i=0;i<ppfi6.length;i++){
                		if(ppfi6[i].main==1){
                			$("#look_xieban6 tbody").append("<tr>"+
    								"<td style='width:25%;'>主办部门</td>"+
    								"<td style='width:25%;'>"+ppfi6[i].department+"</td>"+
    								"<td style='width:25%;'>金额</td>"+
    								"<td style='width:25%;'>"+ppfi6[i].money+"</td>"+
    							"</tr>")
                		}else{
                			$("#look_xieban6 tbody").append("<tr>"+
    								"<td>协办部门</td>"+
    								"<td>"+ppfi6[i].department+"</td>"+
    								"<td>金额</td>"+
    								"<td>"+ppfi6[i].money+"</td>"+
    							"</tr>")
                		}
                	}
            	} */
            	
            	$("#look_fb tbody").html('');
            	$("#look_fb_ys tbody").html('');
            	if(ppfb!=null){
            		for(var i=0;i<ppfb.length;i++){
            			if(ppfb[i].fbName!=""&&ppfb[i].fbName!=null){
            				var ppfbIncomeAllBili =ppfb[i].incomeAll*100/ppfb[i].fbMoney;
            				$("#look_fb tbody").append("<tr>"+
									"<td>"+
									'<a href="../chankanxiangqing/fbContractDetails.html?fbNo='
									+ppfb[i].fbId
									+'" target="_blank" style="color:blue;">'+ppfb[i].fbName+'</a>'
									+"</td>"+
									"<td>"+ppfb[i].department+"</td>"+
									"<td>"+ppfb[i].fbMoney+"</td>"+
									"<td>"+ppfb[i].fbUnit+"</td>"+
									"<td>"+ppfbIncomeAllBili.toFixed(2)+"</td>"+
									"<td>"+ppfb[i].incomeAll+"</td>"+
									"<td>"+ppfb[i].incomeBq+"</td>"+
									"<td>"+ppfb[i].rate+"</td>"+
									"<td>"+ppfb[i].rateMoney+"</td>"+
								"</tr>")
							$("#look_fb").show();
                        	$("#look_fb_ys").hide();
            			}else{
            				$("#look_fb_ys tbody").append("<tr>"+
            																			"<td>"+ppfb[i].department+"</td>"+
            																			"<td>"+ppfb[i].incomeBq+"</td>"+
            																	 +"</tr>")
            				$("#look_fb").hide();
                        	$("#look_fb_ys").show();
            			}
                		
                	}
            	}
            	
            	/* $("#look_cj tbody").html('');
            	if(ppcj!=null){
            		for(var i=0;i<ppcj.length;i++){
                		$("#look_cj tbody").append("<tr>"+
                														"<td>"+ppcj[i].cjName+"</td>"+
                														"<td>"+ppcj[i].contractMoney+"</td>"+
                														"<td>"+ppcj[i].temporaryMoney+"</td>"+
                														"<td>"+ppcj[i].incomeBq+"</td>"+
                														"<td>"+ppcj[i].incomeAll+"</td>"+
                													"</tr>")
                	}
            	} */
            	
            	myTool.mask.hide();
            	$("#allMsg1").modal("show");
            }
    	})
    	
    }
    
    function getCnByOt(s){
  	  if(s==1){
  		  return "提交";
  	  }else if(s==2){
  		  return "退回";
  	  }else if(s==3){
  		  return "撤销";
  	  }else if(s==0){
  		  return "驳回";
  	  }else if(s==8){
  		  return "待审批";
  	  }
    }
    
    function downloadFile(obj){
		var filePath=$(obj).attr("data");
		var fileName=$(obj).parents("tr").find("td").eq(1).text();
		window.location.href=encodeURI(getContextPath()+"/FileDownLoad?fileName="+fileName+"&filePath="+filePath);
	}
    
    function getBq(obj){
    	var zb=$(obj).parents('tr').find("input").eq(0).val();
    	 if(zb.indexOf("%")==-1){
      	   $(obj).parent().find("input").eq(0).val(zb+"%");
         }
    	var department=$(obj).parent().parent().find("td").eq(1).text();
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/ppf/getBq',
            dataType: 'json',
            data: {
            	all:zb,
            	no:$("#task_no").val(),
            	department:department
            },
            success: function (json) {
               var bq=json.bq;
               $("#zb2").val(bq);
            }
        });
    }
    function getBq1(obj){
    	var zb=$(obj).parent().find("input").eq(0).val();
    	 if(zb.indexOf("%")==-1){
        	   $(obj).parent().find("input").eq(0).val(zb+"%");
         }
    	var department=$(obj).parent().parent().find("td").eq(1).text();
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/ppf/getBq',
            dataType: 'json',
            data: {
            	all:zb,
            	no:$("#task_no").val(),
            	department:department
            },
            success: function (json) {
               var bq=json.bq;
               $("#xb1_1").val(bq);
            }
        });
    }
    function getBq2(obj){
    	var zb=$(obj).parent().find("input").eq(0).val();
    	 if(zb.indexOf("%")==-1){
        	   $(obj).parent().find("input").eq(0).val(zb+"%");
        }
    	var department=$(obj).parent().parent().find("td").eq(1).text();
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/ppf/getBq',
            dataType: 'json',
            data: {
            	all:zb,
            	no:$("#task_no").val(),
            	department:department
            },
            success: function (json) {
               var bq=json.bq;
               $("#xb2_2").val(bq);
            }
        });
    }
    function getBq3(obj){
    	var zb=$(obj).parent().find("input").eq(0).val();
    	 if(zb.indexOf("%")==-1){
        	   $(obj).parent().find("input").eq(0).val(zb+"%");
        }
    	var department=$(obj).parent().parent().find("td").eq(1).text();
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/ppf/getBq',
            dataType: 'json',
            data: {
            	all:zb,
            	no:$("#task_no").val(),
            	department:department
            },
            success: function (json) {
               var bq=json.bq;
               $("#xb3_3").val(bq);
            }
        });
    }
    
    function cjBq(obj){
    	var zb=$(obj).parent().parent().find("input").eq(1).val();
    	if(zb.indexOf("%")==-1){
    		$(obj).parent().parent().find("input").eq(1).val(zb+"%");
        }
    	var id=$(obj).parent().parent().find("input").eq(1).attr("data");
    	$.ajax({
            type: 'POST',
            url: getContextPath()+'/ppf/cjBq',
            dataType: 'json',
            data: {
            	all:zb,
            	no:$("#task_no").val(),
            	id:id
            },
            success: function (json) {
               var bq=json.bq;
               $(obj).parent().parent().find("input").eq(0).val(bq);
            }
        });
    }
    
    function gotoPrj(obj){
    	dom=$(obj).parents("tr");
		var data=$('#mainContent').DataTable().row(dom).data();
		//console.log(data);
		//var t = encodeURI(encodeURI(data.prjId));
		$.ajax({
			type:"POST",
			url:getContextPath()+"/task/selectIdByNameAndNo",
			dataType:"json",
			async:false,
			data:{ 
				name:data.prjName,
				no:data.taskNo
				},
			success:function(json){
				$(obj).attr('href', '../shengchanGuanli/TaskManagement.html?prjId='+json.prjId+'&prjNo='+data.taskNo+'');
			}
		}) 
    }
    
    function showNow(){
    	myTool.mask.show('查询中...');
    	$.ajax({
			type:"POST",
			url:getContextPath()+"/ppf/selectNewest",
			dataType:"json",
			data:{ 
				
			},
			success:function(json){
				myTool.mask.hide();
				$('#mainContent').dataTable().fnClearTable();
                $('#mainContent').DataTable().rows.add(json).draw(false);
			}
		}) 
    }
    
    function lookDesign(obj){
    	$('#look_design').on('hidden.bs.modal', function () {//解决模态框页面滚动问题
            if ($('.modal.in').size() >= 1) {
                $('body').addClass('modal-open')
            }
        })
    	
    	var type=$(obj).attr("data");
    	var yg=$(obj).attr("data2");
    	var chubu=$(obj).attr("data3");
    	var shigongtu=$(obj).attr("data4");
    	if(type.indexOf("B2")!=-1){
    		$("#chubu_tr").show();
    		$("#chubu_td").text(chubu);
    		$("#shigongtu_tr").show();
    		$("#shigongtu_td").text(shigongtu);
    	}
		if(type.indexOf("B3")!=-1){
			$("#yugongke_tr").show();
			$("#yugongke_td").text(yg);
			$("#chubu_tr").show();
    		$("#chubu_td").text(chubu);
    		$("#shigongtu_tr").show();
    		$("#shigongtu_td").text(shigongtu);
    	}
		if(type.indexOf("B4")!=-1){
			$("#yugongke_tr").show();
			$("#yugongke_td").text(yg);
    		$("#shigongtu_tr").show();
    		$("#shigongtu_td").text(shigongtu);
    	}
    	$("#look_design").modal("show");
    }
    
    function checkZs(obj){
    	var reg=/^([1-9]\d?|100)$/;
    	if(!reg.test($(obj).val())){
    		toastr.error('请填写0-100整数');
    		$(obj).val('0');
    		return;
    	}
    }
    
    $("#b1_shigongsheji").on("change",function(){
    	var aa=$(this).val();
    	$("#b1_span1_1").val(aa);
    })
    
    $("#firstsheji").on("change",function(){
    	var aa=$(this).val();
    	$("#b2_span1_1").val(aa);
    })
    $("#shigongsheji").on("change",function(){
    	var aa=$(this).val();
    	$("#b2_span2_1").val(aa);
    })
    $("#b3_yugong_sheji").on("change",function(){
    	var aa=$(this).val();
    	$("#b3_span1_1").val(aa);
    })
    $("#b3_firstsheji").on("change",function(){
    	var aa=$(this).val();
    	$("#b3_span2_1").val(aa);
    })
    $("#b3_shigongsheji").on("change",function(){
    	var aa=$(this).val();
    	$("#b3_span3_1").val(aa);
    })
    $("#b4_yugong_sheji").on("change",function(){
    	var aa=$(this).val();
    	$("#b4_span1_1").val(aa);
    })
    $("#b4_shigongsheji").on("change",function(){
    	var aa=$(this).val();
    	$("#b4_span2_1").val(aa);
    })
    
    function getLocalPath(){
		var pathArray = window.location.pathname.split('/');
		var secondLevelLocation = pathArray[1];
		var loginUrl = window.location.protocol + "//"  + window.location.host ;
		return loginUrl;
	}
    
    function getRateMoney(obj){
    	var rate=$(obj).val();
    	var all_money_yuan=$("#all_money_yuan").val();
    	if(all_money_yuan==''||all_money_yuan==null){
    		toastr.error('累计收入为空');
    		$(obj).val('');
    		return;
    	}
    	var reg=/^([1-9]\d?|100)$/;
    	if(!reg.test(rate)){
    		toastr.error('请填写1-100');
    		$(obj).val('');
    		return;
    	}
    	var sum=(rate*all_money_yuan/100).toFixed(2);
    	$("#new_rate_money").val(sum);
    }
    
    function getRate(obj){
    	var rate=$(obj).val();
    	var money=$(obj).parents("tr").find("input").eq(1).val();
    	if(money==''||money==null){
    		toastr.error('累计收入为空');
    		$(obj).val('');
    		return;
    	}
    	var reg=/^([1-9]\d?|100)$/;
    	if(!reg.test(rate)){
    		toastr.error('请填写1-100');
    		$(obj).val('');
    		return;
    	}
    	var sum=(rate*money/100).toFixed(2);
    	$(obj).parents("tr").find("input").eq(4).val(sum);
    }
    
 // 两个浮点数相减
    function accSub(num1,num2){
       var r1,r2,m;
       try{
           r1 = num1.toString().split('.')[1].length;
       }catch(e){
           r1 = 0;
       }
       try{
           r2=num2.toString().split(".")[1].length;
       }catch(e){
           r2=0;
       }
       m=Math.pow(10,Math.max(r1,r2));
       n=(r1>=r2)?r1:r2;
       return (Math.round(num1*m-num2*m)/m).toFixed(n);
    }
 
 
 
	function shouhui(obj){
		var tr=$(obj).parents("tr");
		var data=$("#mainContent").DataTable().row(tr).data();
		var tr2 = $(obj).closest('tr');
		$.SmartMessageBox({
            title: "收回提示",
            content: "确认收回？",
            buttons: '[取消][确定]'
        }, function (ButtonPressed) {
        	if (ButtonPressed === "确定") {
        			myTool.mask.show('收回中...');
	        		$.ajax({
	            		type:"post",
	            		url:getContextPath()+"/ppf/updateBackState",
	            		dataType: 'json',
	            		data:{
	            			backState:1,
    		    			id:data.ppfId,
	            		},
	            		success:function(json){
	            			myTool.mask.hide();
	            			if(json>0){
	            				toastr.success("收回成功")
	            				data.backState=1;
	            				$('#mainContent').DataTable().row(tr2).data(data);//修改行立即显示
	            				$(".Peeb").show();
	            				$(".Peec").show();
	            			}else{
	            				toastr.error("收回失败")
	            			}
	            		}
	            	});
        }
    });
	} 
 
</script>
</html>